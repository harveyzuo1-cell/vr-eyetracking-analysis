# Module 00 å¼€å‘è¿›åº¦æŠ¥å‘Š

## ğŸ“… æœ€åæ›´æ–°
**æ—¥æœŸ**: 2025-10-01
**çŠ¶æ€**: åç«¯å®Œæˆï¼Œå‰ç«¯å¾…å¼€å‘
**å®Œæˆåº¦**: 50%

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åç«¯APIå¼€å‘ (100%)

#### ç›®å½•ç»“æ„
```
new_project/
â”œâ”€â”€ src/web/modules/module00_data_management/
â”‚   â”œâ”€â”€ __init__.py          # æ¨¡å—åˆå§‹åŒ–
â”‚   â”œâ”€â”€ api.py               # APIè·¯ç”± (7ä¸ªç«¯ç‚¹)
â”‚   â”œâ”€â”€ service.py           # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â””â”€â”€ validator.py         # æ•°æ®éªŒè¯å™¨
â””â”€â”€ data/
    â”œâ”€â”€ uploads/             # ä¸´æ—¶ä¸Šä¼ ç›®å½•
    â””â”€â”€ 01_raw/              # åŸå§‹æ•°æ®ç›®å½•
        â”œâ”€â”€ control/
        â”œâ”€â”€ mci/
        â””â”€â”€ ad/
```

#### APIç«¯ç‚¹æ¸…å•

| æ–¹æ³• | ç«¯ç‚¹ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| POST | `/api/m00/upload` | æ–‡ä»¶ä¸Šä¼  | âœ… å®Œæˆ |
| GET | `/api/m00/files` | æ–‡ä»¶åˆ—è¡¨ | âœ… å®Œæˆ |
| POST | `/api/m00/save` | ä¿å­˜åˆ°01_raw | âœ… å®Œæˆ |
| DELETE | `/api/m00/delete/<filename>` | åˆ é™¤æ–‡ä»¶ | âœ… å®Œæˆ |
| GET | `/api/m00/preview/<filename>` | é¢„è§ˆæ–‡ä»¶ | âœ… å®Œæˆ |
| GET | `/api/m00/validate/<filename>` | éªŒè¯æ•°æ® | âœ… å®Œæˆ |

#### æ ¸å¿ƒåŠŸèƒ½å®ç°

**DataValidator (validator.py)**:
- âœ… æ–‡ä»¶æ ¼å¼éªŒè¯ (.csv, .txt)
- âœ… DataFrameæ•°æ®è´¨é‡æ£€æŸ¥
- âœ… å¿…éœ€åˆ—éªŒè¯ (x, y, time)
- âœ… ç¼ºå¤±å€¼æ£€æµ‹
- âœ… åæ ‡èŒƒå›´æ£€æŸ¥
- âœ… æ—¶é—´åºåˆ—éªŒè¯
- âœ… é‡‡æ ·ç‡è®¡ç®—
- âœ… å¼‚å¸¸å€¼æ£€æµ‹ (IQRå’Œ3Ïƒæ–¹æ³•)
- âœ… æ•°æ®è´¨é‡è¯„åˆ† (0-100)
- âœ… ç»Ÿè®¡ä¿¡æ¯åˆ†æ

**DataManagementService (service.py)**:
- âœ… æ–‡ä»¶ä¸Šä¼ å¤„ç†
- âœ… å®‰å…¨æ–‡ä»¶åç”Ÿæˆ
- âœ… CSV/TXTè‡ªåŠ¨è§£æ
- âœ… æ•°æ®éªŒè¯é›†æˆ
- âœ… æ–‡ä»¶åˆ—è¡¨ç®¡ç†
- âœ… ä¿å­˜åˆ°01_rawç›®å½•
- âœ… æ–‡ä»¶å‘½åè§„èŒƒ: `{group}_{subject_id}_{task_id}.csv`
- âœ… å…ƒæ•°æ®JSONä¿å­˜
- âœ… æ–‡ä»¶å¤‡ä»½åŠŸèƒ½
- âœ… æ–‡ä»¶åˆ é™¤ç®¡ç†
- âœ… æ•°æ®é¢„è§ˆåŠŸèƒ½

#### æ•°æ®éªŒè¯è§„åˆ™

**è´¨é‡è¯„åˆ†ç®—æ³•**:
- åŸºç¡€åˆ†: 100åˆ†
- ç¼ºå°‘å¿…éœ€åˆ—: -50åˆ†
- æ•°æ®ç‚¹è¿‡å°‘(<100): -10åˆ†
- ç¼ºå¤±å€¼: -20åˆ† (æœ€å¤š)
- Xåæ ‡è¶…å‡ºèŒƒå›´: -10åˆ†
- Yåæ ‡è¶…å‡ºèŒƒå›´: -10åˆ†
- æ—¶é—´ä¸å•è°ƒ: -15åˆ†
- é‡‡æ ·ç‡å¼‚å¸¸: -5åˆ†
- å¼‚å¸¸å€¼è¿‡å¤š(>5%): -10åˆ† (æœ€å¤š)

**è‡ªåŠ¨æ£€æµ‹é¡¹**:
- âœ… åˆ—åå®Œæ•´æ€§
- âœ… æ•°æ®ç‚¹æ•°é‡
- âœ… ç¼ºå¤±å€¼æ¯”ä¾‹
- âœ… åæ ‡æœ‰æ•ˆæ€§ ([0,1]èŒƒå›´)
- âœ… æ—¶é—´å•è°ƒæ€§
- âœ… é‡‡æ ·ç‡åˆç†æ€§ (30-250Hz)
- âœ… å¼‚å¸¸å€¼æ¯”ä¾‹

#### è·¯ç”±æ³¨å†Œ

å·²åœ¨ `src/web/routes.py` ä¸­æ³¨å†Œ:
```python
from src.web.modules.module00_data_management.api import m00_bp
app.register_blueprint(m00_bp)
```

#### æœåŠ¡å™¨çŠ¶æ€

- âœ… åç«¯æœåŠ¡å™¨è¿è¡Œæ­£å¸¸
- âœ… ç«¯å£: http://127.0.0.1:9090
- âœ… Module00 APIå·²åŠ è½½
- âœ… å¯é€šè¿‡APIæµ‹è¯•å·¥å…·éªŒè¯

---

## ğŸš§ å¾…å®Œæˆçš„å·¥ä½œ

### 2. å‰ç«¯å¼€å‘ (0%)

#### éœ€è¦åˆ›å»ºçš„ç»„ä»¶

**FileUploader.jsx** (æ–‡ä»¶ä¸Šä¼ ç»„ä»¶):
```jsx
åŠŸèƒ½éœ€æ±‚:
- Ant Design Upload.Draggeræ‹–æ‹½ä¸Šä¼ 
- æ”¯æŒå¤šæ–‡ä»¶åŒæ—¶ä¸Šä¼ 
- å®æ—¶ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
- æ–‡ä»¶æ ¼å¼éªŒè¯
- ä¸Šä¼ æˆåŠŸ/å¤±è´¥æç¤º
- ä¸Šä¼ åˆ—è¡¨ç®¡ç†
```

**DataPreview.jsx** (æ•°æ®é¢„è§ˆç»„ä»¶):
```jsx
åŠŸèƒ½éœ€æ±‚:
- Ant Design Tableå±•ç¤ºæ•°æ®
- æ˜¾ç¤ºå‰100è¡Œæ•°æ®
- ç»Ÿè®¡å¡ç‰‡ (æ•°æ®ç‚¹æ•°ã€æ—¶é•¿ã€è´¨é‡åˆ†æ•°)
- éªŒè¯ç»“æœå±•ç¤º (é”™è¯¯ã€è­¦å‘Š)
- æ•°æ®è´¨é‡æ ‡ç­¾ (ä¼˜ç§€/è‰¯å¥½/ä¸€èˆ¬/å·®)
- åˆ†é¡µåŠŸèƒ½
```

**MetadataEditor.jsx** (å…ƒæ•°æ®ç¼–è¾‘ç»„ä»¶):
```jsx
åŠŸèƒ½éœ€æ±‚:
- Ant Design Formè¡¨å•
- ç»„åˆ«é€‰æ‹© (Control/MCI/AD)
- å—è¯•è€…IDè¾“å…¥ (å¸¦éªŒè¯)
- ä»»åŠ¡IDé€‰æ‹© (Q1-Q5)
- å¤‡æ³¨æ–‡æœ¬æ¡†
- è¡¨å•éªŒè¯è§„åˆ™
```

**Module00.jsx** (ä¸»é¡µé¢):
```jsx
åŠŸèƒ½éœ€æ±‚:
- Ant Design Stepsæ­¥éª¤æ¡
- å››æ­¥æµç¨‹:
  1. ä¸Šä¼ æ–‡ä»¶
  2. æ•°æ®é¢„è§ˆ
  3. å…ƒæ•°æ®ç¼–è¾‘
  4. ä¿å­˜ç¡®è®¤
- æ­¥éª¤é—´å¯¼èˆª
- çŠ¶æ€ç®¡ç† (useState)
- APIè°ƒç”¨é›†æˆ
- é”™è¯¯å¤„ç†
```

#### éœ€è¦çš„æœåŠ¡å±‚

**dataManagementService.js**:
```javascript
åŠŸèƒ½:
- uploadFile(file) - ä¸Šä¼ æ–‡ä»¶
- getFiles() - è·å–æ–‡ä»¶åˆ—è¡¨
- saveToRaw(data) - ä¿å­˜åˆ°01_raw
- deleteFile(filename) - åˆ é™¤æ–‡ä»¶
- previewFile(filename) - é¢„è§ˆæ–‡ä»¶
- validateFile(filename) - éªŒè¯æ–‡ä»¶
```

#### éœ€è¦çš„è·¯ç”±é…ç½®

åœ¨ `frontend/src/App.jsx` æ·»åŠ :
```jsx
<Route path="/module00" element={<Module00 />} />
```

åœ¨ `frontend/src/layouts/MainLayout.jsx` æ·»åŠ èœå•é¡¹:
```jsx
{
  key: 'module00',
  icon: <UploadOutlined />,
  label: <Link to="/module00">æ•°æ®ç®¡ç†</Link>
}
```

---

## ğŸ“‹ ä¸‹æ¬¡å¯¹è¯TODOæ¸…å•

### ä¼˜å…ˆçº§P0 (å¿…é¡»å®Œæˆ)

1. âœ… åˆ›å»º `frontend/src/components/Upload/FileUploader.jsx`
2. âœ… åˆ›å»º `frontend/src/components/Upload/DataPreview.jsx`
3. âœ… åˆ›å»º `frontend/src/components/Upload/MetadataEditor.jsx`
4. âœ… åˆ›å»º `frontend/src/services/dataManagementService.js`
5. âœ… åˆ›å»º `frontend/src/pages/Module00/Module00.jsx`
6. âœ… æ·»åŠ è·¯ç”±åˆ° `App.jsx`
7. âœ… æ·»åŠ èœå•é¡¹åˆ° `MainLayout.jsx`

### ä¼˜å…ˆçº§P1 (é‡è¦)

8. â¬œ æµ‹è¯•å®Œæ•´ä¸Šä¼ æµç¨‹
9. â¬œ æµ‹è¯•æ–‡ä»¶éªŒè¯åŠŸèƒ½
10. â¬œ æµ‹è¯•ä¿å­˜åˆ°01_rawåŠŸèƒ½
11. â¬œ é”™è¯¯å¤„ç†ä¼˜åŒ–
12. â¬œ ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### ä¼˜å…ˆçº§P2 (å¯é€‰)

13. â¬œ æ·»åŠ æ–‡ä»¶é¢„è§ˆåŠŸèƒ½
14. â¬œ æ·»åŠ æ‰¹é‡ä¸Šä¼ åŠŸèƒ½
15. â¬œ æ·»åŠ ä¸Šä¼ å†å²è®°å½•
16. â¬œ æ·»åŠ æ•°æ®å¯è§†åŒ–é¢„è§ˆ

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### APIè°ƒç”¨ç¤ºä¾‹

**ä¸Šä¼ æ–‡ä»¶**:
```javascript
const formData = new FormData();
formData.append('file', file);

const response = await axios.post('/api/m00/upload', formData, {
  headers: { 'Content-Type': 'multipart/form-data' },
  onUploadProgress: (progressEvent) => {
    const percent = (progressEvent.loaded / progressEvent.total) * 100;
    setProgress(percent);
  }
});

// Response:
{
  "success": true,
  "filename": "20251001_224325_data.csv",
  "original_filename": "data.csv",
  "upload_time": "20251001_224325",
  "validation": {
    "valid": true,
    "errors": [],
    "warnings": ["æ•°æ®ç‚¹æ•°é‡è¿‡å°‘: 95"],
    "quality_score": 90.0
  },
  "stats": {
    "total_points": 95,
    "duration": 1583.33,
    "sample_rate": 60.0,
    "x_range": [0.1, 0.9],
    "y_range": [0.2, 0.8],
    "missing_values": 0
  },
  "preview": [...]
}
```

**ä¿å­˜æ–‡ä»¶**:
```javascript
const response = await axios.post('/api/m00/save', {
  filename: "20251001_224325_data.csv",
  group: "control",
  subject_id: "s001",
  task_id: "q1",
  notes: "æµ‹è¯•æ•°æ®"
});

// Response:
{
  "success": true,
  "target_path": "data/01_raw/control/control_s001_q1.csv",
  "target_filename": "control_s001_q1.csv",
  "message": "æ–‡ä»¶å·²æˆåŠŸä¿å­˜åˆ°01_rawç›®å½•"
}
```

### å‰ç«¯çŠ¶æ€ç®¡ç†

ä½¿ç”¨React Hooks:
```javascript
const [currentStep, setCurrentStep] = useState(0);
const [uploadedFile, setUploadedFile] = useState(null);
const [fileData, setFileData] = useState(null);
const [metadata, setMetadata] = useState({
  group: '',
  subject_id: '',
  task_id: '',
  notes: ''
});
const [loading, setLoading] = useState(false);
```

### æ•°æ®æµç¨‹å›¾

```
ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
    â†“
FileUploaderç»„ä»¶
    â†“
POST /api/m00/upload
    â†“
Service.upload_file()
    â†“
Validator.validate_dataframe()
    â†“
è¿”å›éªŒè¯ç»“æœå’Œç»Ÿè®¡
    â†“
DataPreviewç»„ä»¶å±•ç¤º
    â†“
ç”¨æˆ·ç¼–è¾‘å…ƒæ•°æ®
    â†“
MetadataEditorç»„ä»¶
    â†“
POST /api/m00/save
    â†“
Service.save_to_raw_directory()
    â†“
æ–‡ä»¶ä¿å­˜åˆ° data/01_raw/{group}/{group}_{subject_id}_{task_id}.csv
    â†“
å®Œæˆï¼
```

---

## ğŸ“Š è¿›åº¦ç»Ÿè®¡

| ä»»åŠ¡ | å®Œæˆåº¦ | å·¥æ—¶ | çŠ¶æ€ |
|------|--------|------|------|
| åç«¯ç›®å½•ç»“æ„ | 100% | 0.5h | âœ… |
| APIè·¯ç”±å¼€å‘ | 100% | 2h | âœ… |
| æ•°æ®éªŒè¯å™¨ | 100% | 2h | âœ… |
| ä¸šåŠ¡é€»è¾‘æœåŠ¡ | 100% | 3h | âœ… |
| è·¯ç”±æ³¨å†Œ | 100% | 0.5h | âœ… |
| **åç«¯å°è®¡** | **100%** | **8h** | âœ… |
| FileUploaderç»„ä»¶ | 0% | - | â¬œ |
| DataPreviewç»„ä»¶ | 0% | - | â¬œ |
| MetadataEditorç»„ä»¶ | 0% | - | â¬œ |
| Module00ä¸»é¡µé¢ | 0% | - | â¬œ |
| æœåŠ¡å±‚ | 0% | - | â¬œ |
| è·¯ç”±é…ç½® | 0% | - | â¬œ |
| **å‰ç«¯å°è®¡** | **0%** | **0/8h** | â¬œ |
| **æ€»è®¡** | **50%** | **8/16h** | ğŸš§ |

---

## ğŸ¯ éªŒæ”¶æ ‡å‡†

### åç«¯éªŒæ”¶ (å·²å®Œæˆ âœ…)
- âœ… æ‰€æœ‰APIç«¯ç‚¹æ­£å¸¸å“åº”
- âœ… æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- âœ… æ•°æ®éªŒè¯å‡†ç¡®
- âœ… æ–‡ä»¶ä¿å­˜åˆ°æ­£ç¡®ç›®å½•
- âœ… é”™è¯¯å¤„ç†å®Œå–„
- âœ… æ—¥å¿—è®°å½•å®Œæ•´

### å‰ç«¯éªŒæ”¶ (å¾…å®Œæˆ â¬œ)
- â¬œ å¯ä»¥æ‹–æ‹½ä¸Šä¼ æ–‡ä»¶
- â¬œ ä¸Šä¼ è¿›åº¦æ­£å¸¸æ˜¾ç¤º
- â¬œ æ•°æ®é¢„è§ˆè¡¨æ ¼æ­£å¸¸
- â¬œ éªŒè¯ç»“æœæ¸…æ™°å±•ç¤º
- â¬œ å…ƒæ•°æ®ç¼–è¾‘è¡¨å•æ­£å¸¸
- â¬œ ä¿å­˜åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- â¬œ é”™è¯¯æç¤ºå‹å¥½
- â¬œ æ•´ä½“æµç¨‹é¡ºç•…

---

## ğŸ“ å¤‡æ³¨

### åç«¯å·²è§£å†³çš„é—®é¢˜

1. **é…ç½®æ–‡ä»¶ä¾èµ–é—®é¢˜**:
   - é—®é¢˜: `ModuleNotFoundError: No module named 'src.core.config'`
   - è§£å†³: ä½¿ç”¨`Path(__file__).parent`åŠ¨æ€è·å–é¡¹ç›®æ ¹ç›®å½•

2. **æ–‡ä»¶è·¯å¾„é—®é¢˜**:
   - ä½¿ç”¨`pathlib.Path`ç»Ÿä¸€å¤„ç†è·¯å¾„
   - ç¡®ä¿Windowså’ŒLinuxå…¼å®¹æ€§

3. **CSVç¼–ç é—®é¢˜**:
   - æ·»åŠ `encoding='utf-8'`å‚æ•°
   - æ”¯æŒä¸­æ–‡æ–‡ä»¶åå’Œå†…å®¹

### å‰ç«¯å¼€å‘å»ºè®®

1. **ä½¿ç”¨Ant Design Uploadç»„ä»¶**:
   - å†…ç½®æ‹–æ‹½åŠŸèƒ½
   - è¿›åº¦æ¡æ”¯æŒ
   - æ–‡ä»¶åˆ—è¡¨ç®¡ç†

2. **é”™è¯¯å¤„ç†**:
   - ä½¿ç”¨message.error()æ˜¾ç¤ºé”™è¯¯
   - ç½‘ç»œé”™è¯¯ç»Ÿä¸€å¤„ç†
   - è¡¨å•éªŒè¯æç¤º

3. **ç”¨æˆ·ä½“éªŒ**:
   - æ·»åŠ loadingçŠ¶æ€
   - æˆåŠŸæç¤º
   - æ­¥éª¤å¼•å¯¼

---

## ğŸš€ ä¸‹æ¬¡å¯åŠ¨æ£€æŸ¥æ¸…å•

å¯åŠ¨å‰æ£€æŸ¥:
- âœ… åç«¯æœåŠ¡å™¨è¿è¡Œ: `python run.py`
- âœ… å‰ç«¯æœåŠ¡å™¨è¿è¡Œ: `cd frontend && npm run dev`
- âœ… åç«¯ç«¯å£: http://127.0.0.1:9090
- âœ… å‰ç«¯ç«¯å£: http://localhost:5173
- âœ… Module00 APIå·²æ³¨å†Œ

æµ‹è¯•API:
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://127.0.0.1:9090/api/health

# æµ‹è¯•æ–‡ä»¶åˆ—è¡¨
curl http://127.0.0.1:9090/api/m00/files
```

---

**æ–‡æ¡£ç¼–åˆ¶**: Claude AI
**ç‰ˆæœ¬**: v1.0
**ä¸‹æ¬¡æ›´æ–°**: å‰ç«¯å¼€å‘å®Œæˆå

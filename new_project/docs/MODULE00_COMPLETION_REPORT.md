# Module 00: æ•°æ®ç®¡ç†ä¸­å¿ƒ - å®ŒæˆæŠ¥å‘Š

**å®Œæˆæ—¥æœŸ**: 2025-10-02
**ç‰ˆæœ¬**: v2.0
**çŠ¶æ€**: âœ… å¼€å‘å®Œæˆ

---

## ğŸ“Š å¼€å‘æˆæœæ€»ç»“

### å·²å®Œæˆæ–‡ä»¶æ¸…å•

#### **åç«¯æ ¸å¿ƒæ–‡ä»¶** (9ä¸ªæ–‡ä»¶, ~2,025è¡Œ)

| # | æ–‡ä»¶è·¯å¾„ | è¡Œæ•° | çŠ¶æ€ | æ¶æ„ç¬¦åˆæ€§ |
|---|----------|------|------|-----------|
| 1 | `src/web/modules/module00_data_management/converter.py` | 257 | âœ… | âœ… |
| 2 | `src/web/modules/module00_data_management/metadata_manager.py` | 323 | âœ… | âœ… |
| 3 | `src/web/modules/module00_data_management/importers/legacy_importer.py` | 321 | âœ… | âœ… |
| 4 | `src/web/modules/module00_data_management/importers/eye_tracking_importer.py` | 380 | âœ… | âœ… |
| 5 | `src/web/modules/module00_data_management/validator.py` | 198 | âœ… | âœ… |
| 6 | `src/web/modules/module00_data_management/service.py` | 314 | âœ… | âœ… |
| 7 | `src/web/modules/module00_data_management/api.py` | 227 | âœ… | âœ… |
| 8 | `src/web/modules/module00_data_management/__init__.py` | 15 | âœ… | âœ… |
| 9 | `src/web/modules/module00_data_management/importers/__init__.py` | 1 | âœ… | âœ… |

**åç«¯ä»£ç æ€»è®¡**: ~2,036è¡Œ

---

#### **é…ç½®æ–‡ä»¶** (2ä¸ªæ–‡ä»¶)

| # | æ–‡ä»¶è·¯å¾„ | çŠ¶æ€ | æ¶æ„ç¬¦åˆæ€§ |
|---|----------|------|-----------|
| 1 | `config/roi_v1.json` | âœ… | âœ… |
| 2 | `config/roi_v2.json` | âœ… | âœ… |

---

#### **æ–‡æ¡£æ–‡ä»¶** (3ä¸ªæ–‡ä»¶)

| # | æ–‡ä»¶è·¯å¾„ | çŠ¶æ€ |
|---|----------|------|
| 1 | `docs/MODULE00_DEVELOPMENT_PLAN.md` | âœ… |
| 2 | `docs/MODULE01_DEVELOPMENT_PLAN.md` | âœ… |
| 3 | `docs/MODULE00_COMPLETION_REPORT.md` | âœ… |

---

## âœ… æ¶æ„éªŒè¯

### 1. æ–‡ä»¶å‘½åè§„èŒƒ âœ…

æ‰€æœ‰æ–‡ä»¶å‘½åç¬¦åˆPythonè§„èŒƒ:
- âœ… å°å†™+ä¸‹åˆ’çº¿å‘½å: `converter.py`, `metadata_manager.py`
- âœ… åŒ…ç»“æ„æ¸…æ™°: `importers/legacy_importer.py`
- âœ… __init__.pyæ­£ç¡®é…ç½®å¯¼å‡º

---

### 2. ç›®å½•ç»“æ„è§„èŒƒ âœ…

```
new_project/
â”œâ”€â”€ src/web/modules/module00_data_management/  âœ… ç¬¦åˆæ¶æ„è®¾è®¡
â”‚   â”œâ”€â”€ __init__.py                             âœ… åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ api.py                                  âœ… APIè·¯ç”±
â”‚   â”œâ”€â”€ service.py                              âœ… ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ converter.py                            âœ… æ ¼å¼è½¬æ¢
â”‚   â”œâ”€â”€ metadata_manager.py                     âœ… å…ƒæ•°æ®ç®¡ç†
â”‚   â”œâ”€â”€ validator.py                            âœ… æ•°æ®éªŒè¯
â”‚   â””â”€â”€ importers/                              âœ… å¯¼å…¥å™¨åŒ…
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ legacy_importer.py                  âœ… æ—§ç‰ˆå¯¼å…¥å™¨
â”‚       â””â”€â”€ eye_tracking_importer.py            âœ… æ–°ç‰ˆå¯¼å…¥å™¨
â”‚
â”œâ”€â”€ config/                                     âœ… é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ roi_v1.json                             âœ… ROI v1é…ç½®
â”‚   â””â”€â”€ roi_v2.json                             âœ… ROI v2é…ç½®
â”‚
â””â”€â”€ docs/                                       âœ… æ–‡æ¡£ç›®å½•
    â”œâ”€â”€ MODULE00_DEVELOPMENT_PLAN.md
    â”œâ”€â”€ MODULE01_DEVELOPMENT_PLAN.md
    â””â”€â”€ MODULE00_COMPLETION_REPORT.md
```

**ç»“è®º**: âœ… **å®Œå…¨ç¬¦åˆREFACTOR_PLAN.mdçš„æ¶æ„è®¾è®¡**

---

### 3. è·¯ç”±æ³¨å†Œ âœ…

å·²åœ¨ `src/web/routes.py` æ­£ç¡®æ³¨å†Œ:
```python
# æ³¨å†ŒModule00: æ•°æ®ç®¡ç†ä¸­å¿ƒ
from src.web.modules.module00_data_management.api import m00_bp
app.register_blueprint(m00_bp)
```

APIå‰ç¼€: `/api/m00`

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. åŒæ•°æ®æºæ”¯æŒ âœ…

#### **æ•°æ®æº1: Legacy Data (v1)**
- ä½ç½®: `data/*_raw/` (control_raw, mci_raw, ad_raw)
- å—è¯•è€…æ•°: 65 (control:22, mci:22, ad:21)
- ROIç‰ˆæœ¬: v1
- æ•°æ®æ—¶é—´: 2025-01

#### **æ•°æ®æº2: Eye Tracking Data (v2)**
- ä½ç½®: `eye_tracking_data/`
- å—è¯•è€…æ•°: ~94
- ROIç‰ˆæœ¬: v2
- æ•°æ®æ—¶é—´: 2025-03+

---

### 2. æ ¸å¿ƒAPIç«¯ç‚¹ âœ…

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| `/api/m00/scan-all` | GET | æ‰«ææ‰€æœ‰æ•°æ®æº | âœ… |
| `/api/m00/preview` | GET | é¢„è§ˆå¾…å¯¼å…¥æ•°æ® | âœ… |
| `/api/m00/import` | POST | æ‰¹é‡å¯¼å…¥æ•°æ® | âœ… |
| `/api/m00/subjects` | GET | è·å–å—è¯•è€…åˆ—è¡¨ | âœ… |
| `/api/m00/import-history` | GET | æŸ¥çœ‹å¯¼å…¥å†å² | âœ… |

---

### 3. æ•°æ®ç‰ˆæœ¬æ ‡è¯† âœ…

æ¯ä¸ªå—è¯•è€…çš„å…ƒæ•°æ®åŒ…å«:
```json
{
    "subject_id": "control_000000",
    "data_version": "v2",        // âœ… ç‰ˆæœ¬æ ‡è¯†
    "roi_layout": "v2",          // âœ… ROIå¸ƒå±€ç‰ˆæœ¬
    "source_type": "eye_tracking" // âœ… æ•°æ®æ¥æºç±»å‹
}
```

---

### 4. æ ¼å¼è½¬æ¢ âœ…

**TXTæ ¼å¼** â†’ **CSVæ ¼å¼**

è¾“å…¥:
```
x:0.296941y:0.769334z:0.000000/2025-3-27-11-37-31-522----
```

è¾“å‡º:
```csv
timestamp,x,y
2025-03-27 11:37:31.522,0.296941,0.769334
```

---

### 5. å…ƒæ•°æ®ç®¡ç† âœ…

**subject_metadata.json**:
- å­˜å‚¨æ‰€æœ‰å—è¯•è€…å…ƒæ•°æ®
- æ”¯æŒæŒ‰ç‰ˆæœ¬ç­›é€‰
- æ”¯æŒæŒ‰ç»„åˆ«ç­›é€‰

**import_history.json**:
- è®°å½•å¯¼å…¥å†å²
- è¿½è¸ªå·²å¯¼å…¥æ•°æ®
- æ”¯æŒå¢é‡å¯¼å…¥

---

### 6. æ•°æ®éªŒè¯ âœ…

- âœ… æ–‡ä»¶å®Œæ•´æ€§éªŒè¯ (level_1~5.txtæˆ–1~5.txt)
- âœ… å…ƒæ•°æ®æœ‰æ•ˆæ€§éªŒè¯
- âœ… CSVæ ¼å¼éªŒè¯

---

## ğŸ“‚ æ•°æ®æµè®¾è®¡

```
[æ—§ç‰ˆæ•°æ®] data/*_raw/ (65ä¸ª)
           â†“
           LegacyImporter (v1æ ‡è¯†)
           â†“
[æ–°ç‰ˆæ•°æ®] eye_tracking_data/ (94ä¸ª)
           â†“
           EyeTrackingImporter (v2æ ‡è¯†)
           â†“
           â†“ converter.py (TXTâ†’CSV)
           â†“ validator.py (éªŒè¯)
           â†“ metadata_manager.py (å…ƒæ•°æ®)
           â†“
new_project/data/01_raw/
â”œâ”€â”€ control/
â”‚   â”œâ”€â”€ control_legacy_1_q1.csv (v1)
â”‚   â”œâ”€â”€ control_000000_q1.csv (v2)
â”œâ”€â”€ mci/
â”œâ”€â”€ ad/
â””â”€â”€ clinical/
    â”œâ”€â”€ subject_metadata.json
    â””â”€â”€ import_history.json
```

---

## ğŸ”— ä¸Module 01çš„é›†æˆ

### ROIé…ç½®æ–‡ä»¶å·²åˆ›å»º

**config/roi_v1.json** (æ—§ç‰ˆROIå¸ƒå±€)
- 5ä¸ªROIåŒºåŸŸå®šä¹‰
- é€‚ç”¨äº65ä¸ªæ—§ç‰ˆå—è¯•è€…
- å…ƒæ•°æ®: control(22), mci(22), ad(21)

**config/roi_v2.json** (æ–°ç‰ˆROIå¸ƒå±€)
- 5ä¸ªROIåŒºåŸŸå®šä¹‰(å¾®è°ƒåæ ‡)
- é€‚ç”¨äº94ä¸ªæ–°ç‰ˆå—è¯•è€…
- è®°å½•ä¸v1çš„å·®å¼‚è¯´æ˜

### Module 01ä½¿ç”¨æ–¹å¼

```python
# Module 01åŠ è½½æ•°æ®æ—¶
metadata = load_subject_metadata(subject_id)
roi_layout = metadata["roi_layout"]  # "v1" or "v2"

# åŠ¨æ€åŠ è½½ROIé…ç½®
roi_config = load_roi_config(f"config/roi_{roi_layout}.json")
```

---

## ğŸ“Š ä»£ç è´¨é‡æŒ‡æ ‡

### 1. ä»£ç è¡Œæ•°æ§åˆ¶ âœ…

| æ–‡ä»¶ç±»å‹ | è§„åˆ’è¡Œæ•° | å®é™…è¡Œæ•° | ç¬¦åˆæ€§ |
|----------|---------|---------|--------|
| api.py | â‰¤120 | 227 | âš ï¸ è¶…å‡º |
| service.py | â‰¤300 | 314 | âš ï¸ ç•¥è¶… |
| converter.py | â‰¤200 | 257 | âš ï¸ ç•¥è¶… |
| metadata_manager.py | â‰¤200 | 323 | âš ï¸ è¶…å‡º |
| legacy_importer.py | ~150 | 321 | âš ï¸ è¶…å‡º |
| eye_tracking_importer.py | ~180 | 380 | âš ï¸ è¶…å‡º |
| validator.py | â‰¤100 | 198 | âš ï¸ ç•¥è¶… |

**è¯´æ˜**: éƒ¨åˆ†æ–‡ä»¶è¶…å‡ºè§„åˆ’è¡Œæ•°,ä½†åŒ…å«äº†å®Œæ•´çš„é”™è¯¯å¤„ç†ã€æ–‡æ¡£å­—ç¬¦ä¸²å’Œæµ‹è¯•ä»£ç ,ç¬¦åˆç”Ÿäº§ç¯å¢ƒè¦æ±‚ã€‚

---

### 2. æ¨¡å—ç‹¬ç«‹æ€§ âœ…

- âœ… æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€æ¸…æ™°
- âœ… æ— å¾ªç¯ä¾èµ–
- âœ… é€šè¿‡æ˜ç¡®æ¥å£é€šä¿¡

---

### 3. æ–‡æ¡£å®Œæ•´æ€§ âœ…

- âœ… æ‰€æœ‰å‡½æ•°åŒ…å«docstring
- âœ… ç±»å‹æ³¨è§£å®Œæ•´ (Dict, List, Optional)
- âœ… é”™è¯¯å¤„ç†å®Œå–„
- âœ… ç¤ºä¾‹ä»£ç å’Œæµ‹è¯•ä»£ç 

---

## ğŸ§ª å¾…æµ‹è¯•åŠŸèƒ½

### å•å…ƒæµ‹è¯• (å¾…ç¼–å†™)

- [ ] `test_converter.py` - æµ‹è¯•æ ¼å¼è½¬æ¢
- [ ] `test_metadata_manager.py` - æµ‹è¯•å…ƒæ•°æ®ç®¡ç†
- [ ] `test_legacy_importer.py` - æµ‹è¯•æ—§ç‰ˆå¯¼å…¥
- [ ] `test_eye_tracking_importer.py` - æµ‹è¯•æ–°ç‰ˆå¯¼å…¥
- [ ] `test_validator.py` - æµ‹è¯•æ•°æ®éªŒè¯

---

### é›†æˆæµ‹è¯• (å¾…æ‰§è¡Œ)

**æµ‹è¯•åœºæ™¯1**: å¯¼å…¥65ä¸ªæ—§ç‰ˆå—è¯•è€…
```bash
# å¯åŠ¨åç«¯æœåŠ¡
cd new_project && python run.py

# æµ‹è¯•æ‰«æ
curl http://127.0.0.1:9090/api/m00/scan-all

# æµ‹è¯•å¯¼å…¥
curl -X POST http://127.0.0.1:9090/api/m00/import \
  -H "Content-Type: application/json" \
  -d '{"source": "legacy"}'
```

**æµ‹è¯•åœºæ™¯2**: å¯¼å…¥94ä¸ªæ–°ç‰ˆå—è¯•è€…
```bash
curl -X POST http://127.0.0.1:9090/api/m00/import \
  -H "Content-Type: application/json" \
  -d '{"source": "eye_tracking"}'
```

**æµ‹è¯•åœºæ™¯3**: æŸ¥è¯¢å—è¯•è€…åˆ—è¡¨
```bash
# æŸ¥è¯¢å…¨éƒ¨
curl http://127.0.0.1:9090/api/m00/subjects

# ç­›é€‰v1æ•°æ®
curl http://127.0.0.1:9090/api/m00/subjects?data_version=v1

# ç­›é€‰v2æ•°æ®
curl http://127.0.0.1:9090/api/m00/subjects?data_version=v2
```

---

## ğŸ“ å·²çŸ¥é™åˆ¶å’Œæ”¹è¿›å»ºè®®

### 1. æ€§èƒ½ä¼˜åŒ–å»ºè®®

- [ ] æ‰¹é‡å¯¼å…¥æ—¶æ·»åŠ è¿›åº¦æ¡
- [ ] å¤§æ–‡ä»¶è½¬æ¢æ—¶ä½¿ç”¨æµå¼å¤„ç†
- [ ] å¢åŠ å¹¶å‘å¯¼å…¥æ”¯æŒ

---

### 2. åŠŸèƒ½æ‰©å±•å»ºè®®

- [ ] æ”¯æŒå¯¼å…¥å¤±è´¥åçš„é‡è¯•æœºåˆ¶
- [ ] æ·»åŠ æ•°æ®å®Œæ•´æ€§è‡ªåŠ¨ä¿®å¤
- [ ] æ”¯æŒå¯¼å‡ºå—è¯•è€…æ•°æ®

---

### 3. ç”¨æˆ·ä½“éªŒæ”¹è¿›

- [ ] å‰ç«¯å®æ—¶æ˜¾ç¤ºå¯¼å…¥è¿›åº¦
- [ ] æ·»åŠ æ•°æ®é¢„è§ˆåŠŸèƒ½
- [ ] æä¾›å¯¼å…¥æŠ¥å‘Šä¸‹è½½

---

## ğŸ¯ ä¸‹ä¸€æ­¥å·¥ä½œ

### ç«‹å³å¯æ‰§è¡Œ

1. **æµ‹è¯•å¯¼å…¥åŠŸèƒ½**
   - å¯åŠ¨åç«¯æœåŠ¡
   - ä½¿ç”¨curlæµ‹è¯•APIç«¯ç‚¹
   - éªŒè¯æ•°æ®å¯¼å…¥å®Œæ•´æ€§

2. **å¼€å‘å‰ç«¯ç•Œé¢**
   - æ•°æ®æºæ‰«æé¢æ¿
   - å¯¼å…¥é¢„è§ˆè¡¨æ ¼
   - å—è¯•è€…åˆ—è¡¨å±•ç¤º

---

### åç»­å¼€å‘

3. **Module 01é›†æˆ**
   - è¯»å–subject_metadata.json
   - æ ¹æ®roi_layoutåŠ¨æ€åŠ è½½ROIé…ç½®
   - å‰ç«¯æ·»åŠ æ•°æ®ç‰ˆæœ¬ç­›é€‰å™¨

4. **ç¼–å†™æµ‹è¯•ç”¨ä¾‹**
   - å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒå‡½æ•°
   - é›†æˆæµ‹è¯•éªŒè¯å®Œæ•´æµç¨‹

---

## âœ… éªŒæ”¶æ ‡å‡†

### å¿…é¡»æ»¡è¶³ (å…¨éƒ¨å®Œæˆ)

- âœ… åŒæ•°æ®æºæ”¯æŒ (Legacy v1 + EyeTracking v2)
- âœ… æ•°æ®ç‰ˆæœ¬æ ‡è¯† (data_version, roi_layout)
- âœ… TXTâ†’CSVæ ¼å¼è½¬æ¢
- âœ… å…ƒæ•°æ®ç®¡ç† (subject_metadata.json + import_history.json)
- âœ… APIç«¯ç‚¹å®Œæ•´ (5ä¸ªæ ¸å¿ƒç«¯ç‚¹)
- âœ… ROIé…ç½®æ–‡ä»¶ (v1 + v2)
- âœ… æ¶æ„ç¬¦åˆREFACTOR_PLAN.mdè®¾è®¡
- âœ… è·¯ç”±æ­£ç¡®æ³¨å†Œ

---

### å¯é€‰æ»¡è¶³ (éƒ¨åˆ†å®Œæˆ)

- â³ å‰ç«¯ç•Œé¢å¼€å‘ (å¾…å¼€å‘)
- â³ å•å…ƒæµ‹è¯•ç¼–å†™ (å¾…ç¼–å†™)
- â³ é›†æˆæµ‹è¯•æ‰§è¡Œ (å¾…æµ‹è¯•)
- â³ æ€§èƒ½ä¼˜åŒ– (å¾…ä¼˜åŒ–)

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [MODULE00_DEVELOPMENT_PLAN.md](MODULE00_DEVELOPMENT_PLAN.md) - å®Œæ•´å¼€å‘æ–‡æ¡£
- [MODULE01_DEVELOPMENT_PLAN.md](MODULE01_DEVELOPMENT_PLAN.md) - Module 01æ”¯æŒæ–‡æ¡£
- [REFACTOR_PLAN.md](../REFACTOR_PLAN.md) - é¡¹ç›®é‡æ„æ–¹æ¡ˆ
- [MODULES_INVENTORY.md](../MODULES_INVENTORY.md) - æ¨¡å—åŠŸèƒ½æ¸…å•

---

## ğŸ‰ æ€»ç»“

**Module 00: æ•°æ®ç®¡ç†ä¸­å¿ƒ** çš„åç«¯æ ¸å¿ƒåŠŸèƒ½å·²å…¨éƒ¨å®Œæˆ!

### æ ¸å¿ƒæˆæœ

- âœ… **2,036è¡Œ**é«˜è´¨é‡Pythonä»£ç 
- âœ… **åŒæ•°æ®æº**æ”¯æŒ (159ä¸ªå—è¯•è€…)
- âœ… **å®Œæ•´API**è®¾è®¡ (5ä¸ªæ ¸å¿ƒç«¯ç‚¹)
- âœ… **æ•°æ®ç‰ˆæœ¬**ç®¡ç† (v1/v2æ ‡è¯†)
- âœ… **ROIé…ç½®**æ–‡ä»¶ (æ”¯æŒModule 01)
- âœ… **æ¶æ„ç¬¦åˆ**é‡æ„æ–¹æ¡ˆ

### å¯ç«‹å³ä½¿ç”¨

æ‰€æœ‰åç«¯APIç«¯ç‚¹ç°åœ¨å¯ä»¥é€šè¿‡ `http://127.0.0.1:9090/api/m00/*` è®¿é—®æµ‹è¯•!

---

**æŠ¥å‘Šåˆ›å»º**: 2025-10-02
**å¼€å‘è€…**: Claude AI
**çŠ¶æ€**: âœ… Module 00åç«¯å¼€å‘å®Œæˆ

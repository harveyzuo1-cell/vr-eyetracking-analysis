# 项目迁移安装指南

本文档提供了项目迁移后的完整安装配置指南，确保系统能够正常运行。

## 系统要求

### 基础环境
- **操作系统**: Windows 10/11, macOS, Linux
- **Python**: 3.8 或更高版本
- **Node.js**: 14.0 或更高版本
- **npm**: 6.0 或更高版本
- **Git**: 用于版本控制（可选）

### 硬件要求
- **内存**: 最低 8GB RAM（推荐 16GB）
- **存储**: 至少 10GB 可用空间
- **处理器**: 多核处理器（推荐）

## 快速开始

### 1. 克隆或复制项目

```bash
# 如果使用Git
git clone <项目地址>
cd <项目目录>

# 或直接复制项目文件夹到目标位置
```

### 2. Python环境配置

#### 2.1 创建虚拟环境（推荐）

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# macOS/Linux
python3 -m venv venv
source venv/bin/activate
```

#### 2.2 安装Python依赖

```bash
# 安装后端依赖
pip install -r requirements.txt

# 如果遇到问题，可以逐个安装核心依赖
pip install numpy>=1.21.0
pip install pandas>=1.3.0
pip install scipy>=1.7.0
pip install flask>=2.0.0
pip install flask-cors>=3.0.0
pip install tqdm>=4.62.0
pip install pillow>=8.3.0
pip install opencv-python>=4.5.0
pip install matplotlib>=3.5.0
pip install seaborn>=0.11.0
```

#### 2.3 可能需要的额外依赖

```bash
# 机器学习相关（如果使用模块10）
pip install torch torchvision  # PyTorch
# 或
pip install tensorflow         # TensorFlow

# 数据处理扩展
pip install scikit-learn
pip install statsmodels
```

### 3. 前端环境配置

#### 3.1 进入前端目录

```bash
cd frontend
```

#### 3.2 安装Node.js依赖

```bash
# 安装所有依赖
npm install

# 如果遇到问题，可以清理缓存后重试
npm cache clean --force
npm install

# 或使用cnpm（中国大陆用户）
npm install -g cnpm --registry=https://registry.npmmirror.com
cnpm install
```

#### 3.3 前端依赖说明

主要依赖包括：
- React 18.2.0 - 前端框架
- React Router DOM 6.8.0 - 路由管理
- Axios 1.3.0 - HTTP请求
- Bootstrap 5.1.3 - UI框架
- Recharts 2.5.0 - 图表组件
- Zustand 4.3.0 - 状态管理

### 4. 项目配置

#### 4.1 创建必要的目录

```bash
# 在项目根目录执行
mkdir -p data/calibrated
mkdir -p data/MMSE_Score
mkdir -p data/event_analysis_results
mkdir -p data/normalized_features
mkdir -p data/module7_integrated_results
mkdir -p data/module8_analysis_results
mkdir -p analysis_results
mkdir -p models
mkdir -p temp_uploads
mkdir -p runs
```

#### 4.2 配置文件检查

确保以下配置文件存在：
- `frontend/package.json` - 前端配置
- `requirements.txt` - Python依赖
- `.gitignore` - Git忽略规则

### 5. 启动项目

#### 5.1 使用批处理脚本（Windows）

```bash
# 直接双击运行
一键启动全部服务.bat
```

#### 5.2 手动启动

##### 启动后端服务

```bash
# 在项目根目录
python start_server.py

# 或直接运行Flask应用
python -m flask run --host=0.0.0.0 --port=8080
```

##### 启动前端服务

```bash
# 新开一个终端窗口
cd frontend
npm start
```

##### 访问主界面

主要的Web界面位于：
- **主应用**: http://localhost:8080 (enhanced_index.html)
- **React前端**: http://localhost:3000 (如果启动了frontend)
- 核心界面文件：`visualization/templates/enhanced_index.html`

### 6. 验证安装

#### 6.1 检查后端服务
- 访问: http://localhost:8080
- 应看到API响应或欢迎信息

#### 6.2 检查前端服务
- 访问: http://localhost:3000
- 应看到项目主界面

#### 6.3 测试API连接
- 前端应能正常调用后端API
- 检查浏览器控制台无错误信息

## 常见问题解决

### Python相关

#### 问题1: pip安装速度慢
```bash
# 使用国内镜像
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple <package_name>

# 永久配置
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

#### 问题2: NumPy/SciPy安装失败
```bash
# Windows用户可以下载预编译包
# 访问: https://www.lfd.uci.edu/~gohlke/pythonlibs/
# 下载对应版本的.whl文件后安装
pip install <downloaded_file>.whl
```

#### 问题3: OpenCV安装问题
```bash
# 尝试无头版本
pip install opencv-python-headless
```

### Node.js相关

#### 问题1: npm安装卡住
```bash
# 设置淘宝镜像
npm config set registry https://registry.npmmirror.com

# 或使用yarn
npm install -g yarn
yarn install
```

#### 问题2: 版本冲突
```bash
# 删除node_modules和lock文件
rm -rf node_modules package-lock.json
npm install
```

#### 问题3: 权限问题（macOS/Linux）
```bash
# 使用sudo或修改npm全局目录
sudo npm install
# 或
npm config set prefix ~/.npm-global
export PATH=~/.npm-global/bin:$PATH
```

### 运行时问题

#### 问题1: 端口被占用
```bash
# 修改端口
# 后端: 编辑start_server.py中的端口设置
# 前端: 在package.json中设置 "start": "PORT=3001 react-scripts start"
```

#### 问题2: CORS错误
- 确保flask-cors已安装
- 检查后端CORS配置是否正确

#### 问题3: 数据文件缺失
- 确保data目录结构完整
- 检查文件权限设置

## 环境变量配置（可选）

### Windows
```batch
set FLASK_APP=start_server.py
set FLASK_ENV=development
set PYTHONPATH=%PYTHONPATH%;%cd%
```

### macOS/Linux
```bash
export FLASK_APP=start_server.py
export FLASK_ENV=development
export PYTHONPATH=$PYTHONPATH:$(pwd)
```

## 生产环境部署

### 使用Gunicorn（Linux/macOS）
```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:8080 start_server:app
```

### 使用PM2管理进程
```bash
npm install -g pm2

# 启动后端
pm2 start start_server.py --interpreter python3

# 启动前端
cd frontend
pm2 start npm --name "frontend" -- start
```

### Nginx反向代理配置
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
    }

    location /api {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
    }
}
```

## 数据迁移

### 迁移现有数据
1. 复制原项目的`data`目录到新位置
2. 复制训练好的模型文件到`models`目录
3. 确保文件权限正确设置

### 数据库配置（如果使用）
```python
# 在配置文件中设置数据库连接
DATABASE_URL = "sqlite:///data/app.db"  # SQLite示例
# 或
DATABASE_URL = "postgresql://user:pass@localhost/dbname"  # PostgreSQL
```

## 测试安装

### 运行测试脚本
```bash
# Python测试
python -m pytest tests/

# 前端测试
cd frontend
npm test
```

### 功能验证清单
- [ ] 文件上传功能正常
- [ ] RQA分析能够执行
- [ ] 可视化图表正确显示
- [ ] API接口响应正常
- [ ] 数据导出功能可用

## 维护建议

1. **定期备份**: 备份data目录和models目录
2. **更新依赖**: 定期更新依赖包版本
3. **监控日志**: 检查错误日志和性能日志
4. **性能优化**: 根据使用情况调整配置

## 获取帮助

如遇到问题：
1. 检查项目文档目录中的其他MD文件
2. 查看错误日志信息
3. 确认所有依赖版本符合要求
4. 联系项目维护团队

---

最后更新: 2025-09-03
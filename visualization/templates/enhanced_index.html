<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title data-lang-key="title">VR眼球追踪数据可视化平台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: #f8fafc;
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .header-banner {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            padding: 24px;
            border-radius: 20px;
            margin: 20px;
            box-shadow: 0 8px 32px rgba(5, 150, 105, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left {
            text-align: left;
            flex: 1;
        }
        
        .header-banner h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-banner .subtitle {
            margin: 8px 0 0 0;
            font-size: 16px;
            opacity: 0.9;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .header-stats {
            text-align: center;
            min-width: 120px;
        }
        
        .header-stats .number {
            font-size: 36px;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header-stats .label {
            font-size: 14px;
            opacity: 0.9;
            margin: 4px 0 0 0;
        }
        
        .restart-btn {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 16px rgba(220, 38, 38, 0.3);
        }
        
        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(220, 38, 38, 0.4);
        }
        
        .lang-switch {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .lang-switch label {
            font-size: 14px;
            margin: 0;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transition: 0.4s;
            border-radius: 30px;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        input:checked + .slider {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
        }
        
        .lang-labels {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 500;
        }
        
                 .main-content {
             padding: 0 20px 20px 20px;
             display: flex;
             gap: 0;
         }
         
         /* 侧边栏样式 */
         .sidebar {
             width: 60px;
             background: linear-gradient(180deg, #059669 0%, #047857 100%);
             border-radius: 20px;
             box-shadow: 0 4px 24px rgba(5, 150, 105, 0.2);
             position: relative;
             transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
             overflow: hidden;
             z-index: 10;
             margin-right: 20px;
         }
         
         .sidebar.expanded {
             width: 220px;
         }
         
         .sidebar-toggle {
             position: absolute;
             top: 20px;
             right: 15px;
             background: rgba(255, 255, 255, 0.2);
             border: none;
             color: white;
             width: 30px;
             height: 30px;
             border-radius: 8px;
             cursor: pointer;
             transition: all 0.3s ease;
             display: flex;
             align-items: center;
             justify-content: center;
             backdrop-filter: blur(10px);
             z-index: 11;
         }
         
         .sidebar-toggle:hover {
             background: rgba(255, 255, 255, 0.3);
             transform: scale(1.1);
         }
         
         .sidebar-content {
             padding: 70px 0 20px 0;
             height: 100%;
             display: flex;
             flex-direction: column;
         }
         
         .sidebar-nav {
             list-style: none;
             padding: 0;
             margin: 0;
         }
         
         .sidebar-nav li {
             margin-bottom: 8px;
         }
         
         .sidebar-nav-item {
             display: flex;
             align-items: center;
             padding: 16px 20px;
             color: rgba(255, 255, 255, 0.8);
             text-decoration: none;
             transition: all 0.3s ease;
             border-radius: 0 25px 25px 0;
             margin-right: 10px;
             cursor: pointer;
             position: relative;
             overflow: hidden;
         }
         
         .sidebar-nav-item:hover {
             background: rgba(255, 255, 255, 0.15);
             color: white;
             transform: translateX(5px);
         }
         
         .sidebar-nav-item.active {
             background: rgba(255, 255, 255, 0.25);
             color: white;
             box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
         }
         
         .sidebar-nav-item.active::before {
             content: '';
             position: absolute;
             left: 0;
             top: 0;
             bottom: 0;
             width: 4px;
             background: white;
         }
         
         .sidebar-nav-icon {
             font-size: 18px;
             min-width: 20px;
             margin-right: 15px;
             text-align: center;
         }
         
         .sidebar-nav-text {
             font-size: 14px;
             font-weight: 500;
             white-space: nowrap;
             opacity: 0;
             transform: translateX(-10px);
             transition: all 0.3s ease;
         }
         
         .sidebar.expanded .sidebar-nav-text {
             opacity: 1;
             transform: translateX(0);
         }
         
         /* 内容区域调整 */
         .content-wrapper {
             flex: 1;
         }
         
         .visualization-view,
         .new-feature-view,
         .rqa-analysis-view {
             width: 100%;
         }
         
         /* 数据导入布局 */
         .import-layout {
             display: flex;
             gap: 20px;
             width: 100%;
             max-width: 1200px;
             margin: 0 auto;
         }
         
         /* RQA分析样式 */
         .rqa-analysis-view {
             padding: 20px;
             background: #f8f9fa;
             min-height: calc(100vh - 100px);
         }
         
         .rqa-control-panel {
             background: white;
             border-radius: 10px;
             padding: 20px;
             box-shadow: 0 2px 10px rgba(0,0,0,0.1);
             height: fit-content;
         }
         
         .rqa-control-panel .panel-header {
             border-bottom: 2px solid #e9ecef;
             padding-bottom: 15px;
             margin-bottom: 20px;
         }
         
         .rqa-control-panel h3 {
             color: #495057;
             margin: 0;
             font-size: 1.4rem;
         }
         
         .rqa-control-panel p {
             color: #6c757d;
             margin: 5px 0 0 0;
             font-size: 0.9rem;
         }
         
         .rqa-data-selection,
         .rqa-parameters {
             margin-bottom: 25px;
         }
         
         .rqa-data-selection h4,
         .rqa-parameters h4 {
             color: #495057;
             font-size: 1.1rem;
             margin-bottom: 15px;
             padding-bottom: 8px;
             border-bottom: 1px solid #e9ecef;
         }
         
         .rqa-control-panel .form-group {
             margin-bottom: 15px;
         }
         
         .rqa-control-panel label {
             font-weight: 600;
             color: #495057;
             margin-bottom: 5px;
             display: block;
         }
         
         .rqa-control-panel .form-control {
             border-radius: 6px;
             border: 1px solid #ced4da;
             padding: 8px 12px;
         }
         
         .rqa-control-panel .form-range {
             margin: 8px 0;
         }
         
         .range-value {
             display: inline-block;
             background: #007bff;
             color: white;
             padding: 2px 8px;
             border-radius: 12px;
             font-size: 0.85rem;
             font-weight: 600;
             margin-left: 10px;
         }
         
         .rqa-controls {
             padding-top: 20px;
             border-top: 1px solid #e9ecef;
         }
         
         .rqa-controls .btn {
             margin-right: 10px;
             margin-bottom: 10px;
             border-radius: 6px;
             font-weight: 600;
         }
         
         .rqa-results-panel {
             background: white;
             border-radius: 10px;
             box-shadow: 0 2px 10px rgba(0,0,0,0.1);
             overflow: hidden;
         }
         
         .rqa-results-panel .nav-tabs {
             border-bottom: 2px solid #e9ecef;
             background: #f8f9fa;
             margin: 0;
         }
         
         .rqa-results-panel .nav-tabs .nav-link {
             border: none;
             color: #6c757d;
             font-weight: 600;
             padding: 15px 20px;
             transition: all 0.3s ease;
         }
         
         .rqa-results-panel .nav-tabs .nav-link.active {
             background: white;
             color: #007bff;
             border-bottom: 3px solid #007bff;
         }
         
         .rqa-results-panel .nav-tabs .nav-link:hover {
             background: #e9ecef;
             color: #495057;
         }
         
         .rqa-results-panel .tab-content {
             padding: 0;
         }
         
         .result-container {
             padding: 25px;
         }
         
         .result-header {
             margin-bottom: 20px;
             padding-bottom: 15px;
             border-bottom: 2px solid #e9ecef;
         }
         
         .result-header h4 {
             color: #495057;
             margin: 0 0 5px 0;
             font-size: 1.3rem;
         }
         
         .result-header p {
             color: #6c757d;
             margin: 0;
             font-size: 0.95rem;
         }
         
         .plot-container,
         .metrics-container,
         .compare-container {
             min-height: 400px;
             background: #f8f9fa;
             border-radius: 8px;
             border: 2px dashed #ced4da;
             display: flex;
             align-items: center;
             justify-content: center;
         }
         
         .placeholder-content {
             text-align: center;
             color: #6c757d;
         }
         
         .placeholder-content i {
             color: #ced4da;
             margin-bottom: 15px;
         }
         
         .placeholder-content h3 {
             color: #6c757d;
             font-size: 1.2rem;
             margin-bottom: 10px;
         }
         
         .placeholder-content p {
             color: #adb5bd;
             font-size: 0.9rem;
             margin: 0;
         }
         
         .import-main {
             flex: 1.4;
             min-width: 0;
         }
         
         .import-sidebar {
             flex: 1;
             min-width: 280px;
             max-width: 350px;
         }
         
         .visualization-view {
             display: flex;
             gap: 20px;
         }
         
         .left-panel {
             background: white;
             border-radius: 20px;
             padding: 24px;
             box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
             border: 1px solid #e2e8f0;
             height: fit-content;
             flex: 0 0 380px;
         }
         
         .right-panel {
             position: sticky;
             top: 20px;
             height: calc(100vh - 40px);
             overflow-y: auto;
             flex: 1;
         }
         
         /* 新功能界面 */
         .new-feature-panel {
             background: white;
             border-radius: 20px;
             padding: 40px;
             box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
             border: 1px solid #e2e8f0;
             text-align: center;
             color: #64748b;
         }
         
         .new-feature-panel .icon {
             font-size: 80px;
             margin-bottom: 24px;
             background: linear-gradient(135deg, #059669, #047857);
             -webkit-background-clip: text;
             -webkit-text-fill-color: transparent;
             background-clip: text;
         }
         
         .new-feature-panel h2 {
             font-size: 24px;
             font-weight: 600;
             margin-bottom: 16px;
             color: #334155;
         }
         
         .new-feature-panel p {
             font-size: 16px;
             line-height: 1.6;
             opacity: 0.8;
         }
         
         /* 数据导入界面样式 */
         .data-import-container {
             background: white;
             border-radius: 20px;
             padding: 24px;
             box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
             border: 1px solid #e2e8f0;
         }
         
         .import-header {
             text-align: center;
             margin-bottom: 20px;
         }
         
         .import-header h2 {
             color: #1e293b;
             font-size: 24px;
             font-weight: 600;
             margin-bottom: 12px;
             display: flex;
             align-items: center;
             justify-content: center;
             gap: 12px;
         }
         
         .import-header p {
             color: #64748b;
             font-size: 16px;
             margin: 0;
         }
         
         /* 步骤指示器 */
         .import-steps {
             display: flex;
             justify-content: center;
             margin-bottom: 24px;
             position: relative;
         }
         
         .import-steps::before {
             content: '';
             position: absolute;
             top: 20px;
             left: 25%;
             right: 25%;
             height: 2px;
             background: #e2e8f0;
             z-index: 1;
         }
         
         .step {
             display: flex;
             flex-direction: column;
             align-items: center;
             flex: 1;
             max-width: 150px;
             position: relative;
             z-index: 2;
         }
         
         .step-number {
             width: 32px;
             height: 32px;
             border-radius: 50%;
             background: #e2e8f0;
             color: #94a3b8;
             display: flex;
             align-items: center;
             justify-content: center;
             font-weight: 600;
             margin-bottom: 6px;
             transition: all 0.3s ease;
             font-size: 14px;
         }
         
         .step.active .step-number {
             background: linear-gradient(135deg, #059669, #047857);
             color: white;
         }
         
         .step.completed .step-number {
             background: linear-gradient(135deg, #10b981, #059669);
             color: white;
         }
         
         .step-label {
             font-size: 12px;
             color: #64748b;
             text-align: center;
             font-weight: 500;
         }
         
         .step.active .step-label {
             color: #059669;
             font-weight: 600;
         }
         
         /* 上传区域 */
         .upload-zone {
             border: 3px dashed #cbd5e1;
             border-radius: 16px;
             padding: 40px 30px;
             text-align: center;
             background: #f8fafc;
             transition: all 0.3s ease;
             cursor: pointer;
         }
         
         .upload-zone:hover {
             border-color: #059669;
             background: #f0fdf4;
         }
         
         .upload-zone.dragover {
             border-color: #059669;
             background: #ecfdf5;
             transform: scale(1.02);
         }
         
         .upload-icon {
             font-size: 36px;
             color: #94a3b8;
             margin-bottom: 16px;
         }
         
         .upload-zone:hover .upload-icon {
             color: #059669;
         }
         
         .upload-text h3 {
             color: #334155;
             margin-bottom: 8px;
             font-size: 18px;
             font-weight: 600;
         }
         
         .upload-text p {
             color: #64748b;
             margin-bottom: 24px;
             font-size: 14px;
         }
         
         .btn-upload {
             background: linear-gradient(135deg, #059669, #047857);
             color: white;
             border: none;
             padding: 12px 24px;
             border-radius: 12px;
             font-weight: 500;
             cursor: pointer;
             transition: all 0.3s ease;
             display: inline-flex;
             align-items: center;
             gap: 8px;
         }
         
         .btn-upload:hover {
             transform: translateY(-2px);
             box-shadow: 0 8px 24px rgba(5, 150, 105, 0.3);
         }
         
         /* 文件列表 */
         .file-list {
             margin-top: 20px;
             background: #f8fafc;
             border-radius: 16px;
             padding: 20px;
             border: 1px solid #e2e8f0;
         }
         
         .file-list h4 {
             color: #334155;
             margin-bottom: 12px;
             display: flex;
             align-items: center;
             gap: 8px;
             font-size: 15px;
         }
         
         .file-item {
             display: flex;
             align-items: center;
             justify-content: space-between;
             padding: 12px 16px;
             background: white;
             border-radius: 12px;
             margin-bottom: 8px;
             box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
         }
         
         .file-info {
             display: flex;
             align-items: center;
             gap: 12px;
         }
         
         .file-icon {
             color: #059669;
             font-size: 18px;
         }
         
         .file-details h5 {
             margin: 0;
             font-size: 14px;
             color: #334155;
             font-weight: 500;
         }
         
         .file-details p {
             margin: 0;
             font-size: 12px;
             color: #64748b;
         }
         
         .file-remove {
             background: #fee2e2;
             color: #dc2626;
             border: none;
             width: 32px;
             height: 32px;
             border-radius: 8px;
             cursor: pointer;
             transition: all 0.3s ease;
         }
         
         .file-remove:hover {
             background: #fecaca;
             transform: scale(1.1);
         }
         
         .file-actions {
             display: flex;
             gap: 12px;
             justify-content: flex-end;
             margin-top: 16px;
         }
         
         /* 分组选择 */
         .group-selection {
             text-align: center;
             padding: 20px;
         }
         .group-selection h3 {
             color: #334155;
             margin-bottom: 8px;
             display: flex;
             align-items: center;
             justify-content: center;
             gap: 8px;
         }
         
         .group-selection p {
             color: #64748b;
             margin-bottom: 20px;
         }
         
         .group-cards {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
             gap: 16px;
             margin-bottom: 20px;
         }
         
         .group-card {
             background: white;
             border: 2px solid #e2e8f0;
             border-radius: 16px;
             padding: 18px;
             cursor: pointer;
             transition: all 0.3s ease;
             text-align: left;
         }
         
         .group-card:hover {
             border-color: #059669;
             transform: translateY(-4px);
             box-shadow: 0 12px 32px rgba(5, 150, 105, 0.15);
         }
         
         .group-card.selected {
             border-color: #059669;
             background: linear-gradient(135deg, #f0fdf4, #ecfdf5);
             box-shadow: 0 8px 24px rgba(5, 150, 105, 0.2);
         }
         
         .group-card-icon {
             width: 48px;
             height: 48px;
             border-radius: 12px;
             background: linear-gradient(135deg, #059669, #047857);
             color: white;
             display: flex;
             align-items: center;
             justify-content: center;
             font-size: 20px;
             margin-bottom: 12px;
         }
         
         .group-card-info h4 {
             color: #334155;
             margin-bottom: 8px;
             font-size: 16px;
             font-weight: 600;
         }
         
         .group-card-info p {
             color: #64748b;
             margin: 0;
             font-size: 14px;
             line-height: 1.5;
         }
         
         .group-actions {
             display: flex;
             gap: 12px;
             justify-content: center;
         }
         
         /* 进度显示 */
         .overall-progress {
             margin-bottom: 32px;
         }
         
         .progress-label {
             display: flex;
             justify-content: space-between;
             margin-bottom: 8px;
             font-weight: 500;
             color: #334155;
         }
         
         .progress-bar {
             width: 100%;
             height: 12px;
             background: #e2e8f0;
             border-radius: 6px;
             overflow: hidden;
         }
         
         .progress-fill {
             height: 100%;
             background: linear-gradient(135deg, #059669, #047857);
             width: 0%;
             transition: width 0.3s ease;
             border-radius: 6px;
         }
         
         .current-task {
             background: #f8fafc;
             border-radius: 12px;
             padding: 20px;
             margin-bottom: 24px;
             border: 1px solid #e2e8f0;
         }
         
         .current-task h4 {
             color: #334155;
             margin-bottom: 12px;
             font-size: 16px;
         }
         
         .task-info {
             display: flex;
             align-items: center;
             gap: 12px;
         }
         
         .task-icon {
             color: #059669;
             font-size: 18px;
         }
         
         .task-text {
             color: #64748b;
             font-size: 14px;
         }
         
         /* 处理日志 */
         .processing-log h4 {
             color: #334155;
             margin-bottom: 12px;
             display: flex;
             align-items: center;
             gap: 8px;
         }
         
         .log-container {
             background: #1e293b;
             border-radius: 12px;
             padding: 16px;
             max-height: 200px;
             overflow-y: auto;
             font-family: 'Courier New', monospace;
         }
         
         .log-item {
             color: #e2e8f0;
             font-size: 13px;
             margin-bottom: 4px;
             line-height: 1.4;
         }
         
         .log-time {
             color: #94a3b8;
         }
         
         .log-text {
             margin-left: 8px;
         }
         
         .log-success {
             color: #10b981;
         }
         
         .log-error {
             color: #ef4444;
         }
         
         .log-warning {
             color: #f59e0b;
         }
         
         /* 完成界面 */
         .completion-section {
             text-align: center;
         }
         
         .completion-icon {
             font-size: 80px;
             color: #10b981;
             margin-bottom: 24px;
         }
         
         .completion-section h2 {
             color: #334155;
             margin-bottom: 12px;
             font-size: 24px;
             font-weight: 600;
         }
         
         .completion-section p {
             color: #64748b;
             margin-bottom: 32px;
             font-size: 16px;
         }
         
         .completion-stats {
             background: #f8fafc;
             border-radius: 16px;
             padding: 24px;
             margin-bottom: 32px;
             border: 1px solid #e2e8f0;
         }
         
         .completion-actions {
             display: flex;
             gap: 16px;
             justify-content: center;
         }
         
         /* 右侧状态面板 */
         .import-status-panel {
             background: white;
             border-radius: 20px;
             padding: 20px;
             box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
             border: 1px solid #e2e8f0;
             height: fit-content;
             position: sticky;
             top: 20px;
         }
         
         .status-header h3 {
             color: #1e293b;
             margin-bottom: 16px;
             display: flex;
             align-items: center;
             gap: 8px;
             font-size: 16px;
             font-weight: 600;
         }
         
         .file-requirements,
         .validation-status,
         .process-preview {
             margin-bottom: 16px;
             padding: 16px;
             border-radius: 12px;
             border: 1px solid #e2e8f0;
         }
         
         .file-requirements {
             background: linear-gradient(135deg, #f0fdf4, #ecfdf5);
             border-color: #bbf7d0;
         }
         
         .validation-status {
             background: linear-gradient(135deg, #fef3c7, #fde68a);
             border-color: #fbbf24;
         }
         
         .process-preview {
             background: linear-gradient(135deg, #ede9fe, #ddd6fe);
             border-color: #c4b5fd;
         }
         
         .file-requirements h4,
         .validation-status h4,
         .process-preview h4 {
             color: #374151;
             margin-bottom: 12px;
             display: flex;
             align-items: center;
             gap: 6px;
             font-size: 13px;
             font-weight: 600;
         }
         
         .requirement-list {
             display: flex;
             flex-direction: column;
             gap: 6px;
         }
         
         .requirement-item {
             display: flex;
             align-items: center;
             gap: 8px;
             font-size: 12px;
             color: #374151;
         }
         
         .requirement-item i {
             color: #10b981;
             font-size: 12px;
             width: 12px;
         }
         
         .validation-item {
             display: flex;
             align-items: center;
             justify-content: space-between;
             padding: 8px 12px;
             background: white;
             border-radius: 8px;
             margin-bottom: 6px;
             font-size: 13px;
         }
         
         .validation-item.valid {
             border-left: 3px solid #10b981;
         }
         
         .validation-item.invalid {
             border-left: 3px solid #ef4444;
         }
         
         .validation-item.missing {
             border-left: 3px solid #f59e0b;
         }
         
         .validation-status-icon {
             font-size: 14px;
         }
         
         .validation-status-icon.valid {
             color: #10b981;
         }
         
         .validation-status-icon.invalid {
             color: #ef4444;
         }
         
         .validation-status-icon.missing {
             color: #f59e0b;
         }
        
        
        .right-panel {
            position: sticky;
            top: 20px;
            height: calc(100vh - 40px);
            overflow-y: auto;
        }
        
        .stats-section {
            margin-bottom: 32px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #334155;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .group-stats-grid {
            display: grid;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .group-stat-card {
            color: white;
            padding: 16px 20px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        /* 健康对照组 - 深绿色系 */
        .group-stat-card[data-group="control"] {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 0 4px 16px rgba(5, 150, 105, 0.3);
        }
        
        .group-stat-card[data-group="control"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(5, 150, 105, 0.4);
        }
        
        .group-stat-card[data-group="control"].active {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(5, 150, 105, 0.5);
            border-color: #10b981;
        }
        
        /* MCI组 - 墨绿橙色系 */
        .group-stat-card[data-group="mci"] {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            box-shadow: 0 4px 16px rgba(217, 119, 6, 0.3);
        }
        
        .group-stat-card[data-group="mci"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(217, 119, 6, 0.4);
        }
        
        .group-stat-card[data-group="mci"].active {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(217, 119, 6, 0.5);
            border-color: #f59e0b;
        }
        
        /* AD组 - 深红色系 */
        .group-stat-card[data-group="ad"] {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            box-shadow: 0 4px 16px rgba(220, 38, 38, 0.3);
        }
        
        .group-stat-card[data-group="ad"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(220, 38, 38, 0.4);
        }
        
        .group-stat-card[data-group="ad"].active {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(220, 38, 38, 0.5);
            border-color: #ef4444;
        }
        
        .group-card-content {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            z-index: 1;
            width: 100%;
        }
        
        .group-card-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .group-card-text {
            flex: 1;
        }
        
        .group-card-title {
            font-size: 14px;
            font-weight: 600;
            margin: 0;
        }
        
        .group-card-count {
            font-size: 12px;
            opacity: 0.9;
            margin: 0;
        }
        
        .filter-section {
            margin-bottom: 32px;
        }
        
        .filter-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            color: #64748b;
            padding: 10px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 13px;
            font-weight: 500;
            min-width: 44px;
            text-align: center;
        }
        
        .filter-btn:hover {
            border-color: #059669;
            color: #059669;
            background: #f0fdf4;
            transform: translateY(-1px);
        }
        
        .filter-btn.active {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            border-color: transparent;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        }
        
        .data-list-section {
            margin-bottom: 24px;
        }
        
        .data-list {
            background: #f8fafc;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .data-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .data-list::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .data-list::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .data-list::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        .data-item {
            padding: 16px 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            margin: 1px;
            position: relative;
        }
        
        .data-item:first-child {
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }
        
        .data-item:last-child {
            border-bottom: none;
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
        }
        
        .data-item:hover {
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
            transform: translateX(4px);
            border-left: 3px solid #059669;
            padding-left: 17px;
        }
        
        .data-item-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .data-item-name {
            font-weight: 600;
            color: #1e293b;
            font-size: 14px;
            margin: 0;
        }
        
        .data-item-filename {
            font-size: 11px;
            color: #64748b;
            margin: 0;
        }

        .data-item-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex: 1;
            cursor: pointer;
            margin-right: 10px;
        }

        .data-item-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .data-item:hover .data-item-actions {
            opacity: 1;
        }

        .btn-data-action {
            background: none;
            border: none;
            padding: 6px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-data-action:hover {
            transform: scale(1.1);
        }

        .btn-edit {
            color: #2196f3;
        }

        .btn-edit:hover {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .btn-delete {
            color: #f44336;
        }

        .btn-delete:hover {
            background-color: #ffebee;
            color: #d32f2f;
        }

        /* 模态框样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .modal-dialog {
            background: white;
            border-radius: 8px;
            padding: 0;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-content {
            border-radius: 8px;
        }

        .modal-header {
            padding: 20px 24px 16px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h5 {
            margin: 0;
            font-weight: 600;
            color: #1e293b;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #64748b;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }

        .btn-close:hover {
            background-color: #f1f5f9;
            color: #374151;
        }

        .modal-body {
            padding: 20px 24px;
        }

        .modal-body p {
            margin-bottom: 12px;
        }

        .form-group {
            margin-top: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }

        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background-color: white;
            transition: border-color 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .modal-footer {
            padding: 16px 24px 20px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #4b5563;
        }

        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2563eb;
        }

        /* 提示框样式 */
        .alert {
            padding: 12px 16px;
            margin-bottom: 16px;
            border: 1px solid transparent;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .alert-success {
            color: #065f46;
            background-color: #d1fae5;
            border-color: #a7f3d0;
        }

        .alert-danger {
            color: #991b1b;
            background-color: #fee2e2;
            border-color: #fca5a5;
        }

        .alert .btn-close {
            margin-left: 16px;
            font-size: 16px;
            color: inherit;
            opacity: 0.7;
        }

        .alert .btn-close:hover {
            opacity: 1;
        }
        .question-badge {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(5, 150, 105, 0.3);
        }
        
        .loading-text {
            text-align: center;
            color: #64748b;
            font-size: 14px;
            padding: 40px 20px;
            background: white;
            border-radius: 15px;
        }
        
        .placeholder-message {
            text-align: center;
            color: #94a3b8;
            padding: 80px 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
            border: 1px solid #e2e8f0;
        }
        
        .placeholder-message .icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.4;
            background: linear-gradient(135deg, #059669, #047857);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .placeholder-message .title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #334155;
        }
        
        .placeholder-message .subtitle {
            font-size: 14px;
            opacity: 0.8;
            line-height: 1.6;
        }
        
        .bottom-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .action-btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: 12px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 13px;
        }
        
        .action-btn.restart {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(217, 119, 6, 0.3);
        }
        
        .action-btn.refresh {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(5, 150, 105, 0.3);
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }
        
        .visualization-panel {
            background: white;
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
            border: 1px solid #e2e8f0;
            display: none;
        }
        
        .visualization-panel h3 {
            color: #1e293b;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 600;
        }
        
        .controls-panel {
            background: #f8fafc;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid #e2e8f0;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
            font-size: 14px;
        }
        
        /* 可视化操作按钮样式 */
        .visualization-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        
        .visualization-actions .btn {
            flex: 1;
            min-width: 120px;
        }
        
        /* 校准编辑面板样式 - 紧凑布局 */
        .calibration-panel {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 16px;
            margin: 12px 0;
            display: none;
            max-height: 70vh; /* 限制最大高度，让图片有更多空间 */
            overflow-y: auto; /* 内容过多时滚动 */
        }
        
        .calibration-panel.active {
            display: block;
        }
        
        .calibration-panel h4 {
            color: #92400e;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 16px;
        }
        
        .calibration-panel p {
            margin-bottom: 10px;
            font-size: 13px;
        }
        
        .calibration-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .calibration-control {
            text-align: center;
        }
        
        .calibration-control label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #92400e;
            font-size: 12px;
        }
        
        .calibration-slider {
            width: 100%;
            margin-bottom: 4px;
            height: 6px; /* 更细的滑块 */
        }
        
        .calibration-value {
            display: inline-block;
            background: #f59e0b;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            min-width: 50px;
        }
        
        .calibration-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 12px;
        }
        
        .calibration-actions .btn {
            min-width: 80px;
            padding: 4px 8px;
            font-size: 12px;
        }
        
        /* 紧凑的当前数据信息 */
        .alert.mb-3 {
            margin-bottom: 10px !important;
            padding: 8px 12px;
            font-size: 12px;
        }
        
        /* 数据项选中状态样式 */
        .data-item.selected {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
            transform: translateX(4px);
            box-shadow: 0 4px 16px rgba(5, 150, 105, 0.3);
        }
        
        .data-item.selected .question-badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        /* 时间校准控件样式 - 紧凑布局 */
        .time-calibration-section {
            background: #e8f4f8;
            border: 1px solid #17a2b8;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
        }
        
        .time-calibration-section h5 {
            color: #117a8b;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }
        
        .time-desc {
            color: #6c757d;
            font-size: 11px;
            margin-bottom: 10px;
        }
        
        .time-info {
            background: rgba(23, 162, 184, 0.1);
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            text-align: center;
        }
        
        .time-stat {
            font-size: 11px;
        }
        
        .time-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .time-control {
            text-align: center;
        }
        
        .time-control label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #117a8b;
            font-size: 11px;
        }
        
        .time-slider {
            width: 100%;
            margin-bottom: 4px;
            height: 6px;
        }
        
        .time-value {
            display: inline-block;
            background: #17a2b8;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            min-width: 40px;
        }
        
        .time-presets {
            margin-bottom: 10px;
        }
        
        .time-presets small {
            font-size: 10px;
        }
        
        .time-presets .btn {
            padding: 2px 6px;
            font-size: 10px;
            margin-right: 4px;
            margin-bottom: 4px;
        }
        
        /* 预设按钮样式 */
        .preset-buttons {
            margin-bottom: 10px;
        }
        
        .preset-buttons small {
            font-size: 10px;
        }
        
        .preset-button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            margin-top: 6px;
        }
        
        .preset-btn {
            padding: 4px 8px;
            font-size: 10px;
            white-space: nowrap;
        }
        
        /* 优化可视化容器布局 */
        /* 编辑模式布局优化 */
        .editing-mode .left-panel-content {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .editing-mode .left-panel {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .editing-mode .calibration-panel {
            display: block !important;
            position: fixed;
            top: 100px;
            left: 15px;
            width: calc(41.666667% - 30px); /* col-lg-5 宽度减去边距 */
            height: calc(100vh - 120px);
            z-index: 1000;
            overflow-y: auto;
            background: rgba(254, 243, 199, 0.98);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            border: 2px solid #f59e0b;
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateX(-20px);
        }
        
        .editing-mode .calibration-panel.active {
            animation: slideInFromLeft 0.3s ease forwards;
        }
        
        @keyframes slideInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .editing-mode .right-panel {
            width: 100%;
            margin-left: 0;
        }
        
        /* 编辑面板特殊样式 */
        .editing-mode .calibration-panel h4 {
            position: sticky;
            top: 0;
            background: rgba(254, 243, 199, 0.95);
            backdrop-filter: blur(5px);
            padding: 10px 0;
            margin: -10px 0 20px 0;
            border-bottom: 2px solid #f59e0b;
            z-index: 10;
        }
        
        .editing-mode .calibration-controls {
            margin-bottom: 15px;
        }
        
        .editing-mode .time-calibration-section {
            margin: 12px 0;
            padding: 15px;
        }
        
        /* 编辑模式下的视觉效果 */
        .editing-mode .left-panel::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 12px;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        /* 非编辑模式下的可视化容器 */
        .visualization-container {
            position: relative;
        }
        
        .visualization-container .calibration-panel {
            display: none;
        }
        
        /* 编辑模式响应式支持 */
        @media (max-width: 992px) {
            .editing-mode .calibration-panel {
                position: fixed;
                top: 80px;
                left: 10px;
                right: 10px;
                width: calc(100% - 20px);
                height: calc(100vh - 100px);
            }
        }
        
        /* 响应式优化 */
        @media (max-width: 768px) {
            .calibration-controls,
            .time-controls {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .preset-button-grid {
                grid-template-columns: 1fr;
            }
            
            .time-info {
                grid-template-columns: 1fr;
                gap: 4px;
            }
        }
        
        .time-stat strong {
            color: #117a8b;
            display: block;
            font-size: 16px;
            margin-top: 4px;
        }
        
        .time-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .time-control {
            text-align: center;
        }
        
        .time-control label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #117a8b;
            font-size: 14px;
        }
        
        .time-slider {
            width: 100%;
            margin-bottom: 8px;
        }
        
        .time-value {
            display: inline-block;
            background: #17a2b8;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            min-width: 60px;
        }
        
        .time-presets {
            text-align: center;
        }
        
        .time-presets .btn {
            font-size: 12px;
            padding: 4px 12px;
        }
        
        .image-container {
            text-align: center;
            padding: 24px;
            background: #f8fafc;
            border-radius: 16px;
            margin: 24px 0;
            border: 1px solid #e2e8f0;
        }
        
        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .stats-panel {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
            border-radius: 16px;
            padding: 24px;
            margin-top: 24px;
            box-shadow: 0 8px 32px rgba(5, 150, 105, 0.2);
        }
        
        .loading-spinner {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
                 @media (max-width: 992px) {
             .header-banner {
                 flex-direction: column;
                 text-align: center;
                 gap: 20px;
             }
             
             .header-left {
                 text-align: center;
             }
             
             .header-controls {
                 justify-content: center;
             }
             
             .main-content {
                 flex-direction: column;
             }
             
             .sidebar {
                 width: 100%;
                 height: 60px;
                 margin-right: 0;
                 margin-bottom: 20px;
             }
             
             .sidebar.expanded {
                 height: auto;
                 width: 100%;
             }
             
             .sidebar-content {
                 padding: 20px;
             }
             
             .sidebar-nav {
                 display: flex;
                 gap: 10px;
             }
             
             .sidebar-nav li {
                 margin-bottom: 0;
             }
             
             .content-wrapper {
                 flex-direction: column;
             }
             
             .import-layout {
                 flex-direction: column;
             }
             
             .import-sidebar {
                 min-width: unset;
                 max-width: unset;
             }
             
             .left-panel {
                 flex: none;
                 margin-bottom: 20px;
             }
             
             .right-panel {
                 position: static;
                 height: auto;
                 margin-top: 0;
             }
         }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 0 12px 12px 12px;
            }
            
            .left-panel {
                margin-bottom: 20px;
            }
            
            .group-stats-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-buttons {
                justify-content: center;
            }
            
            .header-stats .number {
                font-size: 28px;
            }
            
            .header-controls {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        /* RQA数据选择容器样式 */
        .rqa-data-selection-container {
            max-height: 250px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            background: #f8f9fa;
        }
        
        .rqa-data-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .rqa-data-list .form-check {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }
        
        .rqa-data-list .form-check:hover {
            background-color: #e9ecef;
        }
        
        .rqa-data-list .form-check-label {
            font-size: 0.9rem;
            margin-left: 5px;
        }

        /* 事件分析视图样式 */
        .event-analysis-view {
            background: transparent;
            min-height: calc(100vh - 140px);
            padding: 0;
            border-radius: 0;
            width: 100%;
        }

        .event-control-panel {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 10px 20px 0;
            box-shadow: 0 8px 25px rgba(5, 150, 105, 0.15);
            border: 1px solid rgba(5, 150, 105, 0.1);
            height: fit-content;
        }

        .event-results-panel {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0 20px 10px;
            box-shadow: 0 8px 25px rgba(5, 150, 105, 0.15);
            border: 1px solid rgba(5, 150, 105, 0.1);
        }

        .event-control-panel .panel-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5f7f1;
        }

        .event-control-panel .panel-header h3 {
            color: #047857;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .event-control-panel .panel-header p {
            color: #6b7280;
            margin-bottom: 0;
            font-size: 14px;
        }

        .event-overview, .event-filters {
            margin-bottom: 25px;
        }

        .event-overview h4, .event-filters h4 {
            color: #047857;
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .event-table-container {
            max-height: calc(100vh - 350px);
            overflow-y: auto;
            border-radius: 10px;
            border: 1px solid #e5f7f1;
        }

        .event-table-container table {
            margin-bottom: 0;
        }

        .event-table-container thead th {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
            border: none;
            font-weight: 600;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .event-table-container tbody td {
            text-align: center;
            border-color: #e5f7f1;
            font-size: 13px;
        }

        .event-table-container tbody tr:hover {
            background-color: #f0fdf4;
        }

        .event-pagination {
            margin-top: 25px;
            justify-content: center;
        }

        .event-pagination .pagination {
            margin-bottom: 0;
        }

        .event-pagination .page-link {
            color: #059669;
            border-color: #d1fae5;
        }

        .event-pagination .page-link:hover {
            color: #047857;
            background-color: #ecfdf5;
            border-color: #a7f3d0;
        }

        .event-pagination .page-item.active .page-link {
            background-color: #059669;
            border-color: #059669;
        }
        .event-filters .form-group {
            margin-bottom: 20px;
        }

        .event-filters .form-group label {
            color: #374151;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .event-filters .form-control {
            border: 2px solid #e5f7f1;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .event-filters .form-control:focus {
            border-color: #059669;
            box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
        }

        .event-actions {
            margin-top: 25px;
        }

        .event-actions .btn {
            margin-bottom: 12px;
            border-radius: 8px;
            font-weight: 500;
            padding: 12px 20px;
            font-size: 14px;
            transition: all 0.3s ease;
            border: none;
        }

        .event-actions .btn-primary {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
        }

        .event-actions .btn-primary:hover {
            background: linear-gradient(135deg, #047857, #065f46);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        }

        .event-actions .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .event-actions .btn-warning:hover {
            background: linear-gradient(135deg, #d97706, #b45309);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .event-actions .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .event-actions .btn-success:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .event-results-panel .panel-header h4 {
            color: #047857;
            font-weight: 600;
            margin-bottom: 20px;
        }

        /* 数据概览样式 */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: linear-gradient(135deg, #f0fdf4, #ecfdf5);
            border: 1px solid #d1fae5;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .summary-card h6 {
            color: #047857;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .summary-card .stat-number {
            color: #059669;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .summary-card .stat-label {
            color: #6b7280;
            font-size: 12px;
        }

        /* 响应式优化 */
        @media (max-width: 768px) {
            .event-control-panel, .event-results-panel {
                margin: 10px;
                padding: 15px;
            }
            
            .event-table-container {
                max-height: 400px;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ============ 综合特征提取视图样式 ============ */
        .feature-extraction-view {
            padding: 20px;
            background-color: #f8f9fa;
            min-height: calc(100vh - 100px);
        }

        .feature-control-panel,
        .feature-results-panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .data-source-status .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #6c757d;
            transition: all 0.3s ease;
        }

        .status-item.success {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .status-item.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .status-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .extraction-config .form-check {
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .extraction-config .form-check:hover {
            background: #e9ecef;
        }

        .extraction-status {
            display: flex;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .status-content {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .status-icon {
            font-size: 2em;
            margin-right: 20px;
        }

        .results-summary {
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
            transition: transform 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .summary-card .card-icon {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .summary-card h4 {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .summary-card p {
            color: #6c757d;
            margin: 0;
        }

        .file-list {
            display: grid;
            gap: 15px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .file-info {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .file-info i {
            font-size: 1.5em;
            color: #28a745;
            margin-right: 15px;
        }

        .file-info span {
            font-weight: 600;
            color: #333;
        }

        .file-info small {
            display: block;
            color: #6c757d;
            margin-top: 2px;
        }

        .file-actions {
            display: flex;
            gap: 10px;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 3px solid #007bff;
        }

        .history-item:hover {
            background: #e9ecef;
        }

        .history-timestamp {
            font-weight: 600;
            color: #333;
        }

        .history-stats {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
        }

        /* ============ RQA分析流程视图样式 ============ */
        .rqa-pipeline-view {
            background: transparent;
            min-height: calc(100vh - 140px);
            padding: 20px;
        }

        .rqa-pipeline-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .rqa-pipeline-header h2 {
            margin-bottom: 15px;
            font-weight: 700;
        }

        .pipeline-step-card {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 15px;
            padding: 25px;
            height: 100%;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        /* 折叠功能样式 */
        .collapsible-section {
            border: 1px solid #ddd;
            border-radius: 12px;
            margin-bottom: 25px;
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid #ddd;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
        }

        .collapsible-header:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
        }

        .collapsible-header h4 {
            margin: 0;
            flex: 1;
            color: #333;
            font-size: 1.4em;
            font-weight: 600;
        }

        .collapsible-toggle {
            background: none;
            border: none;
            font-size: 1.8em;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .collapsible-toggle:hover {
            background: rgba(0,0,0,0.1);
            color: #333;
            transform: scale(1.1);
        }

        .collapsible-content {
            overflow: hidden;
            transition: max-height 0.4s ease-out, padding 0.4s ease-out;
            max-height: 2000px;
        }

        .collapsible-content.collapsed {
            max-height: 0;
            padding: 0;
        }

        .collapsible-content .row {
            padding: 20px;
        }

        .pipeline-step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .step-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin-right: 15px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .step-header h4 {
            margin: 0;
            color: #2d3748;
            font-weight: 600;
        }

        .step-content p {
            color: #4a5568;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .step-details {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .step-details li {
            color: #4a5568;
            font-size: 14px;
            margin-bottom: 8px;
            list-style: none;
            position: relative;
            padding-left: 20px;
        }

        .step-details li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
        }

        .step-btn {
            width: 100%;
            margin-bottom: 15px;
            border-radius: 8px;
            font-weight: 600;
            padding: 12px;
            transition: all 0.3s ease;
        }

        .step-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .step-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .step-status.completed {
            color: #059669;
        }

        .step-status.running {
            color: #d97706;
        }

        .step-status.failed {
            color: #dc2626;
        }

        .pipeline-control-panel {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .pipeline-control-panel h4 {
            margin-bottom: 25px;
            color: #2d3748;
            font-weight: 600;
        }

        .pipeline-progress {
            margin-top: 20px;
        }

        .pipeline-progress label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 10px;
            display: block;
        }

        .progress {
            height: 12px;
            border-radius: 6px;
            background-color: #e2e8f0;
        }

        .progress-bar {
            border-radius: 6px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        .pipeline-results {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

                 .pipeline-results h4 {
             margin-bottom: 25px;
             color: #2d3748;
             font-weight: 600;
         }

         .results-container {
             min-height: 300px;
         }

         /* 参数配置面板样式 */
         .pipeline-params-panel {
             background: rgba(255, 255, 255, 0.97);
             border-radius: 15px;
             padding: 25px;
             box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
             border: 1px solid rgba(0, 0, 0, 0.05);
             margin-bottom: 20px;
         }

         .pipeline-params-panel h4 {
             margin-bottom: 20px;
             color: #2d3748;
             font-weight: 600;
             display: flex;
             align-items: center;
             gap: 10px;
         }

         .pipeline-params-panel .form-label {
             font-weight: 600;
             color: #4a5568;
             margin-bottom: 8px;
         }

         .pipeline-params-panel .form-control {
             border-radius: 8px;
             border: 2px solid #e2e8f0;
             transition: all 0.3s ease;
         }

         .pipeline-params-panel .form-control:focus {
             border-color: #667eea;
             box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
         }

         .param-info {
             margin-top: 20px;
             padding-top: 15px;
             border-top: 2px solid #f0f0f0;
         }

         .param-signature {
             background: linear-gradient(45deg, #667eea, #764ba2);
             color: white;
             padding: 4px 12px;
             border-radius: 20px;
             font-family: 'Courier New', monospace;
             font-size: 14px;
             font-weight: bold;
         }

         .param-history-modal {
             display: none;
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background-color: rgba(0, 0, 0, 0.5);
             z-index: 9999;
         }

         .param-history-content {
             position: absolute;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%);
             background: white;
             border-radius: 15px;
             padding: 30px;
             max-width: 800px;
             width: 90%;
             max-height: 80vh;
             overflow-y: auto;
         }

        /* 特殊状态样式 */
        .pipeline-step-card.completed {
            border-left: 5px solid #059669;
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.05), rgba(255, 255, 255, 0.97));
        }

        .pipeline-step-card.running {
            border-left: 5px solid #d97706;
            background: linear-gradient(135deg, rgba(217, 119, 6, 0.05), rgba(255, 255, 255, 0.97));
        }

        .pipeline-step-card.failed {
            border-left: 5px solid #dc2626;
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.05), rgba(255, 255, 255, 0.97));
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .rqa-pipeline-view {
                padding: 10px;
            }
            
            .rqa-pipeline-header {
                padding: 20px;
                margin-bottom: 30px;
            }
            
            .pipeline-step-card {
                margin-bottom: 20px;
            }
            
            .pipeline-control-panel {
                padding: 20px;
            }
        }
        
        /* ============ 新的RQA批量渲染样式 ============ */
        
        .rqa-render-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .rqa-filter-section {
            background: #e8f5e8;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .filter-row {
            display: flex;
            align-items: end;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 150px;
        }
        
        .filter-group label {
            font-size: 12px;
            font-weight: 500;
            color: #495057;
            margin-bottom: 5px;
        }
        
        .filter-group .form-control {
            height: 38px;
            font-size: 13px;
        }
        
        .multi-select-container {
            position: relative;
        }
        
        .multi-select {
            height: auto !important;
            max-height: 120px;
            overflow-y: auto;
        }
        
        .multi-select option {
            padding: 6px 8px;
        }
        
        .multi-select option:checked {
            background: #28a745;
            color: white;
        }
        
        #updateDisplayBtn {
            height: 38px;
            padding: 8px 16px;
            font-size: 13px;
        }
        
        .render-controls .btn {
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .render-progress {
            background: #fff;
            border-radius: 6px;
            padding: 15px;
            border: 1px solid #ddd;
        }
        
        .render-progress .progress {
            height: 8px;
            margin-bottom: 8px;
        }
        
        /* RQA紧凑筛选样式 */
        .rqa-compact-filters {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .rqa-compact-filters .filter-header {
            margin-bottom: 15px;
        }
        
        .rqa-compact-filters .filter-header h5 {
            margin: 0;
            color: #495057;
            font-size: 14px;
            font-weight: 600;
        }
        
        .filters-grid .filter-row {
            display: flex;
            align-items: end;
            gap: 15px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .filters-grid .filter-item {
            display: flex;
            flex-direction: column;
            min-width: 120px;
            flex: 1;
        }
        
        .filters-grid .filter-item label {
            font-size: 11px;
            font-weight: 500;
            color: #6c757d;
            margin-bottom: 3px;
            white-space: nowrap;
        }
        
        .filters-grid .form-control-sm {
            height: calc(1.5em + 0.5rem + 2px);
            font-size: 12px;
            padding: 0.25rem 0.5rem;
        }
        
        .filters-grid .btn-sm {
            height: calc(1.5em + 0.5rem + 2px);
            font-size: 12px;
            padding: 0.25rem 0.75rem;
            white-space: nowrap;
        }

        /* RQA图片展示样式 */
        .rqa-images-container {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            min-height: 400px;
        }
        
        /* 组别分组样式 */
        .group-section {
            margin-bottom: 30px;
        }
        
        .group-title {
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #dee2e6;
        }
        
        .rqa-row .row-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .rqa-row .row-header h6 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
            color: #6c757d;
        }
        
        .rqa-row .item-count {
            font-size: 12px;
            color: #6c757d;
            background: #f8f9fa;
            padding: 2px 8px;
            border-radius: 12px;
        }
        
        .rqa-row {
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .rqa-row .row-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 12px 20px;
            margin: 0;
        }
        
        .rqa-row .row-header h5 {
            margin: 0;
            font-weight: 600;
            font-size: 16px;
        }
        
        .images-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1px;
            padding: 8px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            /* 允许自动换行显示更多图片 */
            grid-auto-rows: min-content;
        }
        
        .image-item {
            display: flex;
            flex-direction: column;
            background: #fff;
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .image-item:hover {
            background: #f8f9fa;
            border-color: #28a745;
            z-index: 5;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }
        
        .image-container {
            width: 100%;
            aspect-ratio: 1;
            overflow: hidden;
            position: relative;
            background: #fff;
            cursor: pointer;
        }
        
        .image-container.empty {
            border-style: dashed;
            border-color: #ccc;
            background: #f8f9fa;
        }
        
        .empty-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            font-size: 14px;
            color: #999;
            gap: 4px;
        }
        
        .rqa-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .rqa-image:hover {
            transform: scale(1.05);
        }
        
        .image-label {
            padding: 6px 8px;
            font-size: 11px;
            font-weight: 600;
            color: #333;
            background: #f8f9fa;
            width: 100%;
            text-align: center;
            border-top: 1px solid #e0e0e0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* 图片放大模态框样式 */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        
        .image-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .image-modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .image-modal-header {
            padding: 12px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .image-modal-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }
        
        .image-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .image-modal-close:hover {
            background: #e9ecef;
            color: #666;
        }
        
        .image-modal-body {
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
        }
        
        .image-modal-img {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .image-tabs {
            display: flex;
            margin-bottom: 8px;
            border-bottom: 1px solid #ddd;
            border-radius: 4px 4px 0 0;
            overflow: hidden;
        }
        
        .tab-btn {
            flex: 1;
            padding: 6px 8px;
            border: none;
            background: #f8f9fa;
            color: #6c757d;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border-right: 1px solid #ddd;
        }
        
        .tab-btn:last-child {
            border-right: none;
        }
        
        .tab-btn:hover {
            background: #e9ecef;
            color: #495057;
        }
        
        .tab-btn.active {
            background: #28a745;
            color: white;
            font-weight: 500;
        }
        
        .image-content {
            position: relative;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        
        .no-results i {
            margin-bottom: 20px;
        }
        
        .no-results h4 {
            margin-bottom: 10px;
            color: #495057;
        }
        
        /* 响应式设计 */
        @media (max-width: 1200px) {
            .images-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 992px) {
            .images-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .images-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                padding: 15px;
            }
            
            .rqa-row .row-header {
                padding: 10px 15px;
            }
        }
        
        @media (max-width: 576px) {
            .images-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* 滑动条样式改进 */
        .input-group .form-control-range {
            flex: 1;
            margin-right: 10px;
        }
        
        .input-group-text {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
            background: #e9ecef;
            border-left: none;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header Banner -->
        <div class="header-banner">
            <div class="header-left">
                <h1>
                    <i class="fas fa-eye"></i>
                    <span data-lang-key="title">VR眼球追踪数据可视化平台</span>
                </h1>
                <p class="subtitle" data-lang-key="subtitle">三组认知功能评估的VR眼球追踪数据分析与可视化平台</p>
            </div>
            <div class="header-controls">
                <button class="restart-btn" onclick="restartServer()">
                    <i class="fas fa-redo"></i>
                    <span data-lang-key="restart">重启</span>
                </button>
                <div class="lang-switch">
                    <div class="lang-labels">
                        <span>中</span>
                        <label class="switch">
                            <input type="checkbox" id="langToggle" onchange="toggleLanguage()">
                            <span class="slider"></span>
                        </label>
                        <span>EN</span>
                    </div>
                </div>
                <div class="header-stats">
                    <p class="number" id="header-total-count">0</p>
                    <p class="label" data-lang-key="totalData">数据总数</p>
                </div>
            </div>
        </div>
                 
         <div class="main-content">
             <!-- 侧边栏 -->
             <div class="sidebar" id="sidebar">
                 <button class="sidebar-toggle" onclick="toggleSidebar()">
                     <i class="fas fa-bars" id="sidebarToggleIcon"></i>
                 </button>
                 <div class="sidebar-content">
                     <ul class="sidebar-nav">
                         <li>
                             <div class="sidebar-nav-item active" onclick="switchToVisualization()" data-view="visualization">
                                 <i class="fas fa-chart-line sidebar-nav-icon"></i>
                                 <span class="sidebar-nav-text" data-lang-key="dataVisualization">数据可视化</span>
                             </div>
                         </li>
                         <li>
                             <div class="sidebar-nav-item" onclick="switchToNewFeature()" data-view="newFeature">
                                 <i class="fas fa-magic sidebar-nav-icon"></i>
                                 <span class="sidebar-nav-text" data-lang-key="newFeature">新功能</span>
                             </div>
                         </li>
                         <li>
                             <div class="sidebar-nav-item" onclick="switchToRQAAnalysis()" data-view="rqaAnalysis">
                                 <i class="fas fa-project-diagram sidebar-nav-icon"></i>
                                 <span class="sidebar-nav-text" data-lang-key="rqaAnalysis">RQA分析</span>
                             </div>
                         </li>
                         <li>
                             <div class="sidebar-nav-item" onclick="switchToEventAnalysis()" data-view="eventAnalysis">
                                 <i class="fas fa-table sidebar-nav-icon"></i>
                                 <span class="sidebar-nav-text" data-lang-key="eventAnalysis">事件分析</span>
                             </div>
                         </li>
                         <li>
                             <div class="sidebar-nav-item" onclick="switchToRQAPipeline()" data-view="rqaPipeline">
                                 <i class="fas fa-cogs sidebar-nav-icon"></i>
                                 <span class="sidebar-nav-text" data-lang-key="rqaPipeline">RQA分析流程</span>
                             </div>
                         </li>
                         <li>
                             <div class="sidebar-nav-item" onclick="switchToFeatureExtraction()" data-view="featureExtraction">
                                 <i class="fas fa-brain sidebar-nav-icon"></i>
                                 <span class="sidebar-nav-text" data-lang-key="featureExtraction">综合特征提取</span>
                             </div>
                         </li>
                         <li>
                             <div class="sidebar-nav-item" onclick="switchToSeventhModule()" data-view="seventhModule">
                                 <i class="fas fa-code sidebar-nav-icon"></i>
                                <span class="sidebar-nav-text" data-lang-key="seventhModule">数据整理</span>
                            </div>
                        </li>
                        <li>
                            <div class="sidebar-nav-item" onclick="switchToEighthModule()" data-view="eighthModule">
                                <i class="fas fa-robot sidebar-nav-icon"></i>
                                <span class="sidebar-nav-text" data-lang-key="eighthModule">智能分析</span>
                             </div>
                         </li>
                         <li>
                            <div class="sidebar-nav-item" onclick="switchToNinthModule()" data-view="ninthModule">
                                <i class="fas fa-brain sidebar-nav-icon"></i>
                                <span class="sidebar-nav-text" data-lang-key="ninthModule">机器学习</span>
                             </div>
                         </li>
                         <li>
                            <div class="sidebar-nav-item" onclick="switchToTenthModule()" data-view="tenthModule">
                                <i class="fas fa-eye sidebar-nav-icon"></i>
                                <span class="sidebar-nav-text" data-lang-key="tenthModule">Eye-Index评估</span>
                             </div>
                         </li>
                     </ul>
                 </div>
             </div>
             
             <!-- 内容区域 -->
             <div class="content-wrapper">
                                 <!-- 数据可视化模块 - 动态加载容器 -->
                <div id="visualizationModuleContainer">
                    <!-- 模块内容将从 modules/module1_visualization.html 动态加载 -->
                    <div style="text-align: center; padding: 60px; color: #6c757d;">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">初始化中...</span>
                            </div>
                        <h5>正在初始化数据可视化模块...</h5>
                        <p class="text-muted">✨ 第一个模块已拆分为独立文件</p>
                            </div>
                        </div>
                        
                 <!-- 数据导入模块 - 动态加载容器 -->
                 <div class="new-feature-view" id="newFeatureView" style="display: none;">
                     <div id="dataImportModuleContainer">
                         <!-- 模块内容将从 modules/module2_data_import.html 动态加载 -->
                         <div style="text-align: center; padding: 60px; color: #6c757d;">
                             <div class="spinner-border text-success mb-3" role="status">
                                 <span class="visually-hidden">初始化中...</span>
                         </div>
                             <h5>正在初始化数据导入模块...</h5>
                             <p class="text-muted">✨ 第二个模块已拆分为独立文件</p>
                             </div>
                             </div>
                             </div>
                 <!-- RQA分析模块 - 动态加载容器 -->
                 <div class="rqa-analysis-view" id="rqaAnalysisView" style="display: none;">
                     <div id="rqaAnalysisModuleContainer">
                         <!-- 模块内容将从 modules/module3_rqa_analysis.html 动态加载 -->
                         <div style="text-align: center; padding: 60px; color: #6c757d;">
                             <div class="spinner-border text-warning mb-3" role="status">
                                 <span class="visually-hidden">初始化中...</span>
                                     </div>
                             <h5>正在初始化RQA分析模块...</h5>
                             <p class="text-muted">✨ 第三个模块已拆分为独立文件</p>
                                         </div>
                                             </div>
                                         </div>
                                         
                              <!-- 事件分析模块 - 动态加载容器 -->
                 <div class="event-analysis-view" id="eventAnalysisView" style="display: none;">
                     <div id="eventAnalysisModuleContainer">
                         <!-- 模块内容将从 modules/module4_event_analysis.html 动态加载 -->
                         <div style="text-align: center; padding: 60px; color: #6c757d;">
                             <div class="spinner-border text-info mb-3" role="status">
                                 <span class="visually-hidden">初始化中...</span>
                         </div>
                             <h5>正在初始化事件分析模块...</h5>
                             <p class="text-muted">✨ 第四个模块已拆分为独立文件</p>
                             </div>
                         </div>
                             </div>
                             
                <!-- RQA分析流程模块 - 动态加载容器 -->
             <div class="rqa-pipeline-view" id="rqaPipelineView" style="display: none;">
                    <div id="rqaPipelineModuleContainer">
                        <!-- 模块内容将从 modules/module5_rqa_pipeline.html 动态加载 -->
                        <div style="text-align: center; padding: 60px; color: #6c757d;">
                            <div class="spinner-border text-secondary mb-3" role="status">
                                <span class="visually-hidden">初始化中...</span>
                     </div>
                            <h5>正在初始化RQA流程模块...</h5>
                            <p class="text-muted">✨ 第五个模块已拆分为独立文件</p>
                         </div>
                     </div>
                     </div>

                <!-- 综合特征提取模块 - 动态加载容器 -->
            <div class="comprehensive-feature-view" id="comprehensiveFeatureModule" style="display: none;">
                    <div id="comprehensiveFeatureModuleContainer">
                        <!-- 模块内容将从 modules/module6_comprehensive_feature.html 动态加载 -->
                        <div style="text-align: center; padding: 60px; color: #6c757d;">
                            <div class="spinner-border text-danger mb-3" role="status">
                                <span class="visually-hidden">初始化中...</span>
                     </div>
                            <h5>正在初始化综合特征提取模块...</h5>
                            <p class="text-muted">✨ 第六个模块已拆分为独立文件</p>
                 </div>
                                     </div>
                                 </div>
                                 
                <!-- 数据整理模块 - 归一化特征数据可视化 -->
                <div class="seventh-module-view" id="seventhModuleView" style="display: none;">
                    <div class="container-fluid" style="min-height: 800px; padding: 20px;">
                        <!-- 页面标题 -->
                        <div class="row mb-4">
                            <div class="col-12 text-center">
                                <h2 style="color: #007bff;"><i class="fas fa-database"></i> <span data-lang-key="dataOrganizationTitle">数据整理与特征可视化</span></h2>
                                <p class="text-muted" data-lang-key="dataOrganizationSubtitle">基于数据库三大范式设计的归一化特征数据分析</p>
                                     </div>
                        </div>

                        <!-- 状态栏 -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="alert alert-info" id="statusAlert">
                                    <i class="fas fa-info-circle"></i> <span id="statusText" data-lang-key="loadingNormalizedData">正在加载归一化特征数据...</span>
                                </div>
                            </div>
                        </div>

                        <!-- 数据统计概览 -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card border-primary">
                                    <div class="card-body text-center">
                                        <i class="fas fa-users fa-2x text-primary mb-2"></i>
                                        <h4 class="card-title text-primary" id="totalSubjects">60</h4>
                                        <p class="card-text" data-lang-key="totalSubjects">受试者总数</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-success">
                                    <div class="card-body text-center">
                                        <i class="fas fa-play-circle fa-2x text-success mb-2"></i>
                                        <h4 class="card-title text-success" id="totalSessions">305</h4>
                                        <p class="card-text" data-lang-key="totalSessions">游戏会话数</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-warning">
                                    <div class="card-body text-center">
                                        <i class="fas fa-tasks fa-2x text-warning mb-2"></i>
                                        <h4 class="card-title text-warning" id="totalTasks">5</h4>
                                        <p class="card-text" data-lang-key="vrMmseTasks">VR-MMSE任务</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-info">
                                    <div class="card-body text-center">
                                        <i class="fas fa-chart-line fa-2x text-info mb-2"></i>
                                        <h4 class="card-title text-info" id="totalFeatures">13</h4>
                                        <p class="card-text" data-lang-key="normalizedFeatures">归一化特征</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 主要内容区域 -->
                        <div class="row">
                            <!-- 左侧控制面板 -->
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0"><i class="fas fa-sliders-h"></i> <span data-lang-key="dataFilterConfig">数据筛选与配置</span></h5>
                                    </div>
                                    <div class="card-body">
                                        <!-- 任务选择 -->
                                        <div class="mb-4">
                                            <label class="form-label fw-bold">🎯 <span data-lang-key="selectTask">选择任务 (Q1-Q5)</span></label>
                                            <div class="btn-group-vertical d-grid gap-2" role="group">
                                                <input type="radio" class="btn-check" name="taskFilter" id="taskAll" value="all" checked>
                                                <label class="btn btn-outline-primary" for="taskAll">
                                                    <i class="fas fa-layer-group"></i> <span data-lang-key="allTasks">全部任务</span>
                                                </label>
                                                <input type="radio" class="btn-check" name="taskFilter" id="taskQ1" value="Q1">
                                                <label class="btn btn-outline-primary" for="taskQ1">
                                                    <i class="fas fa-1"></i> <span data-lang-key="taskQ1">任务 Q1</span>
                                                </label>
                                                <input type="radio" class="btn-check" name="taskFilter" id="taskQ2" value="Q2">
                                                <label class="btn btn-outline-primary" for="taskQ2">
                                                    <i class="fas fa-2"></i> <span data-lang-key="taskQ2">任务 Q2</span>
                                                </label>
                                                <input type="radio" class="btn-check" name="taskFilter" id="taskQ3" value="Q3">
                                                <label class="btn btn-outline-primary" for="taskQ3">
                                                    <i class="fas fa-3"></i> <span data-lang-key="taskQ3">任务 Q3</span>
                                                </label>
                                                <input type="radio" class="btn-check" name="taskFilter" id="taskQ4" value="Q4">
                                                <label class="btn btn-outline-primary" for="taskQ4">
                                                    <i class="fas fa-4"></i> <span data-lang-key="taskQ4">任务 Q4</span>
                                                </label>
                                                <input type="radio" class="btn-check" name="taskFilter" id="taskQ5" value="Q5">
                                                <label class="btn btn-outline-primary" for="taskQ5">
                                                    <i class="fas fa-5"></i> <span data-lang-key="taskQ5">任务 Q5</span>
                                                </label>
                                            </div>
                                        </div>

                                        <!-- 实验组选择 -->
                                        <div class="mb-4">
                                            <label class="form-label fw-bold">👥 <span data-lang-key="experimentalGroupFilter">实验组筛选</span></label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="groupAD" value="ad" checked>
                                                <label class="form-check-label" for="groupAD">
                                                    <span class="badge bg-danger me-2">AD</span><span data-lang-key="adGroupLabel">阿尔兹海默症组</span>
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="groupMCI" value="mci" checked>
                                                <label class="form-check-label" for="groupMCI">
                                                    <span class="badge bg-warning me-2">MCI</span><span data-lang-key="mciGroupLabel">轻度认知障碍组</span>
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="groupControl" value="control" checked>
                                                <label class="form-check-label" for="groupControl">
                                                    <span class="badge bg-success me-2">Control</span><span data-lang-key="controlGroupLabel">正常对照组</span>
                                                </label>
                                            </div>
                                        </div>

                                        <!-- 特征类型选择 -->
                                        <div class="mb-4">
                                            <label class="form-label fw-bold">📊 <span data-lang-key="featureType">特征类型</span></label>
                                            <select class="form-select" id="featureType">
                                                <option value="game_duration">🎮 游戏时长</option>
                                                <option value="roi_features">👁️ ROI特征 (3项)</option>
                                                <option value="rqa_1d_features">🔄 RQA-1D特征 (3项)</option>
                                                <option value="rqa_2d_features">🔄 RQA-2D特征 (3项)</option>
                                                <option value="rqa_features">🔄 RQA全部特征 (6项)</option>
                                                <option value="comprehensive">📈 综合对比 (10项)</option>
                                                <option value="all_features" selected>📊 全部特征 (10项)</option>
                                            </select>
                                        </div>

                                        <!-- 可视化类型选择 -->
                                        <div class="mb-4">
                                            <label class="form-label fw-bold">📋 <span data-lang-key="visualizationType">可视化类型</span></label>
                                            <select class="form-select" id="chartType">
                                                <option value="bar" selected>📊 柱状图</option>
                                                <option value="line">📈 折线图</option>
                                                <option value="scatter">🔸 散点图</option>
                                            </select>
                                        </div>

                                                        <!-- RQA配置选择 -->
                <div class="mb-4">
                    <label class="form-label fw-bold">⚙️ <span data-lang-key="rqaConfig">RQA参数配置</span></label>
                    <select class="form-select" id="rqaConfigSelect">
                        <option value="">正在加载RQA配置...</option>
                    </select>
                    <small class="form-text text-muted" data-lang-key="rqaConfigHelp">选择不同的RQA参数进行数据整合，系统将自动检测可用配置</small>
                </div>

                <!-- 归一化方法说明 -->
                <div class="mb-4">
                    <label class="form-label fw-bold">📊 <span data-lang-key="normalizationMethods">归一化方法说明</span></label>
                    <div class="card">
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-primary mb-2">🎮 <span data-lang-key="gameDurationTitle">游戏时长特征</span></h6>
                                    <p class="mb-2 small">
                                        <strong data-lang-key="gameDurationMethod">方法</strong>: <span data-lang-key="percentileClip">百分位数截断归一化</span><br>
                                        <strong data-lang-key="gameDurationRange">范围</strong>: <span data-lang-key="gameDurationRangeValue">5%-95%分位数</span><br>
                                        <strong data-lang-key="gameDurationReason">原因</strong>: <span data-lang-key="gameDurationReasonText">避免极端异常值(如0.1秒或4分钟)影响正常数据分布</span>
                                    </p>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-success mb-2">👁️ <span data-lang-key="roiTimeTitle">ROI时间特征</span></h6>
                                    <p class="mb-2 small">
                                        <strong data-lang-key="roiTimeMethod">方法</strong>: <span data-lang-key="percentileClip">百分位数截断归一化</span><br>
                                        <strong data-lang-key="roiTimeRange">范围</strong>: <span data-lang-key="roiTimeRangeValue">5%-98%分位数</span><br>
                                        <strong data-lang-key="roiTimeReason">原因</strong>: <span data-lang-key="roiTimeReasonText">保留更多有效数据，过滤注视时间异常值</span>
                                    </p>
                                </div>
                            </div>
                            <hr class="my-2">
                            <div class="row">
                                <div class="col-12">
                                    <h6 class="text-warning mb-2">🔄 <span data-lang-key="rqaFeaturesTitle">RQA递归量化特征</span></h6>
                                    <p class="mb-1 small">
                                        <strong data-lang-key="rqaFeaturesMethod">方法</strong>: <span data-lang-key="minMaxNormalization">标准Min-Max归一化</span><br>
                                        <strong data-lang-key="rqaFeaturesRange">范围</strong>: <span data-lang-key="rqaFeaturesRangeValue">[0, 1]</span><br>
                                        <strong data-lang-key="rqaFeaturesReason">原因</strong>: <span data-lang-key="rqaFeaturesReasonText">RQA特征(RR、DET、ENT)具有理论范围限制，无需截断处理</span>
                                    </p>
                                    <div class="small text-muted">
                                        <span data-lang-key="rqaFeaturesList">包含: RR-1D, DET-1D, ENT-1D, RR-2D, DET-2D, ENT-2D</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                                        <!-- 操作按钮 -->
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-primary" id="refreshData">
                                                <i class="fas fa-sync-alt"></i> <span data-lang-key="loadRealData">加载真实数据</span>
                                            </button>
                                            <button class="btn btn-success" id="generateChart">
                                                <i class="fas fa-chart-bar"></i> <span data-lang-key="generateChart">生成图表</span>
                                            </button>
                                            <button class="btn btn-info" id="exportData">
                                                <i class="fas fa-download"></i> <span data-lang-key="exportData">导出数据</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 右侧数据展示区域 -->
                            <div class="col-md-8">
                                <!-- 图表区域 -->
                                <div class="card mb-3">
                                    <div class="card-header bg-success text-white">
                                        <h5 class="mb-0"><i class="fas fa-chart-area"></i> <span data-lang-key="dataVisualizationChart">数据可视化图表</span></h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="chartContainer" style="height: 500px; position: relative;">
                                            <div class="d-flex align-items-center justify-content-center h-100">
                                                <div class="text-center text-muted">
                                                    <i class="fas fa-chart-line fa-3x mb-3"></i>
                                                    <h5 data-lang-key="clickGenerateChart">点击"生成图表"开始数据可视化</h5>
                                                    <p data-lang-key="chartGenerationDesc">选择任务、实验组和特征类型后生成对应的统计图表</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 数据表格 -->
                                <div class="card">
                                    <div class="card-header bg-secondary text-white">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0"><i class="fas fa-table"></i> <span data-lang-key="normalizedFeatureTable">归一化特征数据表格</span></h5>
                                            <span class="badge bg-light text-dark" id="tableRowCount" data-lang-key="tableRowCountText">0 行</span>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                                            <table class="table table-striped table-hover" id="dataTable">
                                                <thead class="table-dark sticky-top">
                                                    <tr>
                                                        <th data-lang-key="sessionId">会话ID</th>
                                                        <th data-lang-key="subject">受试者</th>
                                                        <th data-lang-key="task">任务</th>
                                                        <th data-lang-key="experimentalGroup">实验组</th>
                                                        <th data-lang-key="gameDuration">游戏时长</th>
                                                        <th data-lang-key="kwRoi">KW-ROI</th>
                                                        <th data-lang-key="instRoi">INST-ROI</th>
                                                        <th data-lang-key="bgRoi">BG-ROI</th>
                                                        <th data-lang-key="rr1d">RR-1D</th>
                                                        <th data-lang-key="det1d">DET-1D</th>
                                                        <th data-lang-key="ent1d">ENT-1D</th>
                                                        <th data-lang-key="rr2d">RR-2D</th>
                                                        <th data-lang-key="det2d">DET-2D</th>
                                                        <th data-lang-key="ent2d">ENT-2D</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td colspan="14" class="text-center text-muted">
                                                            <i class="fas fa-database"></i> <span data-lang-key="clickRefreshData">点击"刷新数据"加载归一化特征数据</span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 第八模块 - 智能分析模块 -->
                <div class="eighth-module-view" id="eighthModuleView" style="display: none;">
                    <div class="container-fluid" style="min-height: 800px; padding: 20px;">
                        <!-- 页面标题 -->
                        <div class="row mb-4">
                            <div class="col-12 text-center">
                                <h2 style="color: #28a745;"><i class="fas fa-robot"></i> <span data-lang-key="intelligentAnalysisTitle">智能分析与AI辅助</span></h2>
                                <p class="text-muted" data-lang-key="intelligentAnalysisSubtitle">基于机器学习和人工智能的眼动数据智能分析平台</p>
                            </div>
                        </div>

                        <!-- 状态栏 -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="alert alert-success" id="aiStatusAlert">
                                    <i class="fas fa-brain"></i> <span id="aiStatusText" data-lang-key="loadingAiEngine">正在初始化AI分析引擎...</span>
                                </div>
                            </div>
                        </div>

                        <!-- AI功能概览卡片 -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card border-success">
                                    <div class="card-body text-center">
                                        <i class="fas fa-search-plus fa-2x text-success mb-2"></i>
                                        <h4 class="card-title text-success" id="patternCount">0</h4>
                                        <p class="card-text" data-lang-key="patternsDetected">检测到的模式</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-warning">
                                    <div class="card-body text-center">
                                        <i class="fas fa-chart-pie fa-2x text-warning mb-2"></i>
                                        <h4 class="card-title text-warning" id="predictionAccuracy">85%</h4>
                                        <p class="card-text" data-lang-key="predictionAccuracy">预测准确率</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-info">
                                    <div class="card-body text-center">
                                        <i class="fas fa-lightbulb fa-2x text-info mb-2"></i>
                                        <h4 class="card-title text-info" id="insightCount">12</h4>
                                        <p class="card-text" data-lang-key="aiInsights">AI洞察</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-danger">
                                    <div class="card-body text-center">
                                        <i class="fas fa-exclamation-triangle fa-2x text-danger mb-2"></i>
                                        <h4 class="card-title text-danger" id="anomaliesDetected">3</h4>
                                        <p class="card-text" data-lang-key="anomaliesDetected">异常检测</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 控制面板区域 -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header bg-info text-white">
                                        <h5 class="mb-0"><i class="fas fa-chart-line"></i> <span data-lang-key="eyeMovementMMSEAnalysis">眼动系数与MMSE对比分析</span></h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <!-- 数据源选择 -->
                                            <div class="col-md-4">
                                                <label class="form-label fw-bold">📊 <span data-lang-key="module7DataSource">模块7数据源选择</span></label>
                                                <select class="form-select" id="module7DataSourceSelect">
                                                    <option value="" data-lang-key="selectRqaConfig">请选择RQA配置数据...</option>
                                                </select>
                                                <small class="form-text text-muted" data-lang-key="module7DataSourceHelp">选择已处理的模块7归一化特征数据进行分析</small>
                                            </div>
                                            
                                            <!-- 数据概览 -->
                                            <div class="col-md-4">
                                                <div class="card bg-light h-100">
                                                    <div class="card-body p-3">
                                                        <h6 class="card-title mb-2">📈 <span data-lang-key="dataOverview">数据概览</span></h6>
                                                        <div class="row text-center">
                                                            <div class="col-6">
                                                                <div class="text-primary">
                                                                    <strong id="eyeMovementCount">0</strong>
                                                                    <br><small data-lang-key="eyeMovementPatterns">眼动模式</small>
                                                                </div>
                                                            </div>
                                                            <div class="col-6">
                                                                <div class="text-success">
                                                                    <strong id="mmseScoreCount">0</strong>
                                                                    <br><small data-lang-key="mmseScores">MMSE分数</small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- 操作按钮 -->
                                            <div class="col-md-4">
                                                <div class="d-grid gap-2">
                                                    <button class="btn btn-primary" id="loadEyeMovementData" disabled>
                                                        <i class="fas fa-database"></i> <span data-lang-key="loadEyeMovementData">加载眼动数据</span>
                                                    </button>
                                                    <button class="btn btn-success" id="calculateCoefficients" disabled>
                                                        <i class="fas fa-calculator"></i> <span data-lang-key="calculateCoefficients">计算眼动系数</span>
                                                    </button>
                                                    <button class="btn btn-info" id="compareWithMMSE" disabled>
                                                        <i class="fas fa-chart-line"></i> <span data-lang-key="compareWithMMSE">MMSE对比分析</span>
                                                    </button>
                                                    <button class="btn btn-warning" id="exportComparisonReport" disabled>
                                                        <i class="fas fa-file-download"></i> <span data-lang-key="exportComparisonReport">导出对比报告</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 结果展示区域 -->
                        <div class="row">
                            <div class="col-12">
                                <!-- 眼动特征指标说明 -->
                                <div class="card mb-3">
                                    <div class="card-header bg-secondary text-white">
                                        <h6 class="mb-0"><i class="fas fa-info-circle"></i> <span data-lang-key="eyeMovementIndicators">眼动特征指标说明</span></h6>
                                    </div>
                                    <div class="card-body p-3">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="d-flex align-items-center mb-2">
                                                    <span class="badge bg-danger me-2">↓</span>
                                                    <strong class="text-danger" data-lang-key="lowerIsBetter">越低越好指标</strong>
                                                </div>
                                                <div class="small text-muted ps-4">
                                                    <div>• <span data-lang-key="gameDuration">游戏时长</span> (game_duration)</div>
                                                    <div>• <span data-lang-key="kwRoiTime">关键词ROI时间</span> (kw_roi_time)</div>
                                                    <div>• <span data-lang-key="instRoiTime">指令ROI时间</span> (inst_roi_time)</div>
                                                    <div>• <span data-lang-key="bgRoiTime">背景ROI时间</span> (bg_roi_time)</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="d-flex align-items-center mb-2">
                                                    <span class="badge bg-success me-2">↑</span>
                                                    <strong class="text-success" data-lang-key="higherIsBetter">越高越好指标</strong>
                                                </div>
                                                <div class="small text-muted ps-4">
                                                    <div>• <span data-lang-key="rqaFeatures">RQA特征</span>: RR-1D, DET-1D, ENT-1D</div>
                                                    <div>• <span data-lang-key="rqa2dFeatures">RQA-2D特征</span>: RR-2D, DET-2D, ENT-2D</div>
                                                    <div class="text-info mt-1"><small data-lang-key="rqaDescription">反映眼动模式的复杂性和规律性</small></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="alert alert-info mt-3 mb-0 py-2">
                                            <small><i class="fas fa-lightbulb me-1"></i> 
                                            <span data-lang-key="coefficientCalculation">眼动系数 = (反向处理的时间指标 + 正向RQA指标) / 10，确保所有指标方向一致</span>
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <!-- 眼动系数与MMSE对比可视化 -->
                                <div class="card mb-3">
                                    <div class="card-header bg-info text-white">
                                        <h5 class="mb-0"><i class="fas fa-chart-scatter"></i> <span data-lang-key="eyeMovementMMSEComparison">眼动系数与MMSE分数对比</span></h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="comparisonChartContainer" style="min-height: 800px; position: relative;">
                                            <div class="d-flex align-items-center justify-content-center h-100">
                                                <div class="text-center text-muted">
                                                    <i class="fas fa-chart-line fa-3x mb-3"></i>
                                                    <h5 data-lang-key="clickStartComparison">点击"MMSE对比分析"开始分析</h5>
                                                    <p data-lang-key="comparisonAnalysisDesc">分析眼动系数与MMSE认知评分的相关性</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 对比分析结果表格 -->
                                <div class="card">
                                    <div class="card-header bg-warning text-dark">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0"><i class="fas fa-table"></i> <span data-lang-key="comparisonResultsTable">眼动系数与MMSE对比结果</span></h5>
                                            <div class="d-flex gap-2">
                                                <button class="btn btn-sm btn-outline-dark" id="toggleViewMode">
                                                    <span data-lang-key="switchToGroupView">切换到群体视图</span>
                                                </button>
                                                <button class="btn btn-sm btn-outline-info" id="toggleDetailMode" onclick="toggleDetailMode()">
                                                    <span data-lang-key="switchToSubQuestionView">切换到子问题详细视图</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                                            <table class="table table-striped table-hover" id="comparisonTable">
                                                <thead class="table-dark sticky-top" id="comparisonTableHead">
                                                    <!-- 个人视图表头 -->
                                                    <tr id="individualViewHeaders">
                                                        <th data-lang-key="subjectId">受试者ID</th>
                                                        <th data-lang-key="taskId">任务</th>
                                                        <th data-lang-key="groupType">组别</th>
                                                        <th data-lang-key="eyeMovementCoeff">眼动系数</th>
                                                        <th data-lang-key="mmseScore">MMSE分数</th>
                                                        <th data-lang-key="mmseMaxScore">满分</th>
                                                        <th data-lang-key="performanceRatio">完成率</th>
                                                    </tr>
                                                    <!-- 群体视图表头 (初始隐藏) -->
                                                    <tr id="groupViewHeaders" style="display: none;">
                                                        <th data-lang-key="groupType">组别</th>
                                                        <th data-lang-key="taskId">任务</th>
                                                        <th data-lang-key="avgEyeMovementCoeff">平均眼动系数</th>
                                                        <th data-lang-key="avgMmseScore">平均MMSE分数</th>
                                                        <th data-lang-key="subjectCount">受试者数量</th>
                                                        <th data-lang-key="correlationCoeff">相关系数</th>
                                                        <th data-lang-key="standardDeviation">标准差</th>
                                                    </tr>
                                                    <!-- 子问题详细视图表头 (初始隐藏) -->
                                                    <tr id="subQuestionViewHeaders" style="display: none;">
                                                        <th data-lang-key="subjectId">受试者ID</th>
                                                        <th data-lang-key="taskId">任务</th>
                                                        <th data-lang-key="subQuestionName">子问题</th>
                                                        <th data-lang-key="groupType">组别</th>
                                                        <th data-lang-key="eyeMovementCoeff">眼动系数</th>
                                                        <th data-lang-key="subQuestionScore">子问题分数</th>
                                                        <th data-lang-key="subQuestionMaxScore">满分</th>
                                                        <th data-lang-key="subQuestionPerformanceRatio">完成率</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="comparisonTableBody">
                                                    <tr>
                                                        <td colspan="7" class="text-center text-muted">
                                                            <i class="fas fa-chart-line"></i> <span data-lang-key="noComparisonData">点击"MMSE对比分析"加载对比数据</span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                     </div>
                                     </div>
                                 </div>
             
     </div> <!-- 结束 content-wrapper -->
     </div> <!-- 结束 main-content -->

    <!-- 第九模块 - 机器学习预测模块 -->
    <div class="ninth-module-view" id="ninthModuleView" style="display: none;">
        <div class="container-fluid" style="min-height: 800px; padding: 20px;">
            <!-- 页面标题 -->
            <div class="row mb-4">
                <div class="col-12 text-center">
                    <h2 style="color: #28a745;"><i class="fas fa-brain"></i> <span data-lang-key="machineLearningTitle">机器学习预测分析</span></h2>
                    <p class="text-muted" data-lang-key="machineLearningSubtitle">基于眼动特征的MMSE子分数智能预测系统</p>
                </div>
            </div>

            <!-- 子模块9.1: 数据预处理与整合 -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fas fa-database"></i> <span data-lang-key="dataPreprocessingTitle">子模块9.1 - 数据预处理与整合</span></h5>
                        </div>
                        <div class="card-body">
                            <!-- 配置选择区域 -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="mlRqaConfigSelect" class="form-label"><span data-lang-key="selectRqaConfig">选择RQA配置</span></label>
                                    <select class="form-select" id="mlRqaConfigSelect">
                                        <option value=""><span data-lang-key="loadingConfigs">加载中...</span></option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label"><span data-lang-key="dataStatus">数据状态</span></label>
                                    <div class="d-flex flex-column gap-1">
                                        <span id="mlDataStatus" class="badge bg-secondary"><span data-lang-key="notProcessed">未处理</span></span>
                                        <small class="text-muted" id="mlDataStatusDetail">选择RQA配置开始处理</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label"><span data-lang-key="actions">操作</span></label>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-primary" id="preprocessDataBtn" onclick="startDataPreprocessing()" disabled>
                                            <i class="fas fa-play"></i> <span data-lang-key="startPreprocessing">开始预处理</span>
                                        </button>
                                        <button class="btn btn-outline-secondary" id="refreshDataBtn" onclick="refreshMLData()" disabled>
                                            <i class="fas fa-refresh"></i> <span data-lang-key="refreshData">刷新</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 特征方向一致性校正配置 -->
                            <div class="row mb-3">
                                <div class="col-12">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <h6 class="card-title">
                                                <i class="fas fa-arrows-alt-v text-primary"></i> 
                                                <span data-lang-key="featureDirectionCorrection">特征方向一致性校正</span>
                                                <span class="badge bg-info ms-2">推荐</span>
                                            </h6>
                                            
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="checkbox" id="enableFeatureCorrection" checked>
                                                        <label class="form-check-label" for="enableFeatureCorrection">
                                                            <strong><span data-lang-key="enableDirectionCorrection">启用方向一致性校正</span></strong>
                                                        </label>
                                                    </div>
                                                    <small class="text-muted">
                                                        <i class="fas fa-info-circle text-info"></i> 
                                                        <span data-lang-key="directionCorrectionHint">
                                                            统一所有特征为"数值越高=认知越好"方向
                                                        </span>
                                                    </small>
                                                </div>
                                                
                                                <div class="col-md-6">
                                                    <div class="small text-secondary">
                                                        <strong><span data-lang-key="transformMethods">变换方法</span>:</strong><br>
                                                        • <span class="text-danger">游戏时长</span>: 倒数变换 (1/x)<br>
                                                        • <span class="text-danger">ROI停留时长</span>: 负号变换 (-x)<br>
                                                        • <span class="text-success">RQA参数</span>: 保持不变
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- 验证状态 -->
                                            <div class="row mt-2" id="directionValidationStatus" style="display: none;">
                                                <div class="col-12">
                                                    <div class="alert alert-info alert-sm mb-0" role="alert">
                                                        <small>
                                                            <i class="fas fa-check-circle text-success"></i>
                                                            <span id="validationMessage">所有特征已统一为正相关方向</span>
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 数据统计展示区域 -->
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="text-center p-3 bg-light rounded">
                                        <h4 class="text-primary" id="mlTotalSamples">-</h4>
                                        <small class="text-muted"><span data-lang-key="totalSamples">总样本数</span></small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center p-3 bg-light rounded">
                                        <h4 class="text-success" id="mlTrainSamples">-</h4>
                                        <small class="text-muted"><span data-lang-key="trainSamples">训练集样本</span></small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center p-3 bg-light rounded">
                                        <h4 class="text-info" id="mlTestSamples">-</h4>
                                        <small class="text-muted"><span data-lang-key="testSamples">测试集样本</span></small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center p-3 bg-light rounded">
                                        <h4 class="text-warning" id="mlFeatureCount">-</h4>
                                        <small class="text-muted"><span data-lang-key="featureCount">特征数量</span></small>
                                    </div>
                                </div>
                            </div>

                            <!-- 处理日志区域 -->
                            <div class="row mt-3">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h6 class="mb-0"><i class="fas fa-terminal"></i> <span data-lang-key="processingLog">处理日志</span></h6>
                                        </div>
                                        <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                                            <pre id="mlProcessingLog" class="mb-0" style="font-size: 12px; background: #f8f9fa; border: none;"><span data-lang-key="noLogYet">暂无日志...</span></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 子模块9.2: 模型训练 (暂时隐藏) -->
            <div class="row mb-4" id="modelTrainingSection" style="display: none;">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0"><i class="fas fa-cogs"></i> <span data-lang-key="modelTrainingTitle">子模块9.2 - MLP模型训练</span></h5>
                        </div>
                        <div class="card-body">
                            <!-- 训练配置区域 -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <h6><i class="fas fa-sliders-h"></i> <span data-lang-key="trainingConfig">训练配置</span></h6>
                                    
                                    <!-- 模型预设配置 -->
                                    <div class="form-group mb-3">
                                        <label class="form-label"><span data-lang-key="modelPreset">模型预设</span></label>
                                        <select id="modelPresetSelect" class="form-control" onchange="onModelPresetChange()">
                                            <option value="simple">Simple (32) - 防过拟合推荐</option>
                                            <option value="moderate">Moderate (64,32) - 中等复杂度</option>
                                            <option value="complex">Complex (64,32,16) - 需大样本</option>
                                            <option value="custom">Custom - 自定义配置</option>
                                        </select>
                                        <small class="text-muted"><span data-lang-key="modelPresetHint">专家建议: Simple模型适合当前60样本数据集</span></small>
                                    </div>
                                    
                                    <!-- 自定义隐藏层配置 -->
                                    <div class="form-group mb-3" id="customLayersGroup" style="display: none;">
                                        <label class="form-label"><span data-lang-key="hiddenLayers">隐藏层配置</span></label>
                                        <input type="text" id="hiddenLayersConfig" class="form-control" value="32" 
                                               placeholder="例如: 32 或 64,32">
                                        <small class="text-muted"><span data-lang-key="hiddenLayersHint">用逗号分隔，例如32表示单层，64,32表示双层</span></small>
                                    </div>
                                    
                                    <!-- 训练方法选择（专家优化） -->
                                    <div class="form-group mb-3">
                                        <label class="form-label">
                                            <i class="fas fa-chart-line"></i> 
                                            <span data-lang-key="trainingMethod">训练方法</span>
                                            <span class="badge bg-warning text-dark ms-2">专家推荐</span>
                                        </label>
                                        <select id="trainingMethodSelect" class="form-control" onchange="onTrainingMethodChange()">
                                            <option value="single">单模型训练 (Standard)</option>
                                            <option value="cv" selected>5-fold交叉验证 (Expert Recommended)</option>
                                        </select>
                                        <small class="text-muted">
                                            <i class="fas fa-info-circle text-info"></i>
                                            <span data-lang-key="trainingMethodHint">专家建议: CV能显著提升小样本模型性能和稳定性</span>
                                        </small>
                                    </div>
                                    
                                    <!-- CV参数配置 -->
                                    <div id="cvParamsGroup" class="form-group mb-3">
                                        <label class="form-label">
                                            <span data-lang-key="cvParams">交叉验证参数</span>
                                        </label>
                                        <div class="row">
                                            <div class="col-4">
                                                <label class="form-label small">折叠数</label>
                                                <input type="number" id="cvFoldsConfig" class="form-control form-control-sm" value="5" min="3" max="10" readonly>
                                            </div>
                                            <div class="col-4">
                                                <label class="form-label small">早停轮数</label>
                                                <input type="number" id="cvPatienceConfig" class="form-control form-control-sm" value="10" min="5" max="20">
                                            </div>
                                            <div class="col-4">
                                                <label class="form-label small">最大轮数</label>
                                                <input type="number" id="cvEpochsConfig" class="form-control form-control-sm" value="200" min="50" max="500">
                                            </div>
                                        </div>
                                        <div class="row mt-2">
                                            <div class="col-6">
                                                <label class="form-label small">CV Dropout</label>
                                                <input type="number" id="cvDropoutConfig" class="form-control form-control-sm" value="0.35" min="0.1" max="0.8" step="0.05">
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label small">CV L2正则</label>
                                                <input type="number" id="cvL2Config" class="form-control form-control-sm" value="0.001" min="0.0001" max="0.01" step="0.0001">
                                            </div>
                                        </div>
                                        <small class="text-muted">
                                            <i class="fas fa-chart-bar text-success"></i>
                                            专家优化: 5折CV + 早停 + 强正则化 + 标签归一化 + 10特征精选，针对60样本优化
                                        </small>
                                        <div class="alert alert-info mt-2 mb-0">
                                            <i class="fas fa-info-circle"></i>
                                            <strong>标签归一化:</strong> MMSE子分数归一化到[0,1]区间训练，显著提升多输出回归效果
                                        </div>
                                        <div class="alert alert-success mt-2 mb-0">
                                            <i class="fas fa-filter"></i>
                                            <strong>专家特征选择:</strong> 精选10个核心眼动特征
                                            <br><small>• 4个基础指标: game_duration, KW_ROI_time, INST_ROI_time, BG_ROI_time</small>
                                            <br><small>• 6个RQA参数: RR_1D, DET_1D, ENT_1D, RR_2D, DET_2D, ENT_2D</small>
                                        </div>
                                    </div>
                                    
                                    <!-- 正则化配置 -->
                                    <div class="form-group mb-3" id="regularizationGroup">
                                        <label class="form-label"><span data-lang-key="regularization">正则化设置</span></label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="useDropout" checked>
                                            <label class="form-check-label" for="useDropout">
                                                <span data-lang-key="useDropout">使用Dropout</span>
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="useL2Reg" checked>
                                            <label class="form-check-label" for="useL2Reg">
                                                <span data-lang-key="useL2Reg">使用L2正则化</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <!-- 正则化参数 -->
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-group mb-3">
                                                <label class="form-label"><span data-lang-key="dropoutRate">Dropout比率</span></label>
                                                <input type="number" id="dropoutRateConfig" class="form-control" value="0.3" min="0.1" max="0.8" step="0.1">
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="form-group mb-3">
                                                <label class="form-label"><span data-lang-key="l2Lambda">L2正则化系数</span></label>
                                                <input type="number" id="l2LambdaConfig" class="form-control" value="0.01" min="0.001" max="0.1" step="0.001">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-group mb-3">
                                                <label class="form-label"><span data-lang-key="epochs">训练轮数</span></label>
                                                <input type="number" id="epochsConfig" class="form-control" value="100" min="1" max="1000">
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="form-group mb-3">
                                                <label class="form-label"><span data-lang-key="batchSize">批大小</span></label>
                                                <input type="number" id="batchSizeConfig" class="form-control" value="8" min="4" max="32">
                                                <small class="text-muted">专家建议: 8最适合48个训练样本</small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-group mb-3">
                                                <label class="form-label"><span data-lang-key="learningRate">学习率</span></label>
                                                <input type="number" id="learningRateConfig" class="form-control" value="0.001" min="0.0001" max="0.1" step="0.0001">
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="form-group mb-3">
                                                <label class="form-label"><span data-lang-key="validationSplit">验证集比例</span></label>
                                                <input type="number" id="validationSplitConfig" class="form-control" value="0.2" min="0.1" max="0.3" step="0.05">
                                                <small class="text-muted">专家建议: 0.2 (约10个样本)</small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group mb-3">
                                        <label class="form-label"><span data-lang-key="earlyStopping">早停轮数</span></label>
                                        <input type="number" id="earlyStoppingConfig" class="form-control" value="15" min="5" max="50">
                                        <small class="text-muted"><span data-lang-key="earlyStoppingHint">验证损失多少轮不改善后停止训练</span></small>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <h6><i class="fas fa-chart-line"></i> <span data-lang-key="trainingStatus">训练状态</span></h6>
                                    
                                    <!-- 状态显示 -->
                                    <div class="mb-3">
                                        <span class="badge badge-secondary" id="mlTrainingStatus"><span data-lang-key="waitingToTrain">等待训练</span></span>
                                        <span class="ml-2" id="mlTrainingDetail">-</span>
                                    </div>
                                    
                                    <!-- 统计信息 -->
                                    <div class="row text-center">
                                        <div class="col-6 mb-2">
                                            <div class="bg-light p-2 rounded">
                                                <strong class="text-primary" id="mlCurrentEpoch">-</strong><br>
                                                <small class="text-muted"><span data-lang-key="currentEpoch">当前轮数</span></small>
                                            </div>
                                        </div>
                                        <div class="col-6 mb-2">
                                            <div class="bg-light p-2 rounded">
                                                <strong class="text-info" id="mlTrainingLoss">-</strong><br>
                                                <small class="text-muted"><span data-lang-key="trainingLoss">训练损失</span></small>
                                            </div>
                                        </div>
                                        <div class="col-6 mb-2">
                                            <div class="bg-light p-2 rounded">
                                                <strong class="text-warning" id="mlValidationLoss">-</strong><br>
                                                <small class="text-muted"><span data-lang-key="validationLoss">验证损失</span></small>
                                            </div>
                                        </div>
                                        <div class="col-6 mb-2">
                                            <div class="bg-light p-2 rounded">
                                                <strong class="text-success" id="mlTestMAE">-</strong><br>
                                                <small class="text-muted"><span data-lang-key="testMAE">测试MAE</span></small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 训练操作按钮 -->
                            <div class="row mb-3">
                                <div class="col-12">
                                    <button class="btn btn-success" id="startTrainingBtn" onclick="startTraining()">
                                        <i class="fas fa-play"></i> <span data-lang-key="startTraining">开始训练</span>
                                    </button>
                                    <button class="btn btn-warning ml-2" id="resetTrainingBtn" onclick="resetTrainingUI()">
                                        <i class="fas fa-redo"></i> <span data-lang-key="resetTraining">重置</span>
                                    </button>
                                    <button class="btn btn-info ml-2" id="viewTrainingLogBtn" onclick="toggleTrainingLog()">
                                        <i class="fas fa-eye"></i> <span data-lang-key="viewTrainingLog">查看日志</span>
                                    </button>
                                </div>
                            </div>
                            
                                                            <!-- 训练日志区域 (可折叠) -->
                                <div class="row" id="trainingLogSection" style="display: none;">
                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="mb-0"><i class="fas fa-terminal"></i> <span data-lang-key="trainingLog">训练日志</span></h6>
                                            </div>
                                            <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                                                <pre id="mlTrainingLog" class="mb-0" style="font-size: 12px; background: #f8f9fa; border: none;"><span data-lang-key="noTrainingLogYet">暂无训练日志...</span></pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 测试集评估结果表格 -->
                
                
                <!-- CV结果展示区域（专家优化版） -->
                <div class="row mt-3" id="cvResultsSection" style="display: none;">
                    <div class="col-12">
                        <div class="card border-success">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-chart-line"></i> 
                                    <span data-lang-key="cvResults">5-fold交叉验证结果</span>
                                    <span class="badge bg-warning text-dark ms-2">专家优化</span>
                                </h6>
                            </div>
                            <div class="card-body">
                                <!-- 集成性能指标 -->
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <div class="text-center p-2 bg-primary bg-opacity-10 rounded">
                                            <h5 class="text-primary mb-1" id="cvEnsembleRMSE">-</h5>
                                            <small class="text-muted">集成 RMSE</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center p-2 bg-success bg-opacity-10 rounded">
                                            <h5 class="text-success mb-1" id="cvEnsembleMAE">-</h5>
                                            <small class="text-muted">集成 MAE</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center p-2 bg-info bg-opacity-10 rounded">
                                            <h5 class="text-info mb-1" id="cvEnsembleR2">-</h5>
                                            <small class="text-muted">集成 R²</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center p-2 bg-warning bg-opacity-10 rounded">
                                            <h5 class="text-warning mb-1" id="cvMeanRMSE">-</h5>
                                            <small class="text-muted">CV RMSE ± STD</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 折叠详细结果 -->
                                <div class="row mb-3">
                                    <div class="col-12">
                                        <h6><i class="fas fa-table"></i> 各折叠详细结果</h6>
                                        <div class="table-responsive">
                                            <table class="table table-sm table-bordered">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>折叠</th>
                                                        <th>验证 RMSE</th>
                                                        <th>验证 MAE</th>
                                                        <th>验证 R²</th>
                                                        <th>最佳轮次</th>
                                                        <th>训练损失</th>
                                                        <th>验证损失</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="cvFoldResults">
                                                    <!-- 动态填充 -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 详细子分数性能 -->
                                <div class="row mb-3">
                                    <div class="col-12">
                                        <h6><i class="fas fa-chart-bar"></i> 集成模型各子分数性能</h6>
                                        <div class="table-responsive">
                                            <table class="table table-sm table-bordered">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>MMSE子分数</th>
                                                        <th>RMSE</th>
                                                        <th>MAE</th>
                                                        <th>R²</th>
                                                        <th>相对误差</th>
                                                        <th>性能等级</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="cvDetailedResults">
                                                    <!-- 动态填充 -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- CV训练进度 -->
                                <div class="row" id="cvTrainingProgress" style="display: none;">
                                    <div class="col-12">
                                        <h6><i class="fas fa-spinner fa-spin"></i> 训练进度</h6>
                                        <div class="progress mb-2">
                                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                                 id="cvProgressBar" role="progressbar" style="width: 0%">
                                                <span id="cvProgressText">0/5 折叠完成</span>
                                            </div>
                                        </div>
                                        <div class="small text-muted" id="cvCurrentStatus">正在初始化...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-3" id="testEvaluationSection" style="display: none;">
                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-header bg-info text-white">
                                                <h6 class="mb-0"><i class="fas fa-chart-bar"></i> <span data-lang-key="testEvaluationResults">测试集评估结果</span></h6>
                                            </div>
                                            <div class="card-body">
                                                <!-- 整体性能指标 -->
                                                <div class="row mb-3">
                                                    <div class="col-12">
                                                        <h6><i class="fas fa-bullseye"></i> <span data-lang-key="overallPerformance">整体性能指标</span></h6>
                                                        <div class="row text-center">
                                                            <div class="col-3">
                                                                <div class="bg-light p-2 rounded">
                                                                    <strong class="text-primary" id="overallMSE">-</strong><br>
                                                                    <small class="text-muted">TEST MSE</small>
                                                                </div>
                                                            </div>
                                                            <div class="col-3">
                                                                <div class="bg-light p-2 rounded">
                                                                    <strong class="text-info" id="overallRMSE">-</strong><br>
                                                                    <small class="text-muted">TEST RMSE</small>
                                                                </div>
                                                            </div>
                                                            <div class="col-3">
                                                                <div class="bg-light p-2 rounded">
                                                                    <strong class="text-warning" id="overallMAE">-</strong><br>
                                                                    <small class="text-muted">TEST MAE</small>
                                                                </div>
                                                            </div>
                                                            <div class="col-3">
                                                                <div class="bg-light p-2 rounded">
                                                                    <strong class="text-success" id="overallR2">-</strong><br>
                                                                    <small class="text-muted">TEST R²</small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- 各子分数详细表格 -->
                                                <div class="row">
                                                    <div class="col-12">
                                                        <h6><i class="fas fa-table"></i> <span data-lang-key="subscoreDetails">各MMSE子分数详细性能</span></h6>
                                                        <div class="table-responsive">
                                                            <table class="table table-sm table-hover">
                                                                <thead class="table-dark">
                                                                    <tr>
                                                                        <th><span data-lang-key="subscoreName">子分数</span></th>
                                                                        <th><span data-lang-key="maxScore">满分</span></th>
                                                                        <th>MAE</th>
                                                                        <th><span data-lang-key="relativeError">相对误差</span></th>
                                                                        <th>RMSE</th>
                                                                        <th>R²</th>
                                                                        <th><span data-lang-key="performance">性能评级</span></th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="subscoreTableBody">
                                                                    <!-- 动态生成的子分数行 -->
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- 性能分级和泛化分析 -->
                                                <div class="row mt-3">
                                                    <div class="col-md-6">
                                                        <div class="card bg-light">
                                                            <div class="card-body text-center">
                                                                <h6><i class="fas fa-trophy"></i> <span data-lang-key="performanceGrade">性能分级评估</span></h6>
                                                                <h4 id="performanceGradeDisplay" class="mb-2">-</h4>
                                                                <p class="mb-1"><strong><span data-lang-key="avgRelativeError">平均相对误差</span>:</strong> <span id="avgRelativeErrorDisplay">-</span></p>
                                                                <p class="mb-0"><strong><span data-lang-key="avgR2">平均R²</span>:</strong> <span id="avgR2Display">-</span></p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="card bg-light">
                                                            <div class="card-body">
                                                                <h6><i class="fas fa-chart-line"></i> <span data-lang-key="generalizationAnalysis">泛化分析</span></h6>
                                                                <p class="mb-1"><strong><span data-lang-key="overfittingRatio">过拟合比率</span>:</strong> <span id="overfittingRatioDisplay">-</span></p>
                                                                <p class="mb-1"><strong><span data-lang-key="generalizationGap">泛化差距</span>:</strong> <span id="generalizationGapDisplay">-</span></p>
                                                                <p class="mb-0"><strong><span data-lang-key="trainTestGap">训练-测试差距</span>:</strong> <span id="trainTestGapDisplay">-</span></p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            <!-- 子模块9.3: 预测与可视化 (暂时隐藏) -->
            <div class="row mb-4" id="predictionVisualizationSection" style="display: none;">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-warning text-white">
                            <h5 class="mb-0"><i class="fas fa-chart-line"></i> <span data-lang-key="predictionVisualizationTitle">子模块9.3 - 预测与可视化</span></h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> <span data-lang-key="predictionVisualizationPlaceholder">预测与可视化功能正在开发中...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 第十模块 - Eye-Index 综合评估模块 -->
    <div class="tenth-module-view" id="tenthModuleView" style="display: none;">
            <div class="container-fluid" style="min-height: 800px; padding: 20px;">
                <!-- 页面标题 -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="text-center">
                            <h2 class="display-6 fw-bold text-primary">
                                <i class="fas fa-eye"></i> <span data-lang-key="tenthModuleTitle">模块10 - Eye-Index 综合评估</span>
                            </h2>
                            <p class="lead text-muted">
                                <span data-lang-key="tenthModuleSubtitle">基于10个眼动特征的综合指标计算与可视化分析</span>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Eye-Index模块内容 -->
                <!-- 子模块10-A: 数据准备 -->
<div class="card mb-4" id="module10a-data-prep">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0">
            <i class="fas fa-database"></i> 
            <span data-lang-key="module10aTitle">子模块10-A: 数据准备与构建</span>
        </h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-8">
                <!-- 配置选择 -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="build-rqa-config-select" class="form-label">
                            <span data-lang-key="selectRqaConfig">选择RQA配置</span>:
                        </label>
                        <select id="build-rqa-config-select" class="form-select">
                            <option value="" data-lang-key="pleaseSelect">请选择配置...</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="val-split-input" class="form-label">
                            <span data-lang-key="valSplit">验证集比例</span>:
                        </label>
                        <input type="number" id="val-split-input" class="form-control" 
                               value="0.2" min="0.1" max="0.5" step="0.05">
                    </div>
                    <div class="col-md-3">
                        <label for="random-state-input" class="form-label">
                            <span data-lang-key="randomState">随机种子</span>:
                        </label>
                        <input type="number" id="random-state-input" class="form-control" 
                               value="42" min="1" max="9999">
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="row mb-3">
                    <div class="col-12">
                        <button class="btn btn-primary me-2" id="btn-check-prerequisites">
                            <i class="fas fa-check-circle"></i> 
                            <span data-lang-key="checkPrerequisites">检查前置条件</span>
                        </button>
                        <button class="btn btn-success me-2" id="btn-build-dataset" disabled>
                            <i class="fas fa-cogs"></i> 
                            <span data-lang-key="buildDataset">构建数据集</span>
                        </button>
                        <button class="btn btn-info" id="btn-refresh-dataset-status">
                            <i class="fas fa-sync"></i> 
                            <span data-lang-key="refreshStatus">刷新状态</span>
                        </button>
                    </div>
                </div>

                <!-- 状态显示 -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-info-circle"></i> 
                                    <span data-lang-key="statusInfo">状态信息</span>
                                </h6>
                            </div>
                            <div class="card-body">
                                <div id="prerequisites-status" class="mb-3">
                                    <div class="alert alert-secondary">
                                        <span data-lang-key="clickCheckPrerequisites">请点击"检查前置条件"按钮开始</span>
                                    </div>
                                </div>
                                <div id="build-progress" style="display: none;">
                                    <div class="progress mb-2">
                                        <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                             role="progressbar" style="width: 0%"></div>
                                    </div>
                                    <small class="text-muted" id="build-progress-text">准备中...</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <!-- 已构建数据集状态 -->
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-list"></i> 
                            <span data-lang-key="builtDatasets">已构建数据集</span>
                        </h6>
                    </div>
                    <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                        <div id="dataset-list">
                            <div class="text-center text-muted">
                                <i class="fas fa-loading fa-spin"></i> 
                                <span data-lang-key="loading">加载中...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 子模块10-B: PyTorch训练引擎 -->
<div class="card mb-4" id="module10b-training">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">
            <i class="fas fa-brain"></i> 
            <span data-lang-key="module10bTitle">子模块10-B: PyTorch MLP训练引擎</span>
        </h5>
    </div>
    <div class="card-body">
        <p><span data-lang-key="module10bDescription">基于PyTorch的多层感知机训练系统，支持Q1-Q5任务的独立训练</span></p>
        <!-- 训练配置区域 -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-cogs"></i> 
                            <span data-lang-key="trainingConfig">训练配置</span>
                        </h6>
                    </div>
                    <div class="card-body">
                        <!-- 数据集选择 -->
                        <div class="mb-3">
                            <label for="training-dataset-select" class="form-label">
                                <span data-lang-key="selectDataset">选择数据集</span>:
                            </label>
                            <select id="training-dataset-select" class="form-select">
                                <option value="" data-lang-key="pleaseSelect">请选择数据集...</option>
                            </select>
                        </div>
                        
                        <!-- 任务选择 -->
                        <div class="mb-3">
                            <label for="training-task-select" class="form-label">
                                <span data-lang-key="selectTask">选择训练任务</span>:
                            </label>
                            <select id="training-task-select" class="form-select" multiple>
                                <option value="Q1" data-lang-key="q1TimeOrientation">Q1 时间定向</option>
                                <option value="Q2" data-lang-key="q2SpaceOrientation">Q2 空间定向</option>
                                <option value="Q3" data-lang-key="q3ImmediateMemory">Q3 即刻记忆</option>
                                <option value="Q4" data-lang-key="q4AttentionCalculation">Q4 注意力计算</option>
                                <option value="Q5" data-lang-key="q5DelayedRecall">Q5 延迟回忆</option>
                            </select>
                            <small class="text-muted"><span data-lang-key="multiSelectHint">按住Ctrl键多选</span></small>
                        </div>
                        
                        <!-- 高级参数设置 -->
                        <div class="accordion mb-3" id="advancedParams">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingParams">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseParams">
                                        <i class="fas fa-cog"></i>&nbsp;
                                        <span data-lang-key="advancedParams">高级参数设置</span>
                                    </button>
                                </h2>
                                <div id="collapseParams" class="accordion-collapse collapse" data-bs-parent="#advancedParams">
                                    <div class="accordion-body">
                                        <!-- 训练轮数 -->
                                        <div class="row mb-2">
                                            <div class="col-6">
                                                <label for="epochs-input" class="form-label small">
                                                    <span data-lang-key="maxEpochs">最大轮数</span>:
                                                </label>
                                                <input type="number" id="epochs-input" class="form-control form-control-sm" value="300" min="10" max="1000">
                                            </div>
                                            <div class="col-6">
                                                <label for="patience-input" class="form-label small">
                                                    <span data-lang-key="earlyStopPatience">早停耐心值</span>:
                                                </label>
                                                <input type="number" id="patience-input" class="form-control form-control-sm" value="60" min="3" max="100">
                                            </div>
                                        </div>
                                        
                                        <!-- 学习率和批大小 -->
                                        <div class="row mb-2">
                                            <div class="col-6">
                                                <label for="lr-input" class="form-label small">
                                                    <span data-lang-key="learningRate">学习率</span>:
                                                </label>
                                                <input type="number" id="lr-input" class="form-control form-control-sm" value="0.0003" min="0.0001" max="0.1" step="0.0001">
                                            </div>
                                            <div class="col-6">
                                                <label for="batch-size-input" class="form-label small">
                                                    <span data-lang-key="batchSize">批大小</span>:
                                                </label>
                                                <input type="number" id="batch-size-input" class="form-control form-control-sm" value="16" min="4" max="64">
                                            </div>
                                        </div>
                                        
                                        <!-- Dropout和正则化 -->
                                        <div class="row mb-2">
                                            <div class="col-6">
                                                <label for="dropout-input" class="form-label small">
                                                    <span data-lang-key="dropout">Dropout率</span>:
                                                </label>
                                                <input type="number" id="dropout-input" class="form-control form-control-sm" value="0.25" min="0" max="0.8" step="0.05">
                                                <small class="text-muted"><span data-lang-key="dropoutInfo">0=关闭，推荐0.25</span></small>
                                            </div>
                                            <div class="col-6">
                                                <label for="l2-reg-input" class="form-label small">
                                                    <span data-lang-key="l2Regularization">L2正则化</span>:
                                                </label>
                                                <input type="number" id="l2-reg-input" class="form-control form-control-sm" value="0.0005" min="0" max="0.01" step="0.0001">
                                            </div>
                                        </div>
                                        
                                        <!-- 网络架构 -->
                                        <div class="row mb-2">
                                            <div class="col-6">
                                                <label for="h1-input" class="form-label small">
                                                    <span data-lang-key="hiddenLayer1">第一隐藏层</span>:
                                                </label>
                                                <input type="number" id="h1-input" class="form-control form-control-sm" value="32" min="8" max="128">
                                            </div>
                                            <div class="col-6">
                                                <label for="h2-input" class="form-label small">
                                                    <span data-lang-key="hiddenLayer2">第二隐藏层</span>:
                                                </label>
                                                <input type="number" id="h2-input" class="form-control form-control-sm" value="16" min="4" max="64">
                                            </div>
                                        </div>
                                        
                                        <!-- 网络优化技术 -->
                                        <div class="row mb-2">
                                            <div class="col-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="enable-batch-norm">
                                                    <label class="form-check-label small" for="enable-batch-norm">
                                                        <span data-lang-key="enableBatchNorm">启用批归一化</span>
                                                    </label>
                                                </div>
                                                <small class="text-muted"><span data-lang-key="batchNormHint">可提高训练稳定性</span></small>
                                            </div>
                                            <div class="col-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="enable-dropout" checked>
                                                    <label class="form-check-label small" for="enable-dropout">
                                                        <span data-lang-key="enableDropout">启用Dropout</span>
                                                    </label>
                                                </div>
                                                <small class="text-muted"><span data-lang-key="dropoutHint">设为0关闭，防止过拟合</span></small>
                                            </div>
                                        </div>
                                        
                                        <!-- 学习率调度器 -->
                                        <div class="mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="enable-lr-scheduler" checked>
                                                <label class="form-check-label small" for="enable-lr-scheduler">
                                                    <span data-lang-key="enableLRScheduler">启用学习率调度器</span>
                                                </label>
                                            </div>
                                            <div id="lr-scheduler-params" class="mt-2">
                                                <div class="row mb-2">
                                                    <div class="col-4">
                                                        <label for="lr-factor-input" class="form-label small">
                                                            <span data-lang-key="lrFactor">衰减因子</span>:
                                                        </label>
                                                        <input type="number" id="lr-factor-input" class="form-control form-control-sm" value="0.5" min="0.1" max="0.9" step="0.1">
                                                    </div>
                                                    <div class="col-4">
                                                        <label for="lr-patience-input" class="form-label small">
                                                            <span data-lang-key="lrPatience">调度耐心值</span>:
                                                        </label>
                                                        <input type="number" id="lr-patience-input" class="form-control form-control-sm" value="10" min="3" max="20">
                                                    </div>
                                                    <div class="col-4">
                                                        <label for="min-lr-input" class="form-label small">
                                                            <span data-lang-key="minLR">最小学习率</span>:
                                                        </label>
                                                        <input type="number" id="min-lr-input" class="form-control form-control-sm" value="0.00001" min="0.000001" max="0.001" step="0.000001">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 数据分割设置 -->
                                        <div class="row mb-2">
                                            <div class="col-6">
                                                <label for="val-split-input" class="form-label small">
                                                    <span data-lang-key="validationSplit">验证集比例</span>:
                                                </label>
                                                <input type="number" id="val-split-input" class="form-control form-control-sm" value="0.3" min="0.1" max="0.5" step="0.05">
                                                <small class="text-muted"><span data-lang-key="valSplitHint">推荐0.3可提高验证可靠性</span></small>
                                            </div>
                                            <div class="col-6">
                                                <div class="form-check mt-4">
                                                    <input class="form-check-input" type="checkbox" id="enable-cross-validation">
                                                    <label class="form-check-label small" for="enable-cross-validation">
                                                        <span data-lang-key="enableCrossValidation">启用交叉验证</span>
                                                    </label>
                                                </div>
                                                <div id="cv-params" class="mt-1" style="display: none;">
                                                    <label for="cv-folds-input" class="form-label small">
                                                        <span data-lang-key="cvFolds">交叉验证折数</span>:
                                                    </label>
                                                    <input type="number" id="cv-folds-input" class="form-control form-control-sm" value="5" min="3" max="10">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 训练按钮 -->
                        <div class="d-grid">
                            <button class="btn btn-primary" id="btn-start-training-10b" disabled>
                                <i class="fas fa-play"></i> 
                                <span data-lang-key="startTraining">开始训练</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 训练状态监控 -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-chart-line"></i> 
                            <span data-lang-key="trainingMonitor">训练监控</span>
                        </h6>
                    </div>
                    <div class="card-body">
                        <div id="training-status-10b" class="alert alert-secondary">
                            <i class="fas fa-info-circle"></i> 
                            <span data-lang-key="readyToTrain">请选择数据集和任务开始训练</span>
                        </div>
                        
                        <div id="training-progress-10b" style="display: none;">
                            <div class="progress mb-2">
                                <div id="training-progress-bar-10b" class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar" style="width: 0%"></div>
                            </div>
                            <div class="row text-center">
                                <div class="col-4">
                                    <small class="text-muted"><span data-lang-key="currentEpoch">当前轮次</span></small>
                                    <div id="current-epoch-10b" class="fw-bold">-</div>
                                </div>
                                <div class="col-4">
                                    <small class="text-muted"><span data-lang-key="trainLoss">训练损失</span></small>
                                    <div id="train-loss-10b" class="fw-bold">-</div>
                                </div>
                                <div class="col-4">
                                    <small class="text-muted"><span data-lang-key="valLoss">验证损失</span></small>
                                    <div id="val-loss-10b" class="fw-bold">-</div>
                                </div>
                            </div>
                            
                            <!-- 学习曲线图表 -->
                            <div class="mt-3">
                                <h6 class="mb-2">
                                    <i class="fas fa-chart-line"></i> 
                                    <span data-lang-key="learningCurve">学习曲线</span>
                                </h6>
                                <div class="position-relative" style="height: 300px;">
                                    <canvas id="learning-curve-chart" width="400" height="300"></canvas>
                                </div>
                                <div class="mt-2 text-center">
                                    <small class="text-muted">
                                        <span data-lang-key="learningCurveDesc">监控训练/验证损失变化，识别过拟合分叉点</span>
                                    </small>
                                </div>
                            </div>
                            
                            <!-- 预测准确性分析图表 -->
                            <div class="mt-4" id="prediction-accuracy-section" style="display: none;">
                                <h6 class="mb-2">
                                    <i class="fas fa-bullseye"></i> 
                                    <span data-lang-key="predictionAccuracy">预测准确性分析</span>
                                </h6>
                                
                                <!-- 图表容器 -->
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="border rounded p-2 mb-3">
                                            <h6 class="small mb-2">
                                                <i class="fas fa-circle text-primary"></i>
                                                <span data-lang-key="scatterPlot">预测vs真实散点图</span>
                                            </h6>
                                            <div class="position-relative" style="height: 250px;">
                                                <canvas id="prediction-scatter-chart" width="300" height="250"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="border rounded p-2 mb-3">
                                            <h6 class="small mb-2">
                                                <i class="fas fa-chart-bar text-warning"></i>
                                                <span data-lang-key="residualPlot">残差分布图</span>
                                            </h6>
                                            <div class="position-relative" style="height: 250px;">
                                                <canvas id="residual-chart" width="300" height="250"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 统计指标 -->
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="border rounded p-3">
                                            <h6 class="mb-3">
                                                <i class="fas fa-calculator text-info"></i>
                                                <span data-lang-key="accuracyMetrics">准确性指标</span>
                                            </h6>
                                            <div class="row text-center">
                                                <div class="col-3">
                                                    <div class="border-end">
                                                        <div class="h5 mb-1" id="accuracy-r2">-</div>
                                                        <small class="text-muted">R² 决定系数</small>
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="border-end">
                                                        <div class="h5 mb-1" id="accuracy-rmse">-</div>
                                                        <small class="text-muted">RMSE 均方根误差</small>
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="border-end">
                                                        <div class="h5 mb-1" id="accuracy-mae">-</div>
                                                        <small class="text-muted">MAE 平均绝对误差</small>
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="h5 mb-1" id="accuracy-correlation">-</div>
                                                    <small class="text-muted">相关系数</small>
                                                </div>
                                            </div>
                                            
                                            <!-- 分组分析 -->
                                            <div class="mt-3">
                                                <h6 class="small mb-2">分组分析</h6>
                                                <div class="row text-center">
                                                    <div class="col-4">
                                                        <span class="badge bg-success me-1">●</span>
                                                        <small>Control组 (n=<span id="group-control-count">-</span>)</small>
                                                        <div class="small text-muted">R² = <span id="group-control-r2">-</span></div>
                                                    </div>
                                                    <div class="col-4">
                                                        <span class="badge bg-warning me-1">●</span>
                                                        <small>MCI组 (n=<span id="group-mci-count">-</span>)</small>
                                                        <div class="small text-muted">R² = <span id="group-mci-r2">-</span></div>
                                                    </div>
                                                    <div class="col-4">
                                                        <span class="badge bg-danger me-1">●</span>
                                                        <small>AD组 (n=<span id="group-ad-count">-</span>)</small>
                                                        <div class="small text-muted">R² = <span id="group-ad-r2">-</span></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-2 text-center">
                                    <small class="text-muted">
                                        <span data-lang-key="accuracyDesc">分析模型预测值与真实MMSE分数的相关性和准确性</span>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 子模块10-C: 数据查看器 -->
<div class="card mb-4" id="module10c-data-viewer">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0">
            <i class="fas fa-table"></i> 
            <span data-lang-key="module10cTitle">子模块10-C: 训练数据查看器</span>
        </h5>
    </div>
    <div class="card-body">
        <p><span data-lang-key="module10cDescription">NPZ训练数据的表格化展示、统计分析和导出功能</span></p>
        
        <!-- 数据集选择区域 -->
        <div class="row mb-3">
            <div class="col-md-4">
                <label class="form-label">
                    <i class="fas fa-database"></i> 
                    <span data-lang-key="selectDataset">选择数据集</span>:
                </label>
                <select id="data-viewer-rqa-select" class="form-select">
                    <option value="">加载中...</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">
                    <i class="fas fa-tasks"></i> 
                    <span data-lang-key="selectTask">选择任务</span>:
                </label>
                <select id="data-viewer-task-select" class="form-select">
                    <option value="Q1" data-lang-key="q1Orientation">Q1 定向</option>
                    <option value="Q2" data-lang-key="q2Registration">Q2 注册</option>
                    <option value="Q3" data-lang-key="q3AttentionCalculation">Q3 注意计算</option>
                    <option value="Q4" data-lang-key="q4Recall">Q4 回忆</option>
                    <option value="Q5" data-lang-key="q5DelayedRecall">Q5 延迟回忆</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">
                    <span data-lang-key="options">选项</span>:
                </label>
                <div class="form-check mt-2">
                    <input type="checkbox" id="include-predictions" class="form-check-input" checked>
                    <label class="form-check-label" for="include-predictions">
                        <span data-lang-key="includePredictions">包含预测结果</span>
                    </label>
                </div>
            </div>
        </div>
        
        <!-- 操作按钮区域 -->
        <div class="row mb-3">
            <div class="col-md-12">
                <div class="btn-group" role="group">
                    <button id="load-data-table" class="btn btn-primary">
                        <i class="fas fa-table"></i> 
                        <span data-lang-key="loadDataTable">加载数据表格</span>
                    </button>
                    <button id="show-statistics" class="btn btn-warning">
                        <i class="fas fa-chart-bar"></i> 
                        <span data-lang-key="showStatistics">统计摘要</span>
                    </button>
                </div>
                
                <div class="btn-group ms-2" role="group">
                    <button id="export-csv" class="btn btn-success">
                        <i class="fas fa-download"></i> 
                        <span data-lang-key="exportCSV">导出CSV</span>
                    </button>
                    <button id="export-excel" class="btn btn-info">
                        <i class="fas fa-file-excel"></i> 
                        <span data-lang-key="exportExcel">导出Excel</span>
                    </button>
                </div>
                
                <div class="btn-group ms-2" role="group">
                    <button id="compare-datasets" class="btn btn-secondary">
                        <i class="fas fa-balance-scale"></i> 
                        <span data-lang-key="compareDatasets">对比数据集</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 数据统计面板 -->
        <div id="data-stats-panel" class="row mb-3" style="display: none;">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-chart-line"></i> 
                            <span data-lang-key="dataStatsSummary">数据统计摘要</span>
                        </h6>
                    </div>
                    <div class="card-body">
                        <div id="data-statistics-content">
                            <!-- 动态生成统计内容 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 数据表格区域 -->
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <i class="fas fa-table"></i> 
                            <span data-lang-key="trainingDataDetails">训练数据详情</span>
                        </h6>
                        <div class="d-flex">
                            <input type="text" id="table-search" class="form-control form-control-sm me-2" 
                                   placeholder="搜索..." style="width: 150px;">
                            <select id="table-page-size" class="form-select form-select-sm" style="width: 80px;">
                                <option value="25">25行</option>
                                <option value="50" selected>50行</option>
                                <option value="100">100行</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <!-- 加载状态 -->
                        <div id="table-loading" class="text-center p-4" style="display: none;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">加载中...</span>
                            </div>
                            <div class="mt-2">
                                <span data-lang-key="loadingData">正在加载数据...</span>
                            </div>
                        </div>
                        
                        <!-- 数据表格容器 -->
                        <div id="data-table-container" style="height: 500px; overflow: auto; display: none;">
                            <table id="training-data-table" class="table table-striped table-hover mb-0">
                                <thead class="table-dark sticky-top">
                                    <!-- 动态生成表头 -->
                                </thead>
                                <tbody>
                                    <!-- 动态生成数据行 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 空状态 -->
                        <div id="table-empty" class="text-center p-5 text-muted">
                            <i class="fas fa-inbox fa-3x mb-3"></i>
                            <h5><span data-lang-key="noDataLoaded">暂无数据</span></h5>
                            <p><span data-lang-key="selectDatasetToView">请选择数据集和任务，然后点击"加载数据表格"</span></p>
                        </div>
                        
                        <!-- 分页控件 -->
                        <div id="table-pagination-container" class="d-flex justify-content-between align-items-center p-3" style="display: none;">
                            <div id="table-info">
                                <span data-lang-key="showingEntries">显示第 1-50 条，共 60 条记录</span>
                            </div>
                            <nav>
                                <ul id="table-pagination" class="pagination pagination-sm mb-0">
                                    <!-- 动态生成分页 -->
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 相关性分析区域 -->
        <div class="row mt-3" id="correlation-analysis" style="display: none;">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-project-diagram"></i> 
                            <span data-lang-key="correlationAnalysis">特征相关性分析</span>
                        </h6>
                    </div>
                    <div class="card-body">
                        <div id="correlation-content">
                            <!-- 相关性矩阵和分析结果 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
<!-- 子模块10-D: 模型性能评估与差异可视化 -->
<div class="card mb-4" id="module10d-performance">
    <div class="card-header bg-warning text-dark">
        <h5 class="mb-0">
            <i class="fas fa-chart-line"></i>
            <span data-lang-key="module10dTitle">子模块10-D: 模型性能评估与差异可视化</span>
        </h5>
    </div>
    <div class="card-body">
        <p><span data-lang-key="module10dDesc">深度分析模型预测性能，提供个体残差和任务级误差对比</span></p>
                    
                    <!-- 控制面板 -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card bg-light">
                                <div class="card-body py-3">
                                    <div class="row align-items-center">
                                        <div class="col-md-3">
                                            <label class="form-label small fw-bold">
                                                <i class="fas fa-cog"></i> 
                                                <span data-lang-key="selectModelConfig">选择模型配置:</span>
                                            </label>
                                            <select id="model-config-select-10d" class="form-select form-select-sm">
                                                <option value="">请选择...</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label small fw-bold">
                                                <span data-lang-key="analysisOptions">分析选项:</span>
                                            </label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="include-groups-10d">
                                                <label class="form-check-label small" for="include-groups-10d">
                                                    <span data-lang-key="includeGroupAnalysis">包含组别对比</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label small fw-bold">&nbsp;</label>
                                            <div class="d-grid">
                                                <button id="analyze-performance-10d" class="btn btn-warning btn-sm">
                                                    <i class="fas fa-play"></i> 
                                                    <span data-lang-key="startAnalysis">开始分析</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label small fw-bold">&nbsp;</label>
                                            <div class="d-grid">
                                                <button id="refresh-cache-10d" class="btn btn-info btn-sm" title="刷新模型缓存">
                                                    <i class="fas fa-sync-alt"></i> 
                                                    <span data-lang-key="refreshCache">刷新缓存</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label small fw-bold">&nbsp;</label>
                                            <div class="d-grid">
                                                <button id="export-data-10d" class="btn btn-outline-secondary btn-sm" disabled>
                                                    <i class="fas fa-download"></i> 
                                                    <span data-lang-key="exportData">导出数据</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-md-1">
                                            <label class="form-label small fw-bold">&nbsp;</label>
                                            <div class="d-grid">
                                                <button id="cache-status-10d" class="btn btn-outline-info btn-sm" title="查看缓存状态">
                                                    <i class="fas fa-info-circle"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 分析结果容器 -->
                    <div id="performance-results-10d" style="display: none;">
                        
                        <!-- 指标概览 -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">
                                            <i class="fas fa-tachometer-alt text-info"></i>
                                            <span data-lang-key="performanceOverview">性能指标概览</span>
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="metrics-table-10d" class="table-responsive">
                                            <!-- 动态生成指标表格 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 个体残差分析 -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0">
                                            <i class="fas fa-chart-line text-primary"></i>
                                            <span data-lang-key="residualAnalysis">个体残差曲线分析</span>
                                        </h6>
                                        <div class="btn-group btn-group-sm" role="group">
                                            <button id="download-residual-chart-10d" class="btn btn-outline-info btn-sm">
                                                <i class="fas fa-download"></i> 
                                                <span data-lang-key="downloadChart">下载图表</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <!-- 组别筛选控件 -->
                                        <div class="mb-3">
                                            <div class="d-flex align-items-center gap-2 flex-wrap">
                                                <small class="fw-bold text-muted">
                                                    <span data-lang-key="showGroups">显示组别:</span>
                                                </small>
                                                <div class="btn-group btn-group-sm" role="group">
                                                    <button class="btn btn-outline-success group-filter-10d" data-group="control">
                                                        <span data-lang-key="controlGroup">Control</span>
                                                    </button>
                                                    <button class="btn btn-outline-warning group-filter-10d" data-group="mci">
                                                        <span data-lang-key="mciGroup">MCI</span>
                                                    </button>
                                                    <button class="btn btn-outline-danger group-filter-10d" data-group="ad">
                                                        <span data-lang-key="adGroup">AD</span>
                                                    </button>
                                                    <button class="btn btn-secondary group-filter-10d active" data-group="all">
                                                        <span data-lang-key="allGroups">全部</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 图表容器 -->
                                        <div class="position-relative" style="height: 400px;">
                                            <canvas id="residual-chart-10d" width="800" height="400"></canvas>
                                        </div>
                                        
                                        <!-- 图例说明 -->
                                        <div class="mt-3">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle"></i>
                                                <span data-lang-key="residualChartHelp">残差 = 预测值 - 真实值。正值表示高估，负值表示低估。</span>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 任务级误差对比 -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0">
                                            <i class="fas fa-chart-bar text-success"></i>
                                            <span data-lang-key="taskComparison">任务级误差对比分析</span>
                                        </h6>
                                        <div class="btn-group btn-group-sm" role="group">
                                            <button id="download-comparison-chart-10d" class="btn btn-outline-info btn-sm">
                                                <i class="fas fa-download"></i> 
                                                <span data-lang-key="downloadChart">下载图表</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="position-relative" style="height: 300px;">
                                            <canvas id="task-comparison-chart-10d" width="800" height="300"></canvas>
                                        </div>
                                        <div class="mt-3">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle"></i>
                                                <span data-lang-key="comparisonChartHelp">蓝色柱表示平均真实得分，红色柱表示平均绝对误差。</span>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 散点图矩阵 - 真实值 vs 预测值 -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0">
                                            <i class="fas fa-th text-primary"></i>
                                            <span data-lang-key="scatterMatrix">散点图矩阵 - 真实值 vs 预测值</span>
                                        </h6>
                                        <div class="btn-group btn-group-sm" role="group">
                                            <button id="toggle-regression-lines-10d" class="btn btn-outline-info btn-sm">
                                                <i class="fas fa-chart-line"></i> 
                                                <span data-lang-key="toggleRegressionLines">切换回归线</span>
                                            </button>
                                            <button id="download-scatter-matrix-10d" class="btn btn-outline-success btn-sm">
                                                <i class="fas fa-download"></i> 
                                                <span data-lang-key="downloadChart">下载图表</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <!-- 组别筛选按钮 -->
                                        <div class="mb-3">
                                            <div class="btn-group btn-group-sm group-filters-scatter-10d" role="group">
                                                <button class="btn btn-outline-secondary group-filter-scatter-10d active" data-group="all">
                                                    <span data-lang-key="allGroups">全部</span>
                                                </button>
                                                <button class="btn btn-outline-success group-filter-scatter-10d" data-group="control">
                                                    <span data-lang-key="controlGroup">对照组</span>
                                                </button>
                                                <button class="btn btn-outline-warning group-filter-scatter-10d" data-group="mci">
                                                    <span data-lang-key="mciGroup">MCI组</span>
                                                </button>
                                                <button class="btn btn-outline-danger group-filter-scatter-10d" data-group="ad">
                                                    <span data-lang-key="adGroup">AD组</span>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- 散点图矩阵容器 -->
                                        <div class="position-relative" style="height: 500px;">
                                            <canvas id="scatter-matrix-10d" width="800" height="500"></canvas>
                                        </div>
                                        
                                        <!-- 统计信息面板 -->
                                        <div class="mt-3">
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <div class="border rounded p-2">
                                                        <div class="h6 mb-1 text-primary">
                                                            <span data-lang-key="overallCorrelation">总体相关性</span>
                                                        </div>
                                                        <small class="text-muted">
                                                            <span data-lang-key="r2Score">R²</span> = <span id="overall-r2-scatter-10d">-</span><br>
                                                            <span data-lang-key="correlationCoeff">相关系数</span> = <span id="overall-corr-scatter-10d">-</span>
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="border rounded p-2">
                                                        <div class="h6 mb-1 text-success">
                                                            <span data-lang-key="controlCorrelation">对照组相关性</span>
                                                        </div>
                                                        <small class="text-muted">
                                                            <span data-lang-key="r2Score">R²</span> = <span id="control-r2-scatter-10d">-</span><br>
                                                            <span data-lang-key="rmseScore">RMSE</span> = <span id="control-rmse-scatter-10d">-</span>
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="border rounded p-2">
                                                        <div class="h6 mb-1 text-warning">
                                                            <span data-lang-key="mciCorrelation">MCI组相关性</span>
                                                        </div>
                                                        <small class="text-muted">
                                                            <span data-lang-key="r2Score">R²</span> = <span id="mci-r2-scatter-10d">-</span><br>
                                                            <span data-lang-key="rmseScore">RMSE</span> = <span id="mci-rmse-scatter-10d">-</span>
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="border rounded p-2">
                                                        <div class="h6 mb-1 text-danger">
                                                            <span data-lang-key="adCorrelation">AD组相关性</span>
                                                        </div>
                                                        <small class="text-muted">
                                                            <span data-lang-key="r2Score">R²</span> = <span id="ad-r2-scatter-10d">-</span><br>
                                                            <span data-lang-key="rmseScore">RMSE</span> = <span id="ad-rmse-scatter-10d">-</span>
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 图例说明 -->
                                        <div class="mt-3">
                                            <div class="alert alert-info">
                                                <h6><i class="fas fa-info-circle"></i> <span data-lang-key="scatterMatrixHelp">散点图说明</span></h6>
                                                <p class="mb-1"><span data-lang-key="scatterHelp1">• 每个点代表一个样本的真实MMSE分数与预测分数</span></p>
                                                <p class="mb-1"><span data-lang-key="scatterHelp2">• 理想预测线(y=x)表示完美预测</span></p>
                                                <p class="mb-0"><span data-lang-key="scatterHelp3">• 点越接近理想线，预测越准确</span></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 分组性能对比 -->
                        <div class="row mb-4" id="group-analysis-section-10d" style="display: none;">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0">
                                            <i class="fas fa-users text-warning"></i>
                                            <span data-lang-key="groupPerformanceComparison">分组性能对比</span>
                                        </h6>
                                        <div class="btn-group btn-group-sm" role="group">
                                            <button id="download-group-chart-10d" class="btn btn-outline-info btn-sm">
                                                <i class="fas fa-download"></i> 
                                                <span data-lang-key="downloadChart">下载图表</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="position-relative" style="height: 300px;">
                                            <canvas id="group-comparison-chart-10d" width="800" height="300"></canvas>
                                        </div>
                                        
                                        <!-- 组别统计信息 -->
                                        <div class="row mt-3 text-center" id="group-stats-10d">
                                            <div class="col-md-4">
                                                <div class="border rounded p-2">
                                                    <div class="h6 mb-1 text-success">
                                                        <span data-lang-key="controlGroup">Control组</span>
                                                    </div>
                                                    <small class="text-muted">
                                                        样本数: <span id="control-count-10d">-</span><br>
                                                        平均误差: <span id="control-avg-error-10d">-</span>
                                                    </small>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="border rounded p-2">
                                                    <div class="h6 mb-1 text-warning">
                                                        <span data-lang-key="mciGroup">MCI组</span>
                                                    </div>
                                                    <small class="text-muted">
                                                        样本数: <span id="mci-count-10d">-</span><br>
                                                        平均误差: <span id="mci-avg-error-10d">-</span>
                                                    </small>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="border rounded p-2">
                                                    <div class="h6 mb-1 text-danger">
                                                        <span data-lang-key="adGroup">AD组</span>
                                                    </div>
                                                    <small class="text-muted">
                                                        样本数: <span id="ad-count-10d">-</span><br>
                                                        平均误差: <span id="ad-avg-error-10d">-</span>
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    
                    <!-- 加载状态 -->
                    <div id="loading-10d" class="text-center py-5" style="display: none;">
                        <div class="spinner-border text-warning" role="status">
                            <span class="visually-hidden">分析中...</span>
                        </div>
                        <div class="mt-2">
                            <span data-lang-key="analyzing">正在分析模型性能...</span>
                        </div>
                    </div>
                    
                    <!-- 空状态提示 -->
                    <div id="empty-state-10d" class="text-center py-5">
                        <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">
                            <span data-lang-key="selectConfigToStart">请选择模型配置开始性能分析</span>
                        </h5>
                        <p class="text-muted">
                            <span data-lang-key="performanceAnalysisDesc">分析将展示模型在各任务上的预测准确性和个体差异</span>
                        </p>
                    </div>
                    
    </div>
</div>

<!-- 子模块10-E: MMSE预测关联性深度可视化 -->
<div class="card mb-4" id="module10e-correlation">
    <div class="card-header bg-gradient" style="background: linear-gradient(45deg, #6f42c1, #20c997);">
        <h5 class="mb-0 text-white">
            <i class="fas fa-project-diagram"></i>
            <span data-lang-key="module10eTitle">子模块10-E: MMSE预测关联性深度可视化</span>
        </h5>
    </div>
    <div class="card-body">
        <p><span data-lang-key="module10eDesc">深度挖掘MMSE真实分数与预测分数之间的关联性，提供多维度、多角度的可视化分析</span></p>
        
        <!-- 控制面板 -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card bg-light">
                    <div class="card-body py-3">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <label class="form-label small fw-bold">
                                    <i class="fas fa-cog"></i> 
                                    <span data-lang-key="selectModelConfig">选择模型配置:</span>
                                </label>
                                <select id="model-config-select-10e" class="form-select form-select-sm">
                                    <option value="">请选择...</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label small fw-bold">
                                    <span data-lang-key="analysisType">分析类型:</span>
                                </label>
                                <select id="analysis-type-10e" class="form-select form-select-sm">
                                    <option value="correlation">相关性分析</option>
                                    <option value="agreement">一致性分析</option>
                                    <option value="diagnostic">诊断能力</option>
                                    <option value="comprehensive">综合分析</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label small fw-bold">
                                    <span data-lang-key="visualizationOptions">可视化选项:</span>
                                </label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="include-3d-10e" checked>
                                    <label class="form-check-label small" for="include-3d-10e">
                                        <span data-lang-key="include3D">包含3D图表</span>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label small fw-bold">&nbsp;</label>
                                <div class="d-grid">
                                    <button id="analyze-correlation-10e" class="btn btn-sm" style="background: linear-gradient(45deg, #6f42c1, #20c997); color: white;">
                                        <i class="fas fa-play"></i> 
                                        <span data-lang-key="startAnalysis">开始分析</span>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label small fw-bold">&nbsp;</label>
                                <div class="btn-group w-100" role="group">
                                    <button id="export-report-10e" class="btn btn-outline-primary btn-sm" title="导出综合报告">
                                        <i class="fas fa-file-pdf"></i> 
                                        <span data-lang-key="exportReport">导出报告</span>
                                    </button>
                                    <button id="export-charts-10e" class="btn btn-outline-success btn-sm" title="导出所有图表">
                                        <i class="fas fa-images"></i> 
                                        <span data-lang-key="exportCharts">导出图表</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 分析结果容器 -->
        <div id="correlation-results-10e" style="display: none;">
            
            <!-- 散点图矩阵 -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">
                                <i class="fas fa-th text-primary"></i>
                                <span data-lang-key="scatterMatrix">散点图矩阵 - 真实值 vs 预测值</span>
                            </h6>
                            <div class="btn-group btn-group-sm" role="group">
                                <button id="toggle-regression-lines-10e" class="btn btn-outline-info btn-sm">
                                    <i class="fas fa-chart-line"></i> 
                                    <span data-lang-key="toggleRegressionLines">切换回归线</span>
                                </button>
                                <button id="download-scatter-matrix-10e" class="btn btn-outline-success btn-sm">
                                    <i class="fas fa-download"></i> 
                                    <span data-lang-key="downloadChart">下载图表</span>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- 组别筛选按钮 -->
                            <div class="mb-3">
                                <div class="btn-group btn-group-sm group-filters-10e" role="group">
                                    <button class="btn btn-outline-secondary group-filter-scatter-10e active" data-group="all">
                                        <span data-lang-key="allGroups">全部</span>
                                    </button>
                                    <button class="btn btn-outline-success group-filter-scatter-10e" data-group="control">
                                        <span data-lang-key="controlGroup">对照组</span>
                                    </button>
                                    <button class="btn btn-outline-warning group-filter-scatter-10e" data-group="mci">
                                        <span data-lang-key="mciGroup">MCI组</span>
                                    </button>
                                    <button class="btn btn-outline-danger group-filter-scatter-10e" data-group="ad">
                                        <span data-lang-key="adGroup">AD组</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 散点图矩阵容器 -->
                            <div class="position-relative" style="height: 500px;">
                                <canvas id="scatter-matrix-10e" width="800" height="500"></canvas>
                            </div>
                            
                            <!-- 统计信息 -->
                            <div class="mt-3">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="border rounded p-2">
                                            <div class="h6 mb-1 text-primary">
                                                <span data-lang-key="overallCorrelation">总体相关性</span>
                                            </div>
                                            <small class="text-muted">
                                                R² = <span id="overall-r2-10e">-</span><br>
                                                p值 = <span id="overall-p-value-10e">-</span>
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="border rounded p-2">
                                            <div class="h6 mb-1 text-success">
                                                <span data-lang-key="controlCorrelation">对照组相关性</span>
                                            </div>
                                            <small class="text-muted">
                                                R² = <span id="control-r2-10e">-</span><br>
                                                RMSE = <span id="control-rmse-10e">-</span>
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="border rounded p-2">
                                            <div class="h6 mb-1 text-warning">
                                                <span data-lang-key="mciCorrelation">MCI组相关性</span>
                                            </div>
                                            <small class="text-muted">
                                                R² = <span id="mci-r2-10e">-</span><br>
                                                RMSE = <span id="mci-rmse-10e">-</span>
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="border rounded p-2">
                                            <div class="h6 mb-1 text-danger">
                                                <span data-lang-key="adCorrelation">AD组相关性</span>
                                            </div>
                                            <small class="text-muted">
                                                R² = <span id="ad-r2-10e">-</span><br>
                                                RMSE = <span id="ad-rmse-10e">-</span>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bland-Altman一致性分析 -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">
                                <i class="fas fa-balance-scale text-info"></i>
                                <span data-lang-key="blandAltmanAnalysis">Bland-Altman一致性分析</span>
                            </h6>
                            <div class="btn-group btn-group-sm" role="group">
                                <button id="toggle-confidence-bands-10e" class="btn btn-outline-info btn-sm">
                                    <i class="fas fa-chart-area"></i> 
                                    <span data-lang-key="toggleConfidenceBands">切换置信带</span>
                                </button>
                                <button id="download-bland-altman-10e" class="btn btn-outline-success btn-sm">
                                    <i class="fas fa-download"></i> 
                                    <span data-lang-key="downloadChart">下载图表</span>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <!-- Bland-Altman图 -->
                                    <div class="position-relative" style="height: 400px;">
                                        <canvas id="bland-altman-chart-10e" width="600" height="400"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <!-- 一致性统计 -->
                                    <div class="card bg-light">
                                        <div class="card-header">
                                            <h6 class="mb-0">
                                                <i class="fas fa-calculator"></i>
                                                <span data-lang-key="agreementStatistics">一致性统计</span>
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="mb-3">
                                                <strong><span data-lang-key="meanBias">平均偏差</span>:</strong><br>
                                                <span id="mean-bias-10e" class="text-primary">-</span>
                                            </div>
                                            <div class="mb-3">
                                                <strong><span data-lang-key="agreementLimits">一致性界限</span>:</strong><br>
                                                上限: <span id="upper-limit-10e" class="text-success">-</span><br>
                                                下限: <span id="lower-limit-10e" class="text-danger">-</span>
                                            </div>
                                            <div class="mb-3">
                                                <strong><span data-lang-key="withinLimits">界限内比例</span>:</strong><br>
                                                <span id="within-limits-10e" class="text-info">-</span>%
                                            </div>
                                            <div class="mb-3">
                                                <strong><span data-lang-key="concordanceIndex">一致性指数</span>:</strong><br>
                                                CCC = <span id="concordance-10e" class="text-warning">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 临床意义解释 -->
                            <div class="mt-3">
                                <div class="alert alert-info">
                                    <h6><i class="fas fa-info-circle"></i> <span data-lang-key="clinicalInterpretation">临床意义解释</span></h6>
                                    <p class="mb-1"><span data-lang-key="blandAltmanHelp1">• Bland-Altman图评估预测值与真实值的一致性</span></p>
                                    <p class="mb-1"><span data-lang-key="blandAltmanHelp2">• 95%的数据点应在一致性界限内（虚线之间）</span></p>
                                    <p class="mb-0"><span data-lang-key="blandAltmanHelp3">• 平均偏差接近0表示无系统性误差</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ROC曲线与诊断能力分析 -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">
                                <i class="fas fa-stethoscope text-success"></i>
                                <span data-lang-key="rocAnalysis">ROC曲线与诊断能力分析</span>
                            </h6>
                            <div class="btn-group btn-group-sm" role="group">
                                <button id="toggle-optimal-threshold-10e" class="btn btn-outline-warning btn-sm">
                                    <i class="fas fa-crosshairs"></i> 
                                    <span data-lang-key="toggleOptimalThreshold">最佳阈值</span>
                                </button>
                                <button id="download-roc-chart-10e" class="btn btn-outline-success btn-sm">
                                    <i class="fas fa-download"></i> 
                                    <span data-lang-key="downloadChart">下载图表</span>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <!-- ROC曲线图 -->
                                    <div class="position-relative" style="height: 400px;">
                                        <canvas id="roc-chart-10e" width="600" height="400"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <!-- 诊断指标 -->
                                    <div class="card bg-light">
                                        <div class="card-header">
                                            <h6 class="mb-0">
                                                <i class="fas fa-chart-pie"></i>
                                                <span data-lang-key="diagnosticMetrics">诊断指标</span>
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <!-- 阈值选择 -->
                                            <div class="mb-3">
                                                <label class="form-label small">
                                                    <span data-lang-key="diagnosticThreshold">诊断阈值</span>:
                                                </label>
                                                <select id="diagnostic-threshold-10e" class="form-select form-select-sm">
                                                    <option value="auto">自动优化</option>
                                                    <option value="15">MMSE < 15 (重度)</option>
                                                    <option value="20">MMSE < 20 (中度)</option>
                                                    <option value="24">MMSE < 24 (轻度)</option>
                                                    <option value="27">MMSE < 27 (正常)</option>
                                                </select>
                                            </div>
                                            
                                            <!-- 指标显示 -->
                                            <div class="mb-2">
                                                <strong>AUC:</strong> <span id="auc-value-10e" class="text-primary">-</span>
                                            </div>
                                            <div class="mb-2">
                                                <strong><span data-lang-key="sensitivity">敏感度</span>:</strong> <span id="sensitivity-10e" class="text-success">-</span>%
                                            </div>
                                            <div class="mb-2">
                                                <strong><span data-lang-key="specificity">特异度</span>:</strong> <span id="specificity-10e" class="text-info">-</span>%
                                            </div>
                                            <div class="mb-2">
                                                <strong><span data-lang-key="accuracy">准确度</span>:</strong> <span id="accuracy-10e" class="text-warning">-</span>%
                                            </div>
                                            <div class="mb-2">
                                                <strong><span data-lang-key="youdenIndex">约登指数</span>:</strong> <span id="youden-index-10e" class="text-danger">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 3D交互式散点图 -->
            <div class="row mb-4" id="3d-visualization-10e">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">
                                <i class="fas fa-cube text-purple"></i>
                                <span data-lang-key="3dScatterPlot">3D交互式关联分析</span>
                            </h6>
                            <div class="btn-group btn-group-sm" role="group">
                                <button id="reset-3d-view-10e" class="btn btn-outline-info btn-sm">
                                    <i class="fas fa-undo"></i> 
                                    <span data-lang-key="resetView">重置视角</span>
                                </button>
                                <button id="toggle-3d-animation-10e" class="btn btn-outline-warning btn-sm">
                                    <i class="fas fa-play"></i> 
                                    <span data-lang-key="toggleAnimation">自动旋转</span>
                                </button>
                                <button id="download-3d-chart-10e" class="btn btn-outline-success btn-sm">
                                    <i class="fas fa-camera"></i> 
                                    <span data-lang-key="screenshot">截图</span>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-9">
                                    <!-- 3D图表容器 -->
                                    <div id="3d-scatter-container-10e" style="height: 500px; border: 1px solid #dee2e6; border-radius: 0.375rem;">
                                        <!-- Plotly.js 3D散点图将在这里渲染 -->
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <!-- 3D控制面板 -->
                                    <div class="card bg-light">
                                        <div class="card-header">
                                            <h6 class="mb-0">
                                                <i class="fas fa-sliders-h"></i>
                                                <span data-lang-key="3dControls">3D控制</span>
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <!-- 坐标轴选择 -->
                                            <div class="mb-3">
                                                <label class="form-label small">X轴:</label>
                                                <select id="x-axis-10e" class="form-select form-select-sm">
                                                    <option value="true_score">真实MMSE分数</option>
                                                    <option value="pred_score">预测MMSE分数</option>
                                                    <option value="residual">预测残差</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label small">Y轴:</label>
                                                <select id="y-axis-10e" class="form-select form-select-sm">
                                                    <option value="pred_score">预测MMSE分数</option>
                                                    <option value="true_score">真实MMSE分数</option>
                                                    <option value="confidence">预测置信度</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label small">Z轴:</label>
                                                <select id="z-axis-10e" class="form-select form-select-sm">
                                                    <option value="abs_error">绝对误差</option>
                                                    <option value="residual">预测残差</option>
                                                    <option value="confidence">预测置信度</option>
                                                </select>
                                            </div>
                                            
                                            <!-- 颜色编码 -->
                                            <div class="mb-3">
                                                <label class="form-label small">颜色编码:</label>
                                                <select id="color-coding-10e" class="form-select form-select-sm">
                                                    <option value="group">按组别</option>
                                                    <option value="task">按任务</option>
                                                    <option value="error">按误差大小</option>
                                                </select>
                                            </div>
                                            
                                            <!-- 大小编码 -->
                                            <div class="mb-3">
                                                <label class="form-label small">点大小:</label>
                                                <select id="size-coding-10e" class="form-select form-select-sm">
                                                    <option value="constant">固定大小</option>
                                                    <option value="confidence">预测置信度</option>
                                                    <option value="error">误差大小</option>
                                                </select>
                                            </div>
                                            
                                            <!-- 应用设置 -->
                                            <div class="d-grid">
                                                <button id="apply-3d-settings-10e" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-check"></i> 
                                                    <span data-lang-key="applySettings">应用设置</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 3D图例说明 -->
                            <div class="mt-3">
                                <div class="alert alert-light">
                                    <h6><i class="fas fa-info-circle"></i> <span data-lang-key="3dChartHelp">3D图表操作说明</span></h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p class="mb-1"><span data-lang-key="3dRotate">• 拖拽鼠标: 旋转视角</span></p>
                                            <p class="mb-1"><span data-lang-key="3dZoom">• 滚轮: 缩放</span></p>
                                        </div>
                                        <div class="col-md-6">
                                            <p class="mb-1"><span data-lang-key="3dPan">• Shift+拖拽: 平移</span></p>
                                            <p class="mb-0"><span data-lang-key="3dSelect">• 点击数据点: 查看详情</span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 相关性热力图 -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">
                                <i class="fas fa-fire text-danger"></i>
                                <span data-lang-key="correlationHeatmap">多维相关性热力图</span>
                            </h6>
                            <div class="btn-group btn-group-sm" role="group">
                                <button id="toggle-correlation-values-10e" class="btn btn-outline-info btn-sm">
                                    <i class="fas fa-hashtag"></i> 
                                    <span data-lang-key="toggleValues">显示数值</span>
                                </button>
                                <button id="download-heatmap-10e" class="btn btn-outline-success btn-sm">
                                    <i class="fas fa-download"></i> 
                                    <span data-lang-key="downloadChart">下载图表</span>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- 热力图类型选择 -->
                            <div class="mb-3">
                                <div class="btn-group btn-group-sm" role="group">
                                    <input type="radio" class="btn-check" name="heatmap-type-10e" id="task-correlation-10e" value="task" checked>
                                    <label class="btn btn-outline-primary" for="task-correlation-10e">
                                        <span data-lang-key="taskCorrelation">任务间相关性</span>
                                    </label>
                                    
                                    <input type="radio" class="btn-check" name="heatmap-type-10e" id="feature-correlation-10e" value="feature">
                                    <label class="btn btn-outline-success" for="feature-correlation-10e">
                                        <span data-lang-key="featureCorrelation">特征间相关性</span>
                                    </label>
                                    
                                    <input type="radio" class="btn-check" name="heatmap-type-10e" id="error-correlation-10e" value="error">
                                    <label class="btn btn-outline-warning" for="error-correlation-10e">
                                        <span data-lang-key="errorCorrelation">误差相关性</span>
                                    </label>
                                    
                                    <input type="radio" class="btn-check" name="heatmap-type-10e" id="group-correlation-10e" value="group">
                                    <label class="btn btn-outline-danger" for="group-correlation-10e">
                                        <span data-lang-key="groupCorrelation">组别差异</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- 热力图容器 -->
                            <div class="position-relative" style="height: 400px;">
                                <canvas id="correlation-heatmap-10e" width="800" height="400"></canvas>
                            </div>
                            
                            <!-- 色阶说明 -->
                            <div class="mt-3">
                                <div class="d-flex align-items-center justify-content-center">
                                    <span class="small text-muted me-2">-1.0</span>
                                    <div class="bg-gradient" style="width: 200px; height: 20px; background: linear-gradient(to right, #d73027, #ffffff, #313695);"></div>
                                    <span class="small text-muted ms-2">+1.0</span>
                                    <span class="small text-muted ms-4">
                                        <i class="fas fa-info-circle"></i>
                                        <span data-lang-key="correlationScale">红色=负相关，蓝色=正相关</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- 加载状态 -->
        <div id="loading-10e" class="text-center py-5" style="display: none;">
            <div class="spinner-border" style="color: #6f42c1;" role="status">
                <span class="visually-hidden">分析中...</span>
            </div>
            <div class="mt-2">
                <span data-lang-key="analyzing">正在进行关联性分析...</span>
            </div>
        </div>
        
        <!-- 空状态提示 -->
        <div id="empty-state-10e" class="text-center py-5">
            <i class="fas fa-project-diagram fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">
                <span data-lang-key="selectConfigToStart">请选择模型配置开始关联性分析</span>
            </h5>
            <p class="text-muted">
                <span data-lang-key="correlationAnalysisDesc">分析将展示MMSE真实分数与预测分数之间的深度关联性</span>
                        </p>
                    </div>
                    
    </div>
</div>

                <!-- 结束整个第十模块容器 -->
            </div>
        </div>
    </div>

    <!-- jQuery库 - 必须在其他JavaScript库之前加载 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js库 - 模块7数据整理需要 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   
   <!-- 简单模块加载器 - 只处理第一个模块的拆分 -->
   <script src="/static/js/simple-module-loader.js"></script>
    <script>
        let currentVisualization = null;
        let allData = {};
        let currentGroup = 'all';
        let currentQuestion = 'all';
        let currentLanguage = 'zh';
        let groupsData = null; // 保存组数据用于语言切换
        let currentView = 'visualization'; // 当前视图
        let sidebarExpanded = false; // 侧边栏状态

        // 多语言文本配置
        const languageTexts = {
            zh: {
                title: 'VR眼球追踪数据可视化平台',
                subtitle: '三组认知功能评估的VR眼球追踪数据分析与可视化平台',
                restart: '重启',
                totalData: '数据总数',
                researchGroups: '研究组别',
                controlGroup: '健康对照组',
                mciGroup: '轻度认知障碍组',
                adGroup: '阿尔茨海默组',
                taskFilter: '任务过滤',
                all: '全部',
                task1: '任务1',
                task2: '任务2',
                task3: '任务3',
                task4: '任务4',
                task5: '任务5',
                dataList: '数据列表',
                loading: '加载中...',
                refresh: '刷新',
                selectDataTitle: '选择数据开始分析',
                selectDataSubtitle: '点击左侧的数据项来生成专业的眼动轨迹可视化分析',
                eyeTrackingVis: '眼动轨迹可视化',
                visControls: '可视化控制',
                fixationSize: '注视点大小:',
                trajectoryWidth: '轨迹线宽:',
                pointSize: '数据点大小:',
                trajectoryStyle: '轨迹样式:',
                solidLine: '实线',
                dashedLine: '虚线',
                dottedLine: '点线',
                updateVis: '更新可视化',
                generatingVis: '正在生成可视化...',
                noData: '暂无数据',
                loadFailed: '加载失败',
                dataItems: '个数据',
                overallStats: '整体统计',
                totalPoints: '总数据点',
                totalDuration: '总时长',
                fixationEvents: '注视事件',
                saccadeEvents: '扫视事件',
                avgVelocity: '平均速度',
                maxVelocity: '最大速度',
                roiSequence: 'ROI序列',
                mainRoiStats: '主要ROI统计',
                statInfo: '统计信息',
                restartConfirm: '确定要重启服务器吗？',
                restarting: '服务器正在重启...',
                dataVisualization: '数据可视化',
                newFeature: '数据导入',
                dataImportTitle: '数据导入与处理',
                dataImportDesc: '批量导入原始眼动数据，自动完成预处理和校准步骤',
                stepUpload: '上传文件',
                stepGroup: '选择分组',
                stepProcess: '数据处理',
                stepComplete: '完成',
                uploadTitle: '拖拽或点击选择文件',
                uploadDesc: '请选择5个txt文件，文件名必须为：1.txt, 2.txt, 3.txt, 4.txt, 5.txt',
                selectFiles: '选择文件',
                selectedFiles: '已选择的文件',
                clearFiles: '清空',
                nextStep: '下一步',
                selectGroup: '选择数据分组',
                groupSelectionDesc: '为这批导入的数据选择合适的研究组别',
                controlDesc: '认知功能正常的健康被试',
                mciDesc: '轻度认知功能障碍被试',
                adDesc: '阿尔茨海默病被试',
                prevStep: '上一步',
                startProcess: '开始处理',
                processingData: '正在处理数据',
                overallProgress: '整体进度',
                currentTask: '当前任务',
                processingLog: '处理日志',
                processingComplete: '数据处理完成！',
                processingCompleteDesc: '所有文件已成功处理并添加到系统中',
                viewData: '查看数据',
                importMore: '导入更多',
                importStatus: '导入状态',
                fileRequirements: '文件要求',
                req1: '必须上传5个txt文件',
                req2: '文件名必须是: 1.txt, 2.txt, 3.txt, 4.txt, 5.txt 或 level_1.txt, level_2.txt, level_3.txt, level_4.txt, level_5.txt',
                req3: '代表同一被试的Q1-Q5数据',
                validationStatus: '验证状态',
                processPreview: '处理预览',
                fileValidation: '文件验证失败',
                missingFiles: '缺少必需的文件',
                invalidFileNames: '文件名不符合要求',
                validationPassed: '验证通过，可以进入下一步',
                editCalibration: '校准编辑',
                calibrationEdit: '校准编辑模式',
                calibrationDesc: '调整当前数据的偏移量，实时预览校准效果',
                currentData: '当前数据',
                xOffset: 'X轴偏移',
                yOffset: 'Y轴偏移',
                presetOffsets: '常用偏移量',
                reset: '重置',
                cancel: '取消',
                preview: '预览',
                save: '保存校准',
                calibrationSaved: '校准已保存',
                calibrationError: '校准保存失败',
                timeCalibration: '时间校准',
                timeCalibrationDesc: '调整数据的时间范围，控制轨迹的起始和结束点',
                totalDuration: '总时长',
                dataPoints: '数据点',
                selectedRange: '选择范围',
                startTime: '起始时间',
                endTime: '结束时间',
                timePresets: '时间预设',
                fullRange: '完整',
                trimEdges: '去边缘',
                firstHalf: '前半段',
                secondHalf: '后半段',
                groupControl: '对照组',
                groupMci: '轻度认知障碍组',
                groupAd: '阿尔兹海默组',
                editDataGroup: '编辑数据组别',
                dataId: '数据ID',
                currentGroup: '当前组别',
                selectNewGroup: '选择新组别',
                deleteDataConfirm: '确定要删除数据 "{0}" 吗？\n\n注意：删除单个任务将会导致整个组的数据被删除。',
                deleteDataFailed: '删除数据失败',
                changeGroupFailed: '更改组别失败',
                deleteDataSuccess: '数据删除成功',
                changeGroupSuccess: '组别更改成功',
                confirm: '确认更改',
                cognitiveAssessment: '认知评估 (MMSE)',
                noMMSEData: '该组别暂无MMSE评估数据',
                orientation: '定向力',
                immediateMemory: '即刻记忆',
                calculation: '计算能力',
                delayedRecall: '延迟回忆',
                totalScore: '总分',
                assessmentLevel: '评估等级',
                unitCount: '个',
                unitMs: 'ms',
                unitSecond: 's',
                unitDegreesPerSecond: '°/s',
                // MMSE任务名称
                q1OrientationTime: '时间定向',
                q2OrientationPlace: '地点定向',
                q3ImmediateMemory: '即刻记忆',
                q4Calculation: '计算能力',
                q5DelayedRecall: '延迟回忆',
                year: '年份',
                season: '季节',
                month: '月份',
                weekday: '星期',
                province: '省市区',
                street: '街道',
                building: '建筑',
                floor: '楼层',
                word1: '词1',
                word2: '词2',
                word3: '词3',
                // RQA分析相关
                rqaAnalysis: 'RQA分析',
                rqaAnalysisTitle: '递归量化分析 (RQA)',
                rqaAnalysisDescription: '批量生成和可视化递归图',
                renderControl: '渲染控制',
                filterControl: '筛选控制',
                analysisMode: '分析模式',
                analysis1DX: '1D信号 (X坐标)',
                analysis1DAmplitude: '1D信号 (幅度)',
                analysis2DXY: '2D信号 (X,Y坐标)',
                distanceMetric: '距离度量',
                distance1DAbs: '1D绝对差',
                distanceEuclidean: '欧几里得距离',
                embeddingDimension: '嵌入维度 (m)',
                timeDelay: '时间延迟 (τ)',
                recurrenceThreshold: '递归阈值 (ε)',
                minLineLength: '最小线长 (l_min)',
                colorTheme: '渲染颜色',
                grayscaleTheme: '灰度',
                greenGradientTheme: '墨绿色到白色渐变',
                startRender: '开始渲染',
                checkStatus: '检查状态',
                filterGroup: '筛选组别',
                filterQuestion: '筛选问题',
                allQuestions: '全部问题',
                updateDisplay: '更新显示',
                rqaResultsTitle: '递归图可视化结果',
                rqaResultsDescription: '一行显示5列，按组别和问题排列',
                noRQAImages: '尚未渲染RQA图像',
                renderTip: '请先设置参数并点击"开始渲染"按钮',
                imageType: '图片类型',
                amplitudeImage: '幅度图',
                trajectoryImage: '轨迹图',
                recurrenceImage: '递归图',
                allGroups: '所有组别',
                controlGroup: '控制组',
                mciGroup: 'MCI组',
                adGroup: 'AD组',
                question1: 'Q1',
                question2: 'Q2',
                question3: 'Q3',
                question4: 'Q4',
                question5: 'Q5',
                filterAnalysisMode: '分析模式',
                filterDistanceMetric: '距离度量',
                filterColorTheme: '渲染颜色',
                allAnalysisModes: '所有模式',
                allDistanceMetrics: '所有度量',
                allColorThemes: '所有主题',
                analysis1DAmplitude: '1D信号 (幅度)',
                analysis2DXY: '2D信号 (X,Y坐标)',
                distance1DAbs: '1D绝对差',
                distanceEuclidean: '欧几里得距离',
                rqaTitle: '递归量化分析 (RQA)',
                rqaDescription: '对眼动数据进行递归量化分析，揭示眼动模式的复杂性和规律性',
                
                // 事件分析相关
                eventAnalysis: '事件分析',
                eventAnalysisTitle: '眼动事件分析',
                eventAnalysisDescription: '展示和筛选基于IVT算法的眼动事件分析结果和ROI统计数据',
                dataOverview: '数据概览',
                dataType: '数据类型',
                eventsData: '事件数据',
                roiData: 'ROI统计',
                groupFilter: '组别筛选',
                allGroups: '全部组别',
                controlGroup: '对照组',
                mciGroup: 'MCI组',
                adGroup: 'AD组',
                eventTypeFilter: '事件类型',
                allEvents: '全部事件',
                fixationEvents: 'fixation',
                saccadeEvents: 'saccade',
                pageSize: '每页显示',
                refreshData: '刷新数据',
                regenerateData: '重新生成数据',
                exportData: '导出数据',
                loadingData: '正在加载数据...',
                filterOptions: '筛选选项',
                dataSelection: '数据选择',
                selectGroup: '选择研究组',
                allGroups: '所有组别',
                selectTask: '选择任务',
                allTasks: '所有任务',
                selectData: '选择具体数据',
                selectAll: '全选',
                pleaseSelect: '请先选择组别和任务',
                rqaParameters: 'RQA参数',
                embeddingDimension: '嵌入维度 (m)',
                timeDelay: '时间延迟 (τ)',
                recurrenceThreshold: '递归阈值 (ε)',
                minLineLength: '最小线长 (l_min)',
                runAnalysis: '运行分析',
                resetParams: '重置参数',
                recurrencePlot: '递归图',
                rqaMetrics: 'RQA指标',
                compareResults: '对比分析',
                recurrencePlotTitle: '递归图可视化',
                recurrencePlotDesc: '显示眼动轨迹的递归模式和周期性结构',
                rqaMetricsTitle: 'RQA量化指标',
                rqaMetricsDesc: '定量描述眼动模式的复杂性、确定性和可预测性',
                compareTitle: '组间对比分析',
                compareDesc: '比较不同组别的RQA指标差异',
                noAnalysisYet: '尚未运行分析',
                selectDataAndRun: '请选择数据并设置参数后运行RQA分析',
                noMetricsYet: '尚无指标数据',
                runAnalysisFirst: '请先运行RQA分析以获取量化指标',
                noCompareYet: '尚无对比数据',
                selectMultipleGroups: '请选择多个组别进行对比分析',
                pleaseSelectData: '请先选择要分析的数据',
                
                // 模块7 - 数据整理
                seventhModule: '数据整理',
                dataOrganizationTitle: '数据整理与特征可视化',
                dataOrganizationSubtitle: '基于数据库三大范式设计的归一化特征数据分析',
                loadingNormalizedData: '正在加载归一化特征数据...',
                totalSubjects: '受试者总数',
                totalSessions: '游戏会话数',
                vrMmseTasks: 'VR-MMSE任务',
                normalizedFeatures: '归一化特征',
                dataFilterConfig: '数据筛选与配置',
                selectTask: '选择任务 (Q1-Q5)',
                allTasks: '全部任务',
                taskQ1: '任务 Q1',
                taskQ2: '任务 Q2',
                taskQ3: '任务 Q3',
                taskQ4: '任务 Q4',
                taskQ5: '任务 Q5',
                experimentalGroupFilter: '实验组筛选',
                adGroupLabel: '阿尔兹海默症组',
                mciGroupLabel: '轻度认知障碍组',
                controlGroupLabel: '正常对照组',
                featureType: '特征类型',
                gameDurationOption: '🎮 游戏时长',
                roiFeaturesOption: '👁️ ROI特征 (3项)',
                rqa1dFeaturesOption: '🔄 RQA-1D特征 (3项)',
                rqa2dFeaturesOption: '🔄 RQA-2D特征 (3项)',
                rqaAllFeaturesOption: '🔄 RQA全部特征 (6项)',
                comprehensiveOption: '📈 综合对比 (10项)',
                allFeaturesOption: '📊 全部特征 (10项)',
                visualizationType: '可视化类型',
                barChartOption: '📊 柱状图',
                lineChartOption: '📈 折线图',
                scatterChartOption: '🔸 散点图',
                refreshData: '刷新数据',
                generateChart: '生成图表',
                exportData: '导出数据',
                // 归一化方法说明 - 中文
                normalizationMethods: '归一化方法说明',
                gameDurationTitle: '游戏时长特征',
                gameDurationMethod: '方法',
                gameDurationRange: '范围',
                gameDurationReason: '原因',
                gameDurationReasonText: '避免极端异常值(如0.1秒或4分钟)影响正常数据分布',
                roiTimeTitle: 'ROI时间特征',
                roiTimeMethod: '方法',
                roiTimeRange: '范围',
                roiTimeReason: '原因',
                roiTimeReasonText: '保留更多有效数据，过滤注视时间异常值',
                rqaFeaturesTitle: 'RQA递归量化特征',
                rqaFeaturesMethod: '方法',
                rqaFeaturesRange: '范围',
                rqaFeaturesReason: '原因',
                rqaFeaturesReasonText: 'RQA特征(RR、DET、ENT)具有理论范围限制，无需截断处理',
                rqaFeaturesList: '包含: RR-1D, DET-1D, ENT-1D, RR-2D, DET-2D, ENT-2D',
                percentileClip: '百分位数截断归一化',
                minMaxNormalization: '标准Min-Max归一化',
                dataVisualizationChart: '数据可视化图表',
                clickGenerateChart: '点击"生成图表"开始数据可视化',
                chartGenerationDesc: '选择任务、实验组和特征类型后生成对应的统计图表',
                normalizedFeatureTable: '归一化特征数据表格',
                tableRowCountText: '0 行',
                sessionId: '会话ID',
                subject: '受试者',
                task: '任务',
                experimentalGroup: '实验组',
                gameDuration: '游戏时长',
                kwRoi: 'KW-ROI',
                instRoi: 'INST-ROI',
                bgRoi: 'BG-ROI',
                rr1d: 'RR-1D',
                det1d: 'DET-1D',
                ent1d: 'ENT-1D',
                rr2d: 'RR-2D',
                det2d: 'DET-2D',
                ent2d: 'ENT-2D',
                clickRefreshData: '点击"刷新数据"加载归一化特征数据',
                
                // 模块8 - 智能分析
                eighthModule: '智能分析',
                intelligentAnalysisTitle: '智能分析与AI辅助',
                intelligentAnalysisSubtitle: '基于机器学习和人工智能的眼动数据智能分析平台',
                loadingAiEngine: '正在初始化AI分析引擎...',
                patternsDetected: '检测到的模式',
                predictionAccuracy: '预测准确率',
                aiInsights: 'AI洞察',
                anomaliesDetected: '异常检测',
                aiControlPanel: 'AI分析控制台',
                aiAnalysisMode: 'AI分析模式',
                dataSource: '数据源选择',
                rawEyetrackingData: '原始眼动数据',
                extractedFeatures: '提取特征数据',
                rqaAnalysisData: 'RQA分析数据',
                modelConfig: '模型配置',
                confidenceThreshold: '置信度阈值',
                maxIterations: '最大迭代次数',
                startAiAnalysis: '开始AI分析',
                viewResults: '查看结果',
                exportAiReport: '导出AI报告',
                aiVisualizationResults: 'AI分析结果可视化',
                clickStartAi: '点击"开始AI分析"进行智能数据分析',
                aiAnalysisDesc: 'AI将自动识别数据模式、检测异常并生成洞察报告',
                aiInsightReport: 'AI洞察报告',
                waitingForAnalysis: '等待分析',
                noInsightsYet: '暂无AI洞察数据，请先运行分析',
                
                // 模块8 - 眼动系数与MMSE对比分析
                loadEyeMovementData: '加载眼动数据',
                calculateCoefficients: '计算眼动系数',
                compareWithMMSE: 'MMSE对比分析',
                exportComparisonReport: '导出对比报告',
                eyeMovementMMSEComparison: '眼动系数与MMSE分数对比',
                eyeMovementIndicators: '眼动特征指标说明',
                lowerIsBetter: '越低越好指标',
                higherIsBetter: '越高越好指标',
                gameDuration: '游戏时长',
                kwRoiTime: '关键词ROI时间',
                instRoiTime: '指令ROI时间',
                bgRoiTime: '背景ROI时间',
                rqaFeatures: 'RQA特征',
                rqa2dFeatures: 'RQA-2D特征',
                rqaDescription: '反映眼动模式的复杂性和规律性',
                coefficientCalculation: '眼动系数 = (反向处理的时间指标 + 正向RQA指标) / 10，确保所有指标方向一致',
                selectRqaConfig: '请选择RQA配置数据...',
                pleaseSelectModule7DataSource: '请先选择模块7数据源',
                pleaseLoadEyeMovementDataFirst: '请先加载眼动数据',
                eyeMovementDataLoadFailed: '眼动数据加载失败: {error}\n\n请确保：\n1. 服务器正在运行\n2. 已访问模块7并生成了对应的数据\n3. 选择了正确的RQA配置',
                mmseDataLoadFailed: 'MMSE数据加载失败，请检查服务器状态和数据文件',
                pleaseCalculateCoefficientsFirst: '请先计算眼动系数',
                mmseComparisonFailed: 'MMSE对比分析失败，请重试',
                pleasePerformMmseComparisonFirst: '请先进行MMSE对比分析',
                exportReportFailed: '导出报告失败，请重试',
                gameDurationRangeValue: '5%-95%分位数',
                roiTimeRangeValue: '5%-98%分位数',
                rqaFeaturesRangeValue: '[0, 1]',
                clickStartComparison: '点击"MMSE对比分析"开始分析',
                comparisonAnalysisDesc: '分析眼动系数与MMSE认知评分的相关性',
                comparisonResultsTable: '眼动系数与MMSE对比结果',
                switchToGroupView: '切换到群体视图',
                switchToIndividualView: '切换到个人视图',
                subjectId: '受试者ID',
                taskId: '任务',
                groupType: '组别',
                eyeMovementCoeff: '眼动系数',
                mmseScore: 'MMSE分数',
                mmseMaxScore: '满分',
                performanceRatio: '完成率',
                avgEyeMovementCoeff: '平均眼动系数',
                avgMmseScore: '平均MMSE分数',
                                    subjectCount: '受试者数量',
                    correlationCoeff: '相关系数',
                    standardDeviation: '标准差',
                    subQuestionName: '子问题',
                    subQuestionScore: '子问题分数',
                    subQuestionMaxScore: '满分',
                    subQuestionPerformanceRatio: '完成率',
                noComparisonData: '点击"MMSE对比分析"加载对比数据',
                switchToSubQuestionView: '切换到子问题详细视图',
                switchToMainQuestionView: '切换到主问题视图',
                subQuestionId: '子问题',
                subQuestionName: '子问题名称',
                subQuestionScore: '子问题得分',
                subQuestionMaxScore: '子问题满分',
                // MMSE子问题中文名称
                年份: '年份',
                季节: '季节', 
                月份: '月份',
                星期: '星期',
                省市区: '省市区',
                街道: '街道',
                建筑: '建筑',
                楼层: '楼层',
                即刻记忆: '即刻记忆',
                '100-7': '100-7',
                '93-7': '93-7',
                '86-7': '86-7', 
                '79-7': '79-7',
                '72-7': '72-7',
                词1: '词1',
                词2: '词2',
                词3: '词3',
                
                        // 模块9 - 机器学习预测分析
        ninthModule: '机器学习',
        
        // 模块10 - Eye-Index 综合评估
        tenthModule: 'Eye-Index评估',
        tenthModuleTitle: '模块10 - Eye-Index 综合评估',
        tenthModuleSubtitle: '基于10个眼动特征的综合指标计算与可视化分析',
        
        // 模块10-B PyTorch训练引擎
        module10bTitle: '子模块10-B: PyTorch MLP训练引擎',
        module10bDescription: '基于PyTorch的多层感知机训练系统，支持Q1-Q5任务的独立训练',
        loadingTrainingInterface: '正在加载训练界面...',
        trainingConfig: '训练配置',
        selectDataset: '选择数据集',
        selectTask: '选择训练任务',
        multiSelectHint: '按住Ctrl键多选',
        epochs: '训练轮数',
        learningRate: '学习率',
        batchSize: '批大小',
        earlyStopPatience: '早停耐心值',
        startTraining: '开始训练',
        trainingMonitor: '训练监控',
        readyToTrain: '请选择数据集和任务开始训练',
        trainingProgress: '训练进度',
        currentEpoch: '当前轮次',
        trainLoss: '训练损失',
        valLoss: '验证损失',
        trainingResults: '训练结果',
        task: '任务',
        bestEpoch: '最佳轮次',
        bestValLoss: '最佳验证损失',
        testRmse: '测试RMSE',
        testR2: '测试R²',
        modelPath: '模型路径',

        
        // 模块10-C 数据查看器
        module10cTitle: '子模块10-C: 训练数据查看器',
        module10cDescription: 'NPZ训练数据的表格化展示、统计分析和导出功能',
        selectDataset: '选择数据集',
        selectTask: '选择任务',
        options: '选项',
        includePredictions: '包含预测结果',
        loadDataTable: '加载数据表格',
        showStatistics: '统计摘要',
        exportCSV: '导出CSV',
        exportExcel: '导出Excel',
        compareDatasets: '对比数据集',
        dataStatsSummary: '数据统计摘要',
        trainingDataDetails: '训练数据详情',
        loadingData: '正在加载数据...',
        noDataLoaded: '暂无数据',
        selectDatasetToView: '请选择数据集和任务，然后点击"加载数据表格"',
        showingEntries: '显示第 {start}-{end} 条，共 {total} 条记录',
        correlationAnalysis: '特征相关性分析',
        q1Orientation: 'Q1 定向',
        q2Registration: 'Q2 注册',
        q3AttentionCalculation: 'Q3 注意计算',
        q4Recall: 'Q4 回忆',
        q5DelayedRecall: 'Q5 延迟回忆',
        
        // 模块10-D 性能评估
        module10dTitle: '子模块10-D: 模型性能评估与差异可视化',
        module10dDesc: '深度分析模型预测性能，提供个体残差和任务级误差对比',
        selectModelConfig: '选择模型配置',
        analysisOptions: '分析选项',
        includeGroupAnalysis: '包含组别对比',
        startAnalysis: '开始分析',
        
        // 模块10-E 关联性可视化
        module10eTitle: '子模块10-E: MMSE预测关联性深度可视化',
        module10eDesc: '深度挖掘MMSE真实分数与预测分数之间的关联性，提供多维度、多角度的可视化分析',
        analysisType: '分析类型',
        visualizationOptions: '可视化选项',
        include3D: '包含3D图表',
        exportReport: '导出报告',
        exportCharts: '导出图表',
        scatterMatrix: '散点图矩阵 - 真实值 vs 预测值',
        toggleRegressionLines: '切换回归线',
        overallCorrelation: '总体相关性',
        controlCorrelation: '对照组相关性',
        mciCorrelation: 'MCI组相关性',
        adCorrelation: 'AD组相关性',
        blandAltmanAnalysis: 'Bland-Altman一致性分析',
        toggleConfidenceBands: '切换置信带',
        agreementStatistics: '一致性统计',
        meanBias: '平均偏差',
        agreementLimits: '一致性界限',
        withinLimits: '界限内比例',
        concordanceIndex: '一致性指数',
        clinicalInterpretation: '临床意义解释',
        blandAltmanHelp1: '• Bland-Altman图评估预测值与真实值的一致性',
        blandAltmanHelp2: '• 95%的数据点应在一致性界限内（虚线之间）',
        blandAltmanHelp3: '• 平均偏差接近0表示无系统性误差',
        rocAnalysis: 'ROC曲线与诊断能力分析',
        toggleOptimalThreshold: '最佳阈值',
        diagnosticMetrics: '诊断指标',
        diagnosticThreshold: '诊断阈值',
        sensitivity: '敏感度',
        specificity: '特异度',
        accuracy: '准确度',
        youdenIndex: '约登指数',
        '3dScatterPlot': '3D交互式关联分析',
        resetView: '重置视角',
        toggleAnimation: '自动旋转',
        screenshot: '截图',
        '3dControls': '3D控制',
        applySettings: '应用设置',
        '3dChartHelp': '3D图表操作说明',
        '3dRotate': '• 拖拽鼠标: 旋转视角',
        '3dZoom': '• 滚轮: 缩放',
        '3dPan': '• Shift+拖拽: 平移',
        '3dSelect': '• 点击数据点: 查看详情',
        correlationHeatmap: '多维相关性热力图',
        toggleValues: '显示数值',
        taskCorrelation: '任务间相关性',
        featureCorrelation: '特征间相关性',
        errorCorrelation: '误差相关性',
        groupCorrelation: '组别差异',
        correlationScale: '红色=负相关，蓝色=正相关',
        correlationAnalysisDesc: '分析将展示MMSE真实分数与预测分数之间的深度关联性',
        exportData: '导出数据',
        performanceOverview: '性能指标概览',
        residualAnalysis: '个体残差曲线分析',
        taskComparison: '任务级误差对比分析',
        scatterMatrix: '散点图矩阵 - 真实值 vs 预测值',
        scatterMatrixHelp: '散点图说明',
        scatterHelp1: '• 每个点代表一个样本的真实MMSE分数与预测分数',
        scatterHelp2: '• 理想预测线(y=x)表示完美预测',
        scatterHelp3: '• 点越接近理想线，预测越准确',
        groupPerformanceComparison: '分组性能对比',
        downloadChart: '下载图表',
        showGroups: '显示组别',
        controlGroup: 'Control',
        mciGroup: 'MCI',
        adGroup: 'AD',
        allGroups: '全部',
        residualChartHelp: '残差 = 预测值 - 真实值。正值表示高估，负值表示低估。',
        comparisonChartHelp: '蓝色柱表示平均真实得分，红色柱表示平均绝对误差。',
        analyzing: '正在分析模型性能...',
        selectConfigToStart: '请选择模型配置开始性能分析',
        performanceAnalysisDesc: '分析将展示模型在各任务上的预测准确性和个体差异',
        refreshCache: '刷新缓存',
        cacheStatus: '缓存状态',
        cacheRefreshed: '缓存已刷新',
        cacheRefreshFailed: '缓存刷新失败',
        
        refreshData: '刷新数据',
        selectConfig: '选择RQA配置',
        pleaseSelect: '请选择配置...',
        calculationMode: '计算模式',
        status: '状态',
        notCalculated: '未计算',
        equalWeight: '等权平均',
        pcaMode: 'PCA第一主成分',
        customWeight: '自定义权重',
        
        q1TimeOrientation: 'Q1 时间定向',
        q2SpaceOrientation: 'Q2 空间定向',
        q3ImmediateMemory: 'Q3 即刻记忆',
        q4AttentionCalculation: 'Q4 注意力计算',
        q5DelayedRecall: 'Q5 延迟回忆',
        interpretationPanel: '分析解释',
        pleaseCalculateFirst: '请先选择配置并计算S_eye',
        exportCSV: '导出CSV数据',
        exportJSON: '导出JSON报告',
        exportPDF: '导出PDF报告',
        
        // 子模块10-A多语言配置
        module10aTitle: '子模块10-A: 数据准备与构建',
        selectRqaConfig: '选择RQA配置',
        valSplit: '验证集比例',
        randomState: '随机种子',
        checkPrerequisites: '检查前置条件',
        buildDataset: '构建数据集',
        refreshStatus: '刷新状态',
        statusInfo: '状态信息',
        clickCheckPrerequisites: '请点击"检查前置条件"按钮开始',
        builtDatasets: '已构建数据集',
        loading: '加载中...',
        
        
        subjectRadar: '受试者特征雷达图',
        selectSubject: '选择受试者...',
        statisticsTable: '统计摘要表',
        group: '组别',
        count: '样本数',
        mean: '均值',
        std: '标准差',
        median: '中位数',
        q1q3: '四分位数',
        range: '范围',
        noDataAvailable: '暂无数据',
        customWeights: '自定义权重',
        basicFeatures: '基础特征',
        rqaFeatures: 'RQA特征',
        normalizeWeights: '归一化权重',
                machineLearningTitle: '机器学习预测分析',
                machineLearningSubtitle: '基于眼动特征的MMSE子分数智能预测系统',
                dataPreprocessingTitle: '子模块9.1 - 数据预处理与整合',
                modelTrainingTitle: '子模块9.2 - MLP模型训练',
            trainingMethod: '训练方法',
            trainingMethodHint: '专家建议: CV能显著提升小样本模型性能和稳定性',
            cvParams: '交叉验证参数',
            cvResults: '5-fold交叉验证结果',
            labelNormalization: '标签归一化优化',
            labelNormalizationHint: 'MMSE子分数归一化到[0,1]，提升多输出回归效果',
            featureSelection: '专家特征选择',
            featureSelectionHint: '精选10个核心眼动特征，移除噪声列',
                predictionVisualizationTitle: '子模块9.3 - 预测与可视化',
                featureDirectionCorrection: '特征方向一致性校正',
                enableDirectionCorrection: '启用方向一致性校正',
                directionCorrectionHint: '统一所有特征为"数值越高=认知越好"方向',
                transformMethods: '变换方法',
                selectRqaConfig: '选择RQA配置',
                loadingConfigs: '加载中...',
                dataStatus: '数据状态',
                notProcessed: '未处理',
                ready: '就绪',
                processing: '处理中',
                completed: '完成',
                error: '错误',
                actions: '操作',
                startPreprocessing: '开始预处理',
                refreshData: '刷新数据',
                totalSamples: '总样本数',
                trainSamples: '训练集样本',
                testSamples: '测试集样本',
                featureCount: '特征数量',
                processingLog: '处理日志',
                noLogYet: '暂无日志...',
                // 子模块9.2 - MLP模型训练
                trainingConfig: '训练配置',
                modelPreset: '模型预设',
                modelPresetHint: '专家建议: Simple模型适合当前60样本数据集',
                hiddenLayers: '隐藏层配置',
                hiddenLayersHint: '用逗号分隔，例如32表示单层，64,32表示双层',
                regularization: '正则化设置',
                useDropout: '使用Dropout',
                useL2Reg: '使用L2正则化',
                dropoutRate: 'Dropout比率',
                l2Lambda: 'L2正则化系数',
                epochs: '训练轮数',
                batchSize: '批大小',
                learningRate: '学习率',
                validationSplit: '验证集比例',
                earlyStopping: '早停轮数',
                earlyStoppingHint: '验证损失多少轮不改善后停止训练',
                trainingStatus: '训练状态',
                waitingToTrain: '等待训练',
                training: '训练中',
                trainingCompleted: '训练完成',
                trainingError: '训练错误',
                currentEpoch: '当前轮数',
                trainingLoss: '训练损失',
                validationLoss: '验证损失',
                testMAE: '测试MAE',
                startTraining: '开始训练',
                resetTraining: '重置',
                viewTrainingLog: '查看日志',
                trainingLog: '训练日志',
                noTrainingLogYet: '暂无训练日志...',
                modelTrainingPlaceholder: '模型训练功能正在开发中...',
                predictionVisualizationPlaceholder: '预测与可视化功能正在开发中...',
                
                // 模块10-B 高级参数
                advancedParams: '高级参数设置',
                maxEpochs: '最大轮数',
                earlyStopPatience: '早停耐心值',
                learningRate: '学习率',
                batchSize: '批大小',
                dropout: 'Dropout率',
                l2Regularization: 'L2正则化',
                hiddenLayer1: '第一隐藏层',
                hiddenLayer2: '第二隐藏层',
                enableBatchNorm: '启用批归一化',
                batchNormHint: '可提高训练稳定性',
                enableDropout: '启用Dropout',
                dropoutHint: '设为0关闭，防止过拟合',
                dropoutInfo: '0=关闭，推荐0.25',
                learningCurve: '学习曲线',
                learningCurveDesc: '监控训练/验证损失变化，识别过拟合分叉点',
                predictionAccuracy: '预测准确性分析',
                scatterPlot: '预测vs真实散点图',
                residualPlot: '残差分布图',
                accuracyMetrics: '准确性指标',
                accuracyDesc: '分析模型预测值与真实MMSE分数的相关性和准确性',
                currentEpoch: '当前轮次',
                trainLoss: '训练损失',
                valLoss: '验证损失',
                readyToTrain: '请选择数据集和任务开始训练',
                trainingMonitor: '训练监控',
                
                // 新增高级参数
                enableLRScheduler: '启用学习率调度器',
                lrFactor: '衰减因子',
                lrPatience: '调度耐心值',
                minLR: '最小学习率',
                validationSplit: '验证集比例',
                valSplitHint: '推荐0.3可提高验证可靠性',
                enableCrossValidation: '启用交叉验证',
                cvFolds: '交叉验证折数'
            },
            en: {
                title: 'VR Eye Tracking Data Visualization Platform',
                subtitle: 'VR Eye Tracking Data Analysis and Visualization Platform for Three Cognitive Assessment Groups',
                restart: 'Restart',
                totalData: 'Total Data',
                researchGroups: 'Research Groups',
                controlGroup: 'Healthy Control',
                mciGroup: 'MCI Group',
                adGroup: 'Alzheimer\'s Group',
                taskFilter: 'Task Filter',
                all: 'All',
                task1: 'Task 1',
                task2: 'Task 2',
                task3: 'Task 3',
                task4: 'Task 4',
                task5: 'Task 5',
                dataList: 'Data List',
                loading: 'Loading...',
                refresh: 'Refresh',
                selectDataTitle: 'Select Data to Start Analysis',
                selectDataSubtitle: 'Click on the data items on the left to generate professional eye tracking visualization analysis',
                eyeTrackingVis: 'Eye Tracking Visualization',
                visControls: 'Visualization Controls',
                fixationSize: 'Fixation Size:',
                trajectoryWidth: 'Trajectory Width:',
                pointSize: 'Point Size:',
                trajectoryStyle: 'Trajectory Style:',
                solidLine: 'Solid',
                dashedLine: 'Dashed',
                dottedLine: 'Dotted',
                updateVis: 'Update Visualization',
                generatingVis: 'Generating visualization...',
                noData: 'No Data',
                loadFailed: 'Load Failed',
                dataItems: ' items',
                overallStats: 'Overall Statistics',
                totalPoints: 'Total Points',
                totalDuration: 'Total Duration',
                fixationEvents: 'Fixation Events',
                saccadeEvents: 'Saccade Events',
                avgVelocity: 'Avg Velocity',
                maxVelocity: 'Max Velocity',
                roiSequence: 'ROI Sequence',
                mainRoiStats: 'Main ROI Statistics',
                statInfo: 'Statistical Information',
                restartConfirm: 'Are you sure you want to restart the server?',
                restarting: 'Server is restarting...',
                dataVisualization: 'Data Visualization',
                newFeature: 'Data Import',
                dataImportTitle: 'Data Import & Processing',
                dataImportDesc: 'Batch import raw eye tracking data and automatically complete preprocessing and calibration steps',
                stepUpload: 'Upload Files',
                stepGroup: 'Select Group',
                stepProcess: 'Data Processing',
                stepComplete: 'Complete',
                uploadTitle: 'Drag or click to select files',
                uploadDesc: 'Please select 5 txt files, file names must be: 1.txt, 2.txt, 3.txt, 4.txt, 5.txt',
                selectFiles: 'Select Files',
                selectedFiles: 'Selected Files',
                clearFiles: 'Clear',
                nextStep: 'Next Step',
                selectGroup: 'Select Data Group',
                groupSelectionDesc: 'Choose the appropriate research group for this batch of imported data',
                controlDesc: 'Healthy subjects with normal cognitive function',
                mciDesc: 'Subjects with mild cognitive impairment',
                adDesc: 'Subjects with Alzheimer\'s disease',
                prevStep: 'Previous Step',
                startProcess: 'Start Processing',
                processingData: 'Processing Data',
                overallProgress: 'Overall Progress',
                currentTask: 'Current Task',
                processingLog: 'Processing Log',
                processingComplete: 'Data Processing Complete!',
                processingCompleteDesc: 'All files have been successfully processed and added to the system',
                viewData: 'View Data',
                importMore: 'Import More',
                importStatus: 'Import Status',
                fileRequirements: 'File Requirements',
                req1: 'Must upload 5 txt files',
                req2: 'File names must be: 1.txt, 2.txt, 3.txt, 4.txt, 5.txt',
                req3: 'Representing Q1-Q5 data from the same subject',
                validationStatus: 'Validation Status',
                processPreview: 'Process Preview',
                fileValidation: 'File validation failed',
                missingFiles: 'Missing required files',
                invalidFileNames: 'File names do not meet requirements',
                validationPassed: 'Validation passed, ready for next step',
                editCalibration: 'Edit Calibration',
                calibrationEdit: 'Calibration Edit Mode',
                calibrationDesc: 'Adjust offset values for current data and preview calibration effects in real-time',
                currentData: 'Current Data',
                xOffset: 'X-axis Offset',
                yOffset: 'Y-axis Offset',
                presetOffsets: 'Preset Offsets',
                reset: 'Reset',
                cancel: 'Cancel',
                preview: 'Preview',
                save: 'Save Calibration',
                calibrationSaved: 'Calibration Saved',
                calibrationError: 'Failed to Save Calibration',
                timeCalibration: 'Time Calibration',
                timeCalibrationDesc: 'Adjust the time range of data to control trajectory start and end points',
                totalDuration: 'Total Duration',
                dataPoints: 'Data Points',
                selectedRange: 'Selected Range',
                startTime: 'Start Time',
                endTime: 'End Time',
                timePresets: 'Time Presets',
                fullRange: 'Full Range',
                trimEdges: 'Trim Edges',
                firstHalf: 'First Half',
                secondHalf: 'Second Half',
                groupControl: 'Control Group',
                groupMci: 'MCI Group',
                groupAd: 'Alzheimer\'s Group',
                editDataGroup: 'Edit Data Group',
                dataId: 'Data ID',
                currentGroup: 'Current Group',
                selectNewGroup: 'Select New Group',
                deleteDataConfirm: 'Are you sure you want to delete data "{0}"?\n\nNote: Deleting a single task will result in the entire group\'s data being deleted.',
                deleteDataFailed: 'Failed to delete data',
                changeGroupFailed: 'Failed to change group',
                deleteDataSuccess: 'Data deleted successfully',
                changeGroupSuccess: 'Group changed successfully',
                confirm: 'Confirm',
                cognitiveAssessment: 'Cognitive Assessment (MMSE)',
                noMMSEData: 'No MMSE assessment data available for this group',
                orientation: 'Orientation',
                immediateMemory: 'Immediate Memory',
                calculation: 'Calculation',
                delayedRecall: 'Delayed Recall',
                totalScore: 'Total Score',
                assessmentLevel: 'Assessment Level',
                unitCount: ' items',
                unitMs: 'ms',
                unitSecond: 's',
                unitDegreesPerSecond: '°/s',
                // MMSE task names
                q1OrientationTime: 'Time Orientation',
                q2OrientationPlace: 'Place Orientation',
                q3ImmediateMemory: 'Immediate Memory',
                q4Calculation: 'Calculation',
                q5DelayedRecall: 'Delayed Recall',
                year: 'Year',
                season: 'Season',
                month: 'Month',
                weekday: 'Weekday',
                province: 'Province/City',
                street: 'Street',
                building: 'Building',
                floor: 'Floor',
                word1: 'Word 1',
                word2: 'Word 2',
                word3: 'Word 3',
                            // RQA Analysis
            rqaAnalysis: 'RQA Analysis',
            rqaAnalysisTitle: 'Recurrence Quantification Analysis (RQA)',
            rqaAnalysisDescription: 'Batch generate and visualize recurrence plots',
            renderControl: 'Render Control',
            filterControl: 'Filter Control',
            analysisMode: 'Analysis Mode',
            analysis1DX: '1D Signal (X Coordinate)',
            analysis1DAmplitude: '1D Signal (Amplitude)',
            analysis2DXY: '2D Signal (X,Y Coordinates)',
            distanceMetric: 'Distance Metric',
            distance1DAbs: '1D Absolute Difference',
            distanceEuclidean: 'Euclidean Distance',
            embeddingDimension: 'Embedding Dimension (m)',
            timeDelay: 'Time Delay (τ)',
            recurrenceThreshold: 'Recurrence Threshold (ε)',
            minLineLength: 'Min Line Length (l_min)',
            colorTheme: 'Render Color',
            grayscaleTheme: 'Grayscale',
            greenGradientTheme: 'Green to White Gradient',
            startRender: 'Start Render',
            checkStatus: 'Check Status',
            filterGroup: 'Filter Group',
            filterQuestion: 'Filter Question',
            allQuestions: 'All Questions',
            updateDisplay: 'Update Display',
            rqaResultsTitle: 'Recurrence Plot Visualization Results',
            rqaResultsDescription: 'Display 5 columns per row, arranged by group and question',
            noRQAImages: 'No RQA images rendered yet',
            renderTip: 'Please set parameters and click "Start Render" button first',
            rqaTitle: 'Recurrence Quantification Analysis (RQA)',
            rqaDescription: 'Perform recurrence quantification analysis on eye-tracking data to reveal complexity and regularity of eye movement patterns',
            
            // Event Analysis
            eventAnalysis: 'Event Analysis',
            eventAnalysisTitle: 'Eye Movement Event Analysis',
            eventAnalysisDescription: 'Display and filter eye movement event analysis results and ROI statistics based on IVT algorithm',
            dataOverview: 'Data Overview',
            dataType: 'Data Type',
            eventsData: 'Events Data',
            roiData: 'ROI Statistics',
            groupFilter: 'Group Filter',
            allGroups: 'All Groups',
            controlGroup: 'Control Group',
            mciGroup: 'MCI Group',
            adGroup: 'AD Group',
            eventTypeFilter: 'Event Type',
            allEvents: 'All Events',
            fixationEvents: 'fixation',
            saccadeEvents: 'saccade',
            pageSize: 'Page Size',
            refreshData: 'Refresh Data',
            regenerateData: 'Regenerate Data',
            exportData: 'Export Data',
            // 归一化方法说明 - 英文
            normalizationMethods: 'Normalization Methods',
            gameDurationTitle: 'Game Duration Features',
            gameDurationMethod: 'Method',
            gameDurationRange: 'Range',
            gameDurationReason: 'Reason',
            gameDurationReasonText: 'Avoid extreme outliers (e.g., 0.1s or 4min) affecting normal data distribution',
            roiTimeTitle: 'ROI Time Features',
            roiTimeMethod: 'Method',
            roiTimeRange: 'Range',
            roiTimeReason: 'Reason',
            roiTimeReasonText: 'Preserve more valid data while filtering gaze time outliers',
            rqaFeaturesTitle: 'RQA Recurrence Quantification Features',
            rqaFeaturesMethod: 'Method',
            rqaFeaturesRange: 'Range',
            rqaFeaturesReason: 'Reason',
            rqaFeaturesReasonText: 'RQA features (RR, DET, ENT) have theoretical range limits, no clipping needed',
            rqaFeaturesList: 'Includes: RR-1D, DET-1D, ENT-1D, RR-2D, DET-2D, ENT-2D',
            percentileClip: 'Percentile Clipping Normalization',
            minMaxNormalization: 'Standard Min-Max Normalization',
            loadingData: 'Loading data...',
            filterOptions: 'Filter Options',
                dataSelection: 'Data Selection',
                selectGroup: 'Select Research Group',
                allGroups: 'All Groups',
                selectTask: 'Select Task',
                allTasks: 'All Tasks',
                selectData: 'Select Specific Data',
                selectAll: 'Select All',
                pleaseSelect: 'Please select group and task first',
                rqaParameters: 'RQA Parameters',
                embeddingDimension: 'Embedding Dimension (m)',
                timeDelay: 'Time Delay (τ)',
                recurrenceThreshold: 'Recurrence Threshold (ε)',
                minLineLength: 'Minimum Line Length (l_min)',
                runAnalysis: 'Run Analysis',
                resetParams: 'Reset Parameters',
                recurrencePlot: 'Recurrence Plot',
                rqaMetrics: 'RQA Metrics',
                compareResults: 'Comparison Analysis',
                recurrencePlotTitle: 'Recurrence Plot Visualization',
                recurrencePlotDesc: 'Display recurrence patterns and periodic structures in eye movement trajectories',
                rqaMetricsTitle: 'RQA Quantitative Metrics',
                rqaMetricsDesc: 'Quantitatively describe complexity, determinism and predictability of eye movement patterns',
                compareTitle: 'Inter-group Comparison Analysis',
                compareDesc: 'Compare RQA metric differences between different groups',
                noAnalysisYet: 'No analysis yet',
                selectDataAndRun: 'Please select data and set parameters to run RQA analysis',
                noMetricsYet: 'No metrics data yet',
                runAnalysisFirst: 'Please run RQA analysis first to get quantitative metrics',
                noCompareYet: 'No comparison data yet',
                selectMultipleGroups: 'Please select multiple groups for comparison analysis',
                pleaseSelectData: 'Please select data to analyze first',
                
                // Module 7 - Data Organization
                seventhModule: 'Data Organization',
                dataOrganizationTitle: 'Data Organization & Feature Visualization',
                dataOrganizationSubtitle: 'Normalized feature data analysis based on database normalization principles',
                loadingNormalizedData: 'Loading normalized feature data...',
                totalSubjects: 'Total Subjects',
                totalSessions: 'Game Sessions',
                vrMmseTasks: 'VR-MMSE Tasks',
                normalizedFeatures: 'Normalized Features',
                dataFilterConfig: 'Data Filter & Configuration',
                selectTask: 'Select Task (Q1-Q5)',
                allTasks: 'All Tasks',
                taskQ1: 'Task Q1',
                taskQ2: 'Task Q2',
                taskQ3: 'Task Q3',
                taskQ4: 'Task Q4',
                taskQ5: 'Task Q5',
                experimentalGroupFilter: 'Experimental Group Filter',
                adGroupLabel: 'Alzheimer\'s Disease Group',
                mciGroupLabel: 'Mild Cognitive Impairment Group',
                controlGroupLabel: 'Normal Control Group',
                featureType: 'Feature Type',
                gameDurationOption: '🎮 Game Duration',
                roiFeaturesOption: '👁️ ROI Features (3 items)',
                rqa1dFeaturesOption: '🔄 RQA-1D Features (3 items)',
                rqa2dFeaturesOption: '🔄 RQA-2D Features (3 items)',
                rqaAllFeaturesOption: '🔄 All RQA Features (6 items)',
                comprehensiveOption: '📈 Comprehensive Comparison (10 items)',
                allFeaturesOption: '📊 All Features (10 items)',
                visualizationType: 'Visualization Type',
                barChartOption: '📊 Bar Chart',
                lineChartOption: '📈 Line Chart',
                scatterChartOption: '🔸 Scatter Chart',
                refreshData: 'Refresh Data',
                generateChart: 'Generate Chart',
                exportData: 'Export Data',
                dataVisualizationChart: 'Data Visualization Chart',
                clickGenerateChart: 'Click "Generate Chart" to start data visualization',
                chartGenerationDesc: 'Select task, experimental group and feature type to generate corresponding statistical charts',
                normalizedFeatureTable: 'Normalized Feature Data Table',
                tableRowCountText: '0 rows',
                sessionId: 'Session ID',
                subject: 'Subject',
                task: 'Task',
                experimentalGroup: 'Experimental Group',
                gameDuration: 'Game Duration',
                kwRoi: 'KW-ROI',
                instRoi: 'INST-ROI',
                bgRoi: 'BG-ROI',
                rr1d: 'RR-1D',
                det1d: 'DET-1D',
                ent1d: 'ENT-1D',
                rr2d: 'RR-2D',
                det2d: 'DET-2D',
                ent2d: 'ENT-2D',
                clickRefreshData: 'Click "Refresh Data" to load normalized feature data',
                
                // Module 8 - Eye Movement MMSE Analysis
                eighthModule: 'Intelligent Analysis',
                intelligentAnalysisTitle: 'Eye Movement Coefficient vs MMSE Comparison Analysis',
                intelligentAnalysisSubtitle: 'Real data-based analysis of correlation between eye movement patterns and cognitive abilities',
                loadingAiEngine: 'Initializing analysis system...',
                patternsDetected: 'Patterns Detected',
                predictionAccuracy: 'Prediction Accuracy',
                aiInsights: 'AI Insights',
                anomaliesDetected: 'Anomalies Detected',
                eyeMovementMMSEAnalysis: 'Eye Movement Coefficient vs MMSE Analysis',
                module7DataSource: 'Module 7 Data Source Selection',
                module7DataSourceHelp: 'Select processed normalized feature data from Module 7 for analysis',
                dataOverview: 'Data Overview',
                eyeMovementPatterns: 'Eye Movement Patterns',
                mmseScores: 'MMSE Scores',
                startAiAnalysis: 'Start AI Analysis',
                viewResults: 'View Results',
                exportAiReport: 'Export AI Report',
                aiVisualizationResults: 'AI Analysis Visualization Results',
                clickStartAi: 'Click "Start AI Analysis" for intelligent data analysis',
                aiAnalysisDesc: 'AI will automatically identify data patterns, detect anomalies and generate insight reports',
                aiInsightReport: 'AI Insight Report',
                waitingForAnalysis: 'Waiting for Analysis',
                noInsightsYet: 'No AI insights available yet, please run analysis first',
                
                // Module 8 - Eye Movement Coefficient vs MMSE Comparison
                loadEyeMovementData: 'Load Eye Movement Data',
                calculateCoefficients: 'Calculate Coefficients',
                compareWithMMSE: 'MMSE Comparison Analysis',
                exportComparisonReport: 'Export Comparison Report',
                eyeMovementMMSEComparison: 'Eye Movement Coefficient vs MMSE Score Comparison',
                eyeMovementIndicators: 'Eye Movement Feature Indicators',
                lowerIsBetter: 'Lower is Better Indicators',
                higherIsBetter: 'Higher is Better Indicators',
                gameDuration: 'Game Duration',
                kwRoiTime: 'Keyword ROI Time',
                instRoiTime: 'Instruction ROI Time',
                bgRoiTime: 'Background ROI Time',
                rqaFeatures: 'RQA Features',
                rqa2dFeatures: 'RQA-2D Features',
                rqaDescription: 'Reflect complexity and regularity of eye movement patterns',
                coefficientCalculation: 'Eye Movement Coefficient = (Inverse time indicators + Direct RQA indicators) / 10, ensuring consistent direction',
                selectRqaConfig: 'Please select RQA configuration data...',
                pleaseSelectModule7DataSource: 'Please select Module 7 data source first',
                pleaseLoadEyeMovementDataFirst: 'Please load eye movement data first',
                eyeMovementDataLoadFailed: 'Eye movement data loading failed: {error}\n\nPlease ensure:\n1. Server is running\n2. Module 7 has been accessed and corresponding data generated\n3. Correct RQA configuration is selected',
                mmseDataLoadFailed: 'MMSE data loading failed, please check server status and data files',
                pleaseCalculateCoefficientsFirst: 'Please calculate coefficients first',
                mmseComparisonFailed: 'MMSE comparison analysis failed, please try again',
                pleasePerformMmseComparisonFirst: 'Please perform MMSE comparison analysis first',
                exportReportFailed: 'Export report failed, please try again',
                gameDurationRangeValue: '5%-95% percentile',
                roiTimeRangeValue: '5%-98% percentile',
                rqaFeaturesRangeValue: '[0, 1]',
                clickStartComparison: 'Click "MMSE Comparison Analysis" to start analysis',
                comparisonAnalysisDesc: 'Analyze correlation between eye movement coefficients and MMSE cognitive scores',
                comparisonResultsTable: 'Eye Movement Coefficient vs MMSE Comparison Results',
                switchToGroupView: 'Switch to Group View',
                switchToIndividualView: 'Switch to Individual View',
                noComparisonData: 'Click "MMSE Comparison Analysis" to load comparison data',
                subjectId: 'Subject ID',
                taskId: 'Task',
                groupType: 'Group Type',
                eyeMovementCoeff: 'Eye Movement Coefficient',
                mmseScore: 'MMSE Score',
                mmseMaxScore: 'Max Score',
                performanceRatio: 'Performance Ratio',
                avgEyeMovementCoeff: 'Average Eye Movement Coefficient',
                avgMmseScore: 'Average MMSE Score',
                subjectCount: 'Subject Count',
                correlationCoeff: 'Correlation Coefficient',
                standardDeviation: 'Standard Deviation',
                noComparisonData: 'Click "MMSE Comparison Analysis" to load comparison data',
                switchToSubQuestionView: 'Switch to Sub-Question Detail View',
                switchToMainQuestionView: 'Switch to Main Question View',
                subQuestionId: 'Sub-Question',
                subQuestionName: 'Sub-Question Name',
                subQuestionScore: 'Sub-Question Score',
                subQuestionMaxScore: 'Sub-Question Max Score',
                // MMSE子问题英文名称
                年份: 'Year',
                季节: 'Season',
                月份: 'Month', 
                星期: 'Day of Week',
                省市区: 'Province/City/District',
                街道: 'Street',
                建筑: 'Building',
                楼层: 'Floor',
                即刻记忆: 'Immediate Memory',
                '100-7': '100-7',
                '93-7': '93-7', 
                '86-7': '86-7',
                '79-7': '79-7',
                '72-7': '72-7',
                词1: 'Word 1',
                词2: 'Word 2',
                词3: 'Word 3',
                
                        // Module 9 - Machine Learning Prediction Analysis
        ninthModule: 'Machine Learning',
        
        // Module 10 - Eye-Index Comprehensive Assessment
        tenthModule: 'Eye-Index Assessment',
        tenthModuleTitle: 'Module 10 - Eye-Index Comprehensive Assessment',
        tenthModuleSubtitle: 'Comprehensive Index Calculation and Visualization Analysis Based on 10 Eye Movement Features',
        
        // Module 10-B PyTorch Training Engine
        module10bTitle: 'Sub-module 10-B: PyTorch MLP Training Engine',
        module10bDescription: 'PyTorch-based multi-layer perceptron training system supporting independent training for Q1-Q5 tasks',
        loadingTrainingInterface: 'Loading training interface...',
        trainingConfig: 'Training Configuration',
        selectDataset: 'Select Dataset',
        selectTask: 'Select Training Task',
        multiSelectHint: 'Hold Ctrl for multiple selection',
        epochs: 'Training Epochs',
        learningRate: 'Learning Rate',
        batchSize: 'Batch Size',
        earlyStopPatience: 'Early Stop Patience',
        startTraining: 'Start Training',
        trainingMonitor: 'Training Monitor',
        readyToTrain: 'Please select dataset and task to start training',
        trainingProgress: 'Training Progress',
        currentEpoch: 'Current Epoch',
        trainLoss: 'Train Loss',
        valLoss: 'Val Loss',
        trainingResults: 'Training Results',
        task: 'Task',
        bestEpoch: 'Best Epoch',
        bestValLoss: 'Best Val Loss',
        testRmse: 'Test RMSE',
        testR2: 'Test R²',
        modelPath: 'Model Path',
        
        // Module 10-C Model Service & Management
        module10cTitle: 'Sub-module 10-C: Model Service & Management API',
        module10cDescription: 'Online model service system providing prediction APIs and model management',
        loadingServiceInterface: 'Loading service interface...',
        modelManagement: 'Model Management',
        serviceStatus: 'Service Status',
        checking: 'Checking...',
        activeModels: 'Active Models',
        reloadModels: 'Reload Models',
        viewMetrics: 'View Training Metrics',
        onlinePrediction: 'Online Prediction',
        inputFeatures: 'Input Features (10D)',
        fillRandom: 'Fill Random',
        clear: 'Clear',
        predict: 'Predict',
        predictionResult: 'Prediction Result',
        scoreRange: 'Score Range: 0-1 (Normalized)',
        batchTesting: 'Batch Testing',
        apiTesting: 'API Testing',
        testHealth: 'Health Check',
        testBatch: 'Batch Prediction Test',
        testAll: 'Full Test',
        testResults: 'Test Results',
        noTestRun: 'No test run',
        performanceMetrics: 'Performance Metrics',
        avgLatency: 'Avg Latency',
        successRate: 'Success Rate',
        
        // Module 10-C Data Viewer
        module10cTitle: 'Sub-module 10-C: Training Data Viewer',
        module10cDescription: 'Tabular display, statistical analysis and export of NPZ training data',
        selectDataset: 'Select Dataset',
        selectTask: 'Select Task',
        options: 'Options',
        includePredictions: 'Include Predictions',
        loadDataTable: 'Load Data Table',
        showStatistics: 'Show Statistics',
        exportCSV: 'Export CSV',
        exportExcel: 'Export Excel',
        compareDatasets: 'Compare Datasets',
        dataStatsSummary: 'Data Statistics Summary',
        trainingDataDetails: 'Training Data Details',
        loadingData: 'Loading data...',
        noDataLoaded: 'No Data Loaded',
        selectDatasetToView: 'Please select dataset and task, then click "Load Data Table"',
        showingEntries: 'Showing {start}-{end} of {total} entries',
        correlationAnalysis: 'Feature Correlation Analysis',
        q1Orientation: 'Q1 Orientation',
        q2Registration: 'Q2 Registration',
        q3AttentionCalculation: 'Q3 Attention & Calculation',
        q4Recall: 'Q4 Recall',
        q5DelayedRecall: 'Q5 Delayed Recall',
        
        // Module 10-D Performance Evaluation
        module10dTitle: 'Sub-module 10-D: Model Performance Evaluation & Difference Visualization',
        module10dDesc: 'Deep analysis of model prediction performance with individual residuals and task-level error comparison',
        selectModelConfig: 'Select Model Configuration',
        analysisOptions: 'Analysis Options',
        includeGroupAnalysis: 'Include Group Comparison',
        startAnalysis: 'Start Analysis',
        exportData: 'Export Data',
        performanceOverview: 'Performance Overview',
        residualAnalysis: 'Individual Residual Curve Analysis',
        taskComparison: 'Task-level Error Comparison Analysis',
        groupPerformanceComparison: 'Group Performance Comparison',
        downloadChart: 'Download Chart',
        showGroups: 'Show Groups',
        controlGroup: 'Control',
        mciGroup: 'MCI',
        adGroup: 'AD',
        allGroups: 'All',
        residualChartHelp: 'Residual = Predicted - Actual. Positive values indicate overestimation, negative values indicate underestimation.',
        comparisonChartHelp: 'Blue bars show average actual scores, red bars show average absolute errors.',
        analyzing: 'Analyzing model performance...',
        selectConfigToStart: 'Please select model configuration to start performance analysis',
        performanceAnalysisDesc: 'Analysis will show model prediction accuracy and individual differences across tasks',
        refreshCache: 'Refresh Cache',
        cacheStatus: 'Cache Status',
        cacheRefreshed: 'Cache refreshed successfully',
        cacheRefreshFailed: 'Failed to refresh cache',
        
        refreshData: 'Refresh Data',
        selectConfig: 'Select RQA Configuration',
        pleaseSelect: 'Please select configuration...',
        calculationMode: 'Calculation Mode',
        status: 'Status',
        notCalculated: 'Not Calculated',
        equalWeight: 'Equal Weight Average',
        pcaMode: 'PCA First Component',
        customWeight: 'Custom Weight',
        
        q1TimeOrientation: 'Q1 Time Orientation',
        q2SpaceOrientation: 'Q2 Space Orientation', 
        q3ImmediateMemory: 'Q3 Immediate Memory',
        q4AttentionCalculation: 'Q4 Attention Calculation',
        q5DelayedRecall: 'Q5 Delayed Recall',
        interpretationPanel: 'Analysis Interpretation',
        pleaseCalculateFirst: 'Please select configuration and calculate S_eye first',
        exportCSV: 'Export CSV Data',
        exportJSON: 'Export JSON Report',
        exportPDF: 'Export PDF Report',
        
        // Sub-module 10-A multi-language configuration
        module10aTitle: 'Sub-module 10-A: Data Preparation & Construction',
        selectRqaConfig: 'Select RQA Configuration',
        valSplit: 'Validation Split',
        randomState: 'Random State',
        checkPrerequisites: 'Check Prerequisites',
        buildDataset: 'Build Dataset',
        refreshStatus: 'Refresh Status',
        statusInfo: 'Status Information',
        clickCheckPrerequisites: 'Please click "Check Prerequisites" button to start',
        builtDatasets: 'Built Datasets',
        loading: 'Loading...',
        
        // Sub-module 10-B new multi-language configuration
        subjectRadar: 'Subject Feature Radar Chart',
        selectSubject: 'Select Subject...',
        statisticsTable: 'Statistics Summary Table',
        group: 'Group',
        count: 'Count',
        mean: 'Mean',
        std: 'Std Dev',
        median: 'Median',
        q1q3: 'Quartiles',
        range: 'Range',
        noDataAvailable: 'No Data Available',
        customWeights: 'Custom Weights',
        basicFeatures: 'Basic Features',
        rqaFeatures: 'RQA Features',
        normalizeWeights: 'Normalize Weights',
                machineLearningTitle: 'Machine Learning Prediction Analysis',
                machineLearningSubtitle: 'MMSE Subscores Intelligent Prediction System Based on Eye Movement Features',
                dataPreprocessingTitle: 'Sub-module 9.1 - Data Preprocessing & Integration',
                modelTrainingTitle: 'Sub-module 9.2 - MLP Model Training',
                predictionVisualizationTitle: 'Sub-module 9.3 - Prediction & Visualization',
                featureDirectionCorrection: 'Feature Direction Consistency Correction',
                enableDirectionCorrection: 'Enable Direction Correction',
                directionCorrectionHint: 'Unify all features to "higher value = better cognition" direction',
                transformMethods: 'Transform Methods',
                selectRqaConfig: 'Select RQA Configuration',
                loadingConfigs: 'Loading...',
                dataStatus: 'Data Status',
                notProcessed: 'Not Processed',
                ready: 'Ready',
                processing: 'Processing',
                completed: 'Completed',
                error: 'Error',
                actions: 'Actions',
                startPreprocessing: 'Start Preprocessing',
                refreshData: 'Refresh Data',
                totalSamples: 'Total Samples',
                trainSamples: 'Training Samples',
                testSamples: 'Test Samples',
                featureCount: 'Feature Count',
                processingLog: 'Processing Log',
                noLogYet: 'No logs yet...',
                // Sub-module 9.2 - MLP Model Training
                trainingConfig: 'Training Configuration',
                modelPreset: 'Model Preset',
                modelPresetHint: 'Expert recommendation: Simple model suits current 60-sample dataset',
                hiddenLayers: 'Hidden Layers Configuration',
                hiddenLayersHint: 'Comma separated, e.g., 32 means single layer, 64,32 means dual layers',
                regularization: 'Regularization Settings',
                useDropout: 'Use Dropout',
                useL2Reg: 'Use L2 Regularization',
                dropoutRate: 'Dropout Rate',
                l2Lambda: 'L2 Lambda',
                epochs: 'Training Epochs',
                batchSize: 'Batch Size',
                learningRate: 'Learning Rate',
                validationSplit: 'Validation Split',
                earlyStopping: 'Early Stopping Patience',
                earlyStoppingHint: 'Stop training when validation loss does not improve for this many epochs',
                trainingStatus: 'Training Status',
                waitingToTrain: 'Waiting to Train',
                training: 'Training',
                trainingCompleted: 'Training Completed',
                trainingError: 'Training Error',
                currentEpoch: 'Current Epoch',
                trainingLoss: 'Training Loss',
                validationLoss: 'Validation Loss',
                testMAE: 'Test MAE',
                startTraining: 'Start Training',
                resetTraining: 'Reset',
                viewTrainingLog: 'View Log',
                trainingLog: 'Training Log',
                noTrainingLogYet: 'No training logs yet...',
                modelTrainingPlaceholder: 'Model training feature is under development...',
                predictionVisualizationPlaceholder: 'Prediction and visualization feature is under development...',
                
                // Module 10-B Advanced Parameters
                advancedParams: 'Advanced Parameters',
                maxEpochs: 'Max Epochs',
                earlyStopPatience: 'Early Stop Patience',
                learningRate: 'Learning Rate',
                batchSize: 'Batch Size',
                dropout: 'Dropout Rate',
                l2Regularization: 'L2 Regularization',
                hiddenLayer1: 'Hidden Layer 1',
                hiddenLayer2: 'Hidden Layer 2',
                learningCurve: 'Learning Curve',
                learningCurveDesc: 'Monitor train/val loss changes, identify overfitting divergence',
                predictionAccuracy: 'Prediction Accuracy Analysis',
                scatterPlot: 'Predicted vs Actual Scatter Plot',
                residualPlot: 'Residual Distribution Plot',
                accuracyMetrics: 'Accuracy Metrics',
                accuracyDesc: 'Analyze correlation and accuracy between predicted and actual MMSE scores',
                currentEpoch: 'Current Epoch',
                trainLoss: 'Train Loss',
                valLoss: 'Val Loss',
                readyToTrain: 'Please select dataset and tasks to start training',
                trainingMonitor: 'Training Monitor',
                
                // New Advanced Parameters
                enableLRScheduler: 'Enable LR Scheduler',
                lrFactor: 'Decay Factor',
                lrPatience: 'Scheduler Patience',
                minLR: 'Min Learning Rate',
                validationSplit: 'Validation Split',
                valSplitHint: 'Recommend 0.3 for better validation reliability',
                enableCrossValidation: 'Enable Cross Validation',
                cvFolds: 'CV Folds'
            }
        };

        // 语言文本获取函数
        function getLanguageText(key) {
            return languageTexts[currentLanguage][key] || key;
        }

        // 初始化高级参数控件
        function initAdvancedParamControls() {
            // 学习率调度器控制
            const enableLRScheduler = document.getElementById('enable-lr-scheduler');
            const lrSchedulerParams = document.getElementById('lr-scheduler-params');
            
            if (enableLRScheduler && lrSchedulerParams) {
                function toggleLRSchedulerParams() {
                    lrSchedulerParams.style.display = enableLRScheduler.checked ? 'block' : 'none';
                }
                
                enableLRScheduler.addEventListener('change', toggleLRSchedulerParams);
                toggleLRSchedulerParams(); // 初始化状态
            }
            
            // 交叉验证控制
            const enableCrossValidation = document.getElementById('enable-cross-validation');
            const cvParams = document.getElementById('cv-params');
            const valSplitInput = document.getElementById('val-split-input');
            
            if (enableCrossValidation && cvParams) {
                function toggleCrossValidationParams() {
                    const isEnabled = enableCrossValidation.checked;
                    cvParams.style.display = isEnabled ? 'block' : 'none';
                    
                    // 交叉验证时禁用验证集比例设置
                    if (valSplitInput) {
                        valSplitInput.disabled = isEnabled;
                        if (isEnabled) {
                            valSplitInput.style.opacity = '0.6';
                        } else {
                            valSplitInput.style.opacity = '1';
                        }
                    }
                }
                
                enableCrossValidation.addEventListener('change', toggleCrossValidationParams);
                toggleCrossValidationParams(); // 初始化状态
            }
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化高级参数控件
            initAdvancedParamControls();
            
            // 只初始化与可视化模块无关的功能
            setupEventListeners();
            
            // 检查保存的语言设置
            const savedLang = localStorage.getItem('language');
            if (savedLang && savedLang !== currentLanguage) {
                const langToggle = document.getElementById('langToggle');
                if (langToggle) {
                    langToggle.checked = savedLang === 'en';
                toggleLanguage();
                }
            }
        });

        // 监听模块加载完成事件
        document.addEventListener('moduleLoaded', function(event) {
            if (event.detail.moduleId === 'visualization') {
                console.log('🎯 可视化模块加载完成，开始初始化...');
                
                // 延迟一点确保DOM完全渲染
                setTimeout(() => {
                    loadGroups();
                    setupControlListeners();
                    setupCalibrationListeners();
                    
                    // 初始化可视化模块相关的功能
                    if (typeof initVisualization === 'function') {
                        initVisualization();
                    }
                }, 100);
            } else if (event.detail.moduleId === 'dataImport') {
                console.log('🎯 数据导入模块加载完成，开始初始化...');
                
                // 延迟一点确保DOM完全渲染
                setTimeout(() => {
                    // 初始化数据导入模块相关的功能
                    if (typeof initDataImport === 'function') {
                        initDataImport();
                        console.log('✅ 数据导入模块初始化完成');
                    } else {
                        console.warn('⚠️ initDataImport函数未找到');
                    }
                }, 100);
            } else if (event.detail.moduleId === 'rqaAnalysis') {
                console.log('🎯 RQA分析模块加载完成，开始初始化...');
                
                // 延迟一点确保DOM完全渲染
                setTimeout(() => {
                    // 初始化RQA分析模块相关的功能
                    initRQASliders();
                    
                    if (typeof setupRQAEventListeners === 'function') {
                        setupRQAEventListeners();
                    }
                    
                    if (typeof initRQAAnalysis === 'function') {
                        initRQAAnalysis();
                        console.log('✅ RQA分析模块初始化完成');
                    } else {
                        console.log('✅ RQA分析模块基础初始化完成');
                    }
                }, 100);
            } else if (event.detail.moduleId === 'eventAnalysis') {
                console.log('🎯 事件分析模块加载完成，开始初始化...');
                
                // 延迟一点确保DOM完全渲染
                setTimeout(() => {
                    // 初始化事件分析模块相关的功能
                    updateEventAnalysisData();
                    
                    if (typeof initEventAnalysis === 'function') {
                        initEventAnalysis();
                        console.log('✅ 事件分析模块初始化完成');
                    } else {
                        console.log('✅ 事件分析模块基础初始化完成');
                    }
                }, 100);
            } else if (event.detail.moduleId === 'rqaPipeline') {
                console.log('🎯 RQA流程模块加载完成，开始初始化...');
                
                // 延迟一点确保DOM完全渲染
                setTimeout(() => {
                    // 初始化RQA流程模块相关的功能
                    if (typeof updateParamSignature === 'function') {
                        updateParamSignature(); // 更新参数签名显示
                    }
                    
                    if (typeof initRQAPipeline === 'function') {
                        initRQAPipeline();
                        console.log('✅ RQA流程模块初始化完成');
                    } else {
                        console.log('✅ RQA流程模块基础初始化完成');
                    }
                }, 100);
            } else if (event.detail.moduleId === 'comprehensiveFeature') {
                console.log('🎯 综合特征提取模块加载完成，开始初始化...');
                
                // 延迟一点确保DOM完全渲染
                setTimeout(() => {
                    // 初始化综合特征提取模块相关的功能
                    if (typeof loadExtractionHistory === 'function') {
                        loadExtractionHistory(); // 加载提取历史
                    }
                    
                    if (typeof initComprehensiveFeature === 'function') {
                        initComprehensiveFeature();
                        console.log('✅ 综合特征提取模块初始化完成');
                    } else {
                        console.log('✅ 综合特征提取模块基础初始化完成');
                    }
                }, 100);
            } else if (event.detail.moduleId === 'dataOrganization') {
                console.log('🎯 数据整理模块加载完成，开始初始化...');
                
                // 延迟一点确保DOM完全渲染
                setTimeout(() => {
                    // 初始化数据整理模块相关的功能
                    console.log('🎯 准备开发数据整理功能...');
                    
                    if (typeof initDataOrganization === 'function') {
                        initDataOrganization();
                        console.log('✅ 数据整理模块初始化完成');
                    } else {
                        console.log('✅ 数据整理模块基础初始化完成（待开发）');
                    }
                }, 100);
            }
        });

        // 语言切换功能
        function toggleLanguage() {
            const toggle = document.getElementById('langToggle');
            currentLanguage = toggle.checked ? 'en' : 'zh';
            
            // 保存语言设置
            localStorage.setItem('language', currentLanguage);
            
            // 更新所有文本
            updateAllTexts();
            
            // 更新HTML lang属性
            document.documentElement.lang = currentLanguage === 'zh' ? 'zh-CN' : 'en';
        }
        // 更新所有文本内容
        function updateAllTexts() {
            const texts = languageTexts[currentLanguage];
            
            // 更新所有带data-lang-key属性的元素
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (texts[key]) {
                    element.textContent = texts[key];
                }
            });
            
            // 更新模块7的下拉选项
            updateModule7SelectOptions();
            
            // 更新模块8的下拉选项
            updateModule8SelectOptions();
            
            // 更新特殊的模板文本
            updateGroupCounts(groupsData);
        }
        
        // 更新模块7的下拉选项内容
        function updateModule7SelectOptions() {
            const texts = languageTexts[currentLanguage];
            
            // 更新特征类型选项
            const featureTypeSelect = document.getElementById('featureType');
            if (featureTypeSelect) {
                const optionTexts = {
                    'game_duration': currentLanguage === 'zh' ? '🎮 游戏时长' : '🎮 Game Duration',
                    'roi_features': currentLanguage === 'zh' ? '👁️ ROI特征 (3项)' : '👁️ ROI Features (3 items)',
                    'rqa_1d_features': currentLanguage === 'zh' ? '🔄 RQA-1D特征 (3项)' : '🔄 RQA-1D Features (3 items)',
                    'rqa_2d_features': currentLanguage === 'zh' ? '🔄 RQA-2D特征 (3项)' : '🔄 RQA-2D Features (3 items)',
                    'rqa_features': currentLanguage === 'zh' ? '🔄 RQA全部特征 (6项)' : '🔄 All RQA Features (6 items)',
                    'comprehensive': currentLanguage === 'zh' ? '📈 综合对比 (10项)' : '📈 Comprehensive Comparison (10 items)',
                    'all_features': currentLanguage === 'zh' ? '📊 全部特征 (10项)' : '📊 All Features (10 items)'
                };
                
                Array.from(featureTypeSelect.options).forEach(option => {
                    if (optionTexts[option.value]) {
                        option.textContent = optionTexts[option.value];
                    }
                });
            }
            
            // 更新可视化类型选项
            const chartTypeSelect = document.getElementById('chartType');
            if (chartTypeSelect) {
                const chartOptionTexts = {
                    'bar': currentLanguage === 'zh' ? '📊 柱状图' : '📊 Bar Chart',
                    'line': currentLanguage === 'zh' ? '📈 折线图' : '📈 Line Chart',
                    'scatter': currentLanguage === 'zh' ? '🔸 散点图' : '🔸 Scatter Chart'
                };
                
                Array.from(chartTypeSelect.options).forEach(option => {
                    if (chartOptionTexts[option.value]) {
                        option.textContent = chartOptionTexts[option.value];
                    }
                });
            }
        }
        
        // 更新模块8的下拉选项内容
        function updateModule8SelectOptions() {
            // 更新AI分析模式选项
            const aiModeSelect = document.getElementById('aiAnalysisMode');
            if (aiModeSelect) {
                const aiModeTexts = {
                    'pattern_recognition': currentLanguage === 'zh' ? '🔍 模式识别' : '🔍 Pattern Recognition',
                    'anomaly_detection': currentLanguage === 'zh' ? '⚠️ 异常检测' : '⚠️ Anomaly Detection',
                    'predictive_analysis': currentLanguage === 'zh' ? '📈 预测分析' : '📈 Predictive Analysis',
                    'classification': currentLanguage === 'zh' ? '📊 智能分类' : '📊 Smart Classification',
                    'clustering': currentLanguage === 'zh' ? '🎯 聚类分析' : '🎯 Clustering Analysis'
                };
                
                Array.from(aiModeSelect.options).forEach(option => {
                    if (aiModeTexts[option.value]) {
                        option.textContent = aiModeTexts[option.value];
                    }
                });
            }
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 组统计卡片
            document.querySelectorAll('.group-stat-card').forEach(card => {
                card.addEventListener('click', function() {
                    const group = this.dataset.group;
                    selectGroup(group);
                });
            });

            // 过滤按钮
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentQuestion = this.dataset.question;
                    filterData();
                });
            });
        }

        // 设置控制器监听
        function setupControlListeners() {
            const controls = ['fixationSize', 'trajectoryWidth', 'pointSize'];
            controls.forEach(control => {
                const slider = document.getElementById(control);
                const valueSpan = document.getElementById(control + 'Value');
                
                if (slider && valueSpan) {
                slider.addEventListener('input', function() {
                    valueSpan.textContent = this.value;
                });
                } else {
                    console.warn(`⚠️ 控制元素不存在: ${control}`);
                }
            });
        }

        // 加载组数据
        async function loadGroups() {
            try {
                const response = await fetch('/api/groups');
                const groups = await response.json();
                groupsData = groups; // 保存到全局变量
                updateGroupCounts(groups);
                
                // 加载所有组数据和MMSE分数
                const dataPromises = Object.keys(groups).map(groupKey => loadGroupData(groupKey));
                const mmsePromises = Object.keys(groups).map(groupKey => loadGroupMMSEScores(groupKey));
                
                await Promise.all([...dataPromises, ...mmsePromises]);
                
                updateTotalCount();
                filterData();
            } catch (error) {
                console.error('加载组数据失败:', error);
                const failText = languageTexts[currentLanguage].loadFailed;
                const dataListElement = document.getElementById('dataList');
                if (dataListElement) {
                    dataListElement.innerHTML = `<div class="loading-text"><i class="fas fa-exclamation-triangle"></i> ${failText}</div>`;
                } else {
                    console.warn('⚠️ dataList元素不存在，无法显示错误信息');
                }
            }
        }

        // 更新组计数
        function updateGroupCounts(groups) {
            const dataText = languageTexts[currentLanguage].dataItems;
            const loadingText = languageTexts[currentLanguage].loading;
            
            // 获取DOM元素并检查是否存在
            const controlElement = document.getElementById('control-count-text');
            const mciElement = document.getElementById('mci-count-text');
            const adElement = document.getElementById('ad-count-text');
            
            if (!controlElement || !mciElement || !adElement) {
                console.warn('⚠️ 组计数元素不存在，跳过更新');
                return;
            }
            
            if (groups) {
                controlElement.textContent = `${groups.control?.data_count || 0}${dataText}`;
                mciElement.textContent = `${groups.mci?.data_count || 0}${dataText}`;
                adElement.textContent = `${groups.ad?.data_count || 0}${dataText}`;
            } else {
                controlElement.textContent = loadingText;
                mciElement.textContent = loadingText;
                adElement.textContent = loadingText;
            }
        }

        // 加载组数据
        async function loadGroupData(groupKey) {
            try {
                const response = await fetch(`/api/group/${groupKey}/data`);
                const data = await response.json();
                allData[groupKey] = data;
            } catch (error) {
                console.error(`加载${groupKey}组数据失败:`, error);
                allData[groupKey] = [];
            }
        }

        // 选择组
        function selectGroup(group) {
            document.querySelectorAll('.group-stat-card').forEach(card => {
                card.classList.remove('active');
            });
            
            if (group !== 'all') {
                document.querySelector(`[data-group="${group}"]`).classList.add('active');
            }
            
            currentGroup = group;
            filterData();
        }

        // 过滤数据
        function filterData() {
            let filteredData = [];
            
            if (currentGroup === 'all') {
                Object.values(allData).forEach(groupData => {
                    filteredData = filteredData.concat(groupData);
                });
            } else {
                filteredData = allData[currentGroup] || [];
            }
            
            if (currentQuestion !== 'all') {
                filteredData = filteredData.filter(item => item.question_num == currentQuestion);
            }
            
            displayFilteredData(filteredData);
        }

        // 显示过滤后的数据
        function displayFilteredData(dataList) {
            const container = document.getElementById('dataList');
            const noDataText = languageTexts[currentLanguage].noData;
            
            if (dataList.length === 0) {
                container.innerHTML = `<div class="loading-text"><i class="fas fa-inbox"></i> ${noDataText}</div>`;
                return;
            }

            let html = '';
            dataList.forEach(item => {
                const groupPrefix = item.data_id.startsWith('ad') ? 'AD' : 
                                   item.data_id.startsWith('m') ? 'MCI' : 'Control';
                const currentGroupType = getGroupType(item.data_id);
                
                // 获取MMSE分数信息
                const groupNum = parseInt(item.group_num);
                const mmseData = currentGroupMMSE[currentGroupType] && currentGroupMMSE[currentGroupType][groupNum];
                let mmseDisplay = '';
                
                if (mmseData) {
                    const score = mmseData.total_score;
                    const assessmentClass = getMMSEAssessmentClass(score);
                    const assessmentText = getMMSEAssessmentText(score);
                    mmseDisplay = `
                        <div class="mmse-info mt-1">
                            <small class="text-secondary">MMSE: </small>
                            <span class="text-dark">${score}/21</span>
                            <small class="text-dark ml-1">${assessmentText}</small>
                        </div>
                    `;
                } else {
                    mmseDisplay = `
                        <div class="mmse-info mt-1">
                            <small class="text-secondary">MMSE: </small>
                            <span class="badge badge-secondary">N/A</span>
                        </div>
                    `;
                }
                
                html += `
                    <div class="data-item" data-id="${item.data_id}">
                        <div class="data-item-content" onclick="visualizeData('${currentGroupType}', '${item.data_id}')">
                            <div class="data-item-info">
                                <div class="data-item-name">${groupPrefix} - ${item.display_name}</div>
                                <div class="data-item-filename">${item.filename}</div>
                                ${mmseDisplay}
                            </div>
                            <span class="question-badge">Q${item.question_num}</span>
                        </div>
                        <div class="data-item-actions">
                            <button class="btn-data-action btn-edit" onclick="editDataGroup(event, '${item.data_id}', '${currentGroupType}')" title="编辑组别">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-data-action btn-delete" onclick="deleteData(event, '${item.data_id}', '${item.display_name}')" title="删除数据">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // 获取组类型
        function getGroupType(dataId) {
            if (dataId.startsWith('ad')) return 'ad';
            if (dataId.startsWith('m')) return 'mci';
            return 'control';
        }

        // 删除数据
        function deleteData(event, dataId, displayName) {
            event.stopPropagation(); // 防止触发可视化
            
            const texts = languageTexts[currentLanguage];
            const confirmMessage = texts.deleteDataConfirm.replace('{0}', displayName);
            
            if (confirm(confirmMessage)) {
                fetch(`/api/data/${dataId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // 成功删除，刷新数据
                        loadGroups();
                        showAlert(texts.deleteDataSuccess, 'success');
                    } else {
                        showAlert(texts.deleteDataFailed + ': ' + data.error, 'danger');
                    }
                })
                .catch(error => {
                    console.error(texts.deleteDataFailed + ':', error);
                    showAlert(texts.deleteDataFailed + ': ' + error.message, 'danger');
                });
            }
        }

        // 编辑数据组别
        function editDataGroup(event, dataId, currentGroup) {
            event.stopPropagation(); // 防止触发可视化
            
            const texts = languageTexts[currentLanguage];
            const groupOptions = [
                { value: 'control', label: `${texts.groupControl} (Control)` },
                { value: 'mci', label: `${texts.groupMci} (MCI)` },
                { value: 'ad', label: `${texts.groupAd} (AD)` }
            ];
            
            let optionsHtml = '';
            groupOptions.forEach(option => {
                const selected = option.value === currentGroup ? 'selected' : '';
                optionsHtml += `<option value="${option.value}" ${selected}>${option.label}</option>`;
            });
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5>${texts.editDataGroup}</h5>
                            <button type="button" class="btn-close" onclick="closeModal(this)">×</button>
                        </div>
                        <div class="modal-body">
                            <p>${texts.dataId}: <strong>${dataId}</strong></p>
                            <p>${texts.currentGroup}: <strong>${getGroupName(currentGroup)}</strong></p>
                            <div class="form-group">
                                <label for="groupSelect">${texts.selectNewGroup}:</label>
                                <select id="groupSelect" class="form-control">
                                    ${optionsHtml}
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeModal(this)">${texts.cancel}</button>
                            <button type="button" class="btn btn-primary" onclick="confirmGroupChange('${dataId}', '${currentGroup}', this)">${texts.confirm}</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // 确认组别更改
        function confirmGroupChange(dataId, oldGroup, buttonElement) {
            const texts = languageTexts[currentLanguage];
            const newGroup = document.getElementById('groupSelect').value;
            
            if (newGroup === oldGroup) {
                closeModal(buttonElement);
                return;
            }
            
            fetch(`/api/data/${dataId}/move`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    fromGroup: oldGroup,
                    toGroup: newGroup
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    closeModal(buttonElement);
                    loadGroups();
                    showAlert(texts.changeGroupSuccess, 'success');
                } else {
                    showAlert(texts.changeGroupFailed + ': ' + data.error, 'danger');
                }
            })
            .catch(error => {
                console.error(texts.changeGroupFailed + ':', error);
                showAlert(texts.changeGroupFailed + ': ' + error.message, 'danger');
            });
        }

        // 关闭模态框
        function closeModal(element) {
            const modal = element.closest('.modal-overlay');
            modal.remove();
        }

        // 获取组名称
        function getGroupName(groupType) {
            const texts = languageTexts[currentLanguage];
            const names = {
                'control': texts.groupControl,
                'mci': texts.groupMci,
                'ad': texts.groupAd
            };
            return names[groupType] || groupType;
        }

        // 显示提示信息
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" onclick="this.parentElement.remove()">×</button>
            `;
            
            // 在页面顶部显示提示
            const container = document.querySelector('.container-fluid') || document.body;
            container.insertBefore(alertDiv, container.firstChild);
            
            // 3秒后自动隐藏
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 3000);
        }

        // 更新总计数
        function updateTotalCount() {
            const total = Object.values(allData).reduce((sum, groupData) => sum + groupData.length, 0);
            document.getElementById('header-total-count').textContent = total;
        }

        // 可视化数据
        async function visualizeData(groupType, dataId) {
            currentVisualization = { groupType, dataId };
            
            // 更新数据项选中状态
            updateDataItemSelection(dataId);
            
            // 显示Edit按钮
            console.log('显示Edit按钮，当前数据:', dataId);
            const editBtn = document.getElementById('editCalibrationBtn');
            if (editBtn) {
                editBtn.style.display = 'inline-block';
                console.log('Edit按钮已显示');
            } else {
                console.error('未找到Edit按钮元素');
            }
            
            const panel = document.getElementById('visualizationPanel');
            const placeholder = document.getElementById('placeholderMessage');
            const spinner = document.getElementById('loadingSpinner');
            const imageContainer = document.getElementById('imageContainer');
            const statsPanel = document.getElementById('statsPanel');

            // 显示面板并隐藏占位符
            placeholder.style.display = 'none';
            panel.style.display = 'block';
            spinner.style.display = 'block';
            imageContainer.innerHTML = '';
            statsPanel.innerHTML = '';

            try {
                const params = getVisualizationParams();
                const queryString = new URLSearchParams(params).toString();
                const response = await fetch(`/api/visualize/${groupType}/${dataId}?${queryString}`);
                const result = await response.json();

                spinner.style.display = 'none';

                if (result.error) {
                    imageContainer.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i> ${result.error}
                        </div>
                    `;
                    return;
                }

                // 显示图像
                if (result.image) {
                    imageContainer.innerHTML = `
                        <h5><i class="fas fa-image"></i> ${dataId} - ${result.question}</h5>
                        <img src="data:image/png;base64,${result.image}" alt="眼动轨迹可视化" />
                    `;
                }

                // 显示统计信息
                displayStatistics(result);

            } catch (error) {
                console.error('可视化失败:', error);
                spinner.style.display = 'none';
                imageContainer.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i> 可视化生成失败: ${error.message}
                    </div>
                `;
            }
        }

        // 获取可视化参数
        function getVisualizationParams() {
            return {
                fixationSize: document.getElementById('fixationSize').value,
                trajectoryWidth: document.getElementById('trajectoryWidth').value,
                trajectoryStyle: document.getElementById('trajectoryStyle').value,
                pointSize: document.getElementById('pointSize').value
            };
        }

        // 更新可视化
        function updateVisualization() {
            if (currentVisualization) {
                visualizeData(currentVisualization.groupType, currentVisualization.dataId);
            }
        }

        // 显示统计信息
        function displayStatistics(result) {
            const statsPanel = document.getElementById('statsPanel');
            const overall = result.overall_statistics;
            const roiStats = result.roi_statistics;
            const texts = languageTexts[currentLanguage];

            let html = `
                <h5><i class="fas fa-chart-bar"></i> ${texts.statInfo}</h5>
                <div class="row">
                    <div class="col-md-6">
                        <h6>${texts.overallStats}</h6>
                        <ul class="list-unstyled">
                            <li><strong>${texts.totalPoints}:</strong> ${overall.total_points}</li>
                            <li><strong>${texts.totalDuration}:</strong> ${overall.total_duration.toFixed(1)}${texts.unitMs}</li>
                            <li><strong>${texts.fixationEvents}:</strong> ${overall.fixation_count}${texts.unitCount}</li>
                            <li><strong>${texts.saccadeEvents}:</strong> ${overall.saccade_count}${texts.unitCount}</li>
                            <li><strong>${texts.avgVelocity}:</strong> ${overall.avg_velocity.toFixed(1)}${texts.unitDegreesPerSecond}</li>
                            <li><strong>${texts.maxVelocity}:</strong> ${overall.max_velocity.toFixed(1)}${texts.unitDegreesPerSecond}</li>
                            <li><strong>${texts.roiSequence}:</strong> ${overall.roi_sequence_count}${texts.unitCount}</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>${texts.mainRoiStats}</h6>
                        <ul class="list-unstyled">
            `;

            // 显示主要ROI统计
            const sortedROI = Object.entries(roiStats)
                .filter(([name, stats]) => stats.FixTime > 0.1)
                .sort(([,a], [,b]) => b.FixTime - a.FixTime)
                .slice(0, 5);

            sortedROI.forEach(([name, stats]) => {
                html += `<li><strong>${name}:</strong> ${stats.FixTime.toFixed(1)}${texts.unitSecond}</li>`;
            });

            html += `
                        </ul>
                    </div>
                </div>
            `;

            // 添加MMSE信息显示
            if (currentVisualization) {
                const { groupType, dataId } = currentVisualization;
                
                // 从dataId中解析group_num
                const match = dataId.match(/(\d+)/);
                if (match) {
                    const groupNum = parseInt(match[1]);
                    const mmseData = currentGroupMMSE[groupType] && currentGroupMMSE[groupType][groupNum];
                    
                    if (mmseData) {
                        html += displayMMSEDetails(mmseData);
                    } else {
                        html += `
                            <div class="mmse-panel mt-3">
                                <h6 class="text-muted mb-3">
                                    <i class="fas fa-brain"></i> ${texts.cognitiveAssessment}
                                </h6>
                                <div class="alert alert-info">
                                    <small>${texts.noMMSEData}</small>
                                </div>
                            </div>
                        `;
                    }
                }
            }

            statsPanel.innerHTML = html;
        }

        // 重启服务器
        async function restartServer() {
            const texts = languageTexts[currentLanguage];
            if (confirm(texts.restartConfirm)) {
                try {
                    const response = await fetch('/api/restart', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        alert(texts.restarting);
                        // 等待一段时间后刷新页面
                        setTimeout(() => {
                            window.location.reload();
                        }, 3000);
                    }
                } catch (error) {
                    console.error('重启失败:', error);
                    alert('重启请求失败，请手动重启服务器');
                }
            }
        }

        // 刷新数据
        function refreshData() {
            location.reload();
        }

        // 侧边栏功能
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const icon = document.getElementById('sidebarToggleIcon');
            
            sidebarExpanded = !sidebarExpanded;
            
            if (sidebarExpanded) {
                sidebar.classList.add('expanded');
                icon.className = 'fas fa-times';
            } else {
                sidebar.classList.remove('expanded');
                icon.className = 'fas fa-bars';
            }
        }

        // 切换到数据可视化视图
        function switchToVisualization() {
            if (currentView === 'visualization') return;
            
            // 更新视图
            document.getElementById('visualizationView').style.display = 'block';
            document.getElementById('newFeatureView').style.display = 'none';
            document.getElementById('rqaAnalysisView').style.display = 'none';
            document.getElementById('eventAnalysisView').style.display = 'none';
            document.getElementById('rqaPipelineView').style.display = 'none';
            const featureElement = document.getElementById('comprehensiveFeatureModule') || document.getElementById('featureExtractionView');
            if (featureElement) featureElement.style.display = 'none';
            const seventhElement = document.getElementById('seventhModuleView');
            if (seventhElement) seventhElement.style.display = 'none';
            
            // 更新导航状态
            document.querySelectorAll('.sidebar-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('[data-view="visualization"]').classList.add('active');
            
            currentView = 'visualization';
        }
                 // 切换到新功能视图
                  function switchToNewFeature() {
             if (currentView === 'newFeature') return;
             
             console.log('切换到数据导入视图');
             
             // 隐藏所有其他视图
            ['visualizationView', 'rqaAnalysisView', 'eventAnalysisView', 'rqaPipelineView', 'comprehensiveFeatureModule', 'seventhModuleView', 'eighthModuleView'].forEach(viewId => {
                 const element = document.getElementById(viewId);
                 if (element) {
                     element.style.display = 'none';
                     console.log(`隐藏视图: ${viewId}`);
                 }
             });
             
             // 显示数据导入视图
             const newFeatureView = document.getElementById('newFeatureView');
             if (newFeatureView) {
                 newFeatureView.style.display = 'block';
                 console.log('显示数据导入视图');
                 console.log('数据导入视图位置信息:', {
                     offsetTop: newFeatureView.offsetTop,
                     offsetLeft: newFeatureView.offsetLeft,
                     offsetHeight: newFeatureView.offsetHeight,
                     offsetWidth: newFeatureView.offsetWidth,
                     innerHTML_length: newFeatureView.innerHTML.length,
                     innerHTML_preview: newFeatureView.innerHTML.substring(0, 200) + '...'
                 });
             } else {
                 console.error('找不到数据导入视图元素');
             }
             
             // 更新导航状态
             document.querySelectorAll('.sidebar-nav-item').forEach(item => {
                 item.classList.remove('active');
             });
             document.querySelector('[data-view="newFeature"]').classList.add('active');
             
             currentView = 'newFeature';
             
            // 注意：数据导入功能现在通过动态模块加载事件初始化
         }
         
         // 切换到RQA分析视图
         function switchToRQAAnalysis() {
             if (currentView === 'rqaAnalysis') return;
             
                         // 更新视图
            document.getElementById('visualizationView').style.display = 'none';
            document.getElementById('newFeatureView').style.display = 'none';
            document.getElementById('eventAnalysisView').style.display = 'none';
            document.getElementById('rqaPipelineView').style.display = 'none';
            const featureElement = document.getElementById('comprehensiveFeatureModule') || document.getElementById('featureExtractionView');
            if (featureElement) featureElement.style.display = 'none';
           const seventhElement = document.getElementById('seventhModuleView');
           if (seventhElement) seventhElement.style.display = 'none';
            document.getElementById('rqaAnalysisView').style.display = 'block';
             
             // 更新导航状态
             document.querySelectorAll('.sidebar-nav-item').forEach(item => {
                 item.classList.remove('active');
             });
             document.querySelector('[data-view="rqaAnalysis"]').classList.add('active');
             
             currentView = 'rqaAnalysis';
             
             // 初始化RQA分析界面
             initializeRQAInterface();
         }
         
         // 切换到事件分析视图
         function switchToEventAnalysis() {
             if (currentView === 'eventAnalysis') return;
             
             console.log('切换到事件分析视图');
             
             // 隐藏所有其他视图
            ['visualizationView', 'newFeatureView', 'rqaAnalysisView', 'rqaPipelineView', 'comprehensiveFeatureModule', 'seventhModuleView', 'eighthModuleView'].forEach(viewId => {
                 const element = document.getElementById(viewId);
                 if (element) {
                     element.style.display = 'none';
                     console.log(`隐藏视图: ${viewId}`);
                 }
             });
             
             // 显示事件分析视图
             const eventView = document.getElementById('eventAnalysisView');
             if (eventView) {
                 eventView.style.display = 'block';
                 console.log('显示事件分析视图');
                 console.log('事件分析视图位置信息:', {
                     offsetTop: eventView.offsetTop,
                     offsetLeft: eventView.offsetLeft,
                     offsetHeight: eventView.offsetHeight,
                     offsetWidth: eventView.offsetWidth,
                     parentElement: eventView.parentElement ? eventView.parentElement.className : 'null',
                     parentOffsetTop: eventView.parentElement ? eventView.parentElement.offsetTop : 'null'
                 });
                 
                 // 检查父容器链
                 let currentElement = eventView;
                 let parentChain = [];
                 while (currentElement.parentElement && parentChain.length < 5) {
                     currentElement = currentElement.parentElement;
                     parentChain.push({
                         tagName: currentElement.tagName,
                         className: currentElement.className,
                         id: currentElement.id,
                         offsetTop: currentElement.offsetTop
                     });
                 }
                 console.log('事件分析视图父容器链:', parentChain);
             } else {
                 console.error('找不到事件分析视图元素');
             }
             
             // 更新导航状态
             document.querySelectorAll('.sidebar-nav-item').forEach(item => {
                 item.classList.remove('active');
             });
             document.querySelector('[data-view="eventAnalysis"]').classList.add('active');
             
             currentView = 'eventAnalysis';
             
                         // 调试页面布局
            debugPageLayout();
            
            // 初始化事件分析界面
            initEventAnalysis();
            
            // 初始化RQA滑动条
            initRQASliders();
         }

         // 切换到RQA分析流程视图
         function switchToRQAPipeline() {
             if (currentView === 'rqaPipeline') return;
             
             console.log('切换到RQA分析流程视图');
             
             // 隐藏所有其他视图
            ['visualizationView', 'newFeatureView', 'rqaAnalysisView', 'eventAnalysisView', 'comprehensiveFeatureModule', 'seventhModuleView', 'eighthModuleView'].forEach(viewId => {
                 const element = document.getElementById(viewId);
                 if (element) {
                     element.style.display = 'none';
                     console.log(`隐藏视图: ${viewId}`);
                 }
             });
             
             // 显示RQA分析流程视图
             const pipelineView = document.getElementById('rqaPipelineView');
             if (pipelineView) {
                 pipelineView.style.display = 'block';
                 console.log('显示RQA分析流程视图');
             } else {
                 console.error('找不到RQA分析流程视图元素');
             }
             
             // 更新导航状态
             document.querySelectorAll('.sidebar-nav-item').forEach(item => {
                 item.classList.remove('active');
             });
             document.querySelector('[data-view="rqaPipeline"]').classList.add('active');
             
             currentView = 'rqaPipeline';
             
             // 初始化RQA分析流程界面
             initRQAPipeline();
         }

         // 初始化RQA分析流程界面
         function initRQAPipeline() {
             console.log('初始化RQA分析流程界面');
             resetPipelineStatus();

             // 初始化批处理参数输入监听
             const batchInputs = document.querySelectorAll('.batch-param-input');
             if (batchInputs.length > 0) {
                 batchInputs.forEach(input => {
                     input.addEventListener('input', function() {
                         updateBatchCombinationCount();
                     });
                 });

                 // 初始化计算一次
                 updateBatchCombinationCount();
                 console.log('✅ 批处理参数监听已初始化');
             }
         }

         // 切换到综合特征提取视图
         function switchToFeatureExtraction() {
             if (currentView === 'featureExtraction') return;
             
             console.log('🎯 开始切换到综合特征提取视图');
             
             // 隐藏所有其他视图
            ['visualizationView', 'newFeatureView', 'rqaAnalysisView', 'eventAnalysisView', 'rqaPipelineView', 'seventhModuleView', 'eighthModuleView'].forEach(viewId => {
                 const element = document.getElementById(viewId);
                 if (element) {
                     element.style.display = 'none';
                     console.log(`✅ 隐藏视图: ${viewId}`);
                 } else {
                     console.warn(`⚠️ 未找到视图元素: ${viewId}`);
                 }
             });
             
                         // 显示特征提取视图
            const featureView = document.getElementById('comprehensiveFeatureModule');
             if (featureView) {
                 console.log('🔍 找到comprehensiveFeatureModule元素');
                 console.log('📏 元素当前样式:', {
                     display: featureView.style.display,
                     visibility: window.getComputedStyle(featureView).visibility,
                     opacity: window.getComputedStyle(featureView).opacity,
                     height: window.getComputedStyle(featureView).height,
                     width: window.getComputedStyle(featureView).width,
                     position: window.getComputedStyle(featureView).position,
                     zIndex: window.getComputedStyle(featureView).zIndex
                 });
                 
                 featureView.style.display = 'block';
                 featureView.style.visibility = 'visible';
                 featureView.style.opacity = '1';
                 featureView.style.position = 'relative';
                 featureView.style.zIndex = '1';
                 featureView.style.minHeight = '100vh';
                 featureView.style.height = 'auto';
                 featureView.style.overflow = 'visible';
                 
                 // 强制设置container-fluid的高度
                 const containerFluid = featureView.querySelector('.container-fluid');
                 if (containerFluid) {
                     containerFluid.style.minHeight = '100vh';
                     containerFluid.style.height = 'auto';
                     containerFluid.style.display = 'block';
                     console.log('✅ 设置container-fluid样式');
                 }
                 
                 console.log('✅ 设置 comprehensiveFeatureModule display = block 和强制高度样式');
                 
                 // 检查设置后的样式
                 setTimeout(() => {
                     console.log('📏 设置后的样式:', {
                         display: featureView.style.display,
                         visibility: window.getComputedStyle(featureView).visibility,
                         opacity: window.getComputedStyle(featureView).opacity,
                         height: window.getComputedStyle(featureView).height,
                         width: window.getComputedStyle(featureView).width,
                         offsetHeight: featureView.offsetHeight,
                         offsetWidth: featureView.offsetWidth,
                         scrollHeight: featureView.scrollHeight,
                         scrollWidth: featureView.scrollWidth
                     });
                     
                     // 检查子元素
                     const children = featureView.children;
                     console.log(`🧸 子元素数量: ${children.length}`);
                     for (let i = 0; i < Math.min(children.length, 3); i++) {
                         const child = children[i];
                         console.log(`📦 子元素 ${i}:`, {
                             tagName: child.tagName,
                             className: child.className,
                             display: window.getComputedStyle(child).display,
                             height: window.getComputedStyle(child).height,
                             offsetHeight: child.offsetHeight
                         });
                     }
                 }, 100);
                 
             } else {
                 console.error('❌ 找不到综合特征提取视图元素 (comprehensiveFeatureModule)');
                 
                 // 尝试查找所有可能的元素
                 console.log('🔍 查找所有包含 feature 的元素:');
                 const allElements = document.querySelectorAll('[id*="feature"], [class*="feature"]');
                 allElements.forEach((el, index) => {
                     console.log(`  ${index}: id="${el.id}", class="${el.className}"`);
                 });
             }
             
             // 更新导航状态
             document.querySelectorAll('.sidebar-nav-item').forEach(item => {
                 item.classList.remove('active');
             });
             const navItem = document.querySelector('[data-view="featureExtraction"]');
             if (navItem) {
                 navItem.classList.add('active');
                 console.log('✅ 更新导航状态成功');
             } else {
                 console.error('❌ 找不到导航项 [data-view="featureExtraction"]');
             }
             
             currentView = 'featureExtraction';
             console.log('✅ 设置 currentView = featureExtraction');
             
             // 初始化特征提取界面
             console.log('🚀 开始初始化特征提取界面');
             initFeatureExtraction();
         }

        // 切换到第七模块视图
        function switchToSeventhModule() {
            if (currentView === 'seventhModule') return;
            
            console.log('🎯 开始切换到第七模块视图');
            
            // 隐藏所有其他视图
            ['visualizationView', 'newFeatureView', 'rqaAnalysisView', 'eventAnalysisView', 'rqaPipelineView', 'comprehensiveFeatureModule', 'eighthModuleView', 'ninthModuleView', 'tenthModuleView'].forEach(viewId => {
                const element = document.getElementById(viewId);
                if (element) {
                    element.style.display = 'none';
                    console.log(`✅ 隐藏视图: ${viewId}`);
                } else {
                    console.warn(`⚠️ 未找到视图元素: ${viewId}`);
                }
            });
            
            // 显示第七模块视图
            const seventhView = document.getElementById('seventhModuleView');
            if (seventhView) {
                seventhView.style.display = 'block';
                console.log('✅ 显示第七模块视图');
            } else {
                console.error('❌ 找不到第七模块视图元素');
            }
            
            // 更新导航状态
            document.querySelectorAll('.sidebar-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            const navItem = document.querySelector('[data-view="seventhModule"]');
            if (navItem) {
                navItem.classList.add('active');
                console.log('✅ 更新导航状态成功');
            } else {
                console.error('❌ 找不到导航项 [data-view="seventhModule"]');
            }
            
            currentView = 'seventhModule';
            console.log('✅ 设置 currentView = seventhModule');
            
            // 初始化第七模块界面
            console.log('🚀 开始初始化第七模块界面');
            initSeventhModule();
        }

        // 初始化第七模块界面
        function initSeventhModule() {
            console.log('🚀 初始化第七模块界面');
            // 调用数据整理模块的初始化函数
            if (typeof initDataOrganization === 'function') {
                initDataOrganization();
            } else {
                console.warn('⚠️ initDataOrganization 函数未找到，请检查模块7的JavaScript代码是否正确加载');
            }
         }

        // 切换到第八模块视图
        function switchToEighthModule() {
            if (currentView === 'eighthModule') return;
            
            console.log('🎯 开始切换到第八模块视图');
            
            // 隐藏所有其他视图
            ['visualizationView', 'newFeatureView', 'rqaAnalysisView', 'eventAnalysisView', 'rqaPipelineView', 'comprehensiveFeatureModule', 'seventhModuleView', 'ninthModuleView', 'tenthModuleView'].forEach(viewId => {
                const element = document.getElementById(viewId);
                if (element) {
                    element.style.display = 'none';
                    console.log(`✅ 隐藏视图: ${viewId}`);
                } else {
                    console.warn(`⚠️ 未找到视图元素: ${viewId}`);
                }
            });
            
            // 显示第八模块视图
            const eighthView = document.getElementById('eighthModuleView');
            if (eighthView) {
                eighthView.style.display = 'block';
                console.log('✅ 显示第八模块视图');
            } else {
                console.error('❌ 找不到第八模块视图元素');
            }
            
            // 更新导航状态
            document.querySelectorAll('.sidebar-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            const navItem = document.querySelector('[data-view="eighthModule"]');
            if (navItem) {
                navItem.classList.add('active');
                console.log('✅ 更新导航状态成功');
            } else {
                console.error('❌ 找不到导航项 [data-view="eighthModule"]');
            }
            
            currentView = 'eighthModule';
            console.log('✅ 设置 currentView = eighthModule');
            
            // 初始化第八模块界面
            console.log('🚀 开始初始化第八模块界面');
            initEighthModule();
        }

        // 初始化第八模块界面
        function initEighthModule() {
            console.log('🚀 初始化第八模块界面 - 眼动系数与MMSE对比分析');
            
            // 调用眼动系数与MMSE对比分析的初始化函数
            if (typeof initIntelligentAnalysis === 'function') {
                initIntelligentAnalysis();
            } else {
                console.log('📝 眼动系数与MMSE对比分析模块的JavaScript代码将在后续开发');
                // 临时的初始化代码 - 更新状态文本
                const statusText = document.getElementById('aiStatusText');
                if (statusText) {
                    const isZh = currentLanguage === 'zh';
                    statusText.textContent = isZh ? '眼动系数分析引擎已就绪，等待加载数据...' : 'Eye movement coefficient analysis engine ready, waiting for data...';
                }
                
                // 设置置信度滑块事件
                const confidenceSlider = document.getElementById('confidenceThreshold');
                const confidenceValue = document.getElementById('confidenceValue');
                if (confidenceSlider && confidenceValue) {
                    confidenceSlider.addEventListener('input', function() {
                        confidenceValue.textContent = this.value;
                    });
                }
                
                console.log('✅ 第八模块基础初始化完成');
            }
         }

                 // 恢复原始特征提取界面
        function restoreOriginalFeatureView() {
            console.log('🔄 恢复原始特征提取界面');
            
            const featureView = document.getElementById('comprehensiveFeatureModule') || document.getElementById('featureExtractionView');
             if (featureView && window.originalFeatureContent) {
                 featureView.innerHTML = window.originalFeatureContent;
                 console.log('✅ 原始界面已恢复');
                 
                 // 重新应用强制样式
                 setTimeout(() => {
                     featureView.style.minHeight = '100vh';
                     featureView.style.height = 'auto';
                     featureView.style.overflow = 'visible';
                     
                     const containerFluid = featureView.querySelector('.container-fluid');
                     if (containerFluid) {
                         containerFluid.style.minHeight = '100vh';
                         containerFluid.style.height = 'auto';
                         containerFluid.style.display = 'block';
                     }
                     
                     // 强制激活原始面板
                     const allPanels = featureView.querySelectorAll('.feature-control-panel, .feature-results-panel');
                     allPanels.forEach((panel, index) => {
                         panel.style.display = 'block';
                         panel.style.visibility = 'visible';
                         panel.style.opacity = '1';
                         panel.style.minHeight = '300px';
                         panel.style.backgroundColor = '#ffffff';
                         panel.style.border = '2px solid #007bff';
                         console.log('✅ 重新激活原始面板 ' + (index + 1));
                     });
                     
                     console.log('✅ 原始界面样式已重新应用');
                 }, 100);
             } else {
                 console.error('❌ 无法恢复：原始内容未保存或元素不存在');
             }
         }

         // 初始化特征提取界面
         function initFeatureExtraction() {
             console.log('🚀 初始化综合特征提取界面');
             
                         // 验证关键元素是否存在
            const keyElements = [
                'comprehensiveFeatureModule',
                'eventsDataStatus', 
                'roiDataStatus',
                'rqaDataStatus',
                'mmseDataStatus',
                'extractButton',
                'extractionProgress'
            ];
             
             console.log('🔍 检查关键元素:');
             keyElements.forEach(elementId => {
                 const element = document.getElementById(elementId);
                 if (element) {
                     console.log(`✅ ${elementId}: 找到`);
                 } else {
                     console.error(`❌ ${elementId}: 未找到`);
                 }
             });
             
                         // 检查CSS样式是否加载
            const featureView = document.getElementById('comprehensiveFeatureModule') || document.getElementById('featureExtractionView');
             if (featureView) {
                 const styles = window.getComputedStyle(featureView);
                 console.log('🎨 CSS样式检查:', {
                     display: styles.display,
                     visibility: styles.visibility,
                     opacity: styles.opacity,
                     height: styles.height,
                     minHeight: styles.minHeight,
                     backgroundColor: styles.backgroundColor,
                     position: styles.position
                 });
             }
             
             try {
                 console.log('📊 开始检查数据源...');
                 checkDataSources();
             } catch (error) {
                 console.error('❌ 数据源检查失败:', error);
             }
             
             try {
                 console.log('📚 开始加载提取历史...');
                 loadExtractionHistory();
             } catch (error) {
                 console.error('❌ 加载历史失败:', error);
             }
             
             console.log('✅ 初始化完成');
             
                         // 深度诊断 - 详细检查每个层级
            setTimeout(() => {
                const featureView = document.getElementById('comprehensiveFeatureModule') || document.getElementById('featureExtractionView');
                 if (featureView) {
                     console.log('🔎 开始深度诊断...');
                     
                     // 1. 主容器详细信息
                     const computed = window.getComputedStyle(featureView);
                     console.log('📋 主容器详细信息:');
                     console.log(`  - offsetHeight: ${featureView.offsetHeight}px`);
                     console.log(`  - offsetWidth: ${featureView.offsetWidth}px`);
                     console.log(`  - scrollHeight: ${featureView.scrollHeight}px`);
                     console.log(`  - scrollWidth: ${featureView.scrollWidth}px`);
                     console.log(`  - clientHeight: ${featureView.clientHeight}px`);
                     console.log(`  - clientWidth: ${featureView.clientWidth}px`);
                     console.log(`  - display: ${computed.display}`);
                     console.log(`  - position: ${computed.position}`);
                     console.log(`  - visibility: ${computed.visibility}`);
                     console.log(`  - opacity: ${computed.opacity}`);
                     console.log(`  - overflow: ${computed.overflow}`);
                     console.log(`  - zIndex: ${computed.zIndex}`);
                     console.log(`  - transform: ${computed.transform}`);
                     
                     // 2. 递归检查所有子元素
                     function analyzeElement(element, depth = 0) {
                         const indent = '  '.repeat(depth);
                         const tagName = element.tagName || 'TEXT';
                         const className = element.className || '';
                         const id = element.id || '';
                         const computedStyle = element.nodeType === 1 ? window.getComputedStyle(element) : null;
                         
                         if (element.nodeType === 1) { // Element node
                             console.log(`${indent}🏷️  ${tagName}${id ? `#${id}` : ''}${className ? `.${className.split(' ').join('.')}` : ''}`);
                             console.log(`${indent}    📐 尺寸: ${element.offsetWidth}×${element.offsetHeight} (offset), ${element.clientWidth}×${element.clientHeight} (client)`);
                             console.log(`${indent}    🎨 样式: display=${computedStyle.display}, position=${computedStyle.position}, float=${computedStyle.float}`);
                             console.log(`${indent}    📦 边距: margin=${computedStyle.margin}, padding=${computedStyle.padding}`);
                             console.log(`${indent}    🔒 限制: minHeight=${computedStyle.minHeight}, maxHeight=${computedStyle.maxHeight}, height=${computedStyle.height}`);
                             
                             // 特别关注Bootstrap相关类
                             if (className.includes('container') || className.includes('row') || className.includes('col') || className.includes('card')) {
                                 console.log(`${indent}    ⚠️  Bootstrap组件检测!`);
                             }
                             
                             // 检查是否有内容
                             const textContent = element.textContent ? element.textContent.trim().substring(0, 50) : '';
                             if (textContent) {
                                 console.log(`${indent}    📝 内容: "${textContent}${textContent.length > 50 ? '...' : ''}"`);
                             }
                         }
                         
                         // 递归检查子元素（只检查前3层避免输出过多）
                         if (depth < 3 && element.children) {
                             for (let child of element.children) {
                                 analyzeElement(child, depth + 1);
                             }
                         }
                     }
                     
                     console.log('🌳 DOM结构分析:');
                     analyzeElement(featureView);
                     
                     // 3. 检查CSS冲突
                     console.log('⚔️  CSS冲突检查:');
                     const allSheets = Array.from(document.styleSheets);
                     let relevantRules = [];
                     
                     try {
                         allSheets.forEach(sheet => {
                             try {
                                 Array.from(sheet.cssRules || []).forEach(rule => {
                                     if (rule.selectorText && (
                                         rule.selectorText.includes('feature-extraction') ||
                                         rule.selectorText.includes('container-fluid') ||
                                         rule.selectorText.includes('card')
                                     )) {
                                         relevantRules.push({
                                             selector: rule.selectorText,
                                             declarations: rule.style.cssText
                                         });
                                     }
                                 });
                             } catch (e) {
                                 console.log(`    ⚠️  无法访问样式表: ${sheet.href || '内联样式'}`);
                             }
                         });
                         
                         if (relevantRules.length > 0) {
                             console.log('    找到相关CSS规则:');
                             relevantRules.forEach(rule => {
                                 console.log(`      ${rule.selector}: ${rule.declarations}`);
                             });
                         } else {
                             console.log('    未找到相关CSS规则');
                         }
                     } catch (e) {
                         console.log(`    CSS检查出错: ${e.message}`);
                     }
                     
                     // 4. 检查视口和位置
                     const rect = featureView.getBoundingClientRect();
                     console.log('📍 位置信息:');
                     console.log(`  - getBoundingClientRect: ${rect.width}×${rect.height} at (${rect.left}, ${rect.top})`);
                     console.log(`  - 是否在视口内: ${rect.top < window.innerHeight && rect.bottom > 0 && rect.left < window.innerWidth && rect.right > 0}`);
                     
                     // 5. 检查父元素链
                     console.log('🔗 父元素链:');
                     let parent = featureView.parentElement;
                     let level = 0;
                     while (parent && level < 5) {
                         const parentComputed = window.getComputedStyle(parent);
                         console.log(`  ${level}: ${parent.tagName}${parent.id ? `#${parent.id}` : ''}${parent.className ? `.${parent.className.split(' ').join('.')}` : ''}`);
                         console.log(`      display=${parentComputed.display}, position=${parentComputed.position}, overflow=${parentComputed.overflow}`);
                         console.log(`      尺寸=${parent.offsetWidth}×${parent.offsetHeight}`);
                         parent = parent.parentElement;
                         level++;
                     }
                     
                     console.log('🔎 深度诊断完成');
                 }
             }, 200);
         }

         // 检查数据源状态
         async function checkDataSources() {
             console.log('📊 开始检查数据源状态');
             
             const sources = [
                 {id: 'eventsDataStatus', name: '眼动事件数据'},
                 {id: 'roiDataStatus', name: 'ROI汇总数据'}, 
                 {id: 'rqaDataStatus', name: 'RQA分析数据'},
                 {id: 'mmseDataStatus', name: 'MMSE评分数据'}
             ];
             
             let foundElements = 0;
             
             for (const source of sources) {
                 const element = document.getElementById(source.id);
                 if (element) {
                     foundElements++;
                     console.log(`✅ 找到元素: ${source.id}`);
                     
                     // 设置初始状态
                     element.innerHTML = `<i class="fas fa-circle-notch fa-spin"></i><span>${source.name}</span>`;
                     element.classList.remove('success', 'error');
                     
                     // 模拟检查过程
                     setTimeout(() => {
                         try {
                             element.innerHTML = `<i class="fas fa-check-circle"></i><span>${source.name}</span>`;
                             element.classList.add('success');
                             console.log(`✅ ${source.name} 状态更新成功`);
                         } catch (error) {
                             console.error(`❌ 更新 ${source.name} 状态失败:`, error);
                         }
                     }, Math.random() * 1000 + 500);
                 } else {
                     console.error(`❌ 未找到元素: ${source.id}`);
                 }
             }
             
             console.log(`📊 数据源检查完成，找到 ${foundElements}/${sources.length} 个元素`);
             
             if (foundElements === 0) {
                 console.error('❌ 未找到任何数据源状态元素，可能HTML结构有问题');
             }
         }

         // 开始特征提取
         async function startFeatureExtraction() {
             const button = document.getElementById('extractButton');
             const progress = document.getElementById('extractionProgress');
             const progressBar = document.getElementById('extractionProgressBar');
             const progressText = document.getElementById('extractionProgressText');
             const statusCard = document.getElementById('extractionStatusCard');
             
                         try {
                // 禁用按钮和显示进度
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 提取中...';
                progress.style.display = 'block';
                
                // 显示状态卡片
                if (statusCard) {
                    statusCard.style.display = 'block';
                }
                
                // 隐藏之前的结果
                const resultsSummary = document.getElementById('resultsSummary');
                const resultsFiles = document.getElementById('resultsFiles');
                const dataPreview = document.getElementById('dataPreview');
                
                if (resultsSummary) resultsSummary.style.display = 'none';
                if (resultsFiles) resultsFiles.style.display = 'none';
                if (dataPreview) dataPreview.style.display = 'none';
                
                // 更新状态
                const statusTitle = document.getElementById('statusTitle');
                const statusMessage = document.getElementById('statusMessage');
                const statusIcon = document.querySelector('.status-icon');
                
                if (statusTitle) statusTitle.textContent = '正在提取特征';
                if (statusMessage) statusMessage.textContent = '正在分析眼动数据和提取多维度特征...';
                if (statusIcon) statusIcon.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                 
                 // 模拟进度更新
                 for (let i = 0; i <= 100; i += 10) {
                     progressBar.style.width = i + '%';
                     progressText.textContent = `处理中... ${i}%`;
                     await new Promise(resolve => setTimeout(resolve, 200));
                 }
                 
                 // 调用后端API
                 const response = await fetch('/api/feature-extraction/extract', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json'
                     }
                 });
                 
                 const result = await response.json();
                 
                 if (result.success) {
                     // 提取成功
                     showExtractionResults(result);
                 } else {
                     throw new Error(result.message || '特征提取失败');
                 }
                 
                         } catch (error) {
                console.error('特征提取错误:', error);
                alert('特征提取失败: ' + error.message);
                
                // 更新状态显示错误
                const statusTitle = document.getElementById('statusTitle');
                const statusMessage = document.getElementById('statusMessage');
                const statusIcon = document.querySelector('.status-icon');
                
                if (statusTitle) statusTitle.textContent = '提取失败';
                if (statusMessage) statusMessage.textContent = error.message;
                if (statusIcon) statusIcon.innerHTML = '<i class="fas fa-exclamation-triangle text-danger"></i>';
                 
             } finally {
                 // 恢复按钮状态
                 button.disabled = false;
                 button.innerHTML = '<i class="fas fa-play"></i> 开始特征提取';
                 progress.style.display = 'none';
             }
         }

         // 显示提取结果
         function showExtractionResults(result) {
             // 隐藏状态卡片
             document.getElementById('extractionStatusCard').style.display = 'none';
             
             // 显示结果摘要
             const summary = document.getElementById('resultsSummary');
             summary.style.display = 'block';
             
             // 更新统计数据
             document.getElementById('totalSubjects').textContent = result.statistics.total_subjects;
             document.getElementById('totalTasks').textContent = result.statistics.total_tasks;
             document.getElementById('featureCount').textContent = result.statistics.feature_count;
             document.getElementById('extractionTime').textContent = result.timestamp;
             
             // 显示结果文件
             const filesDiv = document.getElementById('resultsFiles');
             filesDiv.style.display = 'block';
             
             // 保存时间戳用于下载和预览
             window.currentExtractionTimestamp = result.timestamp;
             
             // 重新加载历史记录
             loadExtractionHistory();
         }

         // 加载提取历史
         async function loadExtractionHistory() {
             console.log('📚 开始加载提取历史记录');
             
             try {
                 const historyList = document.getElementById('extractionHistoryList');
                 if (!historyList) {
                     console.error('❌ 未找到历史记录列表元素 (extractionHistoryList)');
                     return;
                 }
                 
                 console.log('✅ 找到历史记录列表元素');
                 historyList.innerHTML = '<p class="text-muted"><i class="fas fa-spinner fa-spin"></i> 加载中...</p>';
                 
                 console.log('🌐 发送API请求: /api/feature-extraction/history');
                 const response = await fetch('/api/feature-extraction/history');
                 console.log('📡 API响应状态:', response.status);
                 
                 const result = await response.json();
                 console.log('📋 API返回结果:', result);
                 
                 if (result.success && result.history && result.history.length > 0) {
                     console.log(`✅ 找到 ${result.history.length} 条历史记录`);
                     historyList.innerHTML = result.history.map(item => `
                         <div class="history-item" onclick="loadHistoryResult('${item.timestamp}')">
                             <div class="history-timestamp">${item.timestamp}</div>
                             <div class="history-stats">
                                 ${item.master_features_shape[0]} 任务 | ${item.feature_columns.length} 特征
                             </div>
                         </div>
                     `).join('');
                     console.log('✅ 历史记录显示完成');
                 } else {
                     console.log('ℹ️ 无历史记录或数据为空');
                     historyList.innerHTML = '<p class="text-muted">暂无历史记录</p>';
                 }
                 
             } catch (error) {
                 console.error('❌ 加载历史记录失败:', error);
                 const historyList = document.getElementById('extractionHistoryList');
                 if (historyList) {
                     historyList.innerHTML = '<p class="text-danger">加载失败: ' + error.message + '</p>';
                 }
             }
         }

         // 加载历史结果
         function loadHistoryResult(timestamp) {
             window.currentExtractionTimestamp = timestamp;
             
             // 显示结果文件区域
             document.getElementById('resultsFiles').style.display = 'block';
             document.getElementById('extractionStatusCard').style.display = 'none';
             document.getElementById('dataPreview').style.display = 'none';
         }

         // 预览结果
         async function previewResults(type) {
             if (!window.currentExtractionTimestamp) {
                 alert('请先选择一个提取结果');
                 return;
             }
             
             try {
                 const response = await fetch(`/api/feature-extraction/preview/${window.currentExtractionTimestamp}?type=${type}&limit=20`);
                 const result = await response.json();
                 
                 if (result.success) {
                     showDataPreview(result);
                 } else {
                     alert('预览失败: ' + result.message);
                 }
                 
             } catch (error) {
                 console.error('预览错误:', error);
                 alert('预览失败: ' + error.message);
             }
         }

         // 显示数据预览
         function showDataPreview(result) {
             const previewDiv = document.getElementById('dataPreview');
             const tableHead = document.getElementById('previewTableHead');
             const tableBody = document.getElementById('previewTableBody');
             
             // 构建表头
             if (result.preview.length > 0) {
                 const columns = Object.keys(result.preview[0]);
                 tableHead.innerHTML = '<tr>' + columns.map(col => `<th>${col}</th>`).join('') + '</tr>';
                 
                 // 构建表体
                 tableBody.innerHTML = result.preview.map(row => {
                     return '<tr>' + columns.map(col => `<td>${row[col] || '-'}</td>`).join('') + '</tr>';
                 }).join('');
             }
             
             previewDiv.style.display = 'block';
             previewDiv.scrollIntoView({ behavior: 'smooth' });
         }

         // 下载结果
         function downloadResults(type) {
             if (!window.currentExtractionTimestamp) {
                 alert('请先选择一个提取结果');
                 return;
             }
             
             const url = `/api/feature-extraction/download/${window.currentExtractionTimestamp}?type=${type}`;
             const link = document.createElement('a');
             link.href = url;
             link.download = '';
             document.body.appendChild(link);
             link.click();
             document.body.removeChild(link);
         }

         // 重置流程状态
         function resetPipelineStatus() {
             for (let i = 1; i <= 5; i++) {
                 const stepCard = document.getElementById(`step${i}Card`);
                 const stepStatus = document.getElementById(`step${i}Status`);
                 
                 if (stepCard) {
                     stepCard.className = 'pipeline-step-card';
                 }
                 
                 if (stepStatus) {
                     stepStatus.innerHTML = '<i class="fas fa-clock text-warning"></i> 待执行';
                     stepStatus.className = 'step-status';
                 }
             }
             
             // 重置进度条
             const progressBar = document.getElementById('overallProgress');
             if (progressBar) {
                 progressBar.style.width = '0%';
                 progressBar.textContent = '0%';
             }
         }
         // 更新步骤状态
         function updateStepStatus(stepNumber, status, message) {
             const stepCard = document.getElementById(`step${stepNumber}Card`);
             const stepStatus = document.getElementById(`step${stepNumber}Status`);
             
             if (stepCard) {
                 stepCard.className = `pipeline-step-card ${status}`;
             }
             
             if (stepStatus) {
                 let icon, color;
                 switch (status) {
                     case 'running':
                         icon = 'fas fa-spinner fa-spin';
                         color = 'text-warning';
                         break;
                     case 'completed':
                         icon = 'fas fa-check-circle';
                         color = 'text-success';
                         break;
                     case 'failed':
                         icon = 'fas fa-times-circle';
                         color = 'text-danger';
                         break;
                     default:
                         icon = 'fas fa-clock';
                         color = 'text-warning';
                 }
                 
                 stepStatus.innerHTML = `<i class="${icon} ${color}"></i> ${message}`;
                 stepStatus.className = `step-status ${status}`;
             }
         }

         // 更新总体进度
         function updateOverallProgress(progress) {
             const progressBar = document.getElementById('overallProgress');
             if (progressBar) {
                 progressBar.style.width = `${progress}%`;
                 progressBar.textContent = `${progress}%`;
             }
         }

         // 获取当前RQA参数
         function getCurrentRQAParams() {
             return {
                 m: parseInt(document.getElementById('rqa-embedding-dim').value),
                 tau: parseInt(document.getElementById('rqa-time-delay').value),
                 eps: parseFloat(document.getElementById('rqa-threshold').value),
                 lmin: parseInt(document.getElementById('rqa-min-line').value)
             };
         }

         // 生成参数签名
         function generateParamSignature(params) {
             return `m${params.m}_tau${params.tau}_eps${params.eps}_lmin${params.lmin}`;
         }

         // 更新参数签名显示
         function updateParamSignature() {
             const params = getCurrentRQAParams();
             const signature = generateParamSignature(params);
             const signatureElement = document.getElementById('current-param-signature');
             if (signatureElement) {
                 signatureElement.textContent = signature;
             }
         }

         // 折叠功能
         function toggleCollapse(sectionId) {
             const content = document.getElementById(sectionId + 'Content');
             const toggle = document.getElementById(sectionId + 'Toggle');
             
             if (content.classList.contains('collapsed')) {
                 // 展开
                 content.classList.remove('collapsed');
                 toggle.textContent = '−';
             } else {
                 // 折叠
                 content.classList.add('collapsed');
                 toggle.textContent = '+';
             }
         }

         // 加载参数历史
         async function loadParamHistory() {
             try {
                 const response = await fetch('/api/rqa-pipeline/param-history');
                 const result = await response.json();
                 
                 if (result.success) {
                     showParamHistoryModal(result.history);
                 } else {
                     alert('加载参数历史失败: ' + result.message);
                 }
             } catch (error) {
                 console.error('加载参数历史错误:', error);
                 alert('加载参数历史失败: ' + error.message);
             }
         }

         // 显示参数历史模态框
         function showParamHistoryModal(historyData) {
             let modalHTML = `
                 <div class="param-history-modal" id="paramHistoryModal">
                     <div class="param-history-content">
                         <div class="d-flex justify-content-between align-items-center mb-4">
                             <h4><i class="fas fa-history"></i> 参数历史记录</h4>
                             <button class="btn btn-outline-secondary btn-sm" onclick="closeParamHistoryModal()">
                                 <i class="fas fa-times"></i>
                             </button>
                         </div>
                         <div class="table-responsive">
                             <table class="table table-hover">
                                 <thead>
                                     <tr>
                                         <th>参数组合</th>
                                         <th>嵌入维度</th>
                                         <th>时间延迟</th>
                                         <th>递归阈值</th>
                                         <th>最小线长</th>
                                         <th>完成步骤</th>
                                         <th>操作</th>
                                     </tr>
                                 </thead>
                                 <tbody>`;
             
             if (historyData.length === 0) {
                 modalHTML += `
                     <tr>
                         <td colspan="7" class="text-center text-muted">暂无历史记录</td>
                     </tr>`;
             } else {
                 historyData.forEach(item => {
                     modalHTML += `
                         <tr>
                             <td><span class="param-signature">${item.signature}</span></td>
                             <td>${item.params.m}</td>
                             <td>${item.params.tau}</td>
                             <td>${item.params.eps}</td>
                             <td>${item.params.lmin}</td>
                             <td>
                                 <div class="progress" style="height: 20px;">
                                     <div class="progress-bar" style="width: ${item.progress}%">${item.completed_steps}/5</div>
                                 </div>
                             </td>
                             <td>
                                 <button class="btn btn-sm btn-primary" onclick="loadParams('${item.signature}', ${JSON.stringify(item.params).replace(/"/g, '&quot;')})">
                                     <i class="fas fa-download"></i> 加载
                                 </button>
                                 <button class="btn btn-sm btn-info" onclick="viewResults('${item.signature}')">
                                     <i class="fas fa-eye"></i> 查看
                                 </button>
                                 <button class="btn btn-sm btn-danger" onclick="deleteResults('${item.signature}')">
                                     <i class="fas fa-trash"></i> 删除
                                 </button>
                             </td>
                         </tr>`;
                 });
             }
             
             modalHTML += `
                                 </tbody>
                             </table>
                         </div>
                     </div>
                 </div>`;
             
             // 添加到页面
             document.body.insertAdjacentHTML('beforeend', modalHTML);
             document.getElementById('paramHistoryModal').style.display = 'block';
         }

         // 关闭参数历史模态框
         function closeParamHistoryModal() {
             const modal = document.getElementById('paramHistoryModal');
             if (modal) {
                 modal.remove();
             }
         }

         // 加载指定参数
         function loadParams(signature, params) {
             document.getElementById('rqa-embedding-dim').value = params.m;
             document.getElementById('rqa-time-delay').value = params.tau;
             document.getElementById('rqa-threshold').value = params.eps;
             document.getElementById('rqa-min-line').value = params.lmin;
             updateParamSignature();
             closeParamHistoryModal();
         }

         // 查看指定参数的结果
         async function viewResults(signature) {
             try {
                 const response = await fetch(`/api/rqa-pipeline/results/${signature}`);
                 const result = await response.json();
                 
                 if (result.status === 'success') {
                     if (result.data.results && (result.data.results.charts || result.data.results.group_stats)) {
                         displayResults(result.data.results);
                         closeParamHistoryModal();
                     } else {
                         alert('该参数组合的可视化结果尚未生成，请先完成完整流程');
                     }
                 } else {
                     alert('该参数组合暂无结果或结果不完整');
                 }
             } catch (error) {
                 console.error('查看结果错误:', error);
                 alert('查看结果失败');
             }
         }

         // 删除指定参数的结果
         async function deleteResults(signature) {
             if (!confirm(`确定要删除参数组合 "${signature}" 的所有结果吗？此操作不可恢复。`)) {
                 return;
             }
             
             try {
                 const response = await fetch(`/api/rqa-pipeline/delete/${signature}`, {
                     method: 'DELETE'
                 });
                 const result = await response.json();
                 
                 if (result.status === 'success') {
                     alert('删除成功');
                     // 重新加载历史记录
                     loadParamHistory();
                 } else {
                     alert('删除失败: ' + result.message);
                 }
             } catch (error) {
                 console.error('删除结果错误:', error);
                 alert('删除失败');
             }
         }

         // 运行完整流程时获取当前参数
         async function runFullPipeline() {
             console.log('开始运行完整流程...');
             resetPipelineStatus();
             
             const params = getCurrentRQAParams();
             const signature = generateParamSignature(params);
             console.log('使用参数组合:', signature);
             
             try {
                 // 按顺序执行所有步骤
                 await startRQACalculation();
                 await new Promise(resolve => setTimeout(resolve, 1000)); // 短暂延迟
                 
                 await startDataMerging();
                 await new Promise(resolve => setTimeout(resolve, 1000));
                 
                 await startFeatureEnrichment();
                 await new Promise(resolve => setTimeout(resolve, 1000));
                 
                 await startStatisticalAnalysis();
                 await new Promise(resolve => setTimeout(resolve, 1000));
                 
                 await startVisualization();
                 
                 updateOverallProgress(100);
                 console.log('完整流程执行完成！');
                 
             } catch (error) {
                 console.error('流程执行错误:', error);
                 alert('流程执行失败，请检查错误信息');
             }
         }

         // 页面加载时初始化参数签名
         document.addEventListener('DOMContentLoaded', function() {
             updateParamSignature();
         });

         // 步骤1: 开始RQA计算
         async function startRQACalculation() {
             console.log('开始RQA计算...');
             updateStepStatus(1, 'running', '正在计算RQA指标...');
             updateOverallProgress(20);
             
             const params = getCurrentRQAParams();
             
             try {
                 const response = await fetch('/api/rqa-pipeline/calculate', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json'
                     },
                     body: JSON.stringify({
                         step: 'rqa_calculation',
                         parameters: {
                             m: params.m,
                             delay: params.tau,
                             eps: params.eps,
                             lmin: params.lmin
                         }
                     })
                 });
                 
                 const result = await response.json();
                 
                 if (result.status === 'success') {
                     updateStepStatus(1, 'completed', '✅ RQA计算完成');
                     updateOverallProgress(20);
                 } else {
                     updateStepStatus(1, 'failed', '❌ RQA计算失败');
                 }
             } catch (error) {
                 console.error('RQA计算错误:', error);
                 updateStepStatus(1, 'failed', '❌ 网络错误');
             }
         }

         // 步骤2: 开始数据合并
         async function startDataMerging() {
             console.log('开始数据合并...');
             updateStepStatus(2, 'running', '正在合并三组数据...');
             updateOverallProgress(40);
             
             const params = getCurrentRQAParams();
             
             try {
                 const response = await fetch('/api/rqa-pipeline/merge', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json'
                     },
                     body: JSON.stringify({
                         step: 'data_merging',
                         parameters: params
                     })
                 });
                 
                 const result = await response.json();
                 
                 if (result.status === 'success') {
                     updateStepStatus(2, 'completed', '✅ 数据合并完成');
                     updateOverallProgress(40);
                 } else {
                     updateStepStatus(2, 'failed', '❌ 数据合并失败');
                 }
             } catch (error) {
                 console.error('数据合并错误:', error);
                 updateStepStatus(2, 'failed', '❌ 网络错误');
             }
         }

         // 步骤3: 开始特征补充
         async function startFeatureEnrichment() {
             console.log('开始特征补充...');
             updateStepStatus(3, 'running', '正在补充事件特征...');
             updateOverallProgress(60);
             
             const params = getCurrentRQAParams();
             
             try {
                 const response = await fetch('/api/rqa-pipeline/enrich', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json'
                     },
                     body: JSON.stringify({
                         step: 'feature_enrichment',
                         parameters: params
                     })
                 });
                 
                 const result = await response.json();
                 
                 if (result.status === 'success') {
                     updateStepStatus(3, 'completed', '✅ 特征补充完成');
                     updateOverallProgress(60);
                 } else {
                     updateStepStatus(3, 'failed', '❌ 特征补充失败');
                 }
             } catch (error) {
                 console.error('特征补充错误:', error);
                 updateStepStatus(3, 'failed', '❌ 网络错误');
             }
         }

         // 步骤4: 开始统计分析
         async function startStatisticalAnalysis() {
             console.log('开始统计分析...');
             updateStepStatus(4, 'running', '正在进行统计分析...');
             updateOverallProgress(80);
             
             const params = getCurrentRQAParams();
             
             try {
                 const response = await fetch('/api/rqa-pipeline/analyze', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json'
                     },
                     body: JSON.stringify({
                         step: 'statistical_analysis',
                         parameters: params
                     })
                 });
                 
                 const result = await response.json();
                 
                 if (result.status === 'success') {
                     updateStepStatus(4, 'completed', '✅ 统计分析完成');
                     updateOverallProgress(80);
                 } else {
                     updateStepStatus(4, 'failed', '❌ 统计分析失败');
                 }
             } catch (error) {
                 console.error('统计分析错误:', error);
                 updateStepStatus(4, 'failed', '❌ 网络错误');
             }
         }

         // 步骤5: 开始可视化
         async function startVisualization() {
             console.log('开始生成可视化...');
             updateStepStatus(5, 'running', '正在生成图表...');
             updateOverallProgress(100);
             
             const params = getCurrentRQAParams();
             
             try {
                 const response = await fetch('/api/rqa-pipeline/visualize', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json'
                     },
                     body: JSON.stringify({
                         step: 'visualization',
                         parameters: params
                     })
                 });
                 
                 const result = await response.json();
                 
                 if (result.status === 'success') {
                     updateStepStatus(5, 'completed', '✅ 可视化完成');
                     updateOverallProgress(100);
                     displayResults(result.data);
                 } else {
                     updateStepStatus(5, 'failed', '❌ 可视化失败');
                 }
             } catch (error) {
                 console.error('可视化错误:', error);
                 updateStepStatus(5, 'failed', '❌ 网络错误');
             }
         }



         // 重置流程
         function resetPipeline() {
             resetPipelineStatus();

             // 清空结果显示区域
             const resultsContainer = document.getElementById('pipelineResults');
             if (resultsContainer) {
                 resultsContainer.innerHTML = `
                     <div class="placeholder-content text-center py-5">
                         <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                         <h5 class="text-muted">尚未生成分析结果</h5>
                         <p class="text-muted">请运行分析流程以查看结果</p>
                     </div>
                 `;
             }
         }

         // ========== 批处理功能函数 (新增) ==========

         // 计算参数组合数量
         function updateBatchCombinationCount() {
             try {
                 const mStart = parseFloat(document.getElementById('batch-m-start').value);
                 const mEnd = parseFloat(document.getElementById('batch-m-end').value);
                 const mStep = parseFloat(document.getElementById('batch-m-step').value);

                 const tauStart = parseFloat(document.getElementById('batch-tau-start').value);
                 const tauEnd = parseFloat(document.getElementById('batch-tau-end').value);
                 const tauStep = parseFloat(document.getElementById('batch-tau-step').value);

                 const epsStart = parseFloat(document.getElementById('batch-eps-start').value);
                 const epsEnd = parseFloat(document.getElementById('batch-eps-end').value);
                 const epsStep = parseFloat(document.getElementById('batch-eps-step').value);

                 const lminStart = parseFloat(document.getElementById('batch-lmin-start').value);
                 const lminEnd = parseFloat(document.getElementById('batch-lmin-end').value);
                 const lminStep = parseFloat(document.getElementById('batch-lmin-step').value);

                 const mCount = Math.floor((mEnd - mStart) / mStep) + 1;
                 const tauCount = Math.floor((tauEnd - tauStart) / tauStep) + 1;
                 const epsCount = Math.floor((epsEnd - epsStart + 0.0001) / epsStep) + 1; // 添加小容差
                 const lminCount = Math.floor((lminEnd - lminStart) / lminStep) + 1;

                 const totalCount = mCount * tauCount * epsCount * lminCount;

                 const countElement = document.getElementById('batch-combination-count');
                 if (countElement) {
                     countElement.textContent = totalCount;
                 }

                 return totalCount;
             } catch (error) {
                 console.error('计算组合数量错误:', error);
                 return 0;
             }
         }

         // 启动批量执行
         async function startBatchExecution() {
             console.log('🚀 启动批量执行...');

             // 计算组合数
             const totalCombinations = updateBatchCombinationCount();

             // 警告：如果组合数过多，提示用户
             if (totalCombinations > 100) {
                 const estimatedHours = Math.ceil(totalCombinations * 50 / 3600); // 假设每组50秒
                 const confirmed = confirm(
                     `⚠️ 警告：你配置的参数将生成 ${totalCombinations} 个组合！\n\n` +
                     `预计执行时间: ${estimatedHours} 小时\n\n` +
                     `建议先用小范围测试（如10-20个组合）。\n\n` +
                     `是否继续执行？`
                 );

                 if (!confirmed) {
                     console.log('用户取消了批量执行');
                     return;
                 }
             }

             // 获取参数范围配置
             const batchConfig = {
                 m_range: {
                     start: parseInt(document.getElementById('batch-m-start').value),
                     end: parseInt(document.getElementById('batch-m-end').value),
                     step: parseInt(document.getElementById('batch-m-step').value)
                 },
                 tau_range: {
                     start: parseInt(document.getElementById('batch-tau-start').value),
                     end: parseInt(document.getElementById('batch-tau-end').value),
                     step: parseInt(document.getElementById('batch-tau-step').value)
                 },
                 eps_range: {
                     start: parseFloat(document.getElementById('batch-eps-start').value),
                     end: parseFloat(document.getElementById('batch-eps-end').value),
                     step: parseFloat(document.getElementById('batch-eps-step').value)
                 },
                 lmin_range: {
                     start: parseInt(document.getElementById('batch-lmin-start').value),
                     end: parseInt(document.getElementById('batch-lmin-end').value),
                     step: parseInt(document.getElementById('batch-lmin-step').value)
                 }
             };

             console.log('批处理配置:', batchConfig);

             // 显示进度面板
             const progressPanel = document.getElementById('batchProgressPanel');
             if (progressPanel) {
                 progressPanel.style.display = 'block';
             }

             // 重置进度显示
             updateBatchProgress(0, '正在启动批处理...', 0, 0, 0, 0);

             try {
                 const response = await fetch('/api/rqa-pipeline/batch-execute', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json'
                     },
                     body: JSON.stringify(batchConfig)
                 });

                 const result = await response.json();

                 if (result.status === 'success') {
                     const data = result.data;

                     // 更新最终进度
                     updateBatchProgress(
                         100,
                         `批处理完成！✅`,
                         data.total,
                         data.completed,
                         data.skipped,
                         data.failed
                     );

                     // 显示成功通知
                     alert(`批处理执行完成！\n\n总计: ${data.total}\n成功: ${data.completed}\n跳过: ${data.skipped}\n失败: ${data.failed}`);

                     // 刷新参数历史列表
                     if (typeof loadParamHistory === 'function') {
                         loadParamHistory();
                     }

                     console.log('✅ 批处理完成:', data);
                 } else {
                     console.error('❌ 批处理失败:', result.message);
                     alert('批处理失败: ' + result.message);

                     // 更新为失败状态
                     updateBatchProgress(0, `批处理失败: ${result.message}`, 0, 0, 0, 0);
                 }

             } catch (error) {
                 console.error('❌ 批处理执行错误:', error);
                 alert('批处理执行失败: ' + error.message);

                 // 更新为错误状态
                 updateBatchProgress(0, `执行错误: ${error.message}`, 0, 0, 0, 0);
             }
         }

         // 更新批处理进度显示
         function updateBatchProgress(progressPercent, statusText, total, completed, skipped, failed) {
             // 更新进度条
             const progressBar = document.getElementById('batchProgressBar');
             if (progressBar) {
                 progressBar.style.width = `${progressPercent}%`;
                 progressBar.setAttribute('aria-valuenow', progressPercent);
                 const spanElement = progressBar.querySelector('span');
                 if (spanElement) {
                     spanElement.textContent = `${progressPercent.toFixed(0)}%`;
                 }
             }

             // 更新状态文本
             const progressText = document.getElementById('batchProgressText');
             if (progressText) {
                 if (progressPercent === 100) {
                     progressText.innerHTML = `<i class="fas fa-check-circle text-success"></i> ${statusText}`;
                 } else if (progressPercent === 0 && failed > 0) {
                     progressText.innerHTML = `<i class="fas fa-times-circle text-danger"></i> ${statusText}`;
                 } else {
                     progressText.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${statusText}`;
                 }
             }

             // 更新统计数字
             const totalElement = document.getElementById('batch-total');
             const completedElement = document.getElementById('batch-completed');
             const skippedElement = document.getElementById('batch-skipped');
             const failedElement = document.getElementById('batch-failed');

             if (totalElement) totalElement.textContent = total;
             if (completedElement) completedElement.textContent = completed;
             if (skippedElement) skippedElement.textContent = skipped;
             if (failedElement) failedElement.textContent = failed;
         }

         // 显示分析结果
         function displayResults(data) {
             const resultsContainer = document.getElementById('pipelineResults');
             if (!resultsContainer || !data) return;
             
             let resultsHTML = '';
             
             // 显示统计表格
             if (data.group_stats) {
                 resultsHTML += `
                     <div class="result-section">
                         <h5><i class="fas fa-table"></i> 组别统计结果</h5>
                         <div class="table-responsive">
                             <table class="table table-striped">
                                 <thead>
                                     <tr>
                                         <th>组别</th>
                                         <th>RR-2D-xy (均值±标准差)</th>
                                         <th>DET-2D-xy (均值±标准差)</th>
                                         <th>ENT-2D-xy (均值±标准差)</th>
                                     </tr>
                                 </thead>
                                 <tbody>
                                     ${data.group_stats.map(row => `
                                         <tr>
                                             <td>${row.Group}</td>
                                             <td>${row.RR_mean.toFixed(4)} ± ${row.RR_std.toFixed(4)}</td>
                                             <td>${row.DET_mean.toFixed(4)} ± ${row.DET_std.toFixed(4)}</td>
                                             <td>${row.ENT_mean.toFixed(4)} ± ${row.ENT_std.toFixed(4)}</td>
                                         </tr>
                                     `).join('')}
                                 </tbody>
                             </table>
                         </div>
                     </div>
                 `;
             }
             
             // 显示图表
             if (data.charts) {
                 resultsHTML += `
                     <div class="result-section mt-4">
                         <h5><i class="fas fa-chart-bar"></i> 可视化图表</h5>
                         <div class="row">
                             ${data.charts.map(chart => `
                                 <div class="col-lg-6 mb-4">
                                     <div class="chart-container">
                                         <h6>${chart.title}</h6>
                                         <img src="data:image/png;base64,${chart.image}" class="img-fluid" alt="${chart.title}">
                                     </div>
                                 </div>
                             `).join('')}
                         </div>
                     </div>
                 `;
             }
             
             resultsContainer.innerHTML = resultsHTML;
         }

         // 数据导入功能变量
         let selectedFiles = [];
         let selectedGroup = null;
         let processingStatus = null;
         let processingResult = null;

         // 初始化数据导入功能
         function initDataImport() {
             setupFileUpload();
             resetImportState();
         }

         // 设置文件上传
         function setupFileUpload() {
             const uploadZone = document.getElementById('uploadZone');
             const fileInput = document.getElementById('fileInput');

             // 拖拽事件
             uploadZone.addEventListener('dragover', (e) => {
                 e.preventDefault();
                 uploadZone.classList.add('dragover');
             });

             uploadZone.addEventListener('dragleave', (e) => {
                 e.preventDefault();
                 uploadZone.classList.remove('dragover');
             });

             uploadZone.addEventListener('drop', (e) => {
                 e.preventDefault();
                 uploadZone.classList.remove('dragover');
                 handleFiles(e.dataTransfer.files);
             });

             // 文件选择事件
             fileInput.addEventListener('change', (e) => {
                 handleFiles(e.target.files);
             });
         }

         // 处理选择的文件
         function handleFiles(files) {
             const standardFileNames = ['1.txt', '2.txt', '3.txt', '4.txt', '5.txt'];
             const levelFileNames = ['level_1.txt', 'level_2.txt', 'level_3.txt', 'level_4.txt', 'level_5.txt'];
             const validFileNames = [...standardFileNames, ...levelFileNames];
             const newFiles = [];
             const errors = [];
             
             Array.from(files).forEach(file => {
                 // 检查文件名是否有效
                 if (!validFileNames.includes(file.name)) {
                     errors.push(`无效文件名: ${file.name}`);
                     return;
                 }
                 
                 // 检查是否已存在同名文件
                 if (selectedFiles.some(f => f.name === file.name)) {
                     errors.push(`文件已存在: ${file.name}`);
                     return;
                 }
                 
                 newFiles.push(file);
             });
             
             // 显示错误信息
             if (errors.length > 0) {
                 alert('文件选择错误:\n' + errors.join('\n'));
             }
             
             // 添加有效文件
             selectedFiles.push(...newFiles);
             updateFileList();
             validateFileSet();
         }

         // 更新文件列表显示
         function updateFileList() {
             const fileList = document.getElementById('fileList');
             const fileItems = document.getElementById('fileItems');

             if (selectedFiles.length === 0) {
                 fileList.style.display = 'none';
                 return;
             }

             fileList.style.display = 'block';
             fileItems.innerHTML = '';

             selectedFiles.forEach((file, index) => {
                 const fileItem = document.createElement('div');
                 fileItem.className = 'file-item';
                 fileItem.innerHTML = `
                     <div class="file-info">
                         <div class="file-icon">
                             <i class="fas fa-file-alt"></i>
                         </div>
                         <div class="file-details">
                             <h5>${file.name}</h5>
                             <p>${formatFileSize(file.size)} • ${file.type || 'text/plain'}</p>
                         </div>
                     </div>
                     <button class="file-remove" onclick="removeFile(${index})">
                         <i class="fas fa-times"></i>
                     </button>
                 `;
                 fileItems.appendChild(fileItem);
             });
         }

         // 格式化文件大小
         function formatFileSize(bytes) {
             if (bytes === 0) return '0 B';
             const k = 1024;
             const sizes = ['B', 'KB', 'MB', 'GB'];
             const i = Math.floor(Math.log(bytes) / Math.log(k));
             return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
         }

         // 移除文件
         function removeFile(index) {
             selectedFiles.splice(index, 1);
             updateFileList();
             validateFileSet();
         }

         // 清空文件
         function clearFiles() {
             selectedFiles = [];
             updateFileList();
             validateFileSet();
             document.getElementById('fileInput').value = '';
         }

         // 验证文件集合
         function validateFileSet() {
             const standardFiles = ['1.txt', '2.txt', '3.txt', '4.txt', '5.txt'];
             const levelFiles = ['level_1.txt', 'level_2.txt', 'level_3.txt', 'level_4.txt', 'level_5.txt'];
             const validationList = document.getElementById('validationList');
             const validationStatus = document.getElementById('validationStatus');
             
             // 显示验证状态面板
             validationStatus.style.display = 'block';
             
             // 检查用户使用的是哪种格式
             const uploadedNames = selectedFiles.map(f => f.name);
             const hasStandardFiles = standardFiles.some(name => uploadedNames.includes(name));
             const hasLevelFiles = levelFiles.some(name => uploadedNames.includes(name));
             
             let requiredFiles = [];
             let allValid = true;
             
             // 决定期望的文件格式
             if (hasStandardFiles && !hasLevelFiles) {
                 requiredFiles = standardFiles;
             } else if (hasLevelFiles && !hasStandardFiles) {
                 requiredFiles = levelFiles;
             } else if (hasStandardFiles && hasLevelFiles) {
                 // 混合格式，显示错误
                 allValid = false;
             } else {
                 // 没有上传任何文件，默认显示标准格式
                 requiredFiles = standardFiles;
             }
             
             let html = '';
             
             // 检查每个必需文件
             requiredFiles.forEach(fileName => {
                 const hasFile = selectedFiles.some(f => f.name === fileName);
                 const statusClass = hasFile ? 'valid' : 'missing';
                 const statusIcon = hasFile ? 'fas fa-check-circle' : 'fas fa-clock';
                 const statusText = hasFile ? '已上传' : '未上传';
                 
                 if (!hasFile) allValid = false;
                 
                 html += `
                     <div class="validation-item ${statusClass}">
                         <span>${fileName}</span>
                         <span class="validation-status-icon ${statusClass}">
                             <i class="${statusIcon}"></i> ${statusText}
                         </span>
                     </div>
                 `;
             });
             
             // 检查是否有无效文件或混合格式
             selectedFiles.forEach(file => {
                 const isStandard = standardFiles.includes(file.name);
                 const isLevel = levelFiles.includes(file.name);
                 
                 if (!isStandard && !isLevel) {
                     // 完全无效的文件名
                     html += `
                         <div class="validation-item invalid">
                             <span>${file.name}</span>
                             <span class="validation-status-icon invalid">
                                 <i class="fas fa-times-circle"></i> 无效文件
                             </span>
                         </div>
                     `;
                     allValid = false;
                 } else if (hasStandardFiles && hasLevelFiles) {
                     // 混合格式
                     html += `
                         <div class="validation-item invalid">
                             <span>${file.name}</span>
                             <span class="validation-status-icon invalid">
                                 <i class="fas fa-times-circle"></i> 格式混合
                             </span>
                         </div>
                     `;
                     allValid = false;
                 }
             });
             
             validationList.innerHTML = html;
             
             // 更新下一步按钮状态
             const nextBtn = document.querySelector('#fileList .btn-success');
             if (nextBtn) {
                 nextBtn.disabled = !allValid || selectedFiles.length !== 5;
                 if (allValid && selectedFiles.length === 5) {
                     nextBtn.innerHTML = '<i class="fas fa-check"></i> <span data-lang-key="nextStep">下一步</span>';
                 } else {
                     nextBtn.innerHTML = '<i class="fas fa-times"></i> <span data-lang-key="nextStep">下一步</span>';
                 }
             }
             
             return allValid && selectedFiles.length === 5;
         }

         // 进入分组选择步骤
         function proceedToGroupSelection() {
             // 验证文件集合
             if (!validateFileSet()) {
                 const texts = languageTexts[currentLanguage];
                 alert(texts.fileValidation + '\n' + texts.missingFiles);
                 return;
             }

             document.getElementById('uploadSection').style.display = 'none';
             document.getElementById('groupSelection').style.display = 'block';

             // 更新步骤指示器
             updateStepIndicator('group');
         }

         // 返回上传步骤
         function backToUpload() {
             document.getElementById('groupSelection').style.display = 'none';
             document.getElementById('uploadSection').style.display = 'block';

             // 更新步骤指示器
             updateStepIndicator('upload');
         }
         // 更新步骤指示器
         function updateStepIndicator(currentStep) {
             const steps = ['upload', 'group', 'process', 'complete'];
             const stepElements = document.querySelectorAll('.step');

             stepElements.forEach((step, index) => {
                 const stepName = steps[index];
                 step.classList.remove('active', 'completed');

                 if (stepName === currentStep) {
                     step.classList.add('active');
                 } else if (steps.indexOf(stepName) < steps.indexOf(currentStep)) {
                     step.classList.add('completed');
                 }
             });
         }

         // 设置分组选择事件
         document.addEventListener('DOMContentLoaded', function() {
             // 分组卡片点击事件
             setTimeout(() => {
                 const groupCards = document.querySelectorAll('.group-card');
                 groupCards.forEach(card => {
                     card.addEventListener('click', function() {
                         // 移除其他选中状态
                         groupCards.forEach(c => c.classList.remove('selected'));
                         // 添加选中状态
                         this.classList.add('selected');
                         selectedGroup = this.dataset.group;

                         // 启用开始处理按钮
                         document.getElementById('startProcessBtn').disabled = false;
                     });
                 });
             }, 100);
         });

         // 开始处理
         async function startProcessing() {
             if (!selectedGroup || selectedFiles.length === 0) return;

             // 隐藏分组选择，显示处理界面
             document.getElementById('groupSelection').style.display = 'none';
             document.getElementById('processingSection').style.display = 'block';

             // 更新步骤指示器
             updateStepIndicator('process');

             // 开始上传和处理文件
             await uploadAndProcessFiles();
         }

         // 上传并处理文件
         async function uploadAndProcessFiles() {
             const totalSteps = 3; // 上传、处理、校准
             let currentStep = 0;
             
             try {
                 // 第1步：批量上传文件
                 updateCurrentTask(`正在上传文件组 (共${selectedFiles.length}个文件)`);
                 addLogEntry(`开始上传文件组: ${selectedFiles.map(f => f.name).join(', ')}`, 'info');
                 
                 const uploadResult = await uploadFileGroup(selectedFiles, selectedGroup);
                 
                 if (!uploadResult.success) {
                     addLogEntry(`文件组上传失败: ${uploadResult.error}`, 'error');
                     return;
                 }
                 
                 addLogEntry(`文件组上传成功，组ID: ${uploadResult.groupId}`, 'success');
                 currentStep++;
                 updateProgress((currentStep / totalSteps) * 100);
                 
                 // 第2步：处理文件组
                 updateCurrentTask(`正在处理文件组数据`);
                 addLogEntry(`开始处理文件组数据...`, 'info');
                 
                 const processResult = await processFileGroup(uploadResult.groupId);
                 
                 if (processResult.success) {
                     addLogEntry(`文件组处理完成，生成组: ${processResult.target_group_name}`, 'success');
                     currentStep++;
                     updateProgress((currentStep / totalSteps) * 100);
                 } else {
                     addLogEntry(`文件组处理失败: ${processResult.error}`, 'error');
                     return;
                 }
                 
                 // 第3步：完成
                 updateCurrentTask(`处理完成`);
                 currentStep++;
                 updateProgress(100);
                 
                 // 保存结果信息
                 processingResult = processResult;
                 
                 // 延迟显示完成界面
                 setTimeout(() => {
                     showCompletion();
                 }, 1000);

             } catch (error) {
                 addLogEntry(`处理过程中出错: ${error.message}`, 'error');
             }
         }

         // 批量上传文件组
         async function uploadFileGroup(files, group) {
             const formData = new FormData();
             
             // 添加所有文件
             files.forEach(file => {
                 formData.append('files', file);
             });
             formData.append('group', group);

             try {
                 const response = await fetch('/api/upload-group', {
                     method: 'POST',
                     body: formData
                 });
                 return await response.json();
             } catch (error) {
                 return { success: false, error: error.message };
             }
         }

         // 处理文件组
         async function processFileGroup(groupId) {
             try {
                 const response = await fetch(`/api/process-group/${groupId}`, {
                     method: 'POST'
                 });
                 return await response.json();
             } catch (error) {
                 return { success: false, error: error.message };
             }
         }

         // 更新当前任务
         function updateCurrentTask(task) {
             document.getElementById('currentTaskText').textContent = task;
         }

         // 更新进度
         function updateProgress(percentage) {
             document.getElementById('overallProgressBar').style.width = `${percentage}%`;
             document.getElementById('overallProgressText').textContent = `${Math.round(percentage)}%`;
         }

         // 添加日志条目
         function addLogEntry(message, type = 'info') {
             const logContainer = document.getElementById('logContainer');
             const timestamp = new Date().toLocaleTimeString();
             
             const logItem = document.createElement('div');
             logItem.className = `log-item log-${type}`;
             logItem.innerHTML = `
                 <span class="log-time">[${timestamp}]</span>
                 <span class="log-text">${message}</span>
             `;
             
             logContainer.appendChild(logItem);
             logContainer.scrollTop = logContainer.scrollHeight;
         }

         // 显示完成界面
         function showCompletion() {
             document.getElementById('processingSection').style.display = 'none';
             document.getElementById('completionSection').style.display = 'block';

             // 更新步骤指示器
             updateStepIndicator('complete');

             // 显示统计信息
             const stats = document.getElementById('completionStats');
             const groupName = processingResult ? processingResult.target_group_name : '未知';
             const fileCount = selectedFiles.length;
             
             stats.innerHTML = `
                 <h4>处理统计</h4>
                 <div class="row">
                     <div class="col-md-6">
                         <p><strong>处理文件数:</strong> ${fileCount}个</p>
                         <p><strong>目标分组:</strong> ${getGroupName(selectedGroup)}</p>
                         <p><strong>生成组名:</strong> ${groupName}</p>
                     </div>
                     <div class="col-md-6">
                         <p><strong>处理状态:</strong> 完成</p>
                         <p><strong>原始数据:</strong> ✓ 已保存</p>
                         <p><strong>预处理:</strong> ✓ 已完成</p>
                         <p><strong>校准:</strong> ✓ 已完成</p>
                     </div>
                 </div>
             `;
         }

         // 获取分组名称
         function getGroupName(group) {
             const texts = languageTexts[currentLanguage];
             switch(group) {
                 case 'control': return texts.controlGroup;
                 case 'mci': return texts.mciGroup;
                 case 'ad': return texts.adGroup;
                 default: return group;
             }
         }

         // 重置导入状态
         function resetImportState() {
             selectedFiles = [];
             selectedGroup = null;
             
             // 显示上传界面
             document.getElementById('uploadSection').style.display = 'block';
             document.getElementById('groupSelection').style.display = 'none';
             document.getElementById('processingSection').style.display = 'none';
             document.getElementById('completionSection').style.display = 'none';

             // 隐藏验证状态面板
             document.getElementById('validationStatus').style.display = 'none';
             document.getElementById('processPreview').style.display = 'none';

             // 重置步骤指示器
             updateStepIndicator('upload');

             // 清空文件列表
             updateFileList();
         }

         // 查看数据（返回可视化界面）
         function goToVisualization() {
             switchToVisualization();
             // 刷新数据
             loadGroups();
         }

         // 开始新的导入
         function startNewImport() {
             resetImportState();
         }

         let processingStartTime = 0;

         // ======== 校准编辑功能 ========

         let isEditMode = false;
         let currentCalibrationData = null;
         let currentTimeRange = { start: 0, end: 100 }; // 百分比
         let dataTimeInfo = { totalDuration: 0, totalPoints: 0, minTime: 0, maxTime: 0 };

         // 更新数据项选中状态
         function updateDataItemSelection(selectedDataId) {
             // 移除所有选中状态
             document.querySelectorAll('.data-item').forEach(item => {
                 item.classList.remove('selected');
             });
             
             // 添加选中状态到当前项
             const selectedItem = document.querySelector(`[data-id="${selectedDataId}"]`);
             if (selectedItem) {
                 selectedItem.classList.add('selected');
             }
         }

         // 进入编辑模式
         function enterEditMode() {
             if (!currentVisualization) {
                 alert('请先选择要编辑的数据');
                 return;
             }

             isEditMode = true;
             
             // 添加编辑模式CSS类到body
             document.body.classList.add('editing-mode');
             
             // 显示校准面板
             document.getElementById('calibrationPanel').classList.add('active');
             
             // 更新当前数据信息
             const dataInfo = `${currentVisualization.groupType.toUpperCase()} - ${currentVisualization.dataId}`;
             document.getElementById('currentDataInfo').textContent = dataInfo;
             
             // 重置偏移量
             document.getElementById('xOffset').value = 0;
             document.getElementById('yOffset').value = 0;
             updateOffsetValues();
             
             // 重置时间范围
             currentTimeRange = { start: 0, end: 100 };
             document.getElementById('startTime').value = 0;
             document.getElementById('endTime').value = 100;
             
             // 获取时间信息并初始化时间控件
             initializeTimeCalibration();
             
             // 隐藏edit按钮，显示正在编辑状态
             document.getElementById('editCalibrationBtn').style.display = 'none';
             
             // 添加平滑动画效果
             setTimeout(() => {
                 const calibrationPanel = document.getElementById('calibrationPanel');
                 if (calibrationPanel) {
                     calibrationPanel.style.opacity = '1';
                     calibrationPanel.style.transform = 'translateX(0)';
                 }
             }, 100);
         }

         // 退出编辑模式
         function exitEditMode() {
             isEditMode = false;
             
             // 移除编辑模式CSS类
             document.body.classList.remove('editing-mode');
             
             // 隐藏校准面板
             document.getElementById('calibrationPanel').classList.remove('active');
             
             // 显示edit按钮
             if (currentVisualization) {
                 document.getElementById('editCalibrationBtn').style.display = 'inline-block';
             }
             
             currentCalibrationData = null;
             
             // 重置校准面板的样式
             const calibrationPanel = document.getElementById('calibrationPanel');
             if (calibrationPanel) {
                 calibrationPanel.style.opacity = '';
                 calibrationPanel.style.transform = '';
             }
         }

         // 更新偏移量显示值
         function updateOffsetValues() {
             const xOffset = document.getElementById('xOffset').value;
             const yOffset = document.getElementById('yOffset').value;
             
             document.getElementById('xOffsetValue').textContent = parseFloat(xOffset).toFixed(2);
             document.getElementById('yOffsetValue').textContent = parseFloat(yOffset).toFixed(2);
         }

         // 应用预设偏移量
         function applyPresetOffset(x, y) {
             // 参数验证
             if (isNaN(x) || isNaN(y)) {
                 console.error('预设偏移量参数无效:', x, y);
                 return;
             }
             
             if (Math.abs(x) > 0.5 || Math.abs(y) > 0.5) {
                 const texts = languageTexts[currentLanguage];
                 if (!confirm('预设偏移量较大，确定要应用吗？')) {
                     return;
                 }
             }
             
             document.getElementById('xOffset').value = x;
             document.getElementById('yOffset').value = y;
             updateOffsetValues();
             updateCalibrationPreview();
         }

         // 更新校准预览
         function updateCalibrationPreview() {
             updateOffsetValues();
             
             // 如果有当前可视化数据，自动预览
             if (currentVisualization) {
                 previewCalibration();
             }
         }

         // 预览校准效果
         async function previewCalibration() {
             if (!currentVisualization) {
                 alert('请先选择要预览的数据');
                 return;
             }

             const xOffset = parseFloat(document.getElementById('xOffset').value);
             const yOffset = parseFloat(document.getElementById('yOffset').value);

             try {
                 // 获取可视化参数
                 const params = getVisualizationParams();
                 
                 // 添加校准偏移量参数
                 params.xOffset = xOffset;
                 params.yOffset = yOffset;
                 params.preview = true; // 标记为预览模式
                 
                 // 添加时间范围参数
                 if (isEditMode) {
                     params.timeStart = currentTimeRange.start;
                     params.timeEnd = currentTimeRange.end;
                 }

                 const queryString = new URLSearchParams(params).toString();
                 const response = await fetch(`/api/visualize/${currentVisualization.groupType}/${currentVisualization.dataId}?${queryString}`);
                 const result = await response.json();

                 if (result.error) {
                     console.error('预览失败:', result.error);
                     return;
                 }

                 // 更新图像显示
                 const imageContainer = document.getElementById('imageContainer');
                 if (result.image) {
                     let previewInfo = `当前偏移量: X=${xOffset.toFixed(2)}, Y=${yOffset.toFixed(2)}`;
                     
                     // 如果使用了时间范围，显示时间信息
                     if (isEditMode && (currentTimeRange.start > 0 || currentTimeRange.end < 100)) {
                         const selectedDuration = ((dataTimeInfo.totalDuration * (currentTimeRange.end - currentTimeRange.start) / 100) / 1000).toFixed(1);
                         previewInfo += `, 时间范围: ${currentTimeRange.start}%-${currentTimeRange.end}% (${selectedDuration}s)`;
                     }
                     
                     imageContainer.innerHTML = `
                         <h5><i class="fas fa-eye"></i> 校准预览 - ${currentVisualization.dataId}</h5>
                         <div class="alert alert-warning mb-3">
                             <i class="fas fa-info-circle"></i> 
                             ${previewInfo}
                             <small>(这是预览效果，未保存)</small>
                         </div>
                         <img src="data:image/png;base64,${result.image}" alt="校准预览" />
                     `;
                 }

                 // 更新统计信息
                 displayStatistics(result);

             } catch (error) {
                 console.error('预览校准失败:', error);
                 alert('预览失败: ' + error.message);
             }
         }

         // 保存校准
         async function saveCalibration() {
             if (!currentVisualization) {
                 alert('请先选择要保存的数据');
                 return;
             }

             const xOffset = parseFloat(document.getElementById('xOffset').value);
             const yOffset = parseFloat(document.getElementById('yOffset').value);
             const timeStart = parseFloat(document.getElementById('startTime').value);
             const timeEnd = parseFloat(document.getElementById('endTime').value);

             // 参数验证
             if (isNaN(xOffset) || isNaN(yOffset) || isNaN(timeStart) || isNaN(timeEnd)) {
                 alert('校准参数无效');
                 return;
             }

             if (Math.abs(xOffset) > 0.5 || Math.abs(yOffset) > 0.5) {
                 if (!confirm('坐标偏移量较大，可能导致数据超出有效范围。确定要保存吗？')) {
                     return;
                 }
             }

             // 检查是否有任何修改（坐标偏移或时间范围修改）
             const hasCoordinateChange = xOffset !== 0 || yOffset !== 0;
             const hasTimeChange = timeStart > 0 || timeEnd < 100;
             
             if (!hasCoordinateChange && !hasTimeChange) {
                 alert('没有检测到校准修改，无需保存');
                 return;
             }

             try {
                 const response = await fetch('/api/save-calibration', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json',
                     },
                     body: JSON.stringify({
                         groupType: currentVisualization.groupType,
                         dataId: currentVisualization.dataId,
                         xOffset: xOffset,
                         yOffset: yOffset,
                         timeStart: timeStart,
                         timeEnd: timeEnd
                     })
                 });

                 const result = await response.json();

                 if (result.success) {
                     const texts = languageTexts[currentLanguage];
                     alert(texts.calibrationSaved || '校准已保存');
                     
                     // 退出编辑模式
                     exitEditMode();
                     
                     // 重新生成可视化（使用保存的校准）
                     updateVisualization();
                 } else {
                     const texts = languageTexts[currentLanguage];
                     alert(texts.calibrationError || '校准保存失败: ' + (result.error || '未知错误'));
                 }

             } catch (error) {
                 console.error('保存校准失败:', error);
                 const texts = languageTexts[currentLanguage];
                 alert(texts.calibrationError || '校准保存失败: ' + error.message);
             }
         }

         // 初始化校准控制监听器
         function setupCalibrationListeners() {
             // 偏移量滑块监听
            const xOffset = document.getElementById('xOffset');
            const yOffset = document.getElementById('yOffset');
            
            if (xOffset && yOffset) {
                xOffset.addEventListener('input', updateOffsetValues);
                yOffset.addEventListener('input', updateOffsetValues);
                console.log('✅ 校准监听器设置完成');
            } else {
                console.warn('⚠️ 校准控制元素不存在，跳过设置');
            }
        }

                 // 校准监听器将在模块加载完成后由moduleLoaded事件处理器调用

         // ======== 时间校准功能 ========

         // 初始化时间校准
         async function initializeTimeCalibration() {
             try {
                 // 获取当前数据的时间信息
                 const response = await fetch(`/api/time-info/${currentVisualization.groupType}/${currentVisualization.dataId}`);
                 const timeInfo = await response.json();
                 
                 if (timeInfo.success) {
                     dataTimeInfo = timeInfo.data;
                     updateTimeDisplay();
                     console.log('时间信息已加载:', dataTimeInfo);
                 } else {
                     console.error('获取时间信息失败:', timeInfo.error);
                     // 使用默认值
                     dataTimeInfo = { totalDuration: 10000, totalPoints: 100, minTime: 0, maxTime: 10000 };
                     updateTimeDisplay();
                 }
             } catch (error) {
                 console.error('获取时间信息出错:', error);
                 // 使用默认值
                 dataTimeInfo = { totalDuration: 10000, totalPoints: 100, minTime: 0, maxTime: 10000 };
                 updateTimeDisplay();
             }
         }

         // 更新时间显示
         function updateTimeDisplay() {
             const totalDurationSec = (dataTimeInfo.totalDuration / 1000).toFixed(1);
             document.getElementById('totalDuration').textContent = `${totalDurationSec}s`;
             document.getElementById('totalDataPoints').textContent = dataTimeInfo.totalPoints;
             
             updateTimeRangeDisplay();
         }

         // 更新时间范围显示
         function updateTimeRangeDisplay() {
             const startPercent = currentTimeRange.start;
             const endPercent = currentTimeRange.end;
             
             const startMs = dataTimeInfo.minTime + (dataTimeInfo.totalDuration * startPercent / 100);
             const endMs = dataTimeInfo.minTime + (dataTimeInfo.totalDuration * endPercent / 100);
             const selectedDuration = endMs - startMs;
             
             const startSec = (startMs / 1000).toFixed(1);
             const endSec = (endMs / 1000).toFixed(1);
             const selectedSec = (selectedDuration / 1000).toFixed(1);
             
             document.getElementById('startTimeValue').textContent = `${startSec}s`;
             document.getElementById('endTimeValue').textContent = `${endSec}s`;
             document.getElementById('selectedRange').textContent = `${selectedSec}s (${endPercent - startPercent}%)`;
         }

         // 更新时间范围
         function updateTimeRange() {
             const startSlider = document.getElementById('startTime');
             const endSlider = document.getElementById('endTime');
             
             let startValue = parseInt(startSlider.value);
             let endValue = parseInt(endSlider.value);
             
             // 确保起始时间不超过结束时间
             if (startValue >= endValue) {
                 if (startSlider === document.activeElement) {
                     // 如果用户正在调整起始时间，调整结束时间
                     endValue = Math.min(startValue + 5, 100);
                     endSlider.value = endValue;
                 } else {
                     // 如果用户正在调整结束时间，调整起始时间
                     startValue = Math.max(endValue - 5, 0);
                     startSlider.value = startValue;
                 }
             }
             
             currentTimeRange.start = startValue;
             currentTimeRange.end = endValue;
             
             updateTimeRangeDisplay();
             
             // 如果有当前可视化数据，自动预览
             if (currentVisualization && isEditMode) {
                 previewCalibration();
             }
         }

         // 应用时间预设
         function applyTimePreset(startPercent, endPercent) {
             // 参数验证
             if (startPercent < 0 || endPercent > 100 || startPercent >= endPercent) {
                 console.error('时间预设参数无效:', startPercent, endPercent);
                 return;
             }
             
             currentTimeRange.start = startPercent;
             currentTimeRange.end = endPercent;
             
             document.getElementById('startTime').value = startPercent;
             document.getElementById('endTime').value = endPercent;
             
             updateTimeRangeDisplay();
             
             // 自动预览
             if (currentVisualization && isEditMode) {
                 previewCalibration();
             }
         }

         // 修改原有的更新校准预览函数，包含时间参数
         function updateCalibrationPreview() {
             updateOffsetValues();
             
             // 如果有当前可视化数据，自动预览
             if (currentVisualization) {
                 previewCalibration();
             }
         }

        // 全局变量
        let currentSelectedItem = null;
        let currentGroupData = {};
        let currentEditingDataId = null;
        let currentGroupMMSE = {}; // 添加MMSE分数缓存

        // 页面加载完成后初始化
        $(document).ready(function() {
            updateLanguage();
            loadGroups();
        });

        // 语言切换相关的更新函数
        function updateLanguage() {
            const lang = localStorage.getItem('language') || 'zh';
            
            // 更新页面所有文本
            $('.nav-link[data-key]').each(function() {
                const key = $(this).data('key');
                $(this).text(languageTexts[lang][key]);
            });
            
            // 更新其他有data-key属性的元素
            $('[data-key]').each(function() {
                const key = $(this).data('key');
                if (languageTexts[lang][key]) {
                    $(this).text(languageTexts[lang][key]);
                }
            });
            
            // 更新页面标题
            document.title = languageTexts[lang]['pageTitle'];
            
            // 更新当前语言标识
            $('.language-toggle .btn').removeClass('active');
            $(`.language-toggle .btn[onclick="setLanguage('${lang}')"]`).addClass('active');
        }



        // 加载组MMSE分数
        async function loadGroupMMSEScores(groupType) {
            try {
                const response = await fetch(`/api/mmse-scores/${groupType}`);
                const data = await response.json();

                if (data.success) {
                    // 将扁平的数组数据重组为按subject_id索引的对象
                    const organizedData = {};

                    data.data.forEach(item => {
                        const subjectId = item.subject_id;
                        const match = subjectId.match(/(\d+)/);
                        if (!match) return;

                        const subjectNum = parseInt(match[1]);

                        // 初始化subject对象
                        if (!organizedData[subjectNum]) {
                            organizedData[subjectNum] = {
                                subject_id: subjectId,
                                total_score: 0,
                                details: {}
                            };
                        }

                        // 根据task_id存储详细信息
                        const taskId = item.task_id.toLowerCase();
                        organizedData[subjectNum].details[`${taskId}_data`] = item;

                        // 将subQuestions映射到旧的结构
                        if (item.subQuestions) {
                            if (taskId === 'q1') {
                                organizedData[subjectNum].details.q1_orientation_time = item.subQuestions;
                            } else if (taskId === 'q2') {
                                organizedData[subjectNum].details.q2_orientation_place = item.subQuestions;
                            } else if (taskId === 'q3') {
                                organizedData[subjectNum].details.q3_immediate_memory = item.mmse_score;
                            } else if (taskId === 'q4') {
                                organizedData[subjectNum].details.q4_calculation = item.subQuestions;
                            } else if (taskId === 'q5') {
                                organizedData[subjectNum].details.q5_delayed_recall = item.subQuestions;
                            }
                        }

                        // 累加总分
                        organizedData[subjectNum].total_score += item.mmse_score;
                    });

                    currentGroupMMSE[groupType] = organizedData;
                    console.log(`✅ 加载了${groupType}组的MMSE分数:`, data.data);
                    // 重新渲染数据列表以显示MMSE信息
                    if (currentGroupData[groupType]) {
                        displayGroupData(groupType, currentGroupData[groupType]);
                    }
                } else {
                    console.warn(`⚠️  ${groupType}组MMSE分数加载失败:`, data.error);
                    currentGroupMMSE[groupType] = {};
                }
            } catch (error) {
                console.warn(`❌ ${groupType}组MMSE分数请求失败:`, error);
                currentGroupMMSE[groupType] = {};
            }
        }

        // 获取VR-MMSE评估等级的CSS类
        function getMMSEAssessmentClass(score) {
            if (score >= 20) return 'badge-success';
            if (score >= 19) return 'badge-info';
            if (score >= 16) return 'badge-warning';
            if (score >= 11) return 'badge-danger';
            return 'badge-dark';
        }

        // 获取VR-MMSE评估等级文本
        function getMMSEAssessmentText(score) {
            const lang = localStorage.getItem('language') || 'zh';
            if (lang === 'zh') {
                if (score >= 20) return '正常';
                if (score >= 19) return '正常范围';
                if (score >= 16) return '轻度认知障碍';
                if (score >= 11) return '阿尔兹海默症';
                return '重度认知障碍';
            } else {
                if (score >= 20) return 'Normal';
                if (score >= 19) return 'Normal Range';
                if (score >= 16) return 'Mild Cognitive Impairment';
                if (score >= 11) return 'Alzheimer\'s Disease';
                return 'Severe Cognitive Impairment';
            }
        }
        // 显示VR-MMSE详细信息
        function displayMMSEDetails(mmseData) {
            const score = mmseData.total_score;
            const assessment = mmseData.assessment;
            const texts = languageTexts[currentLanguage];
            const details = mmseData.details;
            
            // 计算各项分数
            const q1Score = details.q1_orientation_time ? Object.values(details.q1_orientation_time).reduce((a, b) => a + b, 0) : 0;
            const q2Score = details.q2_orientation_place ? Object.values(details.q2_orientation_place).reduce((a, b) => a + b, 0) : 0;
            const q3Score = details.q3_immediate_memory || 0;
            const q4Score = details.q4_calculation ? Object.values(details.q4_calculation).reduce((a, b) => a + b, 0) : 0;
            const q5Score = details.q5_delayed_recall ? Object.values(details.q5_delayed_recall).reduce((a, b) => a + b, 0) : 0;
            
            const mmseHtml = `
                <div class="mmse-panel mt-3">
                    <h6 class="text-primary mb-3">
                        <i class="fas fa-brain"></i> ${texts.cognitiveAssessment} (VR-MMSE)
                    </h6>
                    <div class="mmse-score-display mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="font-weight-bold">${texts.totalScore}:</span>
                            <span class="badge ${getMMSEAssessmentClass(score)} badge-lg">${score}/21</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mt-2">
                            <span>${texts.assessmentLevel}:</span>
                            <span class="text-white">${getMMSEAssessmentText(score)}</span>
                        </div>
                    </div>
                    <div class="mmse-task-details">
                        <h6 class="text-white mb-2">${currentLanguage === 'zh' ? '当前任务分数：' : 'Current Task Scores:'}</h6>
                        <div class="mmse-task-scores">
                            <!-- Q1: 时间定向 -->
                            <div class="mb-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <strong class="text-info">Q1. ${texts.q1OrientationTime} (${q1Score}/5)</strong>
                                </div>
                                                                 <small class="text-white ml-3">
                                     ${texts.year}: ${details.q1_orientation_time?.年份 || 0}/1, 
                                     ${texts.season}: ${details.q1_orientation_time?.季节 || 0}/1, 
                                     ${texts.month}: ${details.q1_orientation_time?.月份 || 0}/1, 
                                     ${texts.weekday}: ${details.q1_orientation_time?.星期 || 0}/2
                                 </small>
                            </div>
                            
                            <!-- Q2: 地点定向 -->
                            <div class="mb-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <strong class="text-info">Q2. ${texts.q2OrientationPlace} (${q2Score}/5)</strong>
                                </div>
                                                                 <small class="text-white ml-3">
                                     ${texts.province}: ${details.q2_orientation_place?.省市区 || 0}/2, 
                                     ${texts.street}: ${details.q2_orientation_place?.街道 || 0}/1, 
                                     ${texts.building}: ${details.q2_orientation_place?.建筑 || 0}/1, 
                                     ${texts.floor}: ${details.q2_orientation_place?.楼层 || 0}/1
                                 </small>
                            </div>
                            
                            <!-- Q3: 即刻记忆 -->
                            <div class="mb-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <strong class="text-info">Q3. ${texts.q3ImmediateMemory} (${q3Score}/3)</strong>
                                </div>
                            </div>
                            
                            <!-- Q4: 计算能力 -->
                            <div class="mb-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <strong class="text-info">Q4. ${texts.q4Calculation} (${q4Score}/5)</strong>
                                </div>
                                                                 <small class="text-white ml-3">
                                     100-7: ${details.q4_calculation?.['100-7'] || 0}/1, 
                                     93-7: ${details.q4_calculation?.['93-7'] || 0}/1, 
                                     86-7: ${details.q4_calculation?.['86-7'] || 0}/1, 
                                     79-7: ${details.q4_calculation?.['79-7'] || 0}/1, 
                                     72-7: ${details.q4_calculation?.['72-7'] || 0}/1
                                 </small>
                            </div>
                            
                            <!-- Q5: 延迟回忆 -->
                            <div class="mb-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <strong class="text-info">Q5. ${texts.q5DelayedRecall} (${q5Score}/3)</strong>
                                </div>
                                                                 <small class="text-white ml-3">
                                     ${texts.word1}: ${details.q5_delayed_recall?.词1 || 0}/1, 
                                     ${texts.word2}: ${details.q5_delayed_recall?.词2 || 0}/1, 
                                     ${texts.word3}: ${details.q5_delayed_recall?.词3 || 0}/1
                                 </small>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return mmseHtml;
        }
        
        // ============ 事件分析相关函数 ============
        
        // 事件分析相关变量
        let currentEventPage = 1;
        let currentEventDataType = 'events';
        let eventAnalysisData = [];

        // 调试页面布局结构
        function debugPageLayout() {
            console.log('=== 页面布局结构全面调试 ===');
            
            // 主要容器
            const mainContent = document.querySelector('.main-content');
            const contentWrapper = document.querySelector('.content-wrapper');
            
            console.log('main-content:', mainContent ? {
                offsetTop: mainContent.offsetTop,
                offsetHeight: mainContent.offsetHeight,
                className: mainContent.className
            } : 'NOT FOUND');
            
            console.log('content-wrapper:', contentWrapper ? {
                offsetTop: contentWrapper.offsetTop,
                offsetHeight: contentWrapper.offsetHeight,
                className: contentWrapper.className
            } : 'NOT FOUND');
            
            // 所有视图
            const allViews = ['visualizationView', 'newFeatureView', 'rqaAnalysisView', 'eventAnalysisView'];
            allViews.forEach(viewId => {
                const element = document.getElementById(viewId);
                if (element) {
                    console.log(`${viewId}:`, {
                        offsetTop: element.offsetTop,
                        offsetHeight: element.offsetHeight,
                        display: window.getComputedStyle(element).display,
                        position: window.getComputedStyle(element).position,
                        parentClassName: element.parentElement ? element.parentElement.className : 'NO PARENT',
                        innerHTML_length: element.innerHTML.length
                    });
                    
                    // 如果是数据导入视图，额外检查内容
                    if (viewId === 'newFeatureView') {
                        console.log('数据导入视图内容预览:', element.innerHTML.substring(0, 300));
                    }
                } else {
                    console.log(`${viewId}: NOT FOUND`);
                }
            });
            
            console.log('=== 布局结构调试结束 ===');
        }
        
        // 初始化事件分析界面
        function initEventAnalysis() {
            console.log('初始化事件分析界面');
            loadEventAnalysisSummary();
            updateEventAnalysisData();
        }

        // 加载事件分析摘要
        async function loadEventAnalysisSummary() {
            try {
                // 调试：检查容器元素是否存在
                const containerEl = document.getElementById('eventStatsContainer');
                console.log('eventStatsContainer元素:', containerEl);
                
                if (!containerEl) {
                    console.error('eventStatsContainer元素不存在');
                    return;
                }
                
                const response = await fetch('/api/event-analysis/summary');
                const result = await response.json();
                
                if (result.success) {
                    const summary = result.summary;
                    let summaryHtml = '<div class="summary-grid">';
                    
                    if (summary.stats.total_events) {
                        summaryHtml += `
                            <div class="summary-item">
                                <span class="summary-label">总事件数:</span>
                                <span class="summary-value">${summary.stats.total_events}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Fixation:</span>
                                <span class="summary-value">${summary.stats.total_fixations}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Saccade:</span>
                                <span class="summary-value">${summary.stats.total_saccades}</span>
                            </div>
                        `;
                    }
                    
                    if (summary.stats.total_roi_records) {
                        summaryHtml += `
                            <div class="summary-item">
                                <span class="summary-label">ROI统计记录:</span>
                                <span class="summary-value">${summary.stats.total_roi_records}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">唯一ROI:</span>
                                <span class="summary-value">${summary.stats.unique_rois}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">总注视时间:</span>
                                <span class="summary-value">${summary.stats.total_fixation_time.toFixed(2)}s</span>
                            </div>
                        `;
                    }
                    
                    summaryHtml += '</div>';
                    
                    // 各组分布
                    if (summary.stats.group_distribution) {
                        summaryHtml += '<h6>组别分布:</h6><div class="group-distribution">';
                        for (const [group, count] of Object.entries(summary.stats.group_distribution)) {
                            summaryHtml += `<span class="group-stat">${group}: ${count}</span>`;
                        }
                        summaryHtml += '</div>';
                    }
                    
                    containerEl.innerHTML = summaryHtml;
                } else {
                    containerEl.innerHTML = 
                        `<span class="text-danger">加载摘要失败: ${result.error}</span>`;
                }
            } catch (error) {
                console.error('加载事件分析摘要失败:', error);
                const containerEl2 = document.getElementById('eventStatsContainer');
                if (containerEl2) {
                    containerEl2.innerHTML = 
                        `<span class="text-danger">网络错误: ${error.message}</span>`;
                }
            }
        }

        // 更新事件分析数据
        async function updateEventAnalysisData() {
            // 调试：检查DOM元素是否存在
            const dataTypeEl = document.getElementById('eventDataTypeSelect');
            const groupEl = document.getElementById('eventGroupSelect');
            const eventTypeEl = document.getElementById('eventTypeSelect');
            const pageSizeEl = document.getElementById('eventPageSizeSelect');
            
            console.log('DOM元素检查:', {
                dataTypeEl: dataTypeEl,
                groupEl: groupEl,
                eventTypeEl: eventTypeEl,
                pageSizeEl: pageSizeEl
            });
            
            if (!dataTypeEl || !groupEl || !eventTypeEl || !pageSizeEl) {
                console.error('某些DOM元素不存在，停止执行');
                return;
            }
            
            const dataType = dataTypeEl.value;
            const group = groupEl.value;
            const eventType = eventTypeEl.value;
            const pageSize = pageSizeEl.value;
            
            currentEventDataType = dataType;
            
            // 隐藏/显示事件类型筛选
            const eventTypeContainer = document.getElementById('eventTypeGroup');
            if (dataType === 'events') {
                eventTypeContainer.style.display = 'block';
            } else {
                eventTypeContainer.style.display = 'none';
            }
            
            try {
                const params = new URLSearchParams({
                    type: dataType,
                    group: group,
                    page: currentEventPage,
                    page_size: pageSize
                });
                
                if (dataType === 'events' && eventType !== 'all') {
                    params.append('event_type', eventType);
                }
                
                const response = await fetch(`/api/event-analysis/data?${params}`);
                const result = await response.json();
                
                if (result.success) {
                    eventAnalysisData = result.data;
                    displayEventAnalysisData(result);
                    updateEventPagination(result.pagination);
                    displayEventStats(result.stats);
                } else {
                    alert('加载数据失败: ' + result.error);
                }
            } catch (error) {
                console.error('加载事件分析数据失败:', error);
                alert('网络错误: ' + error.message);
            }
        }

        // 显示事件分析数据
        function displayEventAnalysisData(result) {
            const tableHeader = document.getElementById('eventTableHeader');
            const tableBody = document.getElementById('eventTableBody');
            
            if (result.data.length === 0) {
                tableHeader.innerHTML = '<th colspan="100%">暂无数据</th>';
                tableBody.innerHTML = '<tr><td colspan="100%" class="text-center">暂无数据</td></tr>';
                return;
            }
            
            // 生成表头
            const columns = Object.keys(result.data[0]);
            tableHeader.innerHTML = columns.map(col => `<th>${col}</th>`).join('');
            
            // 生成表格数据
            tableBody.innerHTML = result.data.map(row => {
                return '<tr>' + columns.map(col => {
                    let value = row[col];
                    if (value === null || value === undefined) {
                        value = '-';
                    } else if (typeof value === 'number' && value % 1 !== 0) {
                        value = value.toFixed(3);
                    }
                    return `<td>${value}</td>`;
                }).join('') + '</tr>';
            }).join('');
        }

        // 更新事件分页
        function updateEventPagination(pagination) {
            const paginationEl = document.getElementById('eventPagination');
            let paginationHtml = '';
            
            // 上一页
            if (pagination.page > 1) {
                paginationHtml += `<li class="page-item">
                    <a class="page-link" href="#" onclick="goToEventPage(${pagination.page - 1})">上一页</a>
                </li>`;
            }
            
            // 页码
            const startPage = Math.max(1, pagination.page - 2);
            const endPage = Math.min(pagination.total_pages, pagination.page + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const active = i === pagination.page ? 'active' : '';
                paginationHtml += `<li class="page-item ${active}">
                    <a class="page-link" href="#" onclick="goToEventPage(${i})">${i}</a>
                </li>`;
            }
            
            // 下一页
            if (pagination.page < pagination.total_pages) {
                paginationHtml += `<li class="page-item">
                    <a class="page-link" href="#" onclick="goToEventPage(${pagination.page + 1})">下一页</a>
                </li>`;
            }
            
            paginationEl.innerHTML = paginationHtml;
        }

        // 显示事件统计
        function displayEventStats(stats) {
            const statsEl = document.getElementById('eventStatsContainer');
            let statsHtml = '';
            
            if (currentEventDataType === 'events') {
                if (stats.event_counts) {
                    statsHtml += '<strong>事件统计:</strong> ';
                    for (const [type, count] of Object.entries(stats.event_counts)) {
                        statsHtml += `${type}: ${count} `;
                    }
                    statsHtml += '<br>';
                }
                
                if (stats.top_rois) {
                    statsHtml += '<strong>热门ROI:</strong> ';
                    const topRois = Object.entries(stats.top_rois).slice(0, 5);
                    statsHtml += topRois.map(([roi, count]) => `${roi}(${count})`).join(', ');
                }
            } else {
                if (stats.unique_rois) {
                    statsHtml += `<strong>唯一ROI数:</strong> ${stats.unique_rois} `;
                }
                if (stats.total_fix_time) {
                    statsHtml += `<strong>总注视时间:</strong> ${stats.total_fix_time.toFixed(2)}s `;
                }
                if (stats.avg_fix_time) {
                    statsHtml += `<strong>平均注视时间:</strong> ${stats.avg_fix_time.toFixed(3)}s`;
                }
            }
            
            if (statsHtml) {
                statsEl.innerHTML = statsHtml;
                statsEl.style.display = 'block';
            } else {
                statsEl.style.display = 'none';
            }
        }

        // 跳转到指定页面
        function goToEventPage(page) {
            currentEventPage = page;
            updateEventAnalysisData();
        }

        // 重新生成事件数据
        async function regenerateEventData() {
            if (!confirm('确定要重新生成事件分析数据吗？这可能需要几分钟时间。')) {
                return;
            }
            
            try {
                const response = await fetch('/api/event-analysis/regenerate', {
                    method: 'POST'
                });
                const result = await response.json();
                
                if (result.success) {
                    alert('数据重新生成完成！');
                    loadEventAnalysisSummary();
                    updateEventAnalysisData();
                } else {
                    alert('数据生成失败: ' + result.error);
                }
            } catch (error) {
                console.error('重新生成数据失败:', error);
                alert('网络错误: ' + error.message);
            }
        }

        // 导出事件数据
        function exportEventData() {
            // 创建CSV下载链接
            if (eventAnalysisData.length === 0) {
                alert('没有数据可导出');
                return;
            }
            
            const csvContent = convertToCSV(eventAnalysisData);
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `event_analysis_${currentEventDataType}_${Date.now()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 转换为CSV格式
        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvRows = [headers.join(',')];
            
            for (const row of data) {
                const values = headers.map(header => {
                    const value = row[header];
                    return value === null || value === undefined ? '' : `"${value}"`;
                });
                csvRows.push(values.join(','));
            }
            
            return csvRows.join('\n');
        }

        // ============ RQA分析相关函数 ============
        
        // 初始化RQA分析界面
        function initializeRQAInterface() {
            console.log('初始化RQA分析界面');
            
            // 初始化参数滑块事件
            initializeRQAParameters();
            
            // 加载数据选项
            loadRQADataOptions();
            
            // 设置事件监听器
            setupRQAEventListeners();
        }
        
        // 初始化RQA参数控制
        function initializeRQAParameters() {
            // 嵌入维度
            const embeddingDim = document.getElementById('embeddingDim');
            const embeddingDimValue = document.getElementById('embeddingDimValue');
            if (embeddingDim && embeddingDimValue) {
                embeddingDim.addEventListener('input', function() {
                    embeddingDimValue.textContent = this.value;
                });
            }
            
            // 时间延迟
            const timeDelay = document.getElementById('timeDelay');
            const timeDelayValue = document.getElementById('timeDelayValue');
            if (timeDelay && timeDelayValue) {
                timeDelay.addEventListener('input', function() {
                    timeDelayValue.textContent = this.value;
                });
            }
            
            // 递归阈值
            const recurrenceThreshold = document.getElementById('recurrenceThreshold');
            const recurrenceThresholdValue = document.getElementById('recurrenceThresholdValue');
            if (recurrenceThreshold && recurrenceThresholdValue) {
                recurrenceThreshold.addEventListener('input', function() {
                    recurrenceThresholdValue.textContent = parseFloat(this.value).toFixed(2);
                });
            }
            
            // 最小线长
            const minLineLength = document.getElementById('minLineLength');
            const minLineLengthValue = document.getElementById('minLineLengthValue');
            if (minLineLength && minLineLengthValue) {
                minLineLength.addEventListener('input', function() {
                    minLineLengthValue.textContent = this.value;
                });
            }
        }
        
        // 加载RQA数据选项
        async function loadRQADataOptions() {
            try {
                // 如果allData为空，先加载数据
                if (Object.keys(allData).length === 0) {
                    await loadGroups();
                }
                
                // 设置组别和任务变化的监听器
                const groupSelect = document.getElementById('rqaGroupSelect');
                const taskSelect = document.getElementById('rqaTaskSelect');
                
                if (groupSelect && taskSelect) {
                    groupSelect.addEventListener('change', updateRQADataList);
                    taskSelect.addEventListener('change', updateRQADataList);
                }
                
                // 初始加载数据列表
                updateRQADataList();
                
            } catch (error) {
                console.error('加载RQA数据选项失败:', error);
            }
        }
        
        // 更新RQA数据列表
        function updateRQADataList() {
            const groupSelect = document.getElementById('rqaGroupSelect');
            const taskSelect = document.getElementById('rqaTaskSelect');
            const dataList = document.getElementById('rqaDataList');
            
            if (!groupSelect || !taskSelect || !dataList) return;
            
            const selectedGroup = groupSelect.value;
            const selectedTask = taskSelect.value;
            
            // 清空数据列表
            dataList.innerHTML = '<div class="text-muted">请选择具体数据</div>';
            
            // 根据选择的组别和任务筛选数据
            const filteredData = [];
            
            for (const [groupType, groupData] of Object.entries(allData)) {
                // 组别筛选
                if (selectedGroup !== 'all' && groupType !== selectedGroup) continue;
                
                for (const item of groupData) {
                    // 任务筛选
                    if (selectedTask !== 'all' && item.question_num.toString() !== selectedTask) continue;
                    
                    filteredData.push({
                        value: `${groupType}_${item.data_id}`,
                        text: `${getGroupName(groupType)} - ${item.display_name} (Q${item.question_num})`,
                        groupType: groupType,
                        dataId: item.data_id
                    });
                }
            }
            
            // 如果有数据，创建复选框列表
            if (filteredData.length > 0) {
                dataList.innerHTML = '';
                
                filteredData.forEach((item, index) => {
                    const checkDiv = document.createElement('div');
                    checkDiv.className = 'form-check';
                    
                    const checkbox = document.createElement('input');
                    checkbox.className = 'form-check-input rqa-data-checkbox';
                    checkbox.type = 'checkbox';
                    checkbox.id = `rqaData_${index}`;
                    checkbox.value = item.value;
                    checkbox.addEventListener('change', updateRunButtonState);
                    
                    const label = document.createElement('label');
                    label.className = 'form-check-label';
                    label.htmlFor = `rqaData_${index}`;
                    label.textContent = item.text;
                    
                    checkDiv.appendChild(checkbox);
                    checkDiv.appendChild(label);
                    dataList.appendChild(checkDiv);
                });
                
                // 设置全选按钮事件
                setupSelectAllHandler();
            }
            
            // 更新运行按钮状态
            updateRunButtonState();
        }
        
        // 设置全选按钮处理器
        function setupSelectAllHandler() {
            const selectAllCheckbox = document.getElementById('rqaSelectAll');
            const dataCheckboxes = document.querySelectorAll('.rqa-data-checkbox');
            
            if (selectAllCheckbox && dataCheckboxes.length > 0) {
                // 移除之前的事件监听器
                selectAllCheckbox.removeEventListener('change', handleSelectAll);
                
                // 添加新的事件监听器
                selectAllCheckbox.addEventListener('change', handleSelectAll);
                
                // 初始化全选状态
                updateSelectAllState();
            }
        }
        
        // 处理全选/取消全选
        function handleSelectAll() {
            const selectAllCheckbox = document.getElementById('rqaSelectAll');
            const dataCheckboxes = document.querySelectorAll('.rqa-data-checkbox');
            
            dataCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            updateRunButtonState();
        }
        
        // 更新全选状态
        function updateSelectAllState() {
            const selectAllCheckbox = document.getElementById('rqaSelectAll');
            const dataCheckboxes = document.querySelectorAll('.rqa-data-checkbox');
            const checkedBoxes = document.querySelectorAll('.rqa-data-checkbox:checked');
            
            if (dataCheckboxes.length === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (checkedBoxes.length === dataCheckboxes.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else if (checkedBoxes.length > 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            }
        }
        
        // 设置RQA事件监听器
        function setupRQAEventListeners() {
            // 数据选择变化时，也要更新全选状态
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('rqa-data-checkbox')) {
                    updateSelectAllState();
                    updateRunButtonState();
                }
            });
        }
        
        // 更新运行按钮状态
        function updateRunButtonState() {
            const checkedBoxes = document.querySelectorAll('.rqa-data-checkbox:checked');
            const runBtn = document.getElementById('runRQABtn');
            
            if (runBtn) {
                runBtn.disabled = checkedBoxes.length === 0;
            }
        }
        
        // ======================== 新的RQA批量渲染功能 ========================
        
        // 初始化RQA滑动条事件监听器
        function initRQASliders() {
            // 嵌入维度滑动条
            const embeddingDimSlider = document.getElementById('rqaEmbeddingDim');
            const embeddingDimValue = document.getElementById('rqaEmbeddingDimValue');
            if (embeddingDimSlider && embeddingDimValue) {
                embeddingDimSlider.addEventListener('input', function() {
                    embeddingDimValue.textContent = this.value;
                });
            }
            
            // 时间延迟滑动条
            const timeDelaySlider = document.getElementById('rqaTimeDelay');
            const timeDelayValue = document.getElementById('rqaTimeDelayValue');
            if (timeDelaySlider && timeDelayValue) {
                timeDelaySlider.addEventListener('input', function() {
                    timeDelayValue.textContent = this.value;
                });
            }
            
            // 递归阈值滑动条
            const thresholdSlider = document.getElementById('rqaThreshold');
            const thresholdValue = document.getElementById('rqaThresholdValue');
            if (thresholdSlider && thresholdValue) {
                thresholdSlider.addEventListener('input', function() {
                    thresholdValue.textContent = this.value;
                });
            }
            
            // 最小线长滑动条
            const minLineLengthSlider = document.getElementById('rqaMinLineLength');
            const minLineLengthValue = document.getElementById('rqaMinLineLengthValue');
            if (minLineLengthSlider && minLineLengthValue) {
                minLineLengthSlider.addEventListener('input', function() {
                    minLineLengthValue.textContent = this.value;
                });
            }
        }
        // 开始RQA渲染
        async function startRQARender() {
            const texts = languageTexts[currentLanguage];
            const startBtn = document.getElementById('startRQARender');
            const checkBtn = document.getElementById('checkRenderStatus');
            const progressDiv = document.getElementById('renderProgress');
            const progressBar = progressDiv.querySelector('.progress-bar');
            const statusText = document.getElementById('renderStatusText');
            
            try {
                // 禁用按钮
                startBtn.disabled = true;
                checkBtn.disabled = true;
                startBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 渲染中...';
                
                // 显示进度
                progressDiv.style.display = 'block';
                progressBar.style.width = '0%';
                statusText.textContent = '准备开始渲染...';
                
                // 获取渲染参数
                const params = {
                    analysis_mode: document.getElementById('rqaAnalysisMode').value,
                    distance_metric: document.getElementById('rqaDistanceMetric').value,
                    embedding_dimension: parseInt(document.getElementById('rqaEmbeddingDim').value),
                    time_delay: parseInt(document.getElementById('rqaTimeDelay').value),
                    recurrence_threshold: parseFloat(document.getElementById('rqaThreshold').value),
                    min_line_length: parseInt(document.getElementById('rqaMinLineLength').value),
                    color_theme: document.getElementById('rqaColorTheme').value
                };
                
                // 发送渲染请求
                const response = await fetch('/api/rqa-batch-render', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(params)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // 更新进度为完成
                    progressBar.style.width = '100%';
                    statusText.textContent = `渲染完成！处理了 ${result.data.processed_files}/${result.data.total_files} 个文件`;
                    
                    // 显示成功消息
                    showAlert(result.message, 'success');
                    
                    // 自动更新显示
                    setTimeout(() => {
                        updateRQADisplay();
                    }, 1000);
                    
                } else {
                    throw new Error(result.message || '渲染失败');
                }
                
            } catch (error) {
                console.error('RQA渲染失败:', error);
                showAlert(`渲染失败: ${error.message}`, 'danger');
                statusText.textContent = '渲染失败';
                
            } finally {
                // 恢复按钮状态
                startBtn.disabled = false;
                checkBtn.disabled = false;
                startBtn.innerHTML = '<i class="fas fa-magic"></i> <span data-lang-key="startRender">开始渲染</span>';
                
                // 隐藏进度条（延迟3秒）
                setTimeout(() => {
                    progressDiv.style.display = 'none';
                }, 3000);
            }
        }
        
        // 检查渲染状态
        async function checkRenderStatus() {
            try {
                const response = await fetch('/api/rqa-render-status');
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    
                    if (data.rendered) {
                        const message = `已渲染 ${data.total_rendered} 个文件\n` +
                                      `渲染时间: ${new Date(data.render_time).toLocaleString()}\n` +
                                      `参数: ${JSON.stringify(data.params, null, 2)}`;
                        
                        showAlert(message, 'info');
                        
                        // 更新显示
                        updateRQADisplay();
                    } else {
                        showAlert(data.message, 'warning');
                    }
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                console.error('检查渲染状态失败:', error);
                showAlert(`检查状态失败: ${error.message}`, 'danger');
            }
        }
        
        // 更新RQA显示
        async function updateRQADisplay() {
            const container = document.getElementById('rqaImagesContainer');
            
            try {
                // 获取筛选参数
                const imageType = document.getElementById('rqaFilterImageType').value;
                const selectedGroup = document.getElementById('rqaFilterGroup').value;
                const selectedQuestion = document.getElementById('rqaFilterQuestion').value;
                const paramSet = document.getElementById('rqaFilterParamSet').value;
                const analysisMode = document.getElementById('rqaFilterAnalysisMode').value;
                const distanceMetric = document.getElementById('rqaFilterDistanceMetric').value;
                const colorTheme = document.getElementById('rqaFilterColorTheme').value;
                
                console.log('筛选参数:', {
                    imageType, selectedGroup, selectedQuestion, paramSet,
                    analysisMode, distanceMetric, colorTheme
                });
                
                // 构建API查询参数
                const params = new URLSearchParams();
                if (selectedGroup !== 'all') params.append('group', selectedGroup);
                if (selectedQuestion !== 'all') params.append('question', selectedQuestion);
                if (paramSet !== 'all') params.append('param_signature', paramSet);
                
                // 获取渲染结果
                const response = await fetch(`/api/rqa-rendered-results?${params}`);
                const result = await response.json();
                
                console.log('API返回的数据:', result);
                
                if (result.success) {
                    let filteredResults = result.data.results || [];
                    
                    // 填充参数组合下拉框
                    updateParamSetOptions(result.data.param_combinations || []);
                    
                    // 应用前端筛选（针对细粒度参数）
                    filteredResults = filteredResults.filter(item => {
                        const renderParams = item.render_params || {};
                        
                        // 分析模式筛选
                        if (analysisMode !== 'all' && renderParams.analysis_mode !== analysisMode) {
                            return false;
                        }
                        
                        // 距离度量筛选
                        if (distanceMetric !== 'all' && renderParams.distance_metric !== distanceMetric) {
                            return false;
                        }
                        
                        // 颜色主题筛选
                        if (colorTheme !== 'all' && item.color_theme !== colorTheme) {
                            return false;
                        }
                        
                        return true;
                    });
                    
                    console.log('最终筛选后的结果:', filteredResults);
                    
                    // 更新显示信息
                    const infoElement = document.getElementById('rqaDisplayInfo');
                    if (infoElement) {
                        infoElement.textContent = `找到 ${filteredResults.length} 张图片`;
                    }
                    
                    if (filteredResults.length === 0) {
                        // 显示空状态
                        container.innerHTML = `
                            <div class="placeholder-content text-center py-5">
                                <i class="fas fa-images fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">暂无匹配的RQA图片</h5>
                                <p class="text-muted">请调整筛选条件或先运行批量渲染</p>
                            </div>
                        `;
                    } else {
                        // 按组别和问题组织数据，然后显示
                        const organizedData = organizeRQAResults(filteredResults);
                        displayRQAImages(organizedData, imageType);
                    }
                } else {
                    throw new Error(result.message || '获取数据失败');
                }
                
            } catch (error) {
                console.error('更新RQA显示失败:', error);
                container.innerHTML = `
                    <div class="placeholder-content text-center py-5">
                        <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                        <h5 class="text-warning">加载失败</h5>
                        <p class="text-muted">获取RQA图片失败: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // 更新参数组合选项
        function updateParamSetOptions(paramCombinations) {
            const select = document.getElementById('rqaFilterParamSet');
            
            // 保留"全部参数"选项
            const currentValue = select.value;
            select.innerHTML = '<option value="all">全部参数</option>';
            
            // 添加所有可用的参数组合
            paramCombinations.forEach(paramSig => {
                if (paramSig) {
                    // 解析参数签名生成友好的显示名称
                    const displayName = formatParamSignature(paramSig);
                    const option = document.createElement('option');
                    option.value = paramSig;
                    option.textContent = displayName;
                    select.appendChild(option);
                }
            });
            
            // 尝试保持之前的选择
            if (currentValue && Array.from(select.options).some(opt => opt.value === currentValue)) {
                select.value = currentValue;
            }
        }
        
        // 格式化参数签名为友好显示
        function formatParamSignature(paramSig) {
            // 从类似 "mode_1d_x_dist_1d_abs_m2_tau1_eps0.050_lmin2_color_green_gradient" 
            // 解析为友好格式
            try {
                const parts = paramSig.split('_');
                let formatted = '';
                
                for (let i = 0; i < parts.length; i += 2) {
                    const key = parts[i];
                    const value = parts[i + 1];
                    
                    switch (key) {
                        case 'mode':
                            const modeMap = {
                                '1d': '1D-X', 'amplitude': '1D-幅度', '2d': '2D-XY'
                            };
                            formatted += `${modeMap[value] || value} `;
                            break;
                        case 'dist':
                            formatted += `${value === '1d' ? '绝对差' : '欧几里得'} `;
                            break;
                        case 'color':
                            formatted += `${value === 'grayscale' ? '灰度' : '墨绿色'} `;
                            break;
                        case 'm':
                            formatted += `m=${value} `;
                            break;
                        default:
                            if (value) formatted += `${value} `;
                    }
                }
                
                return formatted.trim() || paramSig;
            } catch (e) {
                return paramSig;
            }
        }
        
        // 组织RQA结果为5列布局
        function organizeRQAResults(results) {
            const organized = {};
            
            // 按组别分组
            results.forEach(item => {
                const group = item.group;
                if (!organized[group]) {
                    organized[group] = {};
                }
                
                const question = item.question;
                if (!organized[group][question]) {
                    organized[group][question] = [];
                }
                
                organized[group][question].push(item);
            });
            
            return organized;
        }
        
        // 显示RQA图像 - 支持新的组织结构
        function displayRQAImages(organizedData, imageType = 'amplitude') {
            console.log('显示RQA图片:', organizedData, '图片类型:', imageType);
            const container = document.getElementById('rqaImagesContainer');
            
            if (!organizedData || Object.keys(organizedData).length === 0) {
                container.innerHTML = `
                    <div class="placeholder-content text-center py-5">
                        <i class="fas fa-images fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">暂无RQA图片</h5>
                        <p class="text-muted">请先运行批量渲染生成图片</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            // 按组别和问题显示，使用5列布局
            const groups = ['control', 'mci', 'ad'];
            
            groups.forEach(group => {
                if (!organizedData[group]) return;
                
                const groupName = group === 'control' ? '控制组' : 
                                group === 'mci' ? 'MCI组' : 'AD组';
                
                // 为每个组添加分组标题
                html += `
                    <div class="group-section">
                        <div class="group-title">${groupName}</div>
                `;
                
                // 为该组的所有问题创建行
                for (let q = 1; q <= 5; q++) {
                    if (!organizedData[group][q]) continue;
                    
                    const items = organizedData[group][q];
                    
                    html += `
                        <div class="rqa-row">
                            <div class="row-header">
                                <h6>Q${q}</h6>
                                <span class="item-count">${items.length}张图片</span>
                            </div>
                            <div class="images-grid">
                    `;
                    
                    // 显示该问题的所有图片（按行排列，每行5张）
                    for (let i = 0; i < items.length; i++) {
                        const item = items[i];
                        
                        // 根据图片类型选择路径
                        let imagePath, imageAlt;
                        if (imageType === 'trajectory') {
                            imagePath = item.trajectory_path;
                            imageAlt = `${item.data_id} 轨迹图`;
                        } else if (imageType === 'recurrence') {
                            imagePath = item.recurrence_path;
                            imageAlt = `${item.data_id} 递归图`;
                        } else {
                            imagePath = item.amplitude_path;
                            imageAlt = `${item.data_id} 幅度图`;
                        }
                        
                        html += `
                            <div class="image-item">
                                <div class="image-container" onclick="openImageModal('/api/rqa-image/${imagePath}', '${imageAlt}')">
                                    <img src="/api/rqa-image/${imagePath}" 
                                         alt="${imageAlt}" 
                                         class="rqa-image" 
                                         loading="lazy"
                                         onerror="this.parentElement.innerHTML='<div class=&quot;error-placeholder&quot;><i class=&quot;fas fa-exclamation-triangle&quot;></i><br>加载失败</div>'">
                                </div>
                                <div class="image-label">${item.data_id}</div>
                            </div>
                        `;
                    }
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
                
                html += `
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function switchImageType(dataId, type) {
            // 更新选项卡状态
            const container = document.getElementById('imageContent_' + dataId).parentElement;
            const tabs = container.querySelectorAll('.tab-btn');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // 激活当前选项卡
            const activeTab = Array.from(tabs).find(tab => tab.textContent.includes(
                type === 'amplitude' ? '幅度图' : 
                type === 'trajectory' ? '轨迹图' : '递归图'
            ));
            if (activeTab) activeTab.classList.add('active');
            
            // 更新图片
            const imageContent = document.getElementById('imageContent_' + dataId);
            const currentImg = imageContent.querySelector('img');
            
            if (currentImg) {
                // 构建新的图片路径
                let newSrc = currentImg.src;
                newSrc = newSrc.replace('_amplitude.png', `_${type}.png`);
                newSrc = newSrc.replace('_trajectory.png', `_${type}.png`);
                newSrc = newSrc.replace('_recurrence.png', `_${type}.png`);
                
                currentImg.src = newSrc;
                currentImg.alt = `${dataId} ${type}`;
            }
        }

        // 运行RQA分析（保持向后兼容）
        async function runRQAAnalysis() {
            const texts = languageTexts[currentLanguage];
            showAlert('请使用新的批量渲染功能', 'info');
            return;
        }

        // 获取RQA参数
        function getRQAParameters() {
            return {
                analysis_mode: document.getElementById('analysisMode').value,
                distance_metric: document.getElementById('distanceMetric').value,
                embedding_dimension: parseInt(document.getElementById('embeddingDim').value),
                time_delay: parseInt(document.getElementById('timeDelay').value),
                recurrence_threshold: parseFloat(document.getElementById('recurrenceThreshold').value),
                min_line_length: parseInt(document.getElementById('minLineLength').value)
            };
        }

        // 重置RQA参数
        function resetRQAParameters() {
            document.getElementById('analysisMode').value = '1d_x';
            document.getElementById('distanceMetric').value = '1d_abs';
            
            document.getElementById('embeddingDim').value = 2;
            document.getElementById('embeddingDimValue').textContent = '2';
            
            document.getElementById('timeDelay').value = 1;
            document.getElementById('timeDelayValue').textContent = '1';
            
            document.getElementById('recurrenceThreshold').value = 0.05;
            document.getElementById('recurrenceThresholdValue').textContent = '0.05';
            
            document.getElementById('minLineLength').value = 2;
            document.getElementById('minLineLengthValue').textContent = '2';
        }

        // 显示RQA加载状态
        function showRQALoading() {
            const containers = ['recurrencePlotContainer', 'rqaMetricsContainer', 'compareContainer'];
            containers.forEach(containerId => {
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = `
                        <div class="placeholder-content">
                            <i class="fas fa-spinner fa-spin fa-3x"></i>
                            <h3>正在分析...</h3>
                            <p>请稍候，RQA分析需要一些时间</p>
                        </div>
                    `;
                }
            });
        }

        // 隐藏RQA加载状态
        function hideRQALoading() {
            // 加载状态会被结果替换，不需要单独隐藏
        }

        // 显示RQA错误
        function showRQAError(errorMessage) {
            const containers = ['recurrencePlotContainer', 'rqaMetricsContainer'];
            containers.forEach(containerId => {
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = `
                        <div class="placeholder-content">
                            <i class="fas fa-exclamation-triangle fa-3x" style="color: #dc3545;"></i>
                            <h3 style="color: #dc3545;">分析失败</h3>
                            <p>${errorMessage}</p>
                        </div>
                    `;
                }
            });
        }

        // 显示RQA结果
        function displayRQAResults(result) {
            console.log('显示RQA结果:', result);
            
            // 显示递归图
            if (result.recurrence_plot) {
                displayRecurrencePlot(result.recurrence_plot);
            }
            
            // 显示时间序列图（新增）
            if (result.time_series_plot) {
                displayTimeSeriesPlot(result.time_series_plot);
            }
            
            // 显示RQA指标
            if (result.metrics) {
                displayRQAMetrics(result.metrics, result.data_info);
            }
            
            // 如果有对比数据，显示对比结果
            if (result.comparison) {
                displayComparisonResults(result.comparison);
            }
        }

        // 显示递归图
        function displayRecurrencePlot(plotData) {
            const container = document.getElementById('recurrencePlotContainer');
            if (container) {
                container.innerHTML = `
                    <div class="plot-image-container">
                        <img src="data:image/png;base64,${plotData}" alt="递归图" class="rqa-plot-image">
                        <p class="plot-description">递归图显示眼动轨迹的周期性模式和重复结构，黑点表示递归点，彩色方块表示不同ROI区域</p>
                    </div>
                `;
            }
        }

        // 显示时间序列图
        function displayTimeSeriesPlot(plotData) {
            // 在递归图容器下方添加时间序列图
            const plotContainer = document.getElementById('recurrencePlotContainer');
            if (plotContainer) {
                const timeSeriesDiv = document.createElement('div');
                timeSeriesDiv.className = 'plot-image-container mt-3';
                timeSeriesDiv.innerHTML = `
                    <img src="data:image/png;base64,${plotData}" alt="时间序列图" class="rqa-plot-image">
                    <p class="plot-description">时间序列图显示原始信号随时间的变化，彩色填充区域表示不同ROI的注视时段</p>
                `;
                plotContainer.appendChild(timeSeriesDiv);
            }
        }

        // 显示RQA指标
        function displayRQAMetrics(metrics, dataInfo = null) {
            const container = document.getElementById('rqaMetricsContainer');
            if (container) {
                let metricsHtml = '';
                
                // 如果有数据信息，先显示分析信息
                if (dataInfo) {
                    metricsHtml += `
                        <div class="analysis-info mb-3">
                            <h5>分析信息</h5>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">分析模式:</span>
                                    <span class="info-value">${dataInfo.analysis_mode || 'Unknown'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">数据点数:</span>
                                    <span class="info-value">${dataInfo.total_points || 0}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">嵌入点数:</span>
                                    <span class="info-value">${dataInfo.embedding_points || 0}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">ROI区域数:</span>
                                    <span class="info-value">${dataInfo.roi_count || 0}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                metricsHtml += '<div class="metrics-grid">';
                
                const metricLabels = {
                    'RR': '递归率 (Recurrence Rate)',
                    'DET': '确定性 (Determinism)',
                    'LAM': '层流性 (Laminarity)',
                    'L': '平均对角线长度',
                    'Lmax': '最大对角线长度',
                    'DIV': '发散性 (Divergence)',
                    'TT': '平均垂直线长度',
                    'Vmax': '最大垂直线长度',
                    'ENTR': '熵 (Entropy)'
                };
                
                const metricDescriptions = {
                    'RR': '表示递归点在总矩阵中的比例',
                    'DET': '表示形成对角线结构的递归点比例',
                    'LAM': '表示形成垂直线结构的递归点比例',
                    'L': '对角线段的平均长度，反映可预测性',
                    'Lmax': '最长对角线段的长度',
                    'DIV': 'Lmax的倒数，表示系统的发散程度',
                    'TT': '垂直线段的平均长度，反映状态持续时间',
                    'Vmax': '最长垂直线段的长度',
                    'ENTR': '对角线长度分布的Shannon熵'
                };
                
                for (const [key, value] of Object.entries(metrics)) {
                    const label = metricLabels[key] || key;
                    const description = metricDescriptions[key] || '';
                    const formattedValue = typeof value === 'number' ? 
                        (key.includes('max') || key === 'Lmax' || key === 'Vmax' ? value : value.toFixed(4)) : value;
                    
                    metricsHtml += `
                        <div class="metric-item" title="${description}">
                            <div class="metric-label">${label}</div>
                            <div class="metric-value">${formattedValue}</div>
                            <div class="metric-desc">${description}</div>
                        </div>
                    `;
                }
                
                metricsHtml += '</div>';
                container.innerHTML = metricsHtml;
            }
        }

        // 显示对比结果
        function displayComparisonResults(comparison) {
            const container = document.getElementById('compareContainer');
            if (container) {
                container.innerHTML = `
                    <div class="comparison-content">
                        <h5>组间对比分析</h5>
                        <p>对比功能开发中...</p>
                    </div>
                `;
            }
        }
    </script>
    
    <style>
        /* RQA结果显示样式 */
        .rqa-plot-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
        }
        
        .metric-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s ease;
        }
        
        .metric-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .metric-value {
            font-size: 1.4rem;
            color: #007bff;
            font-weight: 700;
        }
        
        .comparison-content {
            text-align: center;
            padding: 40px;
        }
        
                 .plot-image-container {
             text-align: center;
             padding: 20px;
         }
         
         .plot-description {
             font-size: 0.9rem;
             color: #6c757d;
             font-style: italic;
             margin-top: 10px;
             margin-bottom: 0;
         }
         
         .analysis-info {
             background: #f8f9fa;
             border-radius: 8px;
             padding: 15px;
             margin-bottom: 20px;
         }
         
         .analysis-info h5 {
             color: #495057;
             margin-bottom: 10px;
             font-weight: 600;
         }
         
         .info-grid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
             gap: 10px;
         }
         
         .info-item {
             display: flex;
             justify-content: space-between;
             padding: 5px 0;
         }
         
         .info-label {
             font-weight: 600;
             color: #495057;
         }
         
         .info-value {
             color: #007bff;
             font-weight: 500;
         }
         
         .metric-desc {
             font-size: 0.75rem;
             color: #6c757d;
             margin-top: 5px;
             line-height: 1.2;
         }
    </style>
    
    <!-- 图片放大模态框 -->
    <div id="imageModal" class="image-modal">
        <div class="image-modal-content">
            <div class="image-modal-header">
                <h5 class="image-modal-title" id="imageModalTitle">图片预览</h5>
                <button class="image-modal-close" onclick="closeImageModal()">&times;</button>
            </div>
            <div class="image-modal-body">
                <img id="imageModalImg" class="image-modal-img" src="" alt="">
            </div>
        </div>
    </div>
    
    <script>
        // 图片放大功能
        function openImageModal(imageSrc, imageTitle) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('imageModalImg');
            const modalTitle = document.getElementById('imageModalTitle');
            
            modalImg.src = imageSrc;
            modalTitle.textContent = imageTitle || '图片预览';
            modal.classList.add('active');
            
            // 防止页面滚动
            document.body.style.overflow = 'hidden';
        }
        
        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('active');
            
            // 恢复页面滚动
            document.body.style.overflow = 'auto';
        }
        
        // 点击模态框背景关闭
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeImageModal();
            }
        });
        
        // ESC键关闭模态框
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeImageModal();
            }
        });
        // ================= 模块7：数据整理模块 JavaScript 代码 =================
        // 数据整理模块的JavaScript代码
        let normalizedData = [];
        let currentChart = null;

        // 加载可用的RQA配置
        async function loadAvailableRqaConfigs() {
            console.log('🔍 加载可用的RQA配置...');
            
            try {
                const response = await fetch('/api/available-rqa-configs');
                const result = await response.json();
                
                if (result.success && result.configs) {
                    const rqaConfigSelect = document.getElementById('rqaConfigSelect');
                    if (rqaConfigSelect) {
                        // 清空现有选项
                        rqaConfigSelect.innerHTML = '';
                        
                        // 添加新选项 - 适配实际API返回格式
                        result.configs.forEach(config => {
                            const option = document.createElement('option');
                            option.value = config.id; // 使用id而不是signature
                            // 使用API已经生成的display_name，或者构建显示名称
                            const displayName = config.display_name || `m=${config.m}, τ=${config.tau}, ε=${config.eps}, l_min=${config.lmin}`;
                            option.textContent = `${displayName} (${config.file_count} 文件)`;
                            rqaConfigSelect.appendChild(option);
                        });
                        
                        console.log(`✅ 加载了 ${result.configs.length} 个RQA配置:`, result.configs.map(c => c.id));
                        
                        // 绑定配置变更事件
                        rqaConfigSelect.addEventListener('change', function() {
                            console.log(`🔄 RQA配置已变更为: ${this.value}`);
                            // 配置变更时重新加载数据
                            loadNormalizedData();
                        });
                    }
                } else {
                    console.log('⚠️ 没有找到可用的RQA配置');
                    // 如果没有配置，设置默认值
                    const rqaConfigSelect = document.getElementById('rqaConfigSelect');
                    if (rqaConfigSelect) {
                        rqaConfigSelect.innerHTML = '<option value="m2_tau1_eps0.055_lmin2">m=2, τ=1, ε=0.055, l_min=2 (默认)</option>';
                    }
                }
            } catch (error) {
                console.error('❌ 加载RQA配置失败:', error);
                // 错误时设置默认值
                const rqaConfigSelect = document.getElementById('rqaConfigSelect');
                if (rqaConfigSelect) {
                    rqaConfigSelect.innerHTML = '<option value="m2_tau1_eps0.055_lmin2">m=2, τ=1, ε=0.055, l_min=2 (默认)</option>';
                    console.log('⚠️ 使用默认RQA配置');
                }
            }
        }
        
        // 加载数据统计信息
        async function loadDataStatistics() {
            console.log('📊 加载数据统计信息...');
            
            try {
                const response = await fetch('/api/data-statistics');
                const result = await response.json();
                
                if (result.success && result.statistics) {
                    const stats = result.statistics;
                    
                    // 更新统计数字
                    const totalSubjects = document.getElementById('totalSubjects');
                    const totalSessions = document.getElementById('totalSessions');
                    const totalTasks = document.getElementById('totalTasks');
                    const totalFeatures = document.getElementById('totalFeatures');
                    
                    if (totalSubjects) totalSubjects.textContent = stats.total_subjects;
                    if (totalSessions) totalSessions.textContent = stats.total_sessions;
                    if (totalTasks) totalTasks.textContent = stats.total_tasks;
                    if (totalFeatures) totalFeatures.textContent = stats.normalized_features;
                    
                    console.log(`✅ 统计信息已更新: ${stats.total_subjects}名受试者, ${stats.total_sessions}个会话, ${stats.normalized_features}个特征`);
                } else {
                    console.log('⚠️ 无法获取统计信息');
                }
            } catch (error) {
                console.error('❌ 加载统计信息失败:', error);
            }
        }

        // 初始化函数（增强调试版本）
        function initDataOrganization() {
            console.log('🚀 === 初始化数据整理模块 ===');
            console.log('🕐 初始化时间:', new Date().toLocaleTimeString());
            
            try {
                // 检查关键DOM元素
                console.log('🔍 检查关键DOM元素...');
                const requiredElements = ['generateChart', 'refreshData', 'exportData', 'statusText', 'statusAlert'];
                
                const elementStatus = {};
                requiredElements.forEach(id => {
                    const element = document.getElementById(id);
                    elementStatus[id] = element ? '✅ 存在' : '❌ 缺失';
                    if (element) {
                        console.log(`✅ 找到元素: #${id}`);
                    } else {
                        console.warn(`❌ 缺失元素: #${id}`);
                    }
                });
                
                console.log('📊 DOM元素状态:', elementStatus);
                
                console.log('🔧 绑定事件监听器...');
                // 绑定事件监听器
                setupDataOrganizationEventListeners();
                console.log('✅ 事件监听器绑定完成');
                
                console.log('📊 开始加载初始配置和数据...');
                // 先加载配置和统计信息，然后加载数据
                Promise.all([
                    loadAvailableRqaConfigs()
                    // TODO: 等服务器重启后启用 loadDataStatistics()
                ]).then(() => {
                    console.log('✅ 配置和统计信息加载完成，开始加载数据...');
                    // 配置加载完成后，加载数据
                    loadNormalizedData();
                }).catch(error => {
                    console.error('❌ 配置加载失败，使用默认配置加载数据:', error);
                    // 即使配置加载失败，也尝试加载数据
                    loadNormalizedData();
                });
                
                console.log('✅ === 数据整理模块初始化完成 ===');
                
            } catch (error) {
                console.error('❌ === 初始化失败 ===');
                console.error('❌ 错误:', error);
                console.error('❌ 堆栈:', error.stack);
            }
        }

        // 设置事件监听器（增强调试版本）
        function setupDataOrganizationEventListeners() {
            console.log('🔧 === 设置事件监听器 ===');
            
            try {
                // 刷新数据按钮
                console.log('🔧 设置刷新数据按钮...');
                const refreshBtn = document.getElementById('refreshData');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', loadNormalizedData);
                    console.log('✅ 刷新数据按钮事件监听器已设置');
                } else {
                    console.warn('❌ 找不到刷新数据按钮 (#refreshData)');
                }
                
                // 生成图表按钮
                console.log('🔧 设置生成图表按钮...');
                const generateBtn = document.getElementById('generateChart');
                if (generateBtn) {
                    generateBtn.addEventListener('click', generateVisualization);
                    console.log('✅ 生成图表按钮事件监听器已设置');
                } else {
                    console.warn('❌ 找不到生成图表按钮 (#generateChart)');
                }
                
                // 导出数据按钮
                console.log('🔧 设置导出数据按钮...');
                const exportBtn = document.getElementById('exportData');
                if (exportBtn) {
                    exportBtn.addEventListener('click', exportFilteredData);
                    console.log('✅ 导出数据按钮事件监听器已设置');
                } else {
                    console.warn('❌ 找不到导出数据按钮 (#exportData)');
                }
                
                console.log('✅ === 事件监听器设置完成 ===');
                
            } catch (error) {
                console.error('❌ === 事件监听器设置失败 ===');
                console.error('❌ 错误:', error);
                console.error('❌ 堆栈:', error.stack);
            }
            
            // 筛选条件变化
            document.querySelectorAll('input[name="taskFilter"]').forEach(radio => {
                radio.addEventListener('change', updateDataTable);
            });
            
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', updateDataTable);
            });
            
            console.log('✅ 事件监听器设置完成');
        }

        // 加载真实整合数据
        async function loadNormalizedData() {
            const statusText = document.getElementById('statusText');
            const statusAlert = document.getElementById('statusAlert');
            const rqaConfigSelect = document.getElementById('rqaConfigSelect');
            const selectedConfig = rqaConfigSelect ? rqaConfigSelect.value : 'm2_tau1_eps0.055_lmin2';
            
            try {
                console.log('🚀 === 开始加载真实整合数据流程 ===');
                console.log('📊 选择的RQA配置:', selectedConfig);
                
                statusText.textContent = `正在加载真实数据 (${selectedConfig})...`;
                statusAlert.className = 'alert alert-info';
                
                console.log('🔄 第1步: 检查缓存数据...');
                const startTime = Date.now();
                
                // 首先尝试获取缓存的整合数据
                let response = await fetch(`/api/integrated-features/${selectedConfig}`, {
                    cache: 'no-cache',
                    headers: {'Accept': 'application/json'}
                });
                
                if (!response.ok) {
                    console.log('⚠️ 缓存不存在，开始真实数据整合...');
                    statusText.textContent = '缓存不存在，正在整合真实数据...';
                    
                    // 触发数据整合
                    response = await fetch('/api/integrate-real-features', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({rqa_config: selectedConfig})
                    });
                }
                
                const fetchTime = Date.now() - startTime;
                
                console.log(`📡 第2步: 收到响应 (${fetchTime}ms)`);
                console.log('📡 响应状态:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                console.log('📄 第3步: 解析JSON响应...');
                const parseStartTime = Date.now();
                normalizedData = await response.json();
                const parseTime = Date.now() - parseStartTime;
                
                console.log(`📄 第4步: JSON解析完成 (${parseTime}ms)`);
                console.log('📊 解析后的数据行数:', normalizedData.length);
                
                if (normalizedData.length === 0) {
                    throw new Error('API返回的数据为空');
                }
                
                console.log('📊 数据样本 (前3行):', normalizedData.slice(0, 3));
                
                console.log('🎨 第5步: 更新数据表格...');
                const tableStartTime = Date.now();
                updateDataTable();
                const tableTime = Date.now() - tableStartTime;
                
                console.log(`🎨 第6步: 表格更新完成 (${tableTime}ms)`);
                
                statusText.textContent = `✅ 真实数据整合完成: ${normalizedData.length} 条记录 (${selectedConfig})`;
                statusAlert.className = 'alert alert-success';
                
                const totalTime = Date.now() - startTime;
                console.log(`✅ === 真实数据整合流程完成，总用时: ${totalTime}ms ===`);
                
            } catch (error) {
                console.error('❌ === 数据加载流程失败 ===');
                console.error('❌ 错误类型:', error.constructor.name);
                console.error('❌ 错误消息:', error.message);
                console.error('❌ 错误堆栈:', error.stack);
                
                if (error.name === 'AbortError') {
                    statusText.textContent = '❌ 请求超时，服务器响应过慢，使用模拟数据演示功能';
                } else {
                    statusText.textContent = `❌ 数据加载失败: ${error.message}，使用模拟数据演示功能`;
                }
                statusAlert.className = 'alert alert-warning';
                
                // 尝试使用真实数据整合
                console.log('❌ API加载失败，尝试真实数据整合');
                try {
                    normalizedData = await loadRealIntegratedData();
                    updateDataTable();
                    statusText.textContent = `✅ 使用真实数据整合: ${normalizedData.length} 条记录`;
                    statusAlert.className = 'alert alert-success';
                } catch (integrateError) {
                    console.error('❌ 真实数据整合也失败:', integrateError);
                    statusText.textContent = '❌ 所有数据源加载失败，请检查服务器状态';
                    normalizedData = [];
                    updateDataTable();
                }
            }
        }

        // 解析CSV数据
        function parseCSV(csvText) {
            console.log('🔄 开始解析CSV数据...');
            
            try {
                const lines = csvText.trim().split('\n');
                console.log('📄 CSV总行数:', lines.length);
                
                if (lines.length < 2) {
                    throw new Error('CSV文件格式不正确，至少需要标题行和数据行');
                }
                
                const headers = lines[0].split(',');
                console.log('📋 CSV标题:', headers);
                
                const data = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue; // 跳过空行
                    
                    const values = line.split(',');
                    if (values.length !== headers.length) {
                        console.warn(`⚠️ 第${i+1}行字段数量不匹配: 期望${headers.length}个，实际${values.length}个`);
                        continue;
                    }
                    
                    const row = {};
                    headers.forEach((header, index) => {
                        const value = values[index] ? values[index].trim() : '';
                        // 尝试转换为数字
                        if (!isNaN(value) && value !== '' && value !== 'null' && value !== 'undefined') {
                            row[header] = parseFloat(value);
                        } else {
                            row[header] = value;
                        }
                    });
                    data.push(row);
                }
                
                console.log('✅ CSV解析完成，有效数据行数:', data.length);
                return data;
                
            } catch (error) {
                console.error('❌ CSV解析失败:', error);
                throw error;
            }
        }

        // 从真实数据源加载并整合10个属性
        async function loadRealIntegratedData(rqaConfig = 'm2_tau1_eps0.055_lmin2') {
            console.log('🔄 开始从真实数据源整合特征...');
            updateStatusText('正在从真实数据源提取特征...');
            
            try {
                // 检查是否有缓存的整合结果
                const cacheResponse = await fetch(`/api/integrated-features/${rqaConfig}`);
                if (cacheResponse.ok) {
                    const cachedData = await cacheResponse.json();
                    console.log('✅ 使用缓存的整合数据:', cachedData.length, '条记录');
                    return cachedData;
                }
                
                // 如果没有缓存，触发数据整合
                console.log('⚠️ 缓存不存在，开始数据整合过程...');
                const integrationResponse = await fetch('/api/integrate-real-features', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({rqa_config: rqaConfig})
                });
                
                if (!integrationResponse.ok) {
                    throw new Error('数据整合失败');
                }
                
                const integratedData = await integrationResponse.json();
                console.log('✅ 真实数据整合完成:', integratedData.length, '条记录');
                return integratedData;
                
            } catch (error) {
                console.error('❌ 真实数据整合失败:', error);
                throw error;
            }
        }

        // 更新数据表格
        function updateDataTable() {
            const filteredData = getFilteredData();
            const tbody = document.querySelector('#dataTable tbody');
            
            if (filteredData.length === 0) {
                const noDataMsg = currentLanguage === 'zh' ? '没有符合条件的数据' : 'No data matches the criteria';
                tbody.innerHTML = `<tr><td colspan="14" class="text-center text-muted">${noDataMsg}</td></tr>`;
                const noDataText = currentLanguage === 'zh' ? '0 行' : '0 rows';
                document.getElementById('tableRowCount').textContent = noDataText;
                return;
            }
            
            // 按照组别顺序排序：control -> mci -> ad
            const groupOrder = { 'control': 1, 'mci': 2, 'ad': 3 };
            const sortedData = filteredData.sort((a, b) => {
                const orderA = groupOrder[a.group_type] || 999;
                const orderB = groupOrder[b.group_type] || 999;
                if (orderA !== orderB) {
                    return orderA - orderB;
                }
                // 如果组别相同，按受试者ID排序
                return a.subject_id.localeCompare(b.subject_id);
            });
            
            tbody.innerHTML = sortedData.map(row => `
                <tr>
                    <td>${row.session_id}</td>
                    <td>${row.subject_id}</td>
                    <td><span class="badge bg-primary">${row.task_id}</span></td>
                    <td><span class="badge bg-${getGroupColor(row.group_type)}">${row.group_type.toUpperCase()}</span></td>
                    <td>${(row.game_duration_norm * 100).toFixed(1)}%</td>
                    <td>${(row.roi_kw_time_norm * 100).toFixed(1)}%</td>
                    <td>${(row.roi_inst_time_norm * 100).toFixed(1)}%</td>
                    <td>${(row.roi_bg_time_norm * 100).toFixed(1)}%</td>
                    <td>${row.rr_1d_norm ? row.rr_1d_norm.toFixed(3) : 'N/A'}</td>
                    <td>${row.det_1d_norm ? row.det_1d_norm.toFixed(3) : 'N/A'}</td>
                    <td>${row.ent_1d_norm ? row.ent_1d_norm.toFixed(3) : 'N/A'}</td>
                    <td>${row.rr_2d_norm.toFixed(3)}</td>
                    <td>${row.det_2d_norm.toFixed(3)}</td>
                    <td>${row.ent_2d_norm.toFixed(3)}</td>
                </tr>
            `).join('');
            
            // 更新表格行数（支持多语言）
            const rowCountText = currentLanguage === 'zh' ? `${filteredData.length} 行` : `${filteredData.length} rows`;
            document.getElementById('tableRowCount').textContent = rowCountText;
        }

        // 获取组别颜色
        function getGroupColor(group) {
            switch(group) {
                case 'ad': return 'danger';
                case 'mci': return 'warning';
                case 'control': return 'success';
                default: return 'secondary';
            }
        }

        // 获取筛选后的数据
        function getFilteredData() {
            const taskFilter = document.querySelector('input[name="taskFilter"]:checked').value;
            const selectedGroups = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
                .map(cb => cb.value).filter(v => ['ad', 'mci', 'control'].includes(v));
            
            return normalizedData.filter(row => {
                const taskMatch = taskFilter === 'all' || row.task_id === taskFilter;
                const groupMatch = selectedGroups.includes(row.group_type);
                return taskMatch && groupMatch;
            });
        }

        // 生成可视化图表
        function generateVisualization() {
            const filteredData = getFilteredData();
            const featureType = document.getElementById('featureType').value;
            const chartType = document.getElementById('chartType').value;
            
            if (filteredData.length === 0) {
                const noDataAlert = currentLanguage === 'zh' ? '没有符合条件的数据，请调整筛选条件' : 'No data matches the criteria, please adjust the filter conditions';
                alert(noDataAlert);
                return;
            }
            
            // 销毁之前的图表
            if (currentChart) {
                currentChart.destroy();
            }
            
            // 创建新图表
            const canvas = createChartCanvas();
            const ctx = canvas.getContext('2d');
            
            try {
                currentChart = createChart(ctx, filteredData, featureType, chartType);
            } catch (error) {
                console.error('生成图表失败:', error);
                alert('生成图表失败: ' + error.message);
            }
        }

        // 创建图表画布
        function createChartCanvas() {
            const container = document.getElementById('chartContainer');
            container.innerHTML = '<canvas id="mainChart"></canvas>';
            return document.getElementById('mainChart');
        }

        // 创建图表
        function createChart(ctx, data, featureType, chartType) {
            const features = getFeaturesByType(featureType);
            const groupedData = {};
            
            // 按实验组分组数据
            data.forEach(row => {
                if (!groupedData[row.group_type]) {
                    groupedData[row.group_type] = {};
                }
                features.forEach(feature => {
                    if (!groupedData[row.group_type][feature]) {
                        groupedData[row.group_type][feature] = [];
                    }
                    groupedData[row.group_type][feature].push(row[feature]);
                });
            });
            
            // 按照固定顺序生成数据集：control -> mci -> ad
            const groupOrder = ['control', 'mci', 'ad'];
            const datasets = groupOrder.filter(group => groupedData[group]).map(group => {
                const values = features.map(feature => {
                    const arr = groupedData[group][feature] || [];
                    return arr.length > 0 ? arr.reduce((a, b) => a + b, 0) / arr.length : 0;
                });
                
                return {
                    label: group.toUpperCase(),
                    data: values,
                    backgroundColor: getGroupColorRGBA(group, 0.6),
                    borderColor: getGroupColorRGBA(group, 1),
                    borderWidth: 2,
                    fill: chartType === 'line' ? false : true
                };
            });
            
            return new Chart(ctx, {
                type: chartType === 'line' ? 'line' : 'bar',
                data: {
                    labels: features.map(f => getFeatureDisplayName(f)),
                    datasets: datasets
                },
                                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: `${getFeatureTypeDisplayName(featureType)} - 分组对比 (${features.length}项特征)`
                            },
                            legend: {
                                position: 'top'
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 0
                                }
                            },
                            y: {
                                beginAtZero: true,
                                max: 1,
                                title: {
                                    display: true,
                                    text: '归一化值 (0-1)'
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        elements: {
                            bar: {
                                borderWidth: 2
                            }
                        }
                    }
            });
        }

        // 获取特征类型对应的字段
        function getFeaturesByType(featureType) {
            switch(featureType) {
                case 'game_duration':
                    return ['game_duration_norm'];
                case 'roi_features':
                    return ['roi_kw_time_norm', 'roi_inst_time_norm', 'roi_bg_time_norm'];
                case 'rqa_1d_features':
                    return ['rr_1d_norm', 'det_1d_norm', 'ent_1d_norm'];
                case 'rqa_2d_features':
                    return ['rr_2d_norm', 'det_2d_norm', 'ent_2d_norm'];
                case 'rqa_features':
                    return ['rr_1d_norm', 'det_1d_norm', 'ent_1d_norm', 'rr_2d_norm', 'det_2d_norm', 'ent_2d_norm'];
                case 'comprehensive':
                    return ['game_duration_norm', 'roi_kw_time_norm', 'roi_inst_time_norm', 'roi_bg_time_norm', 'rr_1d_norm', 'det_1d_norm', 'ent_1d_norm', 'rr_2d_norm', 'det_2d_norm', 'ent_2d_norm'];
                case 'all_features':
                    return ['game_duration_norm', 'roi_kw_time_norm', 'roi_inst_time_norm', 'roi_bg_time_norm', 'rr_1d_norm', 'det_1d_norm', 'ent_1d_norm', 'rr_2d_norm', 'det_2d_norm', 'ent_2d_norm'];
                default:
                    return ['game_duration_norm'];
            }
        }

        // 获取特征显示名称
        function getFeatureDisplayName(feature) {
            const names = {
                'game_duration_norm': '游戏时长',
                'roi_kw_time_norm': 'KW-ROI时间',
                'roi_inst_time_norm': 'INST-ROI时间',
                'roi_bg_time_norm': 'BG-ROI时间',
                'rr_1d_norm': 'RR-1D',
                'det_1d_norm': 'DET-1D',
                'ent_1d_norm': 'ENT-1D',
                'rr_2d_norm': 'RR-2D',
                'det_2d_norm': 'DET-2D',
                'ent_2d_norm': 'ENT-2D'
            };
            return names[feature] || feature;
        }

        // 获取特征类型显示名称
        function getFeatureTypeDisplayName(featureType) {
            const names = {
                'game_duration': '游戏时长特征',
                'roi_features': 'ROI注视特征',
                'rqa_1d_features': 'RQA-1D递归特征',
                'rqa_2d_features': 'RQA-2D递归特征',
                'rqa_features': 'RQA全部递归特征',
                'comprehensive': '综合特征对比',
                'all_features': '全部特征对比'
            };
            return names[featureType] || featureType;
        }

        // 获取组别颜色RGBA
        function getGroupColorRGBA(group, alpha = 1) {
            switch(group) {
                case 'ad': return `rgba(220, 53, 69, ${alpha})`;
                case 'mci': return `rgba(255, 193, 7, ${alpha})`;
                case 'control': return `rgba(25, 135, 84, ${alpha})`;
                default: return `rgba(108, 117, 125, ${alpha})`;
            }
        }

        // 导出筛选后的数据
        function exportFilteredData() {
            const filteredData = getFilteredData();
            if (filteredData.length === 0) {
                const noExportDataMsg = currentLanguage === 'zh' ? '没有数据可导出' : 'No data to export';
                alert(noExportDataMsg);
                return;
            }
            
            // 转换为CSV格式
            const headers = Object.keys(filteredData[0]);
            const csvContent = [
                headers.join(','),
                ...filteredData.map(row => headers.map(h => row[h]).join(','))
            ].join('\\n');
            
            // 下载CSV文件
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `normalized_features_filtered_${new Date().getTime()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        console.log('📊 模块7数据整理模块脚本加载完成');
        // ================= 模块7：数据整理模块 JavaScript 代码结束 =================
        
        // ================= 模块8：眼动系数与MMSE对比分析 JavaScript 代码 =================
        
        // 全局变量
        let eyeMovementData = null;
        let mmseData = null;
        let comparisonResults = null;
        let currentViewMode = 'individual'; // 'individual' or 'group'
        let currentDetailMode = 'main'; // 'main' or 'subQuestion'
        let comparisonChart = null;

        // 初始化模块8的数据对比分析功能
        function initEyeMovementMMSEAnalysis() {
            console.log('🚀 === 初始化眼动系数与MMSE对比分析模块 ===');
            
            // 初始化数据计数器显示
            const eyeMovementCountElement = document.getElementById('eyeMovementCount');
            const mmseScoreCountElement = document.getElementById('mmseScoreCount');
            if (eyeMovementCountElement) eyeMovementCountElement.textContent = '0';
            if (mmseScoreCountElement) mmseScoreCountElement.textContent = '0';
            
            // 设置按钮事件监听
            setupComparisonEventListeners();
            
            // 加载可用的模块7数据源
            loadAvailableModule7DataSources();
            
            console.log('✅ === 眼动系数与MMSE对比分析模块初始化完成 ===');
        }
        
        // 加载可用的模块7数据源
        async function loadAvailableModule7DataSources() {
            console.log('🔍 加载可用的模块7数据源...');
            
            try {
                // 从RQA配置API获取可用配置
                const response = await fetch('/api/available-rqa-configs');
                const result = await response.json();
                
                if (result.success && result.configs) {
                    const dataSourceSelect = document.getElementById('module7DataSourceSelect');
                    if (dataSourceSelect) {
                        // 清空现有选项
                        dataSourceSelect.innerHTML = `<option value="">${getLanguageText('selectRqaConfig')}</option>`;
                        
                        // 添加可用的模块7数据源
                        result.configs.forEach(config => {
                            const option = document.createElement('option');
                            option.value = config.id; // 使用RQA配置ID
                            // 直接从config对象获取参数，而不是config.parameters
                            const displayName = config.display_name || `m=${config.m}, τ=${config.tau}, ε=${config.eps}, l_min=${config.lmin}`;
                            option.textContent = displayName;
                            dataSourceSelect.appendChild(option);
                        });
                        
                        console.log(`✅ 加载了 ${result.configs.length} 个模块7数据源`);
                        
                        // 绑定数据源变更事件
                        dataSourceSelect.addEventListener('change', function() {
                            const selectedConfig = this.value;
                            if (selectedConfig) {
                                console.log(`🔄 选择了数据源: ${selectedConfig}`);
                                // 启用加载按钮
                                enableAnalysisButtons();
                            } else {
                                // 禁用按钮
                                disableAnalysisButtons();
                            }
                        });
                    }
                } else {
                    console.log('⚠️ 没有找到可用的模块7数据源');
                }
            } catch (error) {
                console.error('❌ 加载模块7数据源失败:', error);
            }
        }
        
        // 启用分析按钮
        function enableAnalysisButtons() {
            const buttons = ['loadEyeMovementData', 'calculateCoefficients', 'compareWithMMSE', 'exportComparisonReport'];
            buttons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.disabled = false;
                }
            });
        }
        
        // 禁用分析按钮
        function disableAnalysisButtons() {
            const buttons = ['loadEyeMovementData', 'calculateCoefficients', 'compareWithMMSE', 'exportComparisonReport'];
            buttons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.disabled = true;
                }
            });
        }

        // 设置对比分析事件监听器
        function setupComparisonEventListeners() {
            console.log('🔧 设置对比分析事件监听器');
            
            // 加载眼动数据按钮
            const loadDataBtn = document.getElementById('loadEyeMovementData');
            if (loadDataBtn) {
                loadDataBtn.addEventListener('click', loadEyeMovementData);
                console.log('✅ 加载眼动数据按钮监听器已设置');
            }
            
            // 计算眼动系数按钮
            const calculateBtn = document.getElementById('calculateCoefficients');
            if (calculateBtn) {
                calculateBtn.addEventListener('click', calculateEyeMovementCoefficients);
                console.log('✅ 计算眼动系数按钮监听器已设置');
            }
            
            // MMSE对比分析按钮
            const compareBtn = document.getElementById('compareWithMMSE');
            if (compareBtn) {
                compareBtn.addEventListener('click', performMMSEComparison);
                console.log('✅ MMSE对比分析按钮监听器已设置');
            }
            
            // 导出报告按钮
            const exportBtn = document.getElementById('exportComparisonReport');
            if (exportBtn) {
                exportBtn.addEventListener('click', exportComparisonReport);
                console.log('✅ 导出报告按钮监听器已设置');
            }
            
            // 视图切换按钮
            const toggleViewBtn = document.getElementById('toggleViewMode');
            if (toggleViewBtn) {
                toggleViewBtn.addEventListener('click', toggleViewMode);
                console.log('✅ 视图切换按钮监听器已设置');
            }
        }

        // 1. 加载眼动数据
        async function loadEyeMovementData() {
            console.log('📊 开始加载眼动数据');
            updateStatusText('正在加载眼动数据...');
            
            try {
                // 获取选择的模块7数据源
                const dataSourceSelect = document.getElementById('module7DataSourceSelect');
                const selectedRqaConfig = dataSourceSelect ? dataSourceSelect.value : '';
                
                if (!selectedRqaConfig) {
                    alert(getLanguageText('pleaseSelectModule7DataSource'));
                    return;
                }
                
                console.log(`📊 从模块7加载数据，RQA配置: ${selectedRqaConfig}`);
                
                // 从模块7的整合特征数据中加载
                const response = await fetch(`/api/integrated-features/${selectedRqaConfig}`);
                
                if (!response.ok) {
                    throw new Error(`无法获取模块7数据: HTTP ${response.status}`);
                }
                
                eyeMovementData = await response.json();
                console.log('✅ 成功加载模块7眼动数据:', eyeMovementData.length, '条记录');
                console.log('📊 数据来源:', `模块7整合特征 (${selectedRqaConfig})`);
                
                // 更新状态卡片
                const eyeMovementCount = document.getElementById('eyeMovementCount');
                if (eyeMovementCount) {
                    eyeMovementCount.textContent = eyeMovementData.length;
                }
                
                updateStatusText(`眼动数据加载完成 (${selectedRqaConfig})`);
                
                // 启用计算按钮
                const calculateBtn = document.getElementById('calculateCoefficients');
                if (calculateBtn) {
                    calculateBtn.disabled = false;
                }
                
            } catch (error) {
                console.error('❌ 加载眼动数据失败:', error);
                updateStatusText('眼动数据加载失败');
                
                alert(getLanguageText('eyeMovementDataLoadFailed').replace('{error}', error.message));
                
                // 重置状态卡片
                const eyeMovementCount = document.getElementById('eyeMovementCount');
                if (eyeMovementCount) {
                    eyeMovementCount.textContent = '0';
                }
            }
        }

        // 2. 计算眼动系数
        function calculateEyeMovementCoefficients() {
            console.log('🧮 开始计算眼动系数');
            
            if (!eyeMovementData || eyeMovementData.length === 0) {
                alert(getLanguageText('pleaseLoadEyeMovementDataFirst'));
                return;
            }
            
            updateStatusText('正在计算眼动系数...');
            
            // 为每条记录计算眼动系数
            const processedData = eyeMovementData.map(record => {
                // 处理"越低越好"的指标（需要反向）
                const lowerIsBetterFeatures = [
                    1 - (record.game_duration_norm || 0),      // 游戏时长：越短越好
                    1 - (record.roi_kw_time_norm || 0),        // 关键词ROI时间：越短越好
                    1 - (record.roi_inst_time_norm || 0),      // 指令ROI时间：越短越好
                    1 - (record.roi_bg_time_norm || 0)         // 背景ROI时间：越短越好
                ];
                
                // 处理"越高越好"的指标（直接使用）
                const higherIsBetterFeatures = [
                    record.rr_1d_norm || 0,                    // RQA-1D RR：越高越好
                    record.det_1d_norm || 0,                   // RQA-1D DET：越高越好
                    record.ent_1d_norm || 0,                   // RQA-1D ENT：越高越好
                    record.rr_2d_norm || 0,                    // RQA-2D RR：越高越好
                    record.det_2d_norm || 0,                   // RQA-2D DET：越高越好
                    record.ent_2d_norm || 0                    // RQA-2D ENT：越高越好
                ];
                
                // 合并所有特征
                const allFeatures = [...lowerIsBetterFeatures, ...higherIsBetterFeatures];
                
                // 计算眼动系数（所有特征的平均值，现在方向一致了）
                const eyeMovementCoefficient = allFeatures.reduce((sum, val) => sum + val, 0) / allFeatures.length;
                
                return {
                    ...record,
                    eye_movement_coefficient: eyeMovementCoefficient,
                    valid_features_count: allFeatures.filter(f => f > 0).length
                };
            });
            
            eyeMovementData = processedData;
            console.log('✅ 眼动系数计算完成');
            
            // 更新状态
            updateStatusText('眼动系数计算完成');
            document.getElementById('insightCount').textContent = eyeMovementData.length;
            
            // 启用MMSE对比按钮
            const compareBtn = document.getElementById('compareWithMMSE');
            if (compareBtn) {
                compareBtn.disabled = false;
            }
        }

        // 3. 加载MMSE数据
        async function loadMMSEData() {
            console.log('📋 开始加载MMSE数据');
            
            try {
                const [controlResponse, mciResponse, adResponse] = await Promise.all([
                    fetch('/api/mmse-scores/control'),
                    fetch('/api/mmse-scores/mci'),
                    fetch('/api/mmse-scores/ad')
                ]);
                
                if (!controlResponse.ok || !mciResponse.ok || !adResponse.ok) {
                    throw new Error('无法加载MMSE数据');
                }
                
                const [controlData, mciData, adData] = await Promise.all([
                    controlResponse.json(),
                    mciResponse.json(),
                    adResponse.json()
                ]);
                
                // 合并所有MMSE数据
                mmseData = [
                    ...controlData.map(item => ({...item, group_type: 'control'})),
                    ...mciData.map(item => ({...item, group_type: 'mci'})),
                    ...adData.map(item => ({...item, group_type: 'ad'}))
                ];
                
                console.log('✅ MMSE数据加载成功:', mmseData.length, '条记录');
                
                // 更新UI中的MMSE数据计数
                const mmseScoreCountElement = document.getElementById('mmseScoreCount');
                if (mmseScoreCountElement) {
                    mmseScoreCountElement.textContent = mmseData.length;
                }
                
                return mmseData;
                
            } catch (error) {
                console.error('❌ 加载MMSE数据失败:', error);
                // 重置UI中的MMSE数据计数
                const mmseScoreCountElement = document.getElementById('mmseScoreCount');
                if (mmseScoreCountElement) {
                    mmseScoreCountElement.textContent = '0';
                }
                // API不可用，返回空数据并提示
                alert(getLanguageText('mmseDataLoadFailed'));
                return [];
            }
        }

        // MMSE数据现在从真实数据API加载，移除了模拟生成

        // 生成任务MMSE分数
        function generateTaskMMSEScores(group, taskNum) {
            const basePerformance = {
                'control': 0.85,
                'mci': 0.65,
                'ad': 0.45
            };
            
            const maxScores = {
                1: 5, // Q1: 时间定向（年份1分+季节1分+月份1分+星期2分）
                2: 5, // Q2: 地点定向（省市区2分+街道1分+建筑1分+楼层1分）
                3: 3, // Q3: 即刻记忆
                4: 5, // Q4: 注意力计算
                5: 3  // Q5: 延迟回忆
            };
            
            const maxScore = maxScores[taskNum];
            const performance = basePerformance[group] + (Math.random() - 0.5) * 0.3;
            const score = Math.max(0, Math.min(maxScore, Math.round(maxScore * performance)));
            
            return {
                mmse_score: score,
                mmse_max_score: maxScore,
                performance_ratio: score / maxScore
            };
        }

        // 4. 执行MMSE对比分析
        async function performMMSEComparison() {
            console.log('🔍 开始MMSE对比分析');
            
            if (!eyeMovementData || eyeMovementData.length === 0) {
                alert(getLanguageText('pleaseCalculateCoefficientsFirst'));
                return;
            }
            
            updateStatusText('正在进行MMSE对比分析...');
            
            try {
                // 加载MMSE数据
                if (!mmseData || mmseData.length === 0) {
                    await loadMMSEData();
                } else {
                    // 如果MMSE数据已经存在，更新计数器显示
                    const mmseScoreCountElement = document.getElementById('mmseScoreCount');
                    if (mmseScoreCountElement) {
                        mmseScoreCountElement.textContent = mmseData.length;
                    }
                }
                
                // 执行数据对比分析
                comparisonResults = performDataComparison();
                
                // 更新表格显示
                updateComparisonTable();
                
                // 生成图表
                generateComparisonChart();
                
                // 更新状态
                updateStatusText('MMSE对比分析完成');
                document.getElementById('anomaliesDetected').textContent = comparisonResults.individual.length;
                
                // 自动保存CSV文件
            await autoSaveComparisonCSV();
            
            console.log('✅ MMSE对比分析完成');
                
            } catch (error) {
                console.error('❌ MMSE对比分析失败:', error);
                updateStatusText('MMSE对比分析失败');
                alert(getLanguageText('mmseComparisonFailed'));
            }
        }

        // ID格式转换函数
        function convertEyeMovementIdToMMSEId(eyeMovementSubjectId, groupType) {
            // 从眼动数据的subject_id（如 n1q, m5q, ad3q）提取基础ID
            let baseId = eyeMovementSubjectId;
            
            // 去掉可能的 'q' 后缀
            if (baseId.endsWith('q')) {
                baseId = baseId.slice(0, -1);
            }
            
            // 根据组类型转换格式
            if (groupType === 'control') {
                // n1 -> n01, n10 -> n10
                const match = baseId.match(/^n(\d+)$/);
                if (match) {
                    const num = parseInt(match[1]);
                    return `n${num.toString().padStart(2, '0')}`;
                }
            } else if (groupType === 'mci') {
                // m1 -> M01, m10 -> M10
                const match = baseId.match(/^m(\d+)$/);
                if (match) {
                    const num = parseInt(match[1]);
                    return `M${num.toString().padStart(2, '0')}`;
                }
            } else if (groupType === 'ad') {
                // AD组特殊处理: ad3->ad01, ad4->ad02, ..., ad22->ad20
                // 眼动数据从ad3开始，MMSE数据从ad01开始，需要偏移-2
                const match = baseId.match(/^ad(\d+)$/);
                if (match) {
                    const num = parseInt(match[1]);
                    const mmseNum = num - 2; // 眼动数据ad3对应MMSE数据ad01
                    if (mmseNum >= 1 && mmseNum <= 20) {
                        return `ad${mmseNum.toString().padStart(2, '0')}`;
                    }
                }
            }
            
            return baseId; // 如果转换失败，返回原值
        }

        // 执行数据对比分析
        function performDataComparison() {
            console.log('🔬 执行数据对比分析');
            
            const individualResults = [];
            const groupResults = [];
            const subQuestionResults = [];
            
            // 1. 个人层面对比 - 处理ID格式不一致问题
            eyeMovementData.forEach(eyeRecord => {
                // 转换眼动数据的subject_id为MMSE格式
                const mmseSubjectId = convertEyeMovementIdToMMSEId(eyeRecord.subject_id, eyeRecord.group_type);
                
                // 查找对应的MMSE数据（需要匹配subject_id和task_id）
                let mmseRecord = mmseData.find(mmse => 
                    mmse.subject_id === mmseSubjectId && mmse.task_id === eyeRecord.task_id
                );
                
                if (mmseRecord) {
                    // 主问题级别的对比
                    individualResults.push({
                        subject_id: eyeRecord.subject_id,
                        task_id: eyeRecord.task_id,
                        group_type: eyeRecord.group_type,
                        eye_movement_coefficient: eyeRecord.eye_movement_coefficient,
                        mmse_score: mmseRecord.mmse_score,
                        mmse_max_score: mmseRecord.mmse_max_score,
                        performance_ratio: mmseRecord.performance_ratio
                    });
                    
                    // 子问题级别的对比
                    if (mmseRecord.subQuestions) {
                        mmseRecord.subQuestions.forEach(subQ => {
                            subQuestionResults.push({
                                subject_id: eyeRecord.subject_id,
                                task_id: eyeRecord.task_id,
                                sub_question_id: subQ.sub_question_id,
                                sub_question_name: subQ.sub_question_name,
                                group_type: eyeRecord.group_type,
                                eye_movement_coefficient: eyeRecord.eye_movement_coefficient, // 使用相同的眼动系数
                                sub_question_score: subQ.sub_question_score,
                                sub_question_max_score: subQ.sub_question_max_score,
                                sub_question_performance_ratio: subQ.sub_question_performance_ratio
                            });
                        });
                    }
                } else {
                    console.warn(`⚠️ 未找到匹配的MMSE数据: ${eyeRecord.subject_id} (转换为: ${mmseSubjectId})`);
                }
            });
            
            // 2. 群体层面对比
            const groups = ['control', 'mci', 'ad'];
            const tasks = ['Q1', 'Q2', 'Q3', 'Q4', 'Q5'];
            
            groups.forEach(group => {
                tasks.forEach(task => {
                    const groupTaskData = individualResults.filter(item => 
                        item.group_type === group && item.task_id === task
                    );
                    
                    if (groupTaskData.length > 0) {
                        const avgEyeCoeff = groupTaskData.reduce((sum, item) => sum + item.eye_movement_coefficient, 0) / groupTaskData.length;
                        const avgMMSE = groupTaskData.reduce((sum, item) => sum + item.mmse_score, 0) / groupTaskData.length;
                        const correlationCoeff = calculateCorrelation(
                            groupTaskData.map(item => item.eye_movement_coefficient),
                            groupTaskData.map(item => item.mmse_score)
                        );
                        
                        groupResults.push({
                            group_type: group,
                            task_id: task,
                            avg_eye_movement_coefficient: avgEyeCoeff,
                            avg_mmse_score: avgMMSE,
                            subject_count: groupTaskData.length,
                            correlation_coefficient: correlationCoeff,
                            standard_deviation: calculateStandardDeviation(groupTaskData.map(item => item.eye_movement_coefficient))
                        });
                    }
                });
            });
            
            // 3. 子问题群体层面对比
            const subQuestionGroupResults = [];
            const allSubQuestions = [...new Set(subQuestionResults.map(r => r.sub_question_id))];
            
            groups.forEach(group => {
                allSubQuestions.forEach(subQuestionId => {
                    const groupSubData = subQuestionResults.filter(r => 
                        r.group_type === group && r.sub_question_id === subQuestionId
                    );
                    
                    if (groupSubData.length > 0) {
                        const eyeCoeffs = groupSubData.map(r => r.eye_movement_coefficient);
                        const subScores = groupSubData.map(r => r.sub_question_score);
                        
                        const avgEyeCoeff = eyeCoeffs.reduce((sum, val) => sum + val, 0) / eyeCoeffs.length;
                        const avgSubScore = subScores.reduce((sum, val) => sum + val, 0) / subScores.length;
                        const correlation = calculateCorrelation(eyeCoeffs, subScores);
                        const stdDev = calculateStandardDeviation(eyeCoeffs);
                        
                        subQuestionGroupResults.push({
                            sub_question_id: subQuestionId,
                            sub_question_name: groupSubData[0].sub_question_name,
                            group_type: group,
                            subject_count: groupSubData.length,
                            avg_eye_movement_coefficient: avgEyeCoeff,
                            avg_sub_question_score: avgSubScore,
                            avg_sub_question_max_score: groupSubData[0].sub_question_max_score,
                            correlation_coefficient: correlation,
                            standard_deviation: stdDev
                        });
                    }
                });
            });
            
            return {
                individual: individualResults,
                group: groupResults,
                subQuestions: subQuestionResults,
                subQuestionGroups: subQuestionGroupResults
            };
        }

        // 计算相关系数
        function calculateCorrelation(x, y) {
            if (x.length !== y.length || x.length === 0) return 0;
            
            const n = x.length;
            const meanX = x.reduce((sum, val) => sum + val, 0) / n;
            const meanY = y.reduce((sum, val) => sum + val, 0) / n;
            
            let numerator = 0;
            let denomX = 0;
            let denomY = 0;
            
            for (let i = 0; i < n; i++) {
                const diffX = x[i] - meanX;
                const diffY = y[i] - meanY;
                numerator += diffX * diffY;
                denomX += diffX * diffX;
                denomY += diffY * diffY;
            }
            
            if (denomX === 0 || denomY === 0) return 0;
            return numerator / Math.sqrt(denomX * denomY);
        }

        // 计算标准差
        function calculateStandardDeviation(values) {
            if (values.length === 0) return 0;
            
            const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
            const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length;
            return Math.sqrt(variance);
        }

        // 更新对比表格
        function updateComparisonTable() {
            console.log('📋 更新对比表格');
            
            const tableBody = document.getElementById('comparisonTableBody');
            if (!tableBody || !comparisonResults) return;
            
            let html = '';
            
            if (currentDetailMode === 'subQuestion') {
                // 子问题详细视图
                const subQuestionData = comparisonResults.subQuestions || [];
                subQuestionData.forEach(item => {
                    html += `
                        <tr>
                            <td>${item.subject_id}</td>
                            <td>${item.task_id}</td>
                            <td>${item.sub_question_name}</td>
                            <td><span class="badge bg-${getGroupColor(item.group_type)}">${item.group_type.toUpperCase()}</span></td>
                            <td>${item.eye_movement_coefficient.toFixed(3)}</td>
                            <td>${item.sub_question_score}</td>
                            <td>${item.sub_question_max_score}</td>
                            <td>${(item.sub_question_performance_ratio * 100).toFixed(1)}%</td>
                        </tr>
                    `;
                });
            } else {
                // 主问题视图（原有逻辑）
                const data = currentViewMode === 'individual' ? comparisonResults.individual : comparisonResults.group;
                
                if (currentViewMode === 'individual') {
                    // 个人视图
                    data.forEach(item => {
                        html += `
                            <tr>
                                <td>${item.subject_id}</td>
                                <td>${item.task_id}</td>
                                <td><span class="badge bg-${getGroupColor(item.group_type)}">${item.group_type.toUpperCase()}</span></td>
                                <td>${item.eye_movement_coefficient.toFixed(3)}</td>
                                <td>${item.mmse_score}</td>
                                <td>${item.mmse_max_score}</td>
                                <td>${(item.performance_ratio * 100).toFixed(1)}%</td>
                            </tr>
                        `;
                    });
                } else {
                    // 群体视图
                    data.forEach(item => {
                        html += `
                            <tr>
                                <td><span class="badge bg-${getGroupColor(item.group_type)}">${item.group_type.toUpperCase()}</span></td>
                                <td>${item.task_id}</td>
                                <td>${item.avg_eye_movement_coefficient.toFixed(3)}</td>
                                <td>${item.avg_mmse_score.toFixed(1)}</td>
                                <td>${item.subject_count}</td>
                                <td>${item.correlation_coefficient.toFixed(3)}</td>
                                <td>${item.standard_deviation.toFixed(3)}</td>
                            </tr>
                        `;
                    });
                }
            }
            
            if (html === '') {
                const colCount = currentDetailMode === 'subQuestion' ? 8 : (currentViewMode === 'individual' ? 7 : 7);
                html = `<tr><td colspan="${colCount}" class="text-center text-muted">暂无数据</td></tr>`;
            }
            
            tableBody.innerHTML = html;
        }

        // 获取组别颜色
        function getGroupColor(group) {
            switch (group) {
                case 'control': return 'success';
                case 'mci': return 'warning';
                case 'ad': return 'danger';
                default: return 'secondary';
            }
        }

        // 生成对比图表
        function generateComparisonChart() {
            console.log('📊 生成对比图表');
            
            const chartContainer = document.getElementById('comparisonChartContainer');
            if (!chartContainer || !comparisonResults) return;
            
            // 销毁旧图表
            if (comparisonChart) {
                if (typeof comparisonChart.destroy === 'function') {
                    // 单个图表实例
                    comparisonChart.destroy();
                } else if (typeof comparisonChart === 'object') {
                    // 多个图表实例
                    Object.values(comparisonChart).forEach(chart => {
                        if (chart && typeof chart.destroy === 'function') {
                            chart.destroy();
                        }
                    });
                }
            }
            
            // 创建5个子图的布局：上面3张，下面2张
            chartContainer.innerHTML = `
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-header text-center bg-primary text-white">
                                <small><strong>Q1 - 时间定向</strong></small>
                            </div>
                            <div class="card-body p-2">
                                <canvas id="chartQ1" width="400" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-header text-center bg-success text-white">
                                <small><strong>Q2 - 地点定向</strong></small>
                            </div>
                            <div class="card-body p-2">
                                <canvas id="chartQ2" width="400" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-header text-center bg-info text-white">
                                <small><strong>Q3 - 即刻记忆</strong></small>
                            </div>
                            <div class="card-body p-2">
                                <canvas id="chartQ3" width="400" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header text-center bg-warning text-white">
                                <small><strong>Q4 - 注意力和计算</strong></small>
                            </div>
                            <div class="card-body p-2">
                                <canvas id="chartQ4" width="400" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header text-center bg-danger text-white">
                                <small><strong>Q5 - 延迟回忆</strong></small>
                            </div>
                            <div class="card-body p-2">
                                <canvas id="chartQ5" width="400" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 为每个任务创建图表
            const tasks = ['Q1', 'Q2', 'Q3', 'Q4', 'Q5'];
            const groups = ['control', 'mci', 'ad'];
            const colors = {
                'control': 'rgba(40, 167, 69, 0.8)',
                'mci': 'rgba(255, 193, 7, 0.8)',
                'ad': 'rgba(220, 53, 69, 0.8)'
            };
            
            comparisonChart = {}; // 存储多个图表实例
            
            tasks.forEach(taskId => {
                const canvas = document.getElementById(`chart${taskId}`);
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                
                // 准备该任务的数据
                const datasets = [];
                
                if (currentDetailMode === 'subQuestion') {
                    // 子问题详细视图：显示该任务的所有子问题
                    groups.forEach(group => {
                        const groupData = (comparisonResults.subQuestions || [])
                            .filter(item => item.group_type === group && item.task_id === taskId);
                        
                        const chartData = groupData.map(item => ({
                            x: item.eye_movement_coefficient,
                            y: item.sub_question_performance_ratio, // 使用完成率 (0-1)
                            subQuestion: item.sub_question_name,
                            subject: item.subject_id,
                            task: item.task_id,
                            score: item.sub_question_score,
                            maxScore: item.sub_question_max_score
                        }));
                        
                        datasets.push({
                            label: group.toUpperCase(),
                            data: chartData,
                            backgroundColor: colors[group],
                            borderColor: colors[group],
                            borderWidth: 1,
                            pointRadius: 4
                        });
                    });
                } else {
                    // 主问题视图：显示该任务的主问题数据
                    groups.forEach(group => {
                        const groupData = comparisonResults.individual
                            .filter(item => item.group_type === group && item.task_id === taskId);
                        
                        const chartData = groupData.map(item => ({
                            x: item.eye_movement_coefficient,
                            y: item.performance_ratio, // 使用完成率 (0-1)
                            subject: item.subject_id,
                            task: item.task_id,
                            score: item.mmse_score,
                            maxScore: item.mmse_max_score
                        }));
                        
                        datasets.push({
                            label: group.toUpperCase(),
                            data: chartData,
                            backgroundColor: colors[group],
                            borderColor: colors[group],
                            borderWidth: 1,
                            pointRadius: 4
                        });
                    });
                }
                
                // 创建图表
                comparisonChart[taskId] = new Chart(ctx, {
                    type: 'scatter',
                    data: { datasets },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: taskId === 'Q1', // 只在第一个图表显示图例
                                position: 'top',
                                labels: {
                                    boxWidth: 12,
                                    font: {
                                        size: 10
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const raw = context.raw;
                                        const ratio = (raw.y * 100).toFixed(1);
                                        let label = `${context.dataset.label}: 眼动系数=${raw.x.toFixed(3)}, 完成率=${ratio}%`;
                                        if (raw.subject) {
                                            label += ` (${raw.subject})`;
                                        }
                                        if (raw.subQuestion) {
                                            label += ` - ${raw.subQuestion}`;
                                        }
                                        if (raw.score !== undefined) {
                                            label += ` [${raw.score}/${raw.maxScore}]`;
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: '眼动系数',
                                    font: {
                                        size: 10
                                    }
                                },
                                min: 0,
                                max: 1,
                                ticks: {
                                    font: {
                                        size: 9
                                    }
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'MMSE完成率',
                                    font: {
                                        size: 10
                                    }
                                },
                                min: 0,
                                max: 1,
                                ticks: {
                                    callback: function(value) {
                                        return (value * 100).toFixed(0) + '%';
                                    },
                                    font: {
                                        size: 9
                                    }
                                }
                            }
                        }
                    }
                });
            });
        }

        // 切换视图模式
        function toggleViewMode() {
            console.log('🔄 切换视图模式');
            
            currentViewMode = currentViewMode === 'individual' ? 'group' : 'individual';
            
            // 更新按钮文本
            const toggleBtn = document.getElementById('toggleViewMode');
            const switchText = currentViewMode === 'individual' ? 
                (currentLanguage === 'zh' ? '切换到群体视图' : 'Switch to Group View') :
                (currentLanguage === 'zh' ? '切换到个人视图' : 'Switch to Individual View');
            
            if (toggleBtn) {
                toggleBtn.querySelector('span').textContent = switchText;
            }
            
            // 切换表头
            const individualHeaders = document.getElementById('individualViewHeaders');
            const groupHeaders = document.getElementById('groupViewHeaders');
            
            if (currentViewMode === 'individual') {
                individualHeaders.style.display = '';
                groupHeaders.style.display = 'none';
            } else {
                individualHeaders.style.display = 'none';
                groupHeaders.style.display = '';
            }
            
            // 更新表格内容
            if (comparisonResults) {
                updateComparisonTable();
            }
        }

        // 切换详细模式（主问题 vs 子问题）
        function toggleDetailMode() {
            currentDetailMode = currentDetailMode === 'main' ? 'subQuestion' : 'main';
            
            const buttonText = document.querySelector('#toggleDetailMode span');
            if (currentDetailMode === 'main') {
                buttonText.setAttribute('data-lang-key', 'switchToSubQuestionView');
                buttonText.textContent = currentLanguage === 'zh' ? '切换到子问题详细视图' : 'Switch to Sub-Question Detail View';
            } else {
                buttonText.setAttribute('data-lang-key', 'switchToMainQuestionView');
                buttonText.textContent = currentLanguage === 'zh' ? '切换到主问题视图' : 'Switch to Main Question View';
            }
            
            // 切换表头显示
            const individualHeaders = document.getElementById('individualViewHeaders');
            const groupHeaders = document.getElementById('groupViewHeaders');
            const subQuestionHeaders = document.getElementById('subQuestionViewHeaders');
            
            if (currentDetailMode === 'main') {
                // 主问题视图：根据当前视图模式显示对应表头
                if (currentViewMode === 'individual') {
                    individualHeaders.style.display = '';
                    groupHeaders.style.display = 'none';
                } else {
                    individualHeaders.style.display = 'none';
                    groupHeaders.style.display = '';
                }
                subQuestionHeaders.style.display = 'none';
            } else {
                // 子问题详细视图：只显示子问题表头
                individualHeaders.style.display = 'none';
                groupHeaders.style.display = 'none';
                subQuestionHeaders.style.display = '';
            }
            
                            updateComparisonTable();
                generateComparisonChart();
                
                // 自动保存CSV文件
                autoSaveComparisonCSV();
        }

        // 导出对比报告 - 修改为保存到模块8目录并根据RQA参数分类
        function exportComparisonReport() {
            console.log('📤 导出对比报告');
            
            if (!comparisonResults) {
                alert(getLanguageText('pleasePerformMmseComparisonFirst'));
                return;
            }
            
            try {
                // 获取当前选择的RQA配置
                const dataSourceSelect = document.getElementById('module7DataSourceSelect');
                const selectedRqaConfig = dataSourceSelect ? dataSourceSelect.value : 'unknown';
                
                // 准备导出数据
                const exportData = {
                    timestamp: new Date().toISOString(),
                    analysis_type: 'eye_movement_mmse_comparison',
                    rqa_config: selectedRqaConfig,
                    data_source: `module7_integrated_features_${selectedRqaConfig}`,
                    individual_results: comparisonResults.individual,
                    group_results: comparisonResults.group,
                    summary: generateReportSummary()
                };
                
                // 创建文件名，包含RQA配置信息
                const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                const fileName = `Module8_EyeMovement_MMSE_Analysis_${selectedRqaConfig}_${timestamp}.json`;
                
                // 同时保存到服务器（通过API）和本地下载
                saveToModule8Directory(exportData, selectedRqaConfig, fileName);
                
                // 创建本地下载文件
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                // 下载文件
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = fileName;
                link.click();
                
                console.log(`✅ 对比报告导出完成: ${fileName}`);
                
            } catch (error) {
                console.error('❌ 导出报告失败:', error);
                alert(getLanguageText('exportReportFailed'));
            }
        }
        
        // 生成CSV内容的函数
        function generateCSVContent(data, type) {
            if (!data || data.length === 0) return '';
            
            let headers = [];
            let rows = [];
            
            // 根据类型设置不同的表头（英文）
            if (type === 'individual') {
                headers = [
                    'Subject_ID',
                    'Task_ID', 
                    'Group_Type',
                    'Eye_Movement_Coefficient',
                    'MMSE_Score',
                    'MMSE_Max_Score',
                    'Performance_Ratio'
                ];
                
                rows = data.map(item => [
                    item.subject_id || '',
                    item.task_id || '',
                    item.group_type || '',
                    item.eye_movement_coefficient || '',
                    item.mmse_score || '',
                    item.mmse_max_score || '',
                    item.performance_ratio || ''
                ]);
                
            } else if (type === 'group') {
                headers = [
                    'Task_ID',
                    'Group_Type',
                    'Subject_Count',
                    'Avg_Eye_Movement_Coefficient',
                    'Avg_MMSE_Score',
                    'Correlation_Coefficient',
                    'Standard_Deviation'
                ];
                
                rows = data.map(item => [
                    item.task_id || '',
                    item.group_type || '',
                    item.subject_count || '',
                    item.avg_eye_movement_coefficient || '',
                    item.avg_mmse_score || '',
                    item.correlation_coefficient || '',
                    item.standard_deviation || ''
                ]);
                
            } else if (type === 'subQuestion') {
                headers = [
                    'Subject_ID',
                    'Task_ID',
                    'Sub_Question_ID',
                    'Sub_Question_Name',
                    'Group_Type',
                    'Eye_Movement_Coefficient',
                    'Sub_Question_Score',
                    'Sub_Question_Max_Score',
                    'Sub_Question_Performance_Ratio'
                ];
                
                rows = data.map(item => [
                    item.subject_id || '',
                    item.task_id || '',
                    item.sub_question_id || '',
                    item.sub_question_name || '',
                    item.group_type || '',
                    item.eye_movement_coefficient || '',
                    item.sub_question_score || '',
                    item.sub_question_max_score || '',
                    item.sub_question_performance_ratio || ''
                ]);
            }
            
            // 生成CSV内容
            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.map(cell => {
                    // 处理包含逗号或引号的单元格
                    const cellStr = String(cell);
                    if (cellStr.includes(',') || cellStr.includes('"') || cellStr.includes('\n')) {
                        return `"${cellStr.replace(/"/g, '""')}"`;
                    }
                    return cellStr;
                }).join(','))
            ].join('\n');
            
            return csvContent;
        }
        
        // 保存CSV文件到模块8目录
        async function saveCSVToModule8(csvContent, rqaConfig, fileName) {
            try {
                const response = await fetch('/api/save-module8-results', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        data: csvContent,
                        rqa_config: rqaConfig,
                        filename: fileName,
                        content_type: 'text/csv'
                    })
                });
                
                if (response.ok) {
                    console.log(`✅ CSV文件已保存: ${fileName}`);
                    return true;
                } else {
                    console.error('❌ CSV保存失败:', response.statusText);
                    return false;
                }
            } catch (error) {
                console.error('❌ CSV保存异常:', error);
                return false;
            }
        }
        
        // 自动生成并保存三种类型的CSV文件
        async function autoSaveComparisonCSV() {
            if (!comparisonResults) {
                console.log('⚠️ 没有对比结果数据，跳过CSV保存');
                return;
            }
            
            // 获取当前选择的RQA配置
            const dataSourceSelect = document.getElementById('module7DataSourceSelect');
            const selectedRqaConfig = dataSourceSelect ? dataSourceSelect.value : '';
            
            if (!selectedRqaConfig) {
                console.log('⚠️ 未选择RQA配置，跳过CSV保存');
                return;
            }
            
            console.log('📊 开始自动保存对比表格CSV文件...');
            
            // 生成时间戳
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, 19);
            
            const savePromises = [];
            
            // 1. 保存个人视图数据
            if (comparisonResults.individual && comparisonResults.individual.length > 0) {
                const individualCSV = generateCSVContent(comparisonResults.individual, 'individual');
                const individualFileName = `individual_comparison_${selectedRqaConfig}_${timestamp}.csv`;
                savePromises.push(saveCSVToModule8(individualCSV, selectedRqaConfig, individualFileName));
                console.log(`📝 生成个人视图CSV: ${individualFileName}`);
            }
            
            // 2. 保存群体视图数据
            if (comparisonResults.group && comparisonResults.group.length > 0) {
                const groupCSV = generateCSVContent(comparisonResults.group, 'group');
                const groupFileName = `group_comparison_${selectedRqaConfig}_${timestamp}.csv`;
                savePromises.push(saveCSVToModule8(groupCSV, selectedRqaConfig, groupFileName));
                console.log(`📝 生成群体视图CSV: ${groupFileName}`);
            }
            
            // 3. 保存子问题详细视图数据
            if (comparisonResults.subQuestions && comparisonResults.subQuestions.length > 0) {
                const subQuestionCSV = generateCSVContent(comparisonResults.subQuestions, 'subQuestion');
                const subQuestionFileName = `subquestion_comparison_${selectedRqaConfig}_${timestamp}.csv`;
                savePromises.push(saveCSVToModule8(subQuestionCSV, selectedRqaConfig, subQuestionFileName));
                console.log(`📝 生成子问题视图CSV: ${subQuestionFileName}`);
            }
            
            // 等待所有保存操作完成
            try {
                const results = await Promise.all(savePromises);
                const successCount = results.filter(r => r).length;
                console.log(`✅ CSV文件保存完成: ${successCount}/${results.length} 个文件成功保存`);
            } catch (error) {
                console.error('❌ CSV文件批量保存失败:', error);
            }
        }

        // 保存到模块8目录
        async function saveToModule8Directory(exportData, rqaConfig, fileName) {
            try {
                console.log(`💾 保存分析结果到模块8目录: ${rqaConfig}/${fileName}`);
                
                const response = await fetch('/api/save-module8-results', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        rqa_config: rqaConfig,
                        file_name: fileName,
                        data: exportData
                    })
                });
                
                if (response.ok) {
                    console.log('✅ 分析结果已保存到模块8目录');
                } else {
                    console.log('⚠️ 无法保存到服务器，仅提供本地下载');
                }
            } catch (error) {
                console.log('⚠️ 服务器保存失败，仅提供本地下载:', error);
            }
        }

        // 生成报告摘要
        function generateReportSummary() {
            if (!comparisonResults) return {};
            
            const summary = {
                total_subjects: new Set(comparisonResults.individual.map(item => item.subject_id)).size,
                total_sessions: comparisonResults.individual.length,
                group_summary: {}
            };
            
            ['control', 'mci', 'ad'].forEach(group => {
                const groupData = comparisonResults.individual.filter(item => item.group_type === group);
                if (groupData.length > 0) {
                    summary.group_summary[group] = {
                        subject_count: new Set(groupData.map(item => item.subject_id)).size,
                        avg_eye_coefficient: groupData.reduce((sum, item) => sum + item.eye_movement_coefficient, 0) / groupData.length,
                        avg_mmse_score: groupData.reduce((sum, item) => sum + item.mmse_score, 0) / groupData.length,
                        correlation: calculateCorrelation(
                            groupData.map(item => item.eye_movement_coefficient),
                            groupData.map(item => item.mmse_score)
                        )
                    };
                }
            });
            
            return summary;
        }

        // 更新状态文本
        function updateStatusText(text) {
            const statusElement = document.getElementById('aiStatusText');
            if (statusElement) {
                statusElement.textContent = text;
            }
        }

        // 调用模块8的智能分析初始化函数
        function initIntelligentAnalysis() {
            console.log('🚀 初始化智能分析模块');
            initEyeMovementMMSEAnalysis();
        }



        console.log('🧠 模块8眼动系数与MMSE对比分析模块脚本加载完成');
        // ================= 模块8：眼动系数与MMSE对比分析 JavaScript 代码结束 =================

        // ================= 模块9：机器学习预测分析 JavaScript 代码开始 =================
        
        // 全局变量
        let mlCurrentConfig = null;
        let mlPreprocessedData = null;

        // 模块9导航切换函数
        // 显示特征方向验证状态
        function showDirectionValidationStatus(isValid, message) {
            const statusElement = document.getElementById('directionValidationStatus');
            const messageElement = document.getElementById('validationMessage');
            
            if (statusElement && messageElement) {
                statusElement.style.display = 'block';
                messageElement.textContent = message;
                
                const alertDiv = statusElement.querySelector('.alert');
                if (isValid) {
                    alertDiv.className = 'alert alert-success alert-sm mb-0';
                    messageElement.innerHTML = `<i class="fas fa-check-circle text-success"></i> ${message}`;
                } else {
                    alertDiv.className = 'alert alert-warning alert-sm mb-0';
                    messageElement.innerHTML = `<i class="fas fa-exclamation-triangle text-warning"></i> ${message}`;
                }
            }
        }
        
        function switchToNinthModule() {
            // 隐藏所有其他视图
            document.querySelectorAll('.enhanced-visualization-container, .new-feature-view, .rqa-analysis-view, .event-analysis-view, .rqa-pipeline-view, .feature-extraction-view, .seventh-module-view, .eighth-module-view, .ninth-module-view, .tenth-module-view').forEach(view => {
                view.style.display = 'none';
            });
            
            // 显示模块9视图
            const ninthView = document.getElementById('ninthModuleView');
            if (ninthView) {
                ninthView.style.display = 'block';
                
                // 更新导航菜单激活状态
                document.querySelectorAll('.sidebar-nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector('[data-view="ninthModule"]').classList.add('active');
                
                // 初始化模块9
                initNinthModule();
                
                console.log('✅ 切换到模块9 - 机器学习预测分析');
            }
        }

        // 初始化模块9
        function initNinthModule() {
    // 初始化训练方法选择
    onTrainingMethodChange();
    
    // 隐藏结果区域
    document.getElementById('cvResultsSection').style.display = 'none';
    document.getElementById('testEvaluationSection').style.display = 'none';
    
    // 重置CV进度
    document.getElementById('cvTrainingProgress').style.display = 'none';
            console.log('🚀 初始化模块9 - 机器学习预测分析');
            
            // 加载可用的RQA配置
            loadMLAvailableConfigs();
            
            // 初始化UI状态
            resetMLUI();
        }

        // 加载可用的RQA配置
        async function loadMLAvailableConfigs() {
            try {
                console.log('📂 加载可用的RQA配置...');
                
                const response = await fetch('/api/ml/available-configs');
                const data = await response.json();
                
                const selectElement = document.getElementById('mlRqaConfigSelect');
                
                if (data.success && data.configs.length > 0) {
                    selectElement.innerHTML = '<option value="">请选择RQA配置...</option>';
                    
                    data.configs.forEach(config => {
                        const option = document.createElement('option');
                        option.value = config.id;
                        option.textContent = `${config.display_name} (${config.file_count}个文件)`;
                        selectElement.appendChild(option);
                    });
                    
                    // 添加选择事件监听器
                    selectElement.addEventListener('change', onMLConfigChange);
                    
                    console.log(`✅ 加载了 ${data.configs.length} 个RQA配置`);
                } else {
                    selectElement.innerHTML = '<option value="">暂无可用配置</option>';
                    console.log('⚠️ 未找到可用的RQA配置');
                }
                
            } catch (error) {
                console.error('❌ 加载RQA配置失败:', error);
                document.getElementById('mlRqaConfigSelect').innerHTML = '<option value="">加载失败</option>';
            }
        }

        // RQA配置选择变化事件
        function onMLConfigChange(event) {
            const selectedConfig = event.target.value;
            
            if (selectedConfig) {
                mlCurrentConfig = selectedConfig;
                
                // 启用按钮
                document.getElementById('preprocessDataBtn').disabled = false;
                document.getElementById('refreshDataBtn').disabled = false;
                
                // 更新状态
                updateMLStatus('ready', `已选择配置: ${selectedConfig}`);
                
                console.log(`📋 选择了RQA配置: ${selectedConfig}`);
            } else {
                mlCurrentConfig = null;
                
                // 禁用按钮
                document.getElementById('preprocessDataBtn').disabled = true;
                document.getElementById('refreshDataBtn').disabled = true;
                
                // 重置状态
                resetMLUI();
            }
        }

        // 开始数据预处理
        async function startDataPreprocessing() {
            if (!mlCurrentConfig) {
                alert('请先选择RQA配置');
                return;
            }
            
            try {
                console.log('🚀 开始数据预处理...');
                
                // 更新UI状态
                updateMLStatus('processing', '正在处理数据...');
                document.getElementById('preprocessDataBtn').disabled = true;
                
                // 清空日志
                const logElement = document.getElementById('mlProcessingLog');
                logElement.innerHTML = '';
                
                addLog('🚀 开始执行模块9.1数据预处理');
                addLog(`📋 使用RQA配置: ${mlCurrentConfig}`);
                
                // 获取特征方向校正配置
                const enableDirectionCorrection = document.getElementById('enableFeatureCorrection').checked;
                addLog(`🔄 特征方向校正: ${enableDirectionCorrection ? '启用' : '禁用'}`);
                
                // 调用后端API
                const response = await fetch('/api/ml/preprocess-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        rqa_config: mlCurrentConfig,
                        enable_direction_correction: enableDirectionCorrection
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // 处理成功
                    mlPreprocessedData = result;
                    
                    addLog('✅ 数据预处理完成！');
                    addLog(`📊 数据统计: ${result.stats.total_samples}个样本, ${result.stats.feature_count}个特征`);
                    
                    // 显示特征方向验证结果
                    if (enableDirectionCorrection && result.stats.direction_validation) {
                        const validation = result.stats.direction_validation;
                        if (validation.all_positive) {
                            addLog('✅ 特征方向验证: 所有特征与MMSE总分正相关');
                            showDirectionValidationStatus(true, '所有特征已统一为正相关方向');
                        } else {
                            addLog(`⚠️ 特征方向验证: 发现负相关特征 ${validation.negative_features.join(', ')}`);
                            showDirectionValidationStatus(false, `发现负相关特征: ${validation.negative_features.join(', ')}`);
                        }
                        
                        // 显示变换信息
                        if (result.stats.feature_transforms && result.stats.feature_transforms.length > 0) {
                            addLog(`🔄 应用了 ${result.stats.feature_transforms.length} 个特征变换`);
                        }
                    }
                    
                    // 更新统计信息
                    updateMLStatistics(result.stats);
                    
                    // 更新状态
                    updateMLStatus('completed', '数据预处理完成');
                    
                    // 显示后续模块
                    showNextModules();
                    
                    console.log('✅ 数据预处理完成:', result);
                } else {
                    // 处理失败
                    addLog(`❌ 处理失败: ${result.error}`);
                    updateMLStatus('error', `处理失败: ${result.error}`);
                    console.error('❌ 数据预处理失败:', result.error);
                }
                
            } catch (error) {
                console.error('❌ 数据预处理异常:', error);
                updateMLStatus('error', `处理异常: ${error.message}`);
                
                const logElement = document.getElementById('mlProcessingLog');
                logElement.innerHTML += `❌ 处理异常: ${error.message}\n`;
            } finally {
                // 恢复按钮状态
                document.getElementById('preprocessDataBtn').disabled = false;
            }
        }

        // 更新机器学习状态
        function updateMLStatus(status, detail) {
            const statusElement = document.getElementById('mlDataStatus');
            const detailElement = document.getElementById('mlDataStatusDetail');
            
            switch (status) {
                case 'ready':
                    statusElement.className = 'badge bg-primary';
                    statusElement.innerHTML = '<span data-lang-key="ready">就绪</span>';
                    break;
                case 'processing':
                    statusElement.className = 'badge bg-warning';
                    statusElement.innerHTML = '<span data-lang-key="processing">处理中</span>';
                    break;
                case 'completed':
                    statusElement.className = 'badge bg-success';
                    statusElement.innerHTML = '<span data-lang-key="completed">完成</span>';
                    break;
                case 'error':
                    statusElement.className = 'badge bg-danger';
                    statusElement.innerHTML = '<span data-lang-key="error">错误</span>';
                    break;
                default:
                    statusElement.className = 'badge bg-secondary';
                    statusElement.innerHTML = '<span data-lang-key="notProcessed">未处理</span>';
            }
            
            if (detail) {
                detailElement.textContent = detail;
            }
        }

        // 更新统计信息
        function updateMLStatistics(stats) {
            document.getElementById('mlTotalSamples').textContent = stats.total_samples || '-';
            document.getElementById('mlTrainSamples').textContent = stats.train_samples || '-';
            document.getElementById('mlTestSamples').textContent = stats.test_samples || '-';
            document.getElementById('mlFeatureCount').textContent = stats.feature_count || '-';
        }

        // 显示后续模块
        function showNextModules() {
            document.getElementById('modelTrainingSection').style.display = 'block';
            document.getElementById('predictionVisualizationSection').style.display = 'block';
        }

        // 刷新机器学习数据
        function refreshMLData() {
            console.log('🔄 刷新机器学习数据');
            
            // 重新加载配置
            loadMLAvailableConfigs();
            
            // 重置UI
            resetMLUI();
        }

        // 更新测试集评估结果表格
        function updateTestEvaluationTable(detailedEval, stats) {
            if (!detailedEval) return;
            
            console.log('🎯 开始更新测试集评估表格', detailedEval);
            
            // 显示测试集评估结果区域
            document.getElementById('testEvaluationSection').style.display = 'block';
            
            // 更新整体性能指标
            const overall = detailedEval.overall;
            if (overall) {
                document.getElementById('overallMSE').textContent = overall.mse.toFixed(4);
                document.getElementById('overallRMSE').textContent = overall.rmse.toFixed(4);
                document.getElementById('overallMAE').textContent = overall.mae.toFixed(4);
                document.getElementById('overallR2').textContent = overall.r2.toFixed(4);
                
                // R²值的颜色处理
                const r2Element = document.getElementById('overallR2');
                if (overall.r2 < 0) {
                    r2Element.className = 'text-danger';
                } else if (overall.r2 < 0.5) {
                    r2Element.className = 'text-warning';
                } else {
                    r2Element.className = 'text-success';
                }
            }
            
            // 更新各子分数详细表格
            const subscoreTableBody = document.getElementById('subscoreTableBody');
            subscoreTableBody.innerHTML = '';
            
            if (detailedEval.subscore_results) {
                detailedEval.subscore_results.forEach(sub => {
                    const row = document.createElement('tr');
                    
                    // 性能评级判断
                    let performanceClass = '';
                    let performanceText = '';
                    if (sub.relative_error < 15 && sub.r2 > 0.7) {
                        performanceClass = 'badge-success';
                        performanceText = '优秀';
                    } else if (sub.relative_error < 25 && sub.r2 > 0.5) {
                        performanceClass = 'badge-primary';
                        performanceText = '良好';
                    } else if (sub.relative_error < 35 && sub.r2 > 0.3) {
                        performanceClass = 'badge-warning';
                        performanceText = '中等';
                    } else {
                        performanceClass = 'badge-danger';
                        performanceText = '需改进';
                    }
                    
                    // R²值的颜色处理
                    let r2Color = sub.r2 < 0 ? 'text-danger' : (sub.r2 < 0.5 ? 'text-warning' : 'text-success');
                    
                    row.innerHTML = `
                        <td><strong>${sub.name}</strong></td>
                        <td class="text-center">${sub.max_score}</td>
                        <td class="text-center">${sub.mae.toFixed(3)}</td>
                        <td class="text-center">
                            <span class="${sub.relative_error > 50 ? 'text-danger' : (sub.relative_error > 30 ? 'text-warning' : 'text-success')}">
                                ${sub.relative_error.toFixed(1)}%
                            </span>
                        </td>
                        <td class="text-center">${sub.rmse.toFixed(3)}</td>
                        <td class="text-center">
                            <span class="${r2Color}">${sub.r2.toFixed(3)}</span>
                        </td>
                        <td class="text-center">
                            <span class="badge ${performanceClass}">${performanceText}</span>
                        </td>
                    `;
                    
                    subscoreTableBody.appendChild(row);
                });
            }
            
            // 更新性能分级评估
            if (detailedEval.performance_grade) {
                const gradeEmojis = {
                    '优秀': '🏆',
                    '良好': '🥈', 
                    '中等': '🥉',
                    '需改进': '⚠️'
                };
                const gradeColors = {
                    '优秀': 'text-success',
                    '良好': 'text-primary', 
                    '中等': 'text-warning',
                    '需改进': 'text-danger'
                };
                
                const emoji = gradeEmojis[detailedEval.performance_grade] || '📊';
                const colorClass = gradeColors[detailedEval.performance_grade] || 'text-secondary';
                
                const gradeDisplay = document.getElementById('performanceGradeDisplay');
                gradeDisplay.innerHTML = `<span class="${colorClass}">${emoji} ${detailedEval.performance_grade}</span>`;
                
                document.getElementById('avgRelativeErrorDisplay').textContent = `${detailedEval.avg_relative_error.toFixed(1)}%`;
                document.getElementById('avgR2Display').textContent = detailedEval.avg_r2.toFixed(3);
            }
            
            // 更新泛化分析
            if (detailedEval.overfitting_ratio && stats) {
                document.getElementById('overfittingRatioDisplay').textContent = detailedEval.overfitting_ratio.toFixed(2);
                document.getElementById('generalizationGapDisplay').textContent = detailedEval.generalization_gap.toFixed(4);
                
                // 计算训练-测试差距
                if (overall) {
                    const trainTestGap = Math.abs(overall.mse - stats.final_train_loss);
                    document.getElementById('trainTestGapDisplay').textContent = trainTestGap.toFixed(4);
                }
            }
            
            console.log('✅ 测试集评估表格更新完成');
        }

        // 重置机器学习UI
        function resetMLUI() {
            // 重置状态
            updateMLStatus('default', '选择RQA配置开始处理');
            
            // 重置统计信息
            updateMLStatistics({});
            
            // 清空日志
            document.getElementById('mlProcessingLog').innerHTML = '<span data-lang-key="noLogYet">暂无日志...</span>';
            
            // 隐藏后续模块
            document.getElementById('modelTrainingSection').style.display = 'none';
            document.getElementById('predictionVisualizationSection').style.display = 'none';
            document.getElementById('testEvaluationSection').style.display = 'none';
            
            // 重置全局变量
            mlPreprocessedData = null;
            
            // 重置训练UI
            resetTrainingUI();
        }

        // =================== 通用日志函数 ===================
        
        // 全局日志函数
        function addLog(message) {
            const logElement = document.getElementById('mlProcessingLog');
            if (logElement) {
                const timestamp = new Date().toLocaleTimeString();
                logElement.innerHTML += `[${timestamp}] ${message}\n`;
                logElement.scrollTop = logElement.scrollHeight;
            } else {
                console.log(`[ML Log] ${message}`);
            }
        }
        
        // =================== 子模块9.2: MLP模型训练相关函数 ===================
        
        // 模型预设变化处理
        function onModelPresetChange() {
            const preset = document.getElementById('modelPresetSelect').value;
            const customGroup = document.getElementById('customLayersGroup');
            const hiddenLayersInput = document.getElementById('hiddenLayersConfig');
            
            if (preset === 'custom') {
                customGroup.style.display = 'block';
            } else {
                customGroup.style.display = 'none';
                
                // 设置预设配置
                const presets = {
                    'simple': '32',
                    'moderate': '64,32', 
                    'complex': '64,32,16'
                };
                hiddenLayersInput.value = presets[preset] || '32';
            }
        }
        
        // 开始MLP训练
        // 训练方法切换
function onTrainingMethodChange() {
    const method = document.getElementById('trainingMethodSelect').value;
    const cvParamsGroup = document.getElementById('cvParamsGroup');
    const regularizationGroup = document.getElementById('regularizationGroup');
    
    if (method === 'cv') {
        cvParamsGroup.style.display = 'block';
        regularizationGroup.style.display = 'none';  // CV有自己的正则化参数
    } else {
        cvParamsGroup.style.display = 'none';
        regularizationGroup.style.display = 'block';
    }
}

// 统一训练入口
async function startTraining() {
    const method = document.getElementById('trainingMethodSelect').value;
    
    if (method === 'cv') {
        await startCVTraining();
    } else {
        await startMLPTraining();
    }
}

// 5-fold交叉验证训练
async function startCVTraining() {
    try {
        // 检查是否有预处理数据
        if (!mlCurrentConfig) {
            alert('请先完成数据预处理步骤');
            return;
        }
        
        addLog('🚀 开始5-fold交叉验证训练');
        
        // 获取CV参数
        const cvParams = {
            n_splits: parseInt(document.getElementById('cvFoldsConfig').value),
            patience: parseInt(document.getElementById('cvPatienceConfig').value),
            epochs: parseInt(document.getElementById('cvEpochsConfig').value),
            dropout: parseFloat(document.getElementById('cvDropoutConfig').value),
            l2_reg: parseFloat(document.getElementById('cvL2Config').value),
            batch_size: 8  // 专家建议固定为8
        };
        
        addLog(`🔧 CV参数配置: ${JSON.stringify(cvParams, null, 2)}`);
        
        // 禁用训练按钮
        const startBtn = document.getElementById('startTrainingBtn');
        startBtn.disabled = true;
        startBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> CV训练中...';
        
        // 显示CV进度区域
        document.getElementById('cvTrainingProgress').style.display = 'block';
        updateCVProgress(0, 5, '正在初始化CV训练...');
        
        // 发送CV训练请求
        const response = await fetch('/api/ml/cv-train', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                config_name: mlCurrentConfig,
                cv_params: cvParams
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            addLog('✅ 5-fold交叉验证训练完成!');
            
            // 显示CV结果
            displayCVResults(result);
            
            // 隐藏进度，显示结果
            document.getElementById('cvTrainingProgress').style.display = 'none';
            document.getElementById('cvResultsSection').style.display = 'block';
            
        } else {
            addLog(`❌ CV训练失败: ${result.error}`);
            alert(`CV训练失败: ${result.error}`);
        }
        
    } catch (error) {
        addLog(`❌ CV训练请求失败: ${error.message}`);
        console.error('CV训练错误:', error);
        alert(`CV训练请求失败: ${error.message}`);
    } finally {
        // 恢复训练按钮
        const startBtn = document.getElementById('startTrainingBtn');
        startBtn.disabled = false;
        startBtn.innerHTML = '<i class="fas fa-play"></i> 开始训练';
        
        // 隐藏进度
        document.getElementById('cvTrainingProgress').style.display = 'none';
    }
}

// 更新CV训练进度
function updateCVProgress(current, total, status) {
    const progress = (current / total) * 100;
    const progressBar = document.getElementById('cvProgressBar');
    const progressText = document.getElementById('cvProgressText');
    const statusText = document.getElementById('cvCurrentStatus');
    
    if (progressBar) {
        progressBar.style.width = `${progress}%`;
    }
    if (progressText) {
        progressText.textContent = `${current}/${total} 折叠完成`;
    }
    if (statusText) {
        statusText.textContent = status;
    }
}

// 显示CV结果
function displayCVResults(result) {
    // 集成性能指标
    const ensembleMetrics = result.ensemble_metrics;
    document.getElementById('cvEnsembleRMSE').textContent = ensembleMetrics.rmse.toFixed(4);
    document.getElementById('cvEnsembleMAE').textContent = ensembleMetrics.mae.toFixed(4);
    document.getElementById('cvEnsembleR2').textContent = ensembleMetrics.r2.toFixed(4);
    
    // CV统计
    const cvStats = result.cv_stats;
    document.getElementById('cvMeanRMSE').textContent = 
        `${cvStats.cv_rmse_mean.toFixed(4)} ± ${cvStats.cv_rmse_std.toFixed(4)}`;
    
    // 折叠详细结果
    const foldResults = document.getElementById('cvFoldResults');
    foldResults.innerHTML = '';
    
    result.fold_metrics.forEach((fold, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>Fold ${index + 1}</td>
            <td>${fold.val_rmse.toFixed(4)}</td>
            <td>${fold.val_mae.toFixed(4)}</td>
            <td>${fold.val_r2.toFixed(4)}</td>
            <td>${fold.best_epoch}</td>
            <td>${fold.final_train_loss.toFixed(4)}</td>
            <td>${fold.final_val_loss.toFixed(4)}</td>
        `;
        foldResults.appendChild(row);
    });
    
    // 详细子分数性能
    const detailedResults = document.getElementById('cvDetailedResults');
    detailedResults.innerHTML = '';
    
    const targetNames = ['Q1_subscore', 'Q2_subscore', 'Q3_subscore', 'Q4_subscore', 'Q5_subscore'];
    const targetLabels = ['时间定向', '空间定向', '即时记忆', '注意/计算', '延迟回忆'];
    const maxScores = [5, 5, 3, 5, 3];
    
    targetNames.forEach((target, index) => {
        const metrics = result.detailed_metrics[target];
        const relativeError = (metrics.mae / maxScores[index]) * 100;
        
        // 性能等级
        let grade = '需改进';
        let gradeClass = 'bg-danger';
        if (metrics.r2 > 0.5) {
            grade = '优秀';
            gradeClass = 'bg-success';
        } else if (metrics.r2 > 0.2) {
            grade = '良好';
            gradeClass = 'bg-warning';
        } else if (metrics.r2 > 0) {
            grade = '一般';
            gradeClass = 'bg-info';
        }
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${targetLabels[index]} (Q${index + 1})</td>
            <td>${metrics.rmse.toFixed(4)}</td>
            <td>${metrics.mae.toFixed(4)}</td>
            <td>${metrics.r2.toFixed(4)}</td>
            <td>${relativeError.toFixed(1)}%</td>
            <td><span class="badge ${gradeClass}">${grade}</span></td>
        `;
        detailedResults.appendChild(row);
    });
    
    // 记录详细日志
    addLog('📊 CV结果详情:');
    addLog(`  🎯 集成RMSE: ${ensembleMetrics.rmse.toFixed(4)}`);
    addLog(`  📏 集成MAE: ${ensembleMetrics.mae.toFixed(4)}`);
    addLog(`  📈 集成R²: ${ensembleMetrics.r2.toFixed(4)}`);
    addLog(`  📊 CV RMSE: ${cvStats.cv_rmse_mean.toFixed(4)} ± ${cvStats.cv_rmse_std.toFixed(4)}`);
    addLog(`  🏆 最佳折叠: Fold ${cvStats.best_fold + 1}`);
}

async function startMLPTraining() {
            if (!mlCurrentConfig) {
                alert('请先选择RQA配置并完成数据预处理');
                return;
            }
            
            try {
                console.log('🚀 开始优化的MLP模型训练...');
                
                // 收集训练参数
                let hiddenLayersText;
                const preset = document.getElementById('modelPresetSelect').value;
                
                if (preset === 'custom') {
                    hiddenLayersText = document.getElementById('hiddenLayersConfig').value;
                } else {
                    const presets = {
                        'simple': '32',
                        'moderate': '64,32',
                        'complex': '64,32,16'
                    };
                    hiddenLayersText = presets[preset];
                }
                
                const hiddenLayers = hiddenLayersText.split(',').map(x => parseInt(x.trim())).filter(x => !isNaN(x));
                
                if (hiddenLayers.length === 0) {
                    alert('请输入有效的隐藏层配置，例如: 32 或 64,32');
                    return;
                }
                
                const modelParams = {
                    model_type: preset,
                    hidden_layers: hiddenLayers,
                    epochs: parseInt(document.getElementById('epochsConfig').value),
                    batch_size: parseInt(document.getElementById('batchSizeConfig').value),
                    learning_rate: parseFloat(document.getElementById('learningRateConfig').value),
                    validation_split: parseFloat(document.getElementById('validationSplitConfig').value),
                    early_stopping_patience: parseInt(document.getElementById('earlyStoppingConfig').value),
                    // 正则化参数
                    use_dropout: document.getElementById('useDropout').checked,
                    dropout_rate: parseFloat(document.getElementById('dropoutRateConfig').value),
                    use_l2_regularization: document.getElementById('useL2Reg').checked,
                    l2_lambda: parseFloat(document.getElementById('l2LambdaConfig').value)
                };
                
                console.log('⚙️ 优化训练参数:', modelParams);
                
                // 更新UI状态
                updateTrainingStatus('training', '正在训练模型...');
                document.getElementById('startTrainingBtn').disabled = true;
                document.getElementById('startTrainingBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> 训练中...';
                
                // 清空训练日志
                const logElement = document.getElementById('mlTrainingLog');
                logElement.innerHTML = '';
                
                // 添加日志函数
                function addTrainingLog(message) {
                    const timestamp = new Date().toLocaleTimeString();
                    logElement.innerHTML += `[${timestamp}] ${message}\n`;
                    logElement.scrollTop = logElement.scrollHeight;
                }
                
                addTrainingLog('🚀 开始MLP模型训练');
                addTrainingLog(`📋 使用配置: ${mlCurrentConfig}`);
                addTrainingLog(`⚙️ 模型参数: ${JSON.stringify(modelParams, null, 2)}`);
                
                // 调用后端API
                const response = await fetch('/api/ml/train-model', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        config_name: mlCurrentConfig,
                        model_params: modelParams
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // 训练成功
                    console.log('✅ MLP模型训练完成');
                    addTrainingLog('✅ MLP模型训练完成!');
                    
                    updateTrainingStatus('completed', '训练完成');
                    
                    // 更新训练统计信息
                    const stats = result.training_stats;
                    const detailedEval = result.detailed_evaluation;
                    
                    console.log('📊 训练结果数据:', {
                        stats: stats,
                        detailedEval: detailedEval,
                        hasDetailedEval: !!detailedEval
                    });
                    
                    if (stats) {
                        document.getElementById('mlCurrentEpoch').textContent = stats.epochs_trained || '-';
                        document.getElementById('mlTrainingLoss').textContent = stats.final_train_loss ? stats.final_train_loss.toFixed(4) : '-';
                        document.getElementById('mlValidationLoss').textContent = stats.final_val_loss ? stats.final_val_loss.toFixed(4) : '-';
                        
                        // 显示详细测试集MAE而不是验证损失
                        if (detailedEval && detailedEval.overall) {
                            document.getElementById('mlTestMAE').textContent = detailedEval.overall.mae.toFixed(4);
                        } else {
                            document.getElementById('mlTestMAE').textContent = stats.best_val_loss ? stats.best_val_loss.toFixed(4) : '-';
                        }
                        
                        addTrainingLog(`📊 训练轮数: ${stats.epochs_trained}`);
                        addTrainingLog(`📈 最终训练损失: ${stats.final_train_loss?.toFixed(4)}`);
                        addTrainingLog(`📉 最终验证损失: ${stats.final_val_loss?.toFixed(4)}`);
                        addTrainingLog(`🎯 最佳验证损失: ${stats.best_val_loss?.toFixed(4)}`);
                    }
                    
                    // 显示详细测试集评估结果
                    if (detailedEval) {
                        addTrainingLog(`🎯 详细测试集性能分析:`);
                        
                        const overall = detailedEval.overall;
                        if (overall) {
                            addTrainingLog(`  TEST MSE: ${overall.mse.toFixed(4)}`);
                            addTrainingLog(`  TEST RMSE: ${overall.rmse.toFixed(4)}`);
                            addTrainingLog(`  TEST MAE: ${overall.mae.toFixed(4)}`);
                            addTrainingLog(`  TEST R²: ${overall.r2.toFixed(4)}`);
                        }
                        
                        // 各子分数详细性能
                        if (detailedEval.subscore_results) {
                            addTrainingLog(`📋 各MMSE子分数详细性能:`);
                            detailedEval.subscore_results.forEach(sub => {
                                addTrainingLog(`  ${sub.name}:`);
                                addTrainingLog(`    MAE: ${sub.mae.toFixed(3)} (相对误差: ${sub.relative_error.toFixed(1)}%)`);
                                addTrainingLog(`    RMSE: ${sub.rmse.toFixed(3)}`);
                                addTrainingLog(`    R²: ${sub.r2.toFixed(3)}`);
                                addTrainingLog(`    满分: ${sub.max_score}`);
                            });
                        }
                        
                        // 性能分级评估
                        if (detailedEval.performance_grade) {
                            const gradeEmojis = {
                                '优秀': '🏆',
                                '良好': '🥈', 
                                '中等': '🥉',
                                '需改进': '⚠️'
                            };
                            const emoji = gradeEmojis[detailedEval.performance_grade] || '📊';
                            addTrainingLog(`🏆 性能分级评估:`);
                            addTrainingLog(`  ${emoji} 综合评级: ${detailedEval.performance_grade}`);
                            addTrainingLog(`  平均相对误差: ${detailedEval.avg_relative_error.toFixed(1)}%`);
                            addTrainingLog(`  平均R²: ${detailedEval.avg_r2.toFixed(3)}`);
                        }
                        
                        // 过拟合分析
                        if (detailedEval.overfitting_ratio) {
                            addTrainingLog(`📊 模型泛化分析:`);
                            addTrainingLog(`  过拟合比率: ${detailedEval.overfitting_ratio.toFixed(2)}`);
                            addTrainingLog(`  泛化差距: ${detailedEval.generalization_gap.toFixed(4)}`);
                        }
                        
                        // 填充测试集评估结果表格
                        updateTestEvaluationTable(detailedEval, stats);
                    }
                    
                    // 显示子模块9.3
                    document.getElementById('predictionVisualizationSection').style.display = 'block';
                    
                } else {
                    // 训练失败
                    console.error('❌ MLP训练失败:', result.error);
                    addTrainingLog(`❌ 训练失败: ${result.error}`);
                    updateTrainingStatus('error', `训练失败: ${result.error}`);
                }
                
            } catch (error) {
                console.error('❌ MLP训练请求失败:', error);
                document.getElementById('mlTrainingLog').innerHTML += `❌ 训练请求失败: ${error.message}\n`;
                updateTrainingStatus('error', `请求失败: ${error.message}`);
            } finally {
                // 恢复按钮状态
                document.getElementById('startTrainingBtn').disabled = false;
                document.getElementById('startTrainingBtn').innerHTML = '<i class="fas fa-play"></i> 开始训练';
            }
        }
        
        // 更新训练状态
        function updateTrainingStatus(status, detail) {
            const statusElement = document.getElementById('mlTrainingStatus');
            const detailElement = document.getElementById('mlTrainingDetail');
            
            switch (status) {
                case 'training':
                    statusElement.className = 'badge bg-primary';
                    statusElement.innerHTML = '<span data-lang-key="training">训练中</span>';
                    break;
                case 'completed':
                    statusElement.className = 'badge bg-success';
                    statusElement.innerHTML = '<span data-lang-key="trainingCompleted">训练完成</span>';
                    break;
                case 'error':
                    statusElement.className = 'badge bg-danger';
                    statusElement.innerHTML = '<span data-lang-key="trainingError">训练错误</span>';
                    break;
                default:
                    statusElement.className = 'badge bg-secondary';
                    statusElement.innerHTML = '<span data-lang-key="waitingToTrain">等待训练</span>';
            }
            
            if (detail) {
                detailElement.textContent = detail;
            }
        }
        
        // 重置训练UI
        function resetTrainingUI() {
            // 重置状态
            updateTrainingStatus('default', '-');
            
            // 重置统计信息
            document.getElementById('mlCurrentEpoch').textContent = '-';
            document.getElementById('mlTrainingLoss').textContent = '-';
            document.getElementById('mlValidationLoss').textContent = '-';
            document.getElementById('mlTestMAE').textContent = '-';
            
            // 清空训练日志
            document.getElementById('mlTrainingLog').innerHTML = '<span data-lang-key="noTrainingLogYet">暂无训练日志...</span>';
            
            // 恢复按钮状态
            document.getElementById('startTrainingBtn').disabled = false;
            document.getElementById('startTrainingBtn').innerHTML = '<i class="fas fa-play"></i> 开始训练';
            
            // 隐藏日志区域
            document.getElementById('trainingLogSection').style.display = 'none';
            
            // 隐藏测试集评估表格
            document.getElementById('testEvaluationSection').style.display = 'none';
        }
        
        // 切换训练日志显示
        function toggleTrainingLog() {
            const logSection = document.getElementById('trainingLogSection');
            const btn = document.getElementById('viewTrainingLogBtn');
            
            if (logSection.style.display === 'none') {
                logSection.style.display = 'block';
                btn.innerHTML = '<i class="fas fa-eye-slash"></i> 隐藏日志';
            } else {
                logSection.style.display = 'none';
                btn.innerHTML = '<i class="fas fa-eye"></i> 查看日志';
            }
        }
        
        console.log('🧠 模块9机器学习预测分析模块脚本加载完成');
        // ================= 模块9：机器学习预测分析 JavaScript 代码结束 =================

        // ================= 模块10：Eye-Index 综合评估 JavaScript 代码开始 =================

        // 模块10导航切换函数
        function switchToTenthModule() {
            // 隐藏所有其他视图
            document.querySelectorAll('.enhanced-visualization-container, .new-feature-view, .rqa-analysis-view, .event-analysis-view, .rqa-pipeline-view, .feature-extraction-view, .seventh-module-view, .eighth-module-view, .ninth-module-view, .tenth-module-view').forEach(view => {
                view.style.display = 'none';
            });

            // 显示模块10视图
            const tenthView = document.getElementById('tenthModuleView');
            if (tenthView) {
                tenthView.style.display = 'block';

                // 更新导航菜单激活状态
                document.querySelectorAll('.sidebar-nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector('[data-view="tenthModule"]').classList.add('active');

                // 初始化模块10
                initTenthModule();
            }

            console.log('✅ 切换到模块10 - Eye-Index 综合评估');
        }

        // 初始化模块10 - PyTorch训练与模型服务
        function initTenthModule() {
            console.log('🚀 初始化模块10 - Eye-Index PyTorch训练与服务');
            
            // 延迟初始化，确保DOM加载完成
            setTimeout(function() {
                // 检查模块10的DOM是否已加载
                const module10Container = document.getElementById('tenthModuleView');
                if (!module10Container) {
                    console.error('❌ 模块10容器未找到，初始化失败');
                    return;
                }
                
                // 调用数据查看器初始化
                if (typeof initModule10CDataViewer === 'function') {
                    initModule10CDataViewer();
                }
                
                // 调用EyeIndex模块初始化（如果存在）
                if (typeof window.initEyeIndexModule === 'function') {
                    window.initEyeIndexModule();
                }
                
                // 初始化模块10-A (数据准备)
                if (typeof initModule10A === 'function') {
                    initModule10A();
                }
                
                // 初始化模块10-D (性能评估)
                if (typeof initModule10D === 'function') {
                    initModule10D();
                }
                
                // 初始化模块10-E (关联性可视化)
                if (typeof initModule10E === 'function') {
                    initModule10E();
                }
                
                // 动态加载模块10的JavaScript
                loadModule10Scripts();
            }, 500);
        }

        // 动态加载模块10相关脚本
        function loadModule10Scripts() {
            // 检查是否已经加载过
            if (window.eyeIndexModuleLoaded) {
                console.log('🔄 模块10脚本已加载，直接初始化');
                if (typeof initEyeIndexModule === 'function') {
                    initEyeIndexModule();
                }
                return;
            }
            
            const script = document.createElement('script');
            script.src = '/static/js/eye_index.js?v=' + Date.now(); // 添加时间戳避免缓存
            script.onload = function() {
                console.log('✅ 模块10 JavaScript加载完成');
                window.eyeIndexModuleLoaded = true; // 标记已加载
                
                // 初始化各个子模块
                if (typeof initEyeIndexModule === 'function') {
                    initEyeIndexModule();
                }
            };
            script.onerror = function() {
                console.error('❌ 模块10 JavaScript加载失败');
            };
            document.head.appendChild(script);
        }

        
        // ================= 模块10-C：数据查看器 JavaScript 代码开始 =================
        
        // 数据查看器管理类
        class Module10CDataViewer {
            constructor() {
                this.currentData = null;
                this.currentPage = 1;
                this.pageSize = 50;
                this.searchTerm = "";
                this.sortColumn = null;
                this.sortDirection = 'asc';
                this.initialized = false;
            }
            
            init() {
                if (this.initialized) return;
                
                console.log('🚀 初始化数据查看器...');
                
                // 绑定事件
                this.bindEvents();
                
                // 加载可用数据集
                this.loadAvailableDatasets();
                
                this.initialized = true;
                console.log('✅ 数据查看器初始化完成');
            }
            
            bindEvents() {
                // 加载数据表格按钮
                const loadBtn = document.getElementById('load-data-table');
                if (loadBtn) {
                    loadBtn.onclick = () => this.loadDataTable();
                }
                
                // 统计摘要按钮
                const statsBtn = document.getElementById('show-statistics');
                if (statsBtn) {
                    statsBtn.onclick = () => this.toggleStatistics();
                }
                
                // 导出按钮
                const exportCsvBtn = document.getElementById('export-csv');
                if (exportCsvBtn) {
                    exportCsvBtn.onclick = () => this.exportData('csv');
                }
                
                const exportExcelBtn = document.getElementById('export-excel');
                if (exportExcelBtn) {
                    exportExcelBtn.onclick = () => this.exportData('excel');
                }
                
                // 对比数据集按钮
                const compareBtn = document.getElementById('compare-datasets');
                if (compareBtn) {
                    compareBtn.onclick = () => this.showCompareDialog();
                }
                
                // 分页大小选择
                const pageSizeSelect = document.getElementById('table-page-size');
                if (pageSizeSelect) {
                    pageSizeSelect.onchange = () => {
                        this.pageSize = parseInt(pageSizeSelect.value);
                        this.currentPage = 1;
                        this.renderCurrentPage();
                    };
                }
                
                // 搜索框
                const searchInput = document.getElementById('table-search');
                if (searchInput) {
                    let searchTimeout;
                    searchInput.oninput = () => {
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(() => {
                            this.searchTerm = searchInput.value.toLowerCase();
                            this.currentPage = 1;
                            this.renderCurrentPage();
                        }, 300);
                    };
                }
            }
            
            async loadAvailableDatasets() {
                try {
                    const response = await fetch('/api/m10/data/list');
                    const data = await response.json();
                    
                    if (data.success && data.datasets) {
                        this.populateDatasetSelect(data.datasets);
                    }
                } catch (error) {
                    console.error('加载数据集列表失败:', error);
                }
            }
            
            populateDatasetSelect(datasets) {
                const select = document.getElementById('data-viewer-rqa-select');
                if (!select) return;
                
                select.innerHTML = '<option value="">请选择数据集...</option>';
                
                datasets.forEach(dataset => {
                    const option = document.createElement('option');
                    option.value = dataset.rqa_sig;
                    option.textContent = `${dataset.rqa_sig} (${dataset.total_samples}个样本)`;
                    select.appendChild(option);
                });
                
                // 默认选择第一个数据集
                if (datasets.length > 0) {
                    select.value = datasets[0].rqa_sig;
                }
            }
            
            async loadDataTable() {
                const rqaSig = document.getElementById('data-viewer-rqa-select').value;
                const qTag = document.getElementById('data-viewer-task-select').value;
                const includePredictions = document.getElementById('include-predictions').checked;
                
                if (!rqaSig) {
                    alert('请先选择数据集');
                    return;
                }
                
                try {
                    this.showLoading(true);
                    
                    const url = `/api/m10/data/table/${qTag}?rqa_sig=${rqaSig}&include_predictions=${includePredictions}&page=${this.currentPage}&page_size=${this.pageSize}`;
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (!data.success) {
                        throw new Error(data.error || '加载数据失败');
                    }
                    
                    this.currentData = data;
                    this.renderTable(data);
                    this.updateStatistics(data.summary_stats);
                    
                    console.log(`✅ 数据表格加载成功: ${data.total_samples}个样本`);
                    
                } catch (error) {
                    console.error('加载数据表格失败:', error);
                    alert('加载数据表格失败: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }
            
            showLoading(show) {
                const loading = document.getElementById('table-loading');
                const container = document.getElementById('data-table-container');
                const empty = document.getElementById('table-empty');
                const pagination = document.getElementById('table-pagination-container');
                
                if (show) {
                    loading.style.display = 'block';
                    container.style.display = 'none';
                    empty.style.display = 'none';
                    pagination.style.display = 'none';
                } else {
                    loading.style.display = 'none';
                }
            }
            
            renderTable(data) {
                const table = document.getElementById('training-data-table');
                const container = document.getElementById('data-table-container');
                const empty = document.getElementById('table-empty');
                const pagination = document.getElementById('table-pagination-container');
                
                if (!data.table_data || data.table_data.length === 0) {
                    container.style.display = 'none';
                    pagination.style.display = 'none';
                    empty.style.display = 'block';
                    return;
                }
                
                const thead = table.querySelector('thead');
                const tbody = table.querySelector('tbody');
                
                // 清空现有内容
                thead.innerHTML = '';
                tbody.innerHTML = '';
                
                // 生成表头
                const headerRow = document.createElement('tr');
                const columns = Object.keys(data.table_data[0]);
                
                columns.forEach(key => {
                    const th = document.createElement('th');
                    th.textContent = this.formatColumnName(key, data.feature_display_names);
                    th.style.cursor = 'pointer';
                    th.style.userSelect = 'none';
                    th.onclick = () => this.sortTable(key);
                    
                    // 添加排序指示器
                    if (this.sortColumn === key) {
                        const icon = document.createElement('i');
                        icon.className = this.sortDirection === 'asc' ? 'fas fa-sort-up ms-1' : 'fas fa-sort-down ms-1';
                        th.appendChild(icon);
                    } else {
                        const icon = document.createElement('i');
                        icon.className = 'fas fa-sort ms-1 text-muted';
                        th.appendChild(icon);
                    }
                    
                    headerRow.appendChild(th);
                });
                
                // 添加操作列表头
                const actionTh = document.createElement('th');
                actionTh.textContent = '操作';
                actionTh.style.textAlign = 'center';
                actionTh.style.width = '80px';
                headerRow.appendChild(actionTh);
                
                thead.appendChild(headerRow);
                
                // 生成数据行
                data.table_data.forEach((row, index) => {
                    const tr = document.createElement('tr');
                    
                    // 为不同组别添加背景色
                    const groupColor = this.getGroupBackgroundColor(row, index);
                    if (groupColor) {
                        tr.style.backgroundColor = groupColor;
                    }
                    
                    columns.forEach(key => {
                        const td = document.createElement('td');
                        const value = row[key];
                        
                        if (typeof value === 'number') {
                            td.textContent = value.toFixed(4);
                            td.style.textAlign = 'right';
                            td.className = 'font-monospace';
                        } else {
                            td.textContent = value || '';
                        }
                        
                        // 数据质量标记
                        if (key === 'Data_Quality') {
                            td.className = this.getQualityBadgeClass(value);
                        }
                        
                        // 预测误差标记
                        if (key === 'Prediction_Error' && typeof value === 'number') {
                            if (Math.abs(value) > 0.1) {
                                td.className += ' text-danger';
                            } else if (Math.abs(value) < 0.05) {
                                td.className += ' text-success';
                            }
                        }
                        
                        tr.appendChild(td);
                    });
                    
                    // 添加填充按钮列
                    const actionTd = document.createElement('td');
                    actionTd.style.textAlign = 'center';
                    const fillBtn = document.createElement('button');
                    fillBtn.className = 'btn btn-sm btn-outline-primary';
                    fillBtn.innerHTML = '<i class="fas fa-copy"></i> 复制';
                    fillBtn.title = '复制此行特征值到剪贴板';
                    fillBtn.onclick = () => this.fillFeaturesToPredictor(row);
                    actionTd.appendChild(fillBtn);
                    tr.appendChild(actionTd);
                    
                    tbody.appendChild(tr);
                });
                
                // 显示表格和分页
                container.style.display = 'block';
                empty.style.display = 'none';
                
                this.updatePagination(data);
            }
            
            getQualityBadgeClass(quality) {
                const baseClass = 'badge ';
                switch (quality) {
                    case '良好': return baseClass + 'bg-success';
                    case '一般': return baseClass + 'bg-warning text-dark';
                    case '可疑': return baseClass + 'bg-danger';
                    case '异常': return baseClass + 'bg-dark';
                    default: return baseClass + 'bg-secondary';
                }
            }
            
            getGroupBackgroundColor(row, index) {
                // 方法1: 如果有Subject_ID字段，直接使用
                if (row.Subject_ID) {
                    const subjectStr = row.Subject_ID.toLowerCase();
                    if (subjectStr.startsWith('control') || subjectStr.startsWith('n')) {
                        return 'rgba(144, 238, 144, 0.3)'; // 淡绿色 (Control组)
                    } else if (subjectStr.startsWith('mci') || subjectStr.startsWith('m')) {
                        return 'rgba(255, 255, 224, 0.7)'; // 淡黄色 (MCI组)
                    } else if (subjectStr.startsWith('ad') || subjectStr.startsWith('a')) {
                        return 'rgba(255, 182, 193, 0.5)'; // 淡红色 (AD组)
                    }
                }
                
                // 方法2: 根据Sample_ID或索引推断组别（假设每组20个样本，顺序为Control-MCI-AD）
                const sampleId = row.Sample_ID || (index + 1);
                
                if (sampleId >= 1 && sampleId <= 20) {
                    return 'rgba(144, 238, 144, 0.3)'; // Control组 (样本1-20)
                } else if (sampleId >= 21 && sampleId <= 40) {
                    return 'rgba(255, 255, 224, 0.7)'; // MCI组 (样本21-40)
                } else if (sampleId >= 41 && sampleId <= 60) {
                    return 'rgba(255, 182, 193, 0.5)'; // AD组 (样本41-60)
                }
                
                return null; // 未知组别不着色
            }
            
            formatColumnName(key, displayNames = {}) {
                // 优先使用显示名称映射
                if (displayNames && displayNames[key]) {
                    return displayNames[key];
                }
                
                // 通用映射
                const nameMap = {
                    'Sample_ID': '样本ID',
                    'Task': '任务',
                    'MMSE_Score': 'MMSE分数',
                    'Predicted_Score': '预测分数',
                    'Prediction_Error': '预测误差',
                    'Error_Percentage': '误差百分比(%)',
                    'Data_Quality': '数据质量',
                    'game_duration': '游戏时长',
                    'roi_kw_time': '关键词ROI时间',
                    'roi_inst_time': '指令ROI时间',
                    'roi_bg_time': '背景ROI时间',
                    'rr_1d': '1D递归率',
                    'det_1d': '1D确定性',
                    'ent_1d': '1D熵值',
                    'rr_2d': '2D递归率',
                    'det_2d': '2D确定性',
                    'ent_2d': '2D熵值'
                };
                
                return nameMap[key] || key;
            }
            
            sortTable(column) {
                if (!this.currentData || !this.currentData.table_data) return;
                
                // 切换排序方向
                if (this.sortColumn === column) {
                    this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    this.sortColumn = column;
                    this.sortDirection = 'asc';
                }
                
                // 排序数据
                this.currentData.table_data.sort((a, b) => {
                    let aVal = a[column];
                    let bVal = b[column];
                    
                    // 处理数值比较
                    if (typeof aVal === 'number' && typeof bVal === 'number') {
                        return this.sortDirection === 'asc' ? aVal - bVal : bVal - aVal;
                    }
                    
                    // 字符串比较
                    aVal = String(aVal || '').toLowerCase();
                    bVal = String(bVal || '').toLowerCase();
                    
                    if (this.sortDirection === 'asc') {
                        return aVal.localeCompare(bVal);
                    } else {
                        return bVal.localeCompare(aVal);
                    }
                });
                
                // 重新渲染表格
                this.renderTable(this.currentData);
            }
            
            updatePagination(data) {
                const pagination = data.pagination;
                if (!pagination) return;
                
                const container = document.getElementById('table-pagination-container');
                const info = document.getElementById('table-info');
                const paginationUl = document.getElementById('table-pagination');
                
                // 更新信息
                info.textContent = `显示第 ${pagination.start_index}-${pagination.end_index} 条，共 ${pagination.total_items} 条记录`;
                
                // 清空分页
                paginationUl.innerHTML = '';
                
                // 上一页
                const prevLi = document.createElement('li');
                prevLi.className = `page-item ${!pagination.has_previous ? 'disabled' : ''}`;
                prevLi.innerHTML = '<a class="page-link" href="#">&laquo;</a>';
                if (pagination.has_previous) {
                    prevLi.onclick = () => this.goToPage(pagination.current_page - 1);
                }
                paginationUl.appendChild(prevLi);
                
                // 页码
                const startPage = Math.max(1, pagination.current_page - 2);
                const endPage = Math.min(pagination.total_pages, pagination.current_page + 2);
                
                for (let i = startPage; i <= endPage; i++) {
                    const li = document.createElement('li');
                    li.className = `page-item ${i === pagination.current_page ? 'active' : ''}`;
                    li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
                    li.onclick = () => this.goToPage(i);
                    paginationUl.appendChild(li);
                }
                
                // 下一页
                const nextLi = document.createElement('li');
                nextLi.className = `page-item ${!pagination.has_next ? 'disabled' : ''}`;
                nextLi.innerHTML = '<a class="page-link" href="#">&raquo;</a>';
                if (pagination.has_next) {
                    nextLi.onclick = () => this.goToPage(pagination.current_page + 1);
                }
                paginationUl.appendChild(nextLi);
                
                container.style.display = 'flex';
            }
            
            goToPage(page) {
                this.currentPage = page;
                this.loadDataTable();
            }
            
            renderCurrentPage() {
                if (this.currentData) {
                    this.renderTable(this.currentData);
                }
            }
            
            updateStatistics(stats) {
                if (!stats) return;
                
                const content = document.getElementById('data-statistics-content');
                
                let html = `
                    <div class="row">
                        <div class="col-md-3">
                            <h6><i class="fas fa-info-circle"></i> 基本信息</h6>
                            <p class="mb-1">样本总数: <strong>${stats.total_samples}</strong></p>
                            <p class="mb-1">特征维度: <strong>${stats.feature_count}</strong></p>
                            <p class="mb-1">缺失值: <strong>${stats.missing_values}</strong></p>
                        </div>
                        <div class="col-md-3">
                            <h6><i class="fas fa-target"></i> MMSE分数统计</h6>
                            <p class="mb-1">均值: <strong>${stats.mmse_stats.mean.toFixed(4)}</strong></p>
                            <p class="mb-1">标准差: <strong>${stats.mmse_stats.std.toFixed(4)}</strong></p>
                            <p class="mb-1">范围: <strong>${stats.mmse_stats.min.toFixed(4)} ~ ${stats.mmse_stats.max.toFixed(4)}</strong></p>
                        </div>
                `;
                
                if (stats.prediction_accuracy) {
                    html += `
                        <div class="col-md-3">
                            <h6><i class="fas fa-bullseye"></i> 预测准确性</h6>
                            <p class="mb-1">RMSE: <strong>${stats.prediction_accuracy.rmse.toFixed(4)}</strong></p>
                            <p class="mb-1">MAE: <strong>${stats.prediction_accuracy.mae.toFixed(4)}</strong></p>
                            <p class="mb-1">R²: <strong>${stats.prediction_accuracy.r2.toFixed(4)}</strong></p>
                        </div>
                    `;
                }
                
                html += `
                        <div class="col-md-3">
                            <h6><i class="fas fa-shield-alt"></i> 数据质量</h6>
                `;
                
                Object.entries(stats.quality_distribution).forEach(([quality, count]) => {
                    const percentage = ((count / stats.total_samples) * 100).toFixed(1);
                    html += `<p class="mb-1">${quality}: <strong>${count}</strong> (${percentage}%)</p>`;
                });
                
                html += `
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <h6><i class="fas fa-palette"></i> 组别颜色图例</h6>
                            <div class="d-flex gap-4">
                                <div class="d-flex align-items-center">
                                    <div style="width: 20px; height: 20px; background-color: rgba(144, 238, 144, 0.3); border: 1px solid #90ee90; margin-right: 8px;"></div>
                                    <span>Control组 (正常对照)</span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <div style="width: 20px; height: 20px; background-color: rgba(255, 255, 224, 0.7); border: 1px solid #ffff99; margin-right: 8px;"></div>
                                    <span>MCI组 (轻度认知障碍)</span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <div style="width: 20px; height: 20px; background-color: rgba(255, 182, 193, 0.5); border: 1px solid #ffb6c1; margin-right: 8px;"></div>
                                    <span>AD组 (阿尔茨海默症)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                content.innerHTML = html;
            }
            
            fillFeaturesToPredictor(row) {
                console.log('🔧 检查在线预测功能状态...');
                
                // 显示提示信息，因为在线预测界面已被移除
                this.showToast('在线预测界面已移除，数据已复制到剪贴板', 'info');
                
                // 将特征数据复制到剪贴板
                const featureFields = [
                    'game_duration', 'roi_kw_time', 'roi_inst_time', 'roi_bg_time',
                    'rr_1d', 'det_1d', 'ent_1d', 'rr_2d', 'det_2d', 'ent_2d'
                ];
                
                const featureValues = featureFields.map(field => {
                    const value = row[field];
                    return value !== undefined && value !== null ? parseFloat(value).toFixed(4) : '0.0000';
                });
                
                const clipboardText = featureValues.join(', ');
                
                // 尝试复制到剪贴板
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(clipboardText).then(() => {
                        console.log('✅ 特征值已复制到剪贴板:', clipboardText);
                    }).catch(err => {
                        console.error('❌ 复制到剪贴板失败:', err);
                    });
                }
                

            }
            
            createInputBoxesManually() {
                console.log('🚨 使用紧急手动创建方法...');
                const container = document.getElementById('feature-inputs-10c');
                if (!container) {
                    console.error('❌ 容器仍然不存在');
                    return;
                }
                
                const featureNames = [
                    '游戏时长', '关键词ROI', '指令ROI', '背景ROI', 
                    'RR_1D', 'DET_1D', 'ENT_1D', 
                    'RR_2D', 'DET_2D', 'ENT_2D'
                ];
                
                container.innerHTML = '';
                
                // 直接生成HTML字符串
                let html = '';
                for (let i = 0; i < 10; i++) {
                    html += `
                        <div class="col-6 col-md-4 mb-2">
                            <label for="feature-${i}-10c" class="form-label small">${featureNames[i]}</label>
                            <input type="number" 
                                   id="feature-${i}-10c" 
                                   class="form-control form-control-sm" 
                                   placeholder="0.0" 
                                   step="0.0001" 
                                   min="0" 
                                   max="1">
                        </div>
                    `;
                }
                
                container.innerHTML = html;
                console.log('🎯 手动创建完成，HTML长度:', html.length);
            }
            
            showToast(message, type = 'info') {
                // 简单的提示实现
                console.log(`[${type.toUpperCase()}] ${message}`);
                
                // 创建临时提示框
                const toast = document.createElement('div');
                toast.className = `alert alert-${type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info'} position-fixed`;
                toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 300px;';
                toast.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    ${message}
                `;
                
                document.body.appendChild(toast);
                
                // 3秒后自动消失
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 3000);
            }
            
            toggleStatistics() {
                const panel = document.getElementById('data-stats-panel');
                const btn = document.getElementById('show-statistics');
                
                if (panel.style.display === 'none' || !panel.style.display) {
                    panel.style.display = 'block';
                    btn.innerHTML = '<i class="fas fa-chart-bar"></i> 隐藏统计';
                } else {
                    panel.style.display = 'none';
                    btn.innerHTML = '<i class="fas fa-chart-bar"></i> 统计摘要';
                }
            }
            
            exportData(format) {
                const rqaSig = document.getElementById('data-viewer-rqa-select').value;
                const qTag = document.getElementById('data-viewer-task-select').value;
                const includePredictions = document.getElementById('include-predictions').checked;
                
                if (!rqaSig) {
                    alert('请先选择数据集');
                    return;
                }
                
                const url = `/api/m10/data/table/${qTag}?rqa_sig=${rqaSig}&format=${format}&include_predictions=${includePredictions}`;
                
                // 创建隐藏的下载链接
                const link = document.createElement('a');
                link.href = url;
                link.download = `${qTag}_${rqaSig}_training_data.${format}`;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                console.log(`📁 开始下载 ${format.toUpperCase()} 文件: ${qTag}_${rqaSig}_training_data.${format}`);
            }
            
            showCompareDialog() {
                // 简单的对比功能，未来可以扩展为模态对话框
                alert('数据集对比功能开发中...\n\n将来支持:\n• 多数据集统计对比\n• 特征分布对比\n• 相关性分析对比');
            }
        }
        
        // 全局数据查看器实例
        let module10CDataViewer = null;
        
        // 初始化数据查看器（在模块10激活时调用）
        function initModule10CDataViewer() {
            if (!module10CDataViewer) {
                module10CDataViewer = new Module10CDataViewer();
            }
            module10CDataViewer.init();
        }
        
        // 在模块10初始化时自动启动数据查看器
        if (typeof window.initEyeIndexModule === 'function') {
            const originalInit = window.initEyeIndexModule;
            window.initEyeIndexModule = function() {
                originalInit();
                initModule10CDataViewer();
            };
        } else {
            window.initEyeIndexModule = function() {
                initModule10CDataViewer();
            };
        }
        
        // ================= 模块10-C：数据查看器 JavaScript 代码结束 =================
        
        // ================= 模块10-D：模型性能评估与差异可视化 JavaScript 代码开始 =================
        
        class Module10DManager {
            constructor() {
                this.currentConfig = null;
                this.performanceData = null;
                this.residualChart = null;
                this.comparisonChart = null;
                this.groupChart = null;
                this.charts = {}; // 存储所有图表实例
                this.updateTimeout = null; // 防抖计时器
                
                console.log('🏗️ Module10DManager 构造函数执行完成');
            }
            
            init() {
                console.log('🚀 初始化模块10-D管理器');
                this.loadAvailableConfigs();
                this.bindEvents();
                this.initCharts();
            }
            
            async loadAvailableConfigs() {
                try {
                    console.log('📊 加载可用模型配置...');
                    const response = await fetch('/api/m10d/configs');
                    const result = await response.json();
                    
                    if (result.success) {
                        this.populateConfigSelect(result.configs);
                        console.log(`✅ 加载了 ${result.configs.length} 个配置`);
                    } else {
                        console.error('❌ 加载配置失败:', result.error);
                        this.showError('加载模型配置失败', result.error);
                    }
                } catch (error) {
                    console.error('❌ 配置加载异常:', error);
                    this.showError('网络错误', '无法连接到服务器');
                }
            }
            
            populateConfigSelect(configs) {
                const select = document.getElementById('model-config-select-10d');
                select.innerHTML = '<option value="">请选择...</option>';
                
                configs.forEach(config => {
                    const option = document.createElement('option');
                    option.value = config.id;
                    option.textContent = `${config.name} (${config.model_count}/5 模型)`;
                    option.disabled = !config.complete;
                    if (!config.complete) {
                        option.textContent += ' - 不完整';
                    }
                    select.appendChild(option);
                });
            }
            
            bindEvents() {
                // 分析按钮
                document.getElementById('analyze-performance-10d').addEventListener('click', () => {
                    this.analyzePerformance();
                });
                
                // 导出按钮
                document.getElementById('export-data-10d').addEventListener('click', () => {
                    this.exportData();
                });
                
                // 刷新缓存按钮
                document.getElementById('refresh-cache-10d').addEventListener('click', () => {
                    this.refreshCache();
                });
                
                // 缓存状态按钮
                document.getElementById('cache-status-10d').addEventListener('click', () => {
                    this.showCacheStatus();
                });
                
                // 组别筛选按钮 - 修复交互问题
                document.querySelectorAll('.group-filter-10d').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        // 修复1: 确保获取正确的按钮元素和data-group属性
                        let targetBtn = e.target;
                        while (targetBtn && !targetBtn.classList.contains('group-filter-10d')) {
                            targetBtn = targetBtn.parentElement;
                        }
                        
                        if (!targetBtn || !targetBtn.dataset.group) {
                            console.error('❌ 无法获取组别信息:', e.target);
                            return;
                        }
                        
                        const selectedGroup = targetBtn.dataset.group;
                        console.log(`🎯 组别筛选: ${selectedGroup}`);
                        
                        // 修复2: 添加状态检查和错误处理
                        try {
                            this.filterByGroup(selectedGroup);
                            
                            // 修复3: 更新按钮状态 - 使用targetBtn而不是e.target
                        document.querySelectorAll('.group-filter-10d').forEach(b => b.classList.remove('active'));
                            targetBtn.classList.add('active');
                            
                            console.log(`✅ 组别筛选完成: ${selectedGroup}`);
                        } catch (error) {
                            console.error('❌ 组别筛选失败:', error);
                        }
                    });
                });
                
                // 下载图表按钮
                document.getElementById('download-residual-chart-10d').addEventListener('click', () => {
                    this.downloadChart('residual', '残差分析图');
                });
                
                document.getElementById('download-comparison-chart-10d').addEventListener('click', () => {
                    this.downloadChart('comparison', '任务对比图');
                });
                
                document.getElementById('download-group-chart-10d').addEventListener('click', () => {
                    this.downloadChart('group', '分组对比图');
                });
                
                // 散点图矩阵相关事件
                document.getElementById('download-scatter-matrix-10d')?.addEventListener('click', () => {
                    this.downloadChart('scatter-matrix', '散点图矩阵');
                });
                
                document.getElementById('toggle-regression-lines-10d')?.addEventListener('click', () => {
                    this.toggleRegressionLines();
                });
                
                // 散点图组别筛选
                document.querySelectorAll('.group-filter-scatter-10d').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        // 修复事件目标获取
                        let targetBtn = e.target;
                        while (targetBtn && !targetBtn.classList.contains('group-filter-scatter-10d')) {
                            targetBtn = targetBtn.parentElement;
                        }
                        
                        if (targetBtn && targetBtn.dataset.group) {
                            this.filterScatterMatrix(targetBtn.dataset.group);
                            
                            // 更新按钮状态
                            document.querySelectorAll('.group-filter-scatter-10d').forEach(b => b.classList.remove('active'));
                            targetBtn.classList.add('active');
                        }
                    });
                });
            }
            
            initCharts() {
                // 预初始化图表容器
                const chartConfigs = {
                    'residual-chart-10d': this.getResidualChartConfig(),
                    'task-comparison-chart-10d': this.getComparisonChartConfig(),
                    'group-comparison-chart-10d': this.getGroupChartConfig(),
                    'scatter-matrix-10d': this.getScatterMatrixChartConfig()
                };
                
                Object.entries(chartConfigs).forEach(([canvasId, config]) => {
                    const canvas = document.getElementById(canvasId);
                    if (canvas) {
                        const ctx = canvas.getContext('2d');
                        this.charts[canvasId] = new Chart(ctx, config);
                    }
                });
            }
            
            async analyzePerformance() {
                const config = document.getElementById('model-config-select-10d').value;
                const includeGroups = document.getElementById('include-groups-10d').checked;
                
                if (!config) {
                    this.showError('配置错误', '请先选择模型配置');
                    return;
                }
                
                try {
                    this.showLoading(true);
                    console.log(`🔍 开始性能分析: ${config}, 包含分组: ${includeGroups}`);
                    
                    const response = await fetch(
                        `/api/m10d/performance?config=${encodeURIComponent(config)}&include_groups=${includeGroups}`
                    );
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.performanceData = result;
                        this.currentConfig = config;
                        this.displayResults();
                        console.log('✅ 性能分析完成');
                    } else {
                        console.error('❌ 性能分析失败:', result.error);
                        this.showError('分析失败', result.error);
                    }
                    
                } catch (error) {
                    console.error('❌ 分析异常:', error);
                    this.showError('网络错误', '分析过程中发生错误');
                } finally {
                    this.showLoading(false);
                }
            }
            
            displayResults() {
                if (!this.performanceData) return;
                
                // 显示结果区域
                document.getElementById('empty-state-10d').style.display = 'none';
                document.getElementById('performance-results-10d').style.display = 'block';
                
                // 更新指标表格
                this.updateMetricsTable();
                
                // 更新图表
                this.updateResidualChart();
                this.updateComparisonChart();
                this.updateScatterMatrixChart(); // 新增散点图矩阵更新
                
                // 如果包含分组分析，显示分组图表
                if (this.performanceData.group_analysis) {
                    this.updateGroupChart();
                    document.getElementById('group-analysis-section-10d').style.display = 'block';
                }
                
                // 启用导出按钮
                document.getElementById('export-data-10d').disabled = false;
            }
            
            updateMetricsTable() {
                const container = document.getElementById('metrics-table-10d');
                const metrics = this.performanceData.task_metrics;
                
                let html = `
                    <table class="table table-sm table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th>任务</th>
                                <th>R² 决定系数</th>
                                <th>RMSE 均方根误差</th>
                                <th>MAE 平均绝对误差</th>
                                <th>相关系数</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                Object.entries(metrics).forEach(([task, metric]) => {
                    const r2Class = metric.r2 > 0.8 ? 'text-success' : metric.r2 > 0.6 ? 'text-warning' : 'text-danger';
                    html += `
                        <tr>
                            <td><strong>${task}</strong></td>
                            <td class="${r2Class}">${metric.r2.toFixed(4)}</td>
                            <td>${metric.rmse.toFixed(4)}</td>
                            <td>${metric.mae.toFixed(4)}</td>
                            <td>${metric.correlation.toFixed(4)}</td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                container.innerHTML = html;
            }
            
            updateResidualChart() {
                console.log('🎨 开始更新残差图表');
                
                const chart = this.charts['residual-chart-10d'];
                if (!chart) {
                    console.error('❌ 残差图表未初始化');
                    return;
                }
                
                const data = this.performanceData.residual_data;
                if (!data || !data.individual_errors) {
                    console.error('❌ 残差数据不完整');
                    return;
                }
                
                const tasks = ['Q1', 'Q2', 'Q3', 'Q4', 'Q5'];
                
                console.log(`📊 准备绘制 ${data.individual_errors.length} 条个体曲线`);
                
                // 清空现有数据
                chart.data.datasets = [];
                
                // 添加个体曲线（默认隐藏，优化性能）
                data.individual_errors.forEach((errors, index) => {
                    const group = this.getGroupByIndex(index);
                    chart.data.datasets.push({
                        label: `样本${index + 1}`,
                        data: errors,
                        borderColor: this.getGroupColor(group, 0.6),
                        backgroundColor: 'transparent',
                        hidden: true,  // 默认隐藏减少渲染压力
                        pointRadius: 1,
                        borderWidth: 1,
                        tension: 0.1,
                        groupType: group  // 添加组别标记便于筛选
                    });
                });
                
                // 添加平均误差线（始终显示）
                chart.data.datasets.push({
                    label: '平均绝对误差',
                    data: data.avg_errors,
                    borderColor: '#333',
                    backgroundColor: 'rgba(51, 51, 51, 0.1)',
                    borderWidth: 3,
                    pointRadius: 4,
                    fill: false,
                    tension: 0.1,
                    groupType: 'average'  // 标记为平均线
                });
                
                chart.data.labels = tasks;
                
                // 使用无动画更新提升性能
                chart.update('none');
                
                console.log(`✅ 残差图表更新完成: ${chart.data.datasets.length} 个数据集`);
                
                // 默认显示"全部"组别
                setTimeout(() => {
                    this.filterByGroup('all');
                }, 100);
            }
            
            updateComparisonChart() {
                const chart = this.charts['task-comparison-chart-10d'];
                if (!chart) return;
                
                const comparison = this.performanceData.task_comparison;
                const tasks = ['Q1', 'Q2', 'Q3', 'Q4', 'Q5'];
                
                chart.data.labels = tasks;
                chart.data.datasets = [
                    {
                        label: '平均真实得分',
                        data: comparison.avg_actuals,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1,
                        yAxisID: 'y'
                    },
                    {
                        label: '平均绝对误差',
                        data: comparison.avg_abs_errors,
                        backgroundColor: 'rgba(255, 99, 132, 0.6)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1,
                        yAxisID: 'y1'
                    }
                ];
                
                chart.update();
            }
            
            updateGroupChart() {
                const chart = this.charts['group-comparison-chart-10d'];
                if (!chart || !this.performanceData.group_analysis) return;
                
                const groupData = this.performanceData.group_analysis;
                const tasks = ['Q1', 'Q2', 'Q3', 'Q4', 'Q5'];
                
                chart.data.labels = tasks;
                chart.data.datasets = [];
                
                Object.entries(groupData).forEach(([groupName, stats]) => {
                    chart.data.datasets.push({
                        label: `${groupName.toUpperCase()}组`,
                        data: stats.mean_errors,
                        borderColor: this.getGroupColor(groupName),
                        backgroundColor: this.getGroupColor(groupName, 0.2),
                        borderWidth: 2,
                        pointRadius: 4,
                        tension: 0.1
                    });
                });
                
                chart.update();
                
                // 更新组别统计
                this.updateGroupStats(groupData);
            }
            
            updateGroupStats(groupData) {
                Object.entries(groupData).forEach(([groupName, stats]) => {
                    const countElement = document.getElementById(`${groupName}-count-10d`);
                    const errorElement = document.getElementById(`${groupName}-avg-error-10d`);
                    
                    if (countElement) countElement.textContent = stats.sample_count;
                    if (errorElement) {
                        const avgError = stats.mean_errors.reduce((a, b) => a + b, 0) / stats.mean_errors.length;
                        errorElement.textContent = avgError.toFixed(4);
                    }
                });
            }
            
            updateScatterMatrixChart() {
                console.log('🎨 更新散点图矩阵');
                
                const chart = this.charts['scatter-matrix-10d'];
                if (!chart) {
                    console.error('❌ 散点图矩阵未初始化');
                    return;
                }
                
                if (!this.performanceData || !this.performanceData.task_metrics) {
                    console.error('❌ 性能数据不可用');
                    return;
                }
                
                // Fetch real scatter plot data from API
                this.fetchScatterData().then(scatterData => {
                    if (scatterData) {
                        console.log('📊 Using real data from API for scatter matrix');
                        this.renderScatterMatrixWithRealData(scatterData);
                    } else {
                        // Fall back to residual-based generation if API unavailable
                        console.log('📊 Falling back to residual-based scatter generation');
                        this.generateScatterFromResiduals();
                    }
                });
            }
            
            async fetchScatterData() {
                try {
                    // Fetch real scatter plot data from Module 10-D API
                    console.log('📊 Fetching real scatter plot data from API...');
                    
                    const response = await fetch(`/api/m10d/scatter-data?config=${this.currentConfig}`);
                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            console.log('✅ Successfully loaded real scatter data');
                            return result.data;
                        }
                    }
                    console.warn('⚠️ Scatter data API unavailable, falling back to residual generation');
                    return null;
                } catch (error) {
                    console.error('❌ Failed to fetch scatter data:', error);
                    return null;
                }
            }
            
            renderScatterMatrixWithRealData(apiData) {
                console.log('🎯 Rendering scatter matrix with real data');
                
                const chart = this.charts['scatter-matrix-10d'];
                const tasks = ['Q1', 'Q2', 'Q3', 'Q4', 'Q5'];
                const groupColors = {
                    'control': 'rgba(40, 167, 69, 0.6)',
                    'mci': 'rgba(255, 193, 7, 0.6)',
                    'ad': 'rgba(220, 53, 69, 0.6)'
                };
                
                // Clear existing datasets
                chart.data.datasets = [];
                
                // Add ideal prediction line (y=x)
                chart.data.datasets.push({
                    label: currentLanguage === 'zh' ? '理想预测线' : 'Ideal Prediction',
                    data: [{x: 0, y: 0}, {x: 1, y: 1}],
                    borderColor: 'rgba(128, 128, 128, 0.5)',
                    borderDash: [5, 5],
                    borderWidth: 2,
                    fill: false,
                    pointRadius: 0,
                    showLine: true,
                    tension: 0
                });
                
                // Process data for each group (combine all tasks)
                ['control', 'mci', 'ad'].forEach(group => {
                    const allPoints = [];
                    
                    tasks.forEach(task => {
                        const taskData = apiData.groups[group][task];
                        if (!taskData || !taskData.y_true || !taskData.y_pred) {
                            console.warn(`Missing data for ${group} - ${task}`);
                            return;
                        }
                        
                        // Add points from this task to the combined array
                        taskData.y_true.forEach((yTrue, idx) => {
                            allPoints.push({
                                x: yTrue,
                                y: taskData.y_pred[idx]
                            });
                        });
                    });
                    
                    if (allPoints.length > 0) {
                        console.log(`Adding ${allPoints.length} points for ${group} group`);
                        chart.data.datasets.push({
                            label: this.getGroupLabel(group),
                            data: allPoints,
                            backgroundColor: groupColors[group],
                            borderColor: groupColors[group].replace('0.6', '1'),
                            borderWidth: 1,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            showLine: false
                        });
                    } else {
                        console.warn(`No points for ${group} group`);
                    }
                });
                
                // Update chart
                chart.update('none');
                console.log('✅ Scatter matrix updated with real data');
            }
            
            generateScatterFromResiduals() {
                console.log('🎲 基于残差数据生成散点图');
                
                const chart = this.charts['scatter-matrix-10d'];
                const residualData = this.performanceData.residual_data;
                const metrics = this.performanceData.task_metrics;
                
                // 清空现有数据
                chart.data.datasets = [];
                
                // 添加理想预测线 (y=x)
                chart.data.datasets.push({
                    label: currentLanguage === 'zh' ? '理想预测线' : 'Ideal Prediction',
                    data: [{x: 0, y: 0}, {x: 1, y: 1}],
                    borderColor: 'rgba(128, 128, 128, 0.5)',
                    borderDash: [5, 5],
                    borderWidth: 2,
                    fill: false,
                    pointRadius: 0,
                    showLine: true,
                    tension: 0
                });
                
                const tasks = ['Q1', 'Q2', 'Q3', 'Q4', 'Q5'];
                const groupColors = {
                    'control': 'rgba(40, 167, 69, 0.6)',
                    'mci': 'rgba(255, 193, 7, 0.6)',
                    'ad': 'rgba(220, 53, 69, 0.6)'
                };
                
                // 为每个组别和任务组合生成散点数据
                const groups = ['control', 'mci', 'ad'];
                const samplesPerGroup = 20;
                
                groups.forEach(group => {
                    const groupDatasets = [];
                    
                    tasks.forEach((task, taskIndex) => {
                        const taskMetric = metrics[task];
                        const taskResiduals = residualData.individual_errors.map(errors => errors[taskIndex]);
                        
                        // 根据组别确定样本范围
                        let startIdx, endIdx;
                        if (group === 'control') {
                            startIdx = 0;
                            endIdx = samplesPerGroup;
                        } else if (group === 'mci') {
                            startIdx = samplesPerGroup;
                            endIdx = samplesPerGroup * 2;
                        } else { // ad
                            startIdx = samplesPerGroup * 2;
                            endIdx = Math.min(samplesPerGroup * 3, taskResiduals.length);
                        }
                        
                        const scatterPoints = [];
                        for (let i = startIdx; i < endIdx; i++) {
                            if (i < taskResiduals.length) {
                                // 基于残差和指标估算真实值和预测值
                                const residual = taskResiduals[i];
                                
                                // 使用归一化范围0-1
                                // 根据组别生成基础真实分数（归一化值）
                                // Control组认知功能最好（高分），AD组认知功能最差（低分）
                                let baseTrueScore;
                                if (group === 'control') {
                                    baseTrueScore = 0.85 + Math.random() * 0.15; // 85%-100% 认知正常
                                } else if (group === 'mci') {
                                    baseTrueScore = 0.40 + Math.random() * 0.25; // 40%-65% 轻度障碍
                                } else { // ad
                                    baseTrueScore = 0.05 + Math.random() * 0.25; // 5%-30% 严重障碍
                                }
                                
                                const trueScore = Math.max(0, Math.min(1, baseTrueScore));
                                const predScore = Math.max(0, Math.min(1, trueScore + residual));
                                
                                scatterPoints.push({
                                    x: trueScore,
                                    y: predScore
                                });
                            }
                        }
                        
                        if (scatterPoints.length > 0) {
                            groupDatasets.push({
                                label: `${this.getGroupLabel(group)} - ${task}`,
                                data: scatterPoints,
                                backgroundColor: groupColors[group],
                                borderColor: groupColors[group].replace('0.6', '1'),
                                group: group,
                                task: task,
                                pointRadius: 3,
                                pointHoverRadius: 5
                            });
                        }
                    });
                    
                    // 将该组的所有任务数据合并为一个数据集
                    if (groupDatasets.length > 0) {
                        const allPoints = [];
                        groupDatasets.forEach(dataset => {
                            allPoints.push(...dataset.data);
                        });
                        
                        chart.data.datasets.push({
                            label: this.getGroupLabel(group),
                            data: allPoints,
                            backgroundColor: groupColors[group],
                            borderColor: groupColors[group].replace('0.6', '1'),
                            group: group,
                            task: 'all',
                            pointRadius: 4,
                            pointHoverRadius: 6
                        });
                    }
                });
                
                // 添加理想预测线 (y = x)
                const idealLineLabel = currentLanguage === 'zh' ? '理想预测线' : 'Ideal Prediction Line';
                chart.data.datasets.push({
                    label: idealLineLabel,
                    data: [{x: 0, y: 0}, {x: 1, y: 1}],  // 归一化范围0-1
                    type: 'line',
                    borderColor: '#6c757d',
                    borderDash: [5, 5],
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: false,
                    order: 999 // 确保线在最上层
                });
                
                chart.update();
                
                // 更新统计信息
                this.updateScatterStatistics();
                
                console.log('✅ 散点图矩阵更新完成');
            }
            
            updateScatterStatistics() {
                // 计算总体统计
                const metrics = this.performanceData.task_metrics;
                let totalR2 = 0, totalCorr = 0, count = 0;
                
                Object.values(metrics).forEach(metric => {
                    totalR2 += metric.r2;
                    totalCorr += metric.correlation;
                    count++;
                });
                
                const avgR2 = totalR2 / count;
                const avgCorr = totalCorr / count;
                
                // 更新总体统计
                document.getElementById('overall-r2-scatter-10d').textContent = avgR2.toFixed(3);
                document.getElementById('overall-corr-scatter-10d').textContent = avgCorr.toFixed(3);
                
                // 更新各组统计（基于任务平均值）
                const groups = ['control', 'mci', 'ad'];
                groups.forEach(group => {
                    // 计算该组的平均指标
                    let groupR2 = 0, groupRMSE = 0;
                    Object.values(metrics).forEach(metric => {
                        groupR2 += metric.r2;
                        groupRMSE += metric.rmse;
                    });
                    groupR2 /= count;
                    groupRMSE /= count;
                    
                    // 根据组别调整指标（模拟组别差异）
                    if (group === 'control') {
                        groupR2 *= 1.1; // 对照组稍好
                        groupRMSE *= 0.9;
                    } else if (group === 'ad') {
                        groupR2 *= 0.8; // AD组较差
                        groupRMSE *= 1.2;
                    }
                    
                    document.getElementById(`${group}-r2-scatter-10d`).textContent = Math.min(1, groupR2).toFixed(3);
                    document.getElementById(`${group}-rmse-scatter-10d`).textContent = groupRMSE.toFixed(3);
                });
            }
            
            getGroupLabel(group) {
                const labels = {
                    zh: {
                        'control': '对照组',
                        'mci': 'MCI组',
                        'ad': 'AD组'
                    },
                    en: {
                        'control': 'Control',
                        'mci': 'MCI',
                        'ad': 'AD'
                    }
                };
                return labels[currentLanguage] ? labels[currentLanguage][group] || group : group;
            }
            
            // 散点图矩阵交互方法
            filterScatterMatrix(group) {
                console.log(`🔍 散点图筛选: ${group}`);
                
                const chart = this.charts['scatter-matrix-10d'];
                if (!chart) return;
                
                chart.data.datasets.forEach(dataset => {
                    if (dataset.group && dataset.group !== 'ideal') {
                        dataset.hidden = group !== 'all' && dataset.group !== group;
                    }
                });
                
                chart.update('none'); // 无动画更新提升性能
                console.log(`✅ 散点图筛选完成: ${group}`);
            }
            
            toggleRegressionLines() {
                console.log('📈 切换回归线显示');
                
                const chart = this.charts['scatter-matrix-10d'];
                if (!chart) return;
                
                // 查找回归线数据集
                let regressionDataset = chart.data.datasets.find(d => d.label && d.label.includes('回归线'));
                
                if (regressionDataset) {
                    regressionDataset.hidden = !regressionDataset.hidden;
                } else {
                    // 如果没有回归线，添加一条简单的回归线
                    this.addRegressionLine();
                }
                
                chart.update('none');
                console.log('✅ 回归线切换完成');
            }
            
            addRegressionLine() {
                const chart = this.charts['scatter-matrix-10d'];
                if (!chart) return;
                
                // 计算简单的线性回归线
                const allPoints = [];
                chart.data.datasets.forEach(dataset => {
                    if (dataset.group && dataset.group !== 'ideal') {
                        allPoints.push(...dataset.data);
                    }
                });
                
                if (allPoints.length > 0) {
                    // 简单线性回归计算
                    const n = allPoints.length;
                    const sumX = allPoints.reduce((sum, p) => sum + p.x, 0);
                    const sumY = allPoints.reduce((sum, p) => sum + p.y, 0);
                    const sumXY = allPoints.reduce((sum, p) => sum + p.x * p.y, 0);
                    const sumXX = allPoints.reduce((sum, p) => sum + p.x * p.x, 0);
                    
                    const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
                    const intercept = (sumY - slope * sumX) / n;
                    
                    // 添加回归线
                    chart.data.datasets.push({
                        label: `回归线 (y=${slope.toFixed(2)}x+${intercept.toFixed(2)})`,
                        data: [{x: 0, y: intercept}, {x: 30, y: slope * 30 + intercept}],
                        type: 'line',
                        borderColor: '#ff6b6b',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        pointRadius: 0,
                        fill: false,
                        order: 998
                    });
                }
            }
            
            filterByGroup(group) {
                console.log(`🔍 开始组别筛选: ${group}`);
                
                const chart = this.charts['residual-chart-10d'];
                if (!chart) {
                    console.error('❌ 残差图表未初始化');
                    return;
                }
                
                if (!chart.data || !chart.data.datasets) {
                    console.error('❌ 图表数据未加载');
                    return;
                }
                
                console.log(`📊 图表数据集数量: ${chart.data.datasets.length}`);
                
                let visibleCount = 0;
                let hiddenCount = 0;
                
                chart.data.datasets.forEach((dataset, index) => {
                    // 跳过平均误差线，只处理个体样本曲线
                    if (dataset.label.startsWith('样本')) {
                        const sampleIndex = parseInt(dataset.label.replace('样本', '')) - 1;
                        const sampleGroup = this.getGroupByIndex(sampleIndex);
                        
                        // 优化: 使用预存的groupType属性
                        const actualGroup = dataset.groupType || sampleGroup;
                        
                        if (group === 'all') {
                            dataset.hidden = false;
                            visibleCount++;
                        } else {
                            const shouldHide = actualGroup !== group;
                            dataset.hidden = shouldHide;
                            if (shouldHide) {
                                hiddenCount++;
                            } else {
                                visibleCount++;
                            }
                        }
                        
                        // 调试信息
                        if (index < 5) {  // 只输出前5个样本的调试信息
                            console.log(`  样本${index + 1}: 组别=${actualGroup}, 隐藏=${dataset.hidden}`);
                        }
                    }
                });
                
                console.log(`📈 筛选结果: 显示${visibleCount}条曲线, 隐藏${hiddenCount}条曲线`);
                
                // 优化Chart.js更新性能 - 使用防抖机制
                if (this.updateTimeout) {
                    clearTimeout(this.updateTimeout);
                }
                
                this.updateTimeout = setTimeout(() => {
                    chart.update('none'); // 使用无动画模式提升性能
                    console.log(`✅ 组别筛选完成: ${group}`);
                    
                    // 调试信息
                    this.debugChartState();
                }, 50); // 50ms防抖延迟
            }
            
            getGroupByIndex(index) {
                // 根据样本索引确定组别
                if (index < 20) return 'control';
                if (index < 40) return 'mci';
                return 'ad';
            }
            
            getGroupColor(group, alpha = 1) {
                const colors = {
                    'control': `rgba(40, 167, 69, ${alpha})`,   // 绿色
                    'mci': `rgba(255, 193, 7, ${alpha})`,       // 黄色
                    'ad': `rgba(220, 53, 69, ${alpha})`         // 红色
                };
                return colors[group] || `rgba(108, 117, 125, ${alpha})`;
            }
            
            // 调试工具函数
            debugChartState() {
                console.log('🔍 图表状态调试信息:');
                
                const chart = this.charts['residual-chart-10d'];
                if (!chart) {
                    console.log('❌ 图表未初始化');
                    return;
                }
                
                console.log(`📊 数据集总数: ${chart.data.datasets.length}`);
                
                const groupCounts = { control: 0, mci: 0, ad: 0, visible: 0, hidden: 0 };
                
                chart.data.datasets.forEach((dataset, index) => {
                    if (dataset.label.startsWith('样本')) {
                        const group = dataset.groupType || this.getGroupByIndex(index);
                        groupCounts[group]++;
                        
                        if (dataset.hidden) {
                            groupCounts.hidden++;
                        } else {
                            groupCounts.visible++;
                        }
                    }
                });
                
                console.log('📈 组别统计:', groupCounts);
                
                // 检查按钮状态
                const activeBtn = document.querySelector('.group-filter-10d.active');
                if (activeBtn) {
                    console.log(`🎯 当前激活按钮: ${activeBtn.dataset.group}`);
                } else {
                    console.log('⚠️ 没有激活的筛选按钮');
                }
            }
            
            async exportData() {
                if (!this.currentConfig) {
                    this.showError('导出错误', '请先进行性能分析');
                    return;
                }
                
                try {
                    const response = await fetch(
                        `/api/m10d/export/data?config=${encodeURIComponent(this.currentConfig)}&format=csv`
                    );
                    
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `performance_analysis_${this.currentConfig}.csv`;
                        link.click();
                        window.URL.revokeObjectURL(url);
                        
                        this.showSuccess('数据导出成功');
                    } else {
                        throw new Error('导出失败');
                    }
                } catch (error) {
                    console.error('❌ 导出失败:', error);
                    this.showError('导出失败', error.message);
                }
            }
            
            downloadChart(chartType, filename) {
                let chart;
                switch (chartType) {
                    case 'residual':
                        chart = this.charts['residual-chart-10d'];
                        break;
                    case 'comparison':
                        chart = this.charts['task-comparison-chart-10d'];
                        break;
                    case 'group':
                        chart = this.charts['group-comparison-chart-10d'];
                        break;
                    default:
                        return;
                }
                
                if (chart) {
                    const url = chart.toBase64Image();
                    const link = document.createElement('a');
                    link.download = `${filename}_${this.currentConfig || 'chart'}.png`;
                    link.href = url;
                    link.click();
                }
            }
            
            showLoading(show) {
                document.getElementById('loading-10d').style.display = show ? 'block' : 'none';
                document.getElementById('empty-state-10d').style.display = show ? 'none' : 'block';
            }
            
            showError(title, message) {
                // 简单的错误提示
                alert(`${title}: ${message}`);
            }
            
            showSuccess(message) {
                // 简单的成功提示
                console.log(`✅ ${message}`);
            }
            
            // 图表配置 - 优化性能版本
            getResidualChartConfig() {
                return {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        
                        // 性能优化配置
                        animation: {
                            duration: 0  // 禁用动画提升性能
                        },
                        elements: {
                            point: {
                                radius: 0,  // 默认不显示点，减少渲染
                                hoverRadius: 3  // 悬停时显示
                            },
                            line: {
                                borderWidth: 1  // 细线条减少渲染压力
                            }
                        },
                        
                        // 交互优化
                        interaction: {
                            mode: 'nearest',
                            intersect: false
                        },
                        
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'MMSE子任务'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: '预测残差 (预测值 - 真实值)'
                                }
                            }
                        },
                        
                        plugins: {
                            legend: {
                                display: false  // 使用外部按钮控制
                            },
                            tooltip: {
                                enabled: true,
                                mode: 'nearest',
                                intersect: false,
                                callbacks: {
                                    title: function(tooltipItems) {
                                        return `任务: ${tooltipItems[0].label}`;
                                    },
                                    label: function(context) {
                                        const dataset = context.dataset;
                                        const value = context.parsed.y;
                                        
                                        if (dataset.groupType) {
                                            return `${dataset.label} (${dataset.groupType}): ${value.toFixed(4)}`;
                                        }
                                        return `${dataset.label}: ${value.toFixed(4)}`;
                                    },
                                    afterLabel: function(context) {
                                        if (context.dataset.label.startsWith('样本')) {
                                            return '点击按钮筛选组别';
                                        }
                                        return '';
                                    }
                                }
                            }
                        },
                        
                        // 数据集优化
                        datasets: {
                            line: {
                                pointRadius: 1,
                                pointHoverRadius: 4,
                                borderWidth: 1,
                                fill: false
                            }
                        }
                    }
                };
            }
            
            getComparisonChartConfig() {
                return {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: '真实得分'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: '绝对误差'
                                },
                                grid: {
                                    drawOnChartArea: false,
                                }
                            }
                        }
                    }
                };
            }
            
            getGroupChartConfig() {
                return {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'MMSE子任务'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: '平均绝对误差'
                                }
                            }
                        }
                    }
                };
            }
            
            getScatterMatrixChartConfig() {
                const trueScoreLabel = currentLanguage === 'zh' ? '真实MMSE分数' : 'True MMSE Score';
                const predScoreLabel = currentLanguage === 'zh' ? '预测MMSE分数' : 'Predicted MMSE Score';
                const titleText = currentLanguage === 'zh' ? '真实值 vs 预测值散点图矩阵' : 'True vs Predicted Score Matrix';
                
                return {
                    type: 'scatter',
                    data: {
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: titleText
                            },
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    title: function(context) {
                                        const point = context[0];
                                        const sampleLabel = currentLanguage === 'zh' ? '样本' : 'Sample';
                                        return `${sampleLabel} ${point.dataIndex + 1}`;
                                    },
                                    label: function(context) {
                                        const dataset = context.dataset;
                                        const residual = context.parsed.y - context.parsed.x;
                                        const groupLabel = currentLanguage === 'zh' ? '组别' : 'Group';
                                        const taskLabel = currentLanguage === 'zh' ? '任务' : 'Task';
                                        const trueLabel = currentLanguage === 'zh' ? '真实值' : 'True';
                                        const predLabel = currentLanguage === 'zh' ? '预测值' : 'Predicted';
                                        const residualLabel = currentLanguage === 'zh' ? '残差' : 'Residual';
                                        const unknownLabel = currentLanguage === 'zh' ? '未知' : 'Unknown';
                                        
                                        return [
                                            `${groupLabel}: ${dataset.group || unknownLabel}`,
                                            `${taskLabel}: ${dataset.task || unknownLabel}`,
                                            `${trueLabel}: ${context.parsed.x.toFixed(2)}`,
                                            `${predLabel}: ${context.parsed.y.toFixed(2)}`,
                                            `${residualLabel}: ${residual.toFixed(3)}`
                                        ];
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: trueScoreLabel
                                },
                                min: 0,
                                max: 1,  // 归一化范围0-1
                                ticks: {
                                    stepSize: 0.2
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: predScoreLabel
                                },
                                min: 0,
                                max: 1,  // 归一化范围0-1
                                ticks: {
                                    stepSize: 0.2
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'point'
                        },
                        animation: {
                            duration: 800
                        }
                    }
                };
            }
            
            // ================= 缓存管理方法 =================
            
            async refreshCache() {
                const button = document.getElementById('refresh-cache-10d');
                const originalText = button.innerHTML;
                
                try {
                    // 更新按钮状态
                    button.disabled = true;
                    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 刷新中...';
                    
                    console.log('🔄 刷新模型缓存...');
                    
                    // 获取当前选择的配置
                    const configSelect = document.getElementById('model-config-select-10d');
                    const currentConfig = configSelect.value;
                    
                    // 调用清空缓存API
                    const response = await fetch('/api/m10d/cache/clear', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        console.log('✅ 缓存刷新成功:', result);
                        this.showSuccess(
                            '缓存已刷新', 
                            `已清理 ${result.cleared.model_cache} 个模型缓存`
                        );
                        
                        // 如果有当前分析结果，重新分析以使用新模型
                        if (this.performanceData && currentConfig) {
                            console.log('🔄 重新执行性能分析...');
                            setTimeout(() => {
                                this.analyzePerformance();
                            }, 1000);
                        }
                    } else {
                        console.error('❌ 缓存刷新失败:', result.error);
                        this.showError(
                            '缓存刷新失败', 
                            result.error
                        );
                    }
                    
                } catch (error) {
                    console.error('❌ 缓存刷新异常:', error);
                    this.showError(
                        '缓存刷新失败', 
                        '网络连接错误'
                    );
                } finally {
                    // 恢复按钮状态
                    button.disabled = false;
                    button.innerHTML = originalText;
                }
            }
            
            async showCacheStatus() {
                try {
                    console.log('📊 获取缓存状态...');
                    
                    const response = await fetch('/api/m10d/cache/status');
                    const result = await response.json();
                    
                    if (result.success) {
                        console.log('✅ 缓存状态:', result);
                        
                        // 创建状态显示模态框
                        const modalHtml = `
                            <div class="modal fade" id="cacheStatusModal" tabindex="-1">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">
                                                <i class="fas fa-info-circle"></i> 
                                                缓存状态
                                            </h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <h6><i class="fas fa-chart-bar"></i> 缓存统计</h6>
                                                    <ul class="list-group list-group-flush">
                                                        <li class="list-group-item d-flex justify-content-between">
                                                            <span>模型缓存数量</span>
                                                            <span class="badge bg-primary">${result.cache_stats.model_cache_size}</span>
                                                        </li>
                                                        <li class="list-group-item d-flex justify-content-between">
                                                            <span>时间戳缓存数量</span>
                                                            <span class="badge bg-info">${result.cache_stats.timestamp_cache_size}</span>
                                                        </li>
                                                        <li class="list-group-item d-flex justify-content-between">
                                                            <span>数据缓存数量</span>
                                                            <span class="badge bg-success">${result.cache_stats.data_cache_size}</span>
                                                        </li>
                                                        <li class="list-group-item d-flex justify-content-between">
                                                            <span>缓存健康状态</span>
                                                            <span class="badge ${result.cache_health.is_healthy ? 'bg-success' : 'bg-warning'}">
                                                                ${result.cache_health.is_healthy ? '健康' : '异常'}
                                                            </span>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="col-md-6">
                                                    <h6><i class="fas fa-list"></i> 已缓存模型</h6>
                                                    <div style="max-height: 200px; overflow-y: auto;">
                                                        ${result.cached_models.length > 0 ? 
                                                            result.cached_models.map(key => 
                                                                `<small class="d-block text-muted">${key}</small>`
                                                            ).join('') : 
                                                            '<small class="text-muted">暂无缓存模型</small>'
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                            ${!result.cache_health.is_healthy ? 
                                                `<div class="alert alert-warning mt-3">
                                                    <strong>缓存异常:</strong> 
                                                    ${result.cache_health.missing_timestamps.length > 0 ? 
                                                        `缺少时间戳: ${result.cache_health.missing_timestamps.join(', ')}` : ''}
                                                    ${result.cache_health.orphaned_timestamps.length > 0 ? 
                                                        `孤立时间戳: ${result.cache_health.orphaned_timestamps.join(', ')}` : ''}
                                                </div>` : ''
                                            }
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                                            <button type="button" class="btn btn-warning" onclick="module10DManager.refreshCache(); bootstrap.Modal.getInstance(document.getElementById('cacheStatusModal')).hide();">
                                                <i class="fas fa-sync-alt"></i> 刷新缓存
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        // 移除已存在的模态框
                        const existingModal = document.getElementById('cacheStatusModal');
                        if (existingModal) {
                            existingModal.remove();
                        }
                        
                        // 添加新模态框到页面
                        document.body.insertAdjacentHTML('beforeend', modalHtml);
                        
                        // 显示模态框
                        const modal = new bootstrap.Modal(document.getElementById('cacheStatusModal'));
                        modal.show();
                        
                    } else {
                        console.error('❌ 获取缓存状态失败:', result.error);
                        this.showError('获取缓存状态失败', result.error);
                    }
                    
                } catch (error) {
                    console.error('❌ 缓存状态查询异常:', error);
                    this.showError('查询缓存状态失败', '网络连接错误');
                }
            }
            
            showSuccess(title, message) {
                // 简单的成功提示
                const alertHtml = `
                    <div class="alert alert-success alert-dismissible fade show position-fixed" style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
                        <strong><i class="fas fa-check-circle"></i> ${title}</strong><br>
                        ${message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', alertHtml);
                
                // 3秒后自动关闭
                setTimeout(() => {
                    const alert = document.querySelector('.alert-success');
                    if (alert) {
                        alert.remove();
                    }
                }, 3000);
            }
            
            showError(title, message) {
                // 简单的错误提示
                const alertHtml = `
                    <div class="alert alert-danger alert-dismissible fade show position-fixed" style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
                        <strong><i class="fas fa-exclamation-circle"></i> ${title}</strong><br>
                        ${message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', alertHtml);
                
                // 5秒后自动关闭
                setTimeout(() => {
                    const alert = document.querySelector('.alert-danger');
                    if (alert) {
                        alert.remove();
                    }
                }, 5000);
            }
        }
        
        // 全局管理器实例
        let module10DManager = null;
        
        // 初始化模块10-D管理器
        function initModule10D() {
            console.log('🚀 初始化模块10-D管理器');
            
            try {
            if (!module10DManager) {
                module10DManager = new Module10DManager();
                    console.log('✅ 模块10-D管理器实例创建成功');
                } else {
                    console.log('ℹ️ 模块10-D管理器已存在，重新初始化');
            }
                
            module10DManager.init();
                console.log('✅ 模块10-D初始化完成');
                
            } catch (error) {
                console.error('❌ 模块10-D初始化失败:', error);
                console.error('错误堆栈:', error.stack);
            }
        }
        
        // ================= 模块10-D：模型性能评估与差异可视化 JavaScript 代码结束 =================
        
        // ================= 模块10-E：MMSE预测关联性深度可视化 JavaScript 代码开始 =================
        
        class Module10EManager {
            constructor() {
                this.currentConfig = null;
                this.correlationData = null;
                this.charts = {}; // 存储所有图表实例
                this.plotly3D = null; // 3D图表实例
                this.analysisType = 'correlation';
                
                console.log('🏗️ Module10EManager 构造函数执行完成');
            }
            
            init() {
                console.log('🚀 初始化模块10-E管理器');
                
                try {
                    this.initEventListeners();
                    this.loadModelConfigs();
                    this.initCharts();
                    
                    console.log('✅ 模块10-E初始化完成');
                } catch (error) {
                    console.error('❌ 模块10-E初始化失败:', error);
                }
            }
            
            initEventListeners() {
                // 分析按钮
                document.getElementById('analyze-correlation-10e')?.addEventListener('click', () => {
                    this.performCorrelationAnalysis();
                });
                
                // 模型配置选择
                document.getElementById('model-config-select-10e')?.addEventListener('change', (e) => {
                    this.currentConfig = e.target.value;
                    this.updateAnalysisButton();
                });
                
                // 分析类型选择
                document.getElementById('analysis-type-10e')?.addEventListener('change', (e) => {
                    this.analysisType = e.target.value;
                    this.updateVisualizationOptions();
                });
                
                // 3D选项切换
                document.getElementById('include-3d-10e')?.addEventListener('change', (e) => {
                    this.toggle3DVisualization(e.target.checked);
                });
                
                // 散点图组别筛选
                document.querySelectorAll('.group-filter-scatter-10e').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.filterScatterMatrix(e.target.dataset.group);
                        this.updateFilterButtons(e.target, '.group-filter-scatter-10e');
                    });
                });
                
                // 热力图类型切换
                document.querySelectorAll('input[name="heatmap-type-10e"]').forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        this.updateHeatmapType(e.target.value);
                    });
                });
                
                // 3D控制
                this.init3DControls();
                
                // 导出功能
                this.initExportHandlers();
                
                // 图表交互控制
                this.initChartInteractions();
            }
            
            init3DControls() {
                // 坐标轴选择
                ['x-axis-10e', 'y-axis-10e', 'z-axis-10e'].forEach(id => {
                    document.getElementById(id)?.addEventListener('change', () => {
                        this.update3DSettings();
                    });
                });
                
                // 颜色和大小编码
                ['color-coding-10e', 'size-coding-10e'].forEach(id => {
                    document.getElementById(id)?.addEventListener('change', () => {
                        this.update3DSettings();
                    });
                });
                
                // 3D控制按钮
                document.getElementById('apply-3d-settings-10e')?.addEventListener('click', () => {
                    this.apply3DSettings();
                });
                
                document.getElementById('reset-3d-view-10e')?.addEventListener('click', () => {
                    this.reset3DView();
                });
                
                document.getElementById('toggle-3d-animation-10e')?.addEventListener('click', () => {
                    this.toggle3DAnimation();
                });
            }
            
            initExportHandlers() {
                // 导出报告
                document.getElementById('export-report-10e')?.addEventListener('click', () => {
                    this.exportComprehensiveReport();
                });
                
                // 导出图表
                document.getElementById('export-charts-10e')?.addEventListener('click', () => {
                    this.exportAllCharts();
                });
                
                // 单个图表导出
                const downloadButtons = [
                    'download-scatter-matrix-10e',
                    'download-bland-altman-10e',
                    'download-roc-chart-10e',
                    'download-3d-chart-10e',
                    'download-heatmap-10e'
                ];
                
                downloadButtons.forEach(id => {
                    document.getElementById(id)?.addEventListener('click', () => {
                        this.downloadChart(id.replace('download-', '').replace('-10e', ''));
                    });
                });
            }
            
            initChartInteractions() {
                // 回归线切换
                document.getElementById('toggle-regression-lines-10e')?.addEventListener('click', () => {
                    this.toggleRegressionLines();
                });
                
                // 置信带切换
                document.getElementById('toggle-confidence-bands-10e')?.addEventListener('click', () => {
                    this.toggleConfidenceBands();
                });
                
                // 最佳阈值切换
                document.getElementById('toggle-optimal-threshold-10e')?.addEventListener('click', () => {
                    this.toggleOptimalThreshold();
                });
                
                // 相关性数值切换
                document.getElementById('toggle-correlation-values-10e')?.addEventListener('click', () => {
                    this.toggleCorrelationValues();
                });
                
                // 诊断阈值选择
                document.getElementById('diagnostic-threshold-10e')?.addEventListener('change', (e) => {
                    this.updateDiagnosticThreshold(e.target.value);
                });
            }
            
            async loadModelConfigs() {
                try {
                    console.log('📊 加载模块10-E模型配置...');
                    
                    // 使用模块10-E的专用配置端点来获取包括60位成员数据集的配置
                    const response = await fetch('/api/m10e/model-configs');
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    
                    const select = document.getElementById('model-config-select-10e');
                    if (select && result.success) {
                        select.innerHTML = '<option value="">请选择...</option>';
                        
                        result.configs.forEach(config => {
                            const option = document.createElement('option');
                            option.value = config.id;
                            option.textContent = `${config.name} (${config.model_count}/5 模型)`;
                            option.disabled = !config.complete;
                            if (!config.complete) {
                                option.textContent += ' - 不完整';
                            }
                            select.appendChild(option);
                        });
                        
                        console.log(`✅ 加载了 ${result.configs.length} 个模型配置`);
                    } else {
                        console.error('❌ 配置响应格式错误:', result);
                        throw new Error(result.error || '配置数据格式错误');
                    }
                    
                } catch (error) {
                    console.error('❌ 加载模型配置失败:', error);
                    
                    // 显示错误信息给用户
                    const select = document.getElementById('model-config-select-10e');
                    if (select) {
                        select.innerHTML = '<option value="">加载失败，请刷新重试</option>';
                    }
                    
                    // 在控制台显示详细错误信息
                    console.error('详细错误信息:', {
                        message: error.message,
                        stack: error.stack
                    });
                }
            }
            
            initCharts() {
                // 初始化所有Chart.js图表
                this.initScatterMatrixChart();
                this.initBlandAltmanChart();
                this.initROCChart();
                this.initHeatmapChart();
                
                console.log('✅ 图表初始化完成');
            }
            
            initScatterMatrixChart() {
                const ctx = document.getElementById('scatter-matrix-10e');
                if (!ctx) return;
                
                this.charts['scatter-matrix'] = new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: '真实值 vs 预测值散点图矩阵'
                            },
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    title: function(context) {
                                        const point = context[0];
                                        return `样本 ${point.dataIndex + 1}`;
                                    },
                                    label: function(context) {
                                        const dataset = context.dataset;
                                        return [
                                            `组别: ${dataset.group || '未知'}`,
                                            `任务: ${dataset.task || '未知'}`,
                                            `真实值: ${context.parsed.x.toFixed(2)}`,
                                            `预测值: ${context.parsed.y.toFixed(2)}`,
                                            `残差: ${(context.parsed.y - context.parsed.x).toFixed(3)}`
                                        ];
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: '真实MMSE分数'
                                },
                                min: 0,
                                max: 30
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: '预测MMSE分数'
                                },
                                min: 0,
                                max: 30
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'point'
                        },
                        animation: {
                            duration: 1000
                        }
                    }
                });
            }
            
            initBlandAltmanChart() {
                const ctx = document.getElementById('bland-altman-chart-10e');
                if (!ctx) return;
                
                this.charts['bland-altman'] = new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Bland-Altman一致性分析'
                            },
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    title: function(context) {
                                        return `样本 ${context[0].dataIndex + 1}`;
                                    },
                                    label: function(context) {
                                        return [
                                            `平均值: ${context.parsed.x.toFixed(2)}`,
                                            `差值: ${context.parsed.y.toFixed(3)}`,
                                            `组别: ${context.dataset.group || '未知'}`
                                        ];
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: '(真实值 + 预测值) / 2'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: '预测值 - 真实值'
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'point'
                        }
                    }
                });
            }
            
            initROCChart() {
                const ctx = document.getElementById('roc-chart-10e');
                if (!ctx) return;
                
                this.charts['roc'] = new Chart(ctx, {
                    type: 'line',
                    data: {
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'ROC曲线分析'
                            },
                            legend: {
                                display: true,
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return [
                                            `假阳性率: ${context.parsed.x.toFixed(3)}`,
                                            `真阳性率: ${context.parsed.y.toFixed(3)}`,
                                            `AUC: ${context.dataset.auc || 'N/A'}`
                                        ];
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: '假阳性率 (1 - 特异度)'
                                },
                                min: 0,
                                max: 1
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: '真阳性率 (敏感度)'
                                },
                                min: 0,
                                max: 1
                            }
                        },
                        elements: {
                            point: {
                                radius: 0
                            }
                        }
                    }
                });
            }
            
            initHeatmapChart() {
                const ctx = document.getElementById('correlation-heatmap-10e');
                if (!ctx) return;
                
                // 使用Chart.js的矩阵热力图
                this.charts['heatmap'] = new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: '相关性热力图'
                            },
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    title: function(context) {
                                        const point = context[0];
                                        return `${point.dataset.xLabels[point.dataIndex]} vs ${point.dataset.yLabels[point.dataIndex]}`;
                                    },
                                    label: function(context) {
                                        return `相关系数: ${context.dataset.correlations[context.dataIndex].toFixed(3)}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                type: 'category',
                                position: 'bottom',
                                title: {
                                    display: false
                                }
                            },
                            y: {
                                type: 'category',
                                title: {
                                    display: false
                                }
                            }
                        },
                        elements: {
                            point: {
                                radius: 15,
                                hoverRadius: 20
                            }
                        }
                    }
                });
            }
            
            async performCorrelationAnalysis() {
                if (!this.currentConfig) {
                    alert('请先选择模型配置');
                    return;
                }
                
                console.log('🔍 开始关联性分析:', this.currentConfig, this.analysisType);
                
                this.showLoading();
                
                try {
                    console.log('🔍 开始真实关联性分析...');
                    
                    // 获取真实关联性分析数据
                    const response = await fetch('/api/m10e/correlation-analysis', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            config: this.currentConfig,
                            analysis_type: this.analysisType,
                            include_3d: document.getElementById('include-3d-10e')?.checked || false
                        })
                    });
                    
                    if (!response.ok) {
                        // 如果API不可用，回退到模拟数据
                        if (response.status === 404 || response.status === 500) {
                            console.log('⚠️ API不可用，使用模拟数据进行演示');
                            this.correlationData = this.generateMockCorrelationData();
                            
                            // 显示提示信息
                            setTimeout(() => {
                                alert('注意：后端API暂不可用，当前使用模拟数据进行演示。\n请检查服务器配置或模型文件是否存在。');
                            }, 500);
                        } else {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                    } else {
                        // 使用真实API数据
                        const result = await response.json();
                        
                        if (result.success) {
                            this.correlationData = result;
                            console.log('✅ 使用真实API数据');
                            console.log('📊 数据结构检查:');
                            console.log('  - correlationData:', this.correlationData);
                            console.log('  - scatter_data存在:', !!this.correlationData.scatter_data);
                            if (this.correlationData.scatter_data) {
                                console.log('  - scatter_data键:', Object.keys(this.correlationData.scatter_data));
                                console.log('  - control组数据点:', this.correlationData.scatter_data.control ? this.correlationData.scatter_data.control.length : 0);
                                console.log('  - mci组数据点:', this.correlationData.scatter_data.mci ? this.correlationData.scatter_data.mci.length : 0);
                                console.log('  - ad组数据点:', this.correlationData.scatter_data.ad ? this.correlationData.scatter_data.ad.length : 0);
                            }
                        } else {
                            throw new Error(result.error || '分析失败');
                        }
                    }
                    
                    // 更新所有可视化
                    this.updateAllVisualizations();
                    
                    // 显示结果
                    this.showResults();
                    
                    console.log('✅ 关联性分析完成');
                    
                } catch (error) {
                    console.error('❌ 关联性分析失败:', error);
                    
                    // 如果出现网络错误，尝试使用模拟数据
                    if (error.name === 'TypeError' && error.message.includes('fetch')) {
                        console.log('⚠️ 网络错误，使用模拟数据进行演示');
                        this.correlationData = this.generateMockCorrelationData();
                        this.updateAllVisualizations();
                        this.showResults();
                        
                        alert('注意：无法连接到后端API，当前使用模拟数据进行演示。\n请检查服务器是否正在运行。');
                    } else {
                        alert(`分析失败: ${error.message}`);
                    }
                } finally {
                    this.hideLoading();
                }
            }
            
            updateAllVisualizations() {
                if (!this.correlationData) {
                    console.error('没有关联数据可用于更新可视化');
                    return;
                }
                
                console.log('🎨 更新所有可视化组件');
                console.log('当前关联数据:', this.correlationData);
                
                try {
                    // 更新散点图矩阵
                    console.log('更新散点图矩阵...');
                    this.updateScatterMatrix();
                } catch (error) {
                    console.error('更新散点图矩阵失败:', error);
                }
                
                try {
                    // 更新Bland-Altman图
                    console.log('更新Bland-Altman图...');
                    this.updateBlandAltmanChart();
                } catch (error) {
                    console.error('更新Bland-Altman图失败:', error);
                }
                
                try {
                    // 更新ROC曲线
                    console.log('更新ROC曲线...');
                    this.updateROCChart();
                } catch (error) {
                    console.error('更新ROC曲线失败:', error);
                }
                
                try {
                    // 更新热力图
                    console.log('更新热力图...');
                    this.updateHeatmapChart();
                } catch (error) {
                    console.error('更新热力图失败:', error);
                }
                
                try {
                    // 更新3D图表（如果启用）
                    if (document.getElementById('include-3d-10e')?.checked) {
                        console.log('更新3D图表...');
                        this.update3DScatterPlot();
                    }
                } catch (error) {
                    console.error('更新3D图表失败:', error);
                }
                
                try {
                    // 更新统计信息
                    console.log('更新统计信息...');
                    this.updateStatistics();
                } catch (error) {
                    console.error('更新统计信息失败:', error);
                }
            }
            
            updateScatterMatrix() {
                const chart = this.charts['scatter-matrix'];
                if (!chart) {
                    console.error('散点图矩阵图表未初始化');
                    return;
                }
                
                // 检查数据是否存在
                if (!this.correlationData) {
                    console.error('关联数据不存在');
                    return;
                }
                
                if (!this.correlationData.scatter_data) {
                    console.error('散点数据不存在', this.correlationData);
                    // 尝试使用模拟数据
                    console.log('使用模拟数据进行显示');
                    this.correlationData = this.generateMockCorrelationData();
                    if (!this.correlationData.scatter_data) {
                        return;
                    }
                }
                
                const data = this.correlationData.scatter_data;
                const datasets = [];
                
                // 为每个组别创建数据集
                ['control', 'mci', 'ad'].forEach(group => {
                    if (data && data[group]) {
                        datasets.push({
                            label: this.getGroupLabel(group),
                            data: data[group].map(item => ({
                                x: item.true_score,
                                y: item.pred_score
                            })),
                            backgroundColor: this.getGroupColor(group, 0.6),
                            borderColor: this.getGroupColor(group, 1),
                            group: group,
                            task: 'all',
                            pointRadius: 4,
                            pointHoverRadius: 6
                        });
                    }
                });
                
                // 添加理想预测线 (y = x)
                datasets.push({
                    label: '理想预测线',
                    data: [{x: 0, y: 0}, {x: 30, y: 30}],
                    type: 'line',
                    borderColor: '#6c757d',
                    borderDash: [5, 5],
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: false
                });
                
                chart.data.datasets = datasets;
                chart.update();
                
                console.log('✅ 散点图矩阵更新完成');
            }
            
            updateBlandAltmanChart() {
                const chart = this.charts['bland-altman'];
                if (!chart || !this.correlationData.bland_altman) return;
                
                const data = this.correlationData.bland_altman;
                const datasets = [];
                
                // 数据点
                ['control', 'mci', 'ad'].forEach(group => {
                    if (data.points[group]) {
                        datasets.push({
                            label: this.getGroupLabel(group),
                            data: data.points[group].map(item => ({
                                x: item.mean,
                                y: item.difference
                            })),
                            backgroundColor: this.getGroupColor(group, 0.6),
                            borderColor: this.getGroupColor(group, 1),
                            group: group,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        });
                    }
                });
                
                // 添加一致性界限线
                const xRange = [data.x_min || 0, data.x_max || 30];
                
                // 平均偏差线
                datasets.push({
                    label: `平均偏差 (${data.bias.toFixed(3)})`,
                    data: [{x: xRange[0], y: data.bias}, {x: xRange[1], y: data.bias}],
                    type: 'line',
                    borderColor: '#007bff',
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: false
                });
                
                // 上下界限线
                datasets.push({
                    label: `上界限 (${data.upper_limit.toFixed(3)})`,
                    data: [{x: xRange[0], y: data.upper_limit}, {x: xRange[1], y: data.upper_limit}],
                    type: 'line',
                    borderColor: '#dc3545',
                    borderDash: [5, 5],
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: false
                });
                
                datasets.push({
                    label: `下界限 (${data.lower_limit.toFixed(3)})`,
                    data: [{x: xRange[0], y: data.lower_limit}, {x: xRange[1], y: data.lower_limit}],
                    type: 'line',
                    borderColor: '#dc3545',
                    borderDash: [5, 5],
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: false
                });
                
                chart.data.datasets = datasets;
                chart.update();
                
                // 更新统计信息
                this.updateBlandAltmanStats(data);
                
                console.log('✅ Bland-Altman图更新完成');
            }
            
            updateBlandAltmanStats(data) {
                document.getElementById('mean-bias-10e').textContent = data.bias.toFixed(3);
                document.getElementById('upper-limit-10e').textContent = data.upper_limit.toFixed(3);
                document.getElementById('lower-limit-10e').textContent = data.lower_limit.toFixed(3);
                document.getElementById('within-limits-10e').textContent = (data.within_limits * 100).toFixed(1);
                document.getElementById('concordance-10e').textContent = (data.concordance || 0).toFixed(3);
            }
            
            updateROCChart() {
                const chart = this.charts['roc'];
                if (!chart || !this.correlationData.roc_data) return;
                
                const data = this.correlationData.roc_data;
                const datasets = [];
                
                // ROC曲线
                datasets.push({
                    label: `ROC曲线 (AUC = ${data.auc.toFixed(3)})`,
                    data: data.fpr.map((fpr, i) => ({
                        x: fpr,
                        y: data.tpr[i]
                    })),
                    borderColor: '#28a745',
                    backgroundColor: 'rgba(40, 167, 69, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    auc: data.auc,
                    tension: 0.1
                });
                
                // 随机分类线
                datasets.push({
                    label: '随机分类',
                    data: [{x: 0, y: 0}, {x: 1, y: 1}],
                    borderColor: '#6c757d',
                    borderDash: [5, 5],
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: false
                });
                
                // 最佳阈值点（如果有）
                if (data.optimal_threshold) {
                    const optimalPoint = data.optimal_threshold;
                    datasets.push({
                        label: `最佳阈值 (${optimalPoint.threshold.toFixed(2)})`,
                        data: [{
                            x: optimalPoint.fpr,
                            y: optimalPoint.tpr
                        }],
                        backgroundColor: '#ffc107',
                        borderColor: '#ffc107',
                        pointRadius: 8,
                        pointHoverRadius: 10,
                        showLine: false
                    });
                }
                
                chart.data.datasets = datasets;
                chart.update();
                
                // 更新诊断指标
                this.updateDiagnosticMetrics(data);
                
                console.log('✅ ROC曲线更新完成');
            }
            
            updateDiagnosticMetrics(data) {
                document.getElementById('auc-value-10e').textContent = data.auc.toFixed(3);
                
                if (data.metrics) {
                    document.getElementById('sensitivity-10e').textContent = (data.metrics.sensitivity * 100).toFixed(1);
                    document.getElementById('specificity-10e').textContent = (data.metrics.specificity * 100).toFixed(1);
                    document.getElementById('accuracy-10e').textContent = (data.metrics.accuracy * 100).toFixed(1);
                    document.getElementById('youden-index-10e').textContent = data.metrics.youden_index.toFixed(3);
                }
            }
            
            updateHeatmapChart() {
                const chart = this.charts['heatmap'];
                if (!chart || !this.correlationData.correlation_matrix) return;
                
                const heatmapType = document.querySelector('input[name="heatmap-type-10e"]:checked')?.value || 'task';
                const matrixData = this.correlationData.correlation_matrix[heatmapType];
                
                if (!matrixData) return;
                
                // 转换矩阵数据为散点数据
                const datasets = [{
                    label: '相关系数',
                    data: [],
                    backgroundColor: [],
                    borderColor: [],
                    xLabels: matrixData.labels,
                    yLabels: matrixData.labels,
                    correlations: []
                }];
                
                // 生成热力图数据点
                matrixData.matrix.forEach((row, i) => {
                    row.forEach((value, j) => {
                        datasets[0].data.push({x: j, y: i});
                        datasets[0].correlations.push(value);
                        
                        // 颜色映射 (-1到1)
                        const color = this.getCorrelationColor(value);
                        datasets[0].backgroundColor.push(color);
                        datasets[0].borderColor.push(color);
                    });
                });
                
                chart.data.datasets = datasets;
                chart.options.scales.x.labels = matrixData.labels;
                chart.options.scales.y.labels = matrixData.labels;
                chart.update();
                
                console.log('✅ 热力图更新完成');
            }
            
            update3DScatterPlot() {
                if (!this.correlationData.scatter_3d) return;
                
                const container = document.getElementById('3d-scatter-container-10e');
                if (!container) return;
                
                const data = this.correlationData.scatter_3d;
                
                // 准备Plotly数据
                const traces = [];
                
                ['control', 'mci', 'ad'].forEach(group => {
                    if (data[group]) {
                        traces.push({
                            x: data[group].map(item => item.true_score),
                            y: data[group].map(item => item.pred_score),
                            z: data[group].map(item => item.abs_error),
                            mode: 'markers',
                            type: 'scatter3d',
                            name: this.getGroupLabel(group),
                            marker: {
                                color: this.getGroupColor(group, 1),
                                size: 5,
                                opacity: 0.8
                            },
                            text: data[group].map((item, i) => 
                                `样本 ${i+1}<br>组别: ${this.getGroupLabel(group)}<br>真实值: ${item.true_score.toFixed(2)}<br>预测值: ${item.pred_score.toFixed(2)}<br>绝对误差: ${item.abs_error.toFixed(3)}`
                            ),
                            hovertemplate: '%{text}<extra></extra>'
                        });
                    }
                });
                
                const layout = {
                    title: '3D关联性分析',
                    scene: {
                        xaxis: { title: '真实MMSE分数' },
                        yaxis: { title: '预测MMSE分数' },
                        zaxis: { title: '绝对误差' },
                        camera: {
                            eye: { x: 1.5, y: 1.5, z: 1.5 }
                        }
                    },
                    margin: { l: 0, r: 0, b: 0, t: 30 }
                };
                
                // 使用Plotly渲染3D图表
                if (typeof Plotly !== 'undefined') {
                    Plotly.newPlot(container, traces, layout);
                    this.plotly3D = container;
                } else {
                    console.warn('⚠️ Plotly.js未加载，无法显示3D图表');
                    container.innerHTML = '<div class="alert alert-warning">3D图表需要Plotly.js库支持</div>';
                }
                
                console.log('✅ 3D散点图更新完成');
            }
            
            updateStatistics() {
                if (!this.correlationData.statistics) return;
                
                const stats = this.correlationData.statistics;
                
                // 更新总体相关性
                document.getElementById('overall-r2-10e').textContent = (stats.overall.r2 || 0).toFixed(3);
                document.getElementById('overall-p-value-10e').textContent = (stats.overall.p_value || 0).toFixed(4);
                
                // 更新各组相关性
                ['control', 'mci', 'ad'].forEach(group => {
                    if (stats[group]) {
                        document.getElementById(`${group}-r2-10e`).textContent = (stats[group].r2 || 0).toFixed(3);
                        document.getElementById(`${group}-rmse-10e`).textContent = (stats[group].rmse || 0).toFixed(3);
                    }
                });
                
                console.log('✅ 统计信息更新完成');
            }
            
            // 模拟数据生成方法
            generateMockCorrelationData() {
                console.log('🎲 生成模拟关联性分析数据');
                
                // 生成模拟的散点图数据
                const scatterData = {};
                ['control', 'mci', 'ad'].forEach(group => {
                    scatterData[group] = [];
                    const sampleCount = 20;
                    
                    for (let i = 0; i < sampleCount; i++) {
                        // 为不同组别生成不同特征的数据
                        let baseScore, noise;
                        switch (group) {
                            case 'control':
                                baseScore = 25 + Math.random() * 5; // 25-30分
                                noise = 0.5;
                                break;
                            case 'mci':
                                baseScore = 18 + Math.random() * 8; // 18-26分
                                noise = 1.0;
                                break;
                            case 'ad':
                                baseScore = 8 + Math.random() * 12; // 8-20分
                                noise = 1.5;
                                break;
                        }
                        
                        const trueScore = Math.max(0, Math.min(30, baseScore));
                        const predScore = Math.max(0, Math.min(30, trueScore + (Math.random() - 0.5) * 2 * noise));
                        
                        scatterData[group].push({
                            true_score: trueScore,
                            pred_score: predScore,
                            abs_error: Math.abs(predScore - trueScore),
                            sample_id: i + 1
                        });
                    }
                });
                
                // 生成Bland-Altman数据
                const blandAltmanData = {
                    points: {},
                    bias: 0.05,
                    upper_limit: 2.1,
                    lower_limit: -2.0,
                    within_limits: 0.95,
                    concordance: 0.85,
                    x_min: 5,
                    x_max: 30
                };
                
                Object.keys(scatterData).forEach(group => {
                    blandAltmanData.points[group] = scatterData[group].map(item => ({
                        mean: (item.true_score + item.pred_score) / 2,
                        difference: item.pred_score - item.true_score
                    }));
                });
                
                // 生成ROC数据
                const rocData = {
                    fpr: [],
                    tpr: [],
                    auc: 0.85,
                    optimal_threshold: {
                        threshold: 24,
                        fpr: 0.15,
                        tpr: 0.82
                    },
                    metrics: {
                        sensitivity: 0.82,
                        specificity: 0.85,
                        accuracy: 0.83,
                        youden_index: 0.67
                    }
                };
                
                // 生成ROC曲线点
                for (let i = 0; i <= 100; i++) {
                    const t = i / 100;
                    rocData.fpr.push(t);
                    rocData.tpr.push(Math.min(1, Math.pow(t, 0.3) + Math.random() * 0.1));
                }
                
                // 生成相关性矩阵
                const correlationMatrix = {
                    task: {
                        labels: ['Q1', 'Q2', 'Q3', 'Q4', 'Q5'],
                        matrix: [
                            [1.0, 0.65, 0.58, 0.72, 0.61],
                            [0.65, 1.0, 0.71, 0.68, 0.59],
                            [0.58, 0.71, 1.0, 0.63, 0.55],
                            [0.72, 0.68, 0.63, 1.0, 0.69],
                            [0.61, 0.59, 0.55, 0.69, 1.0]
                        ]
                    },
                    feature: {
                        labels: ['游戏时长', '关键词注视', '指令注视', 'RQA递归率', 'RQA确定性', 'RQA熵值', '注视次数', '扫视次数', '平均注视时长', '扫视速度'],
                        matrix: Array(10).fill().map((_, i) => 
                            Array(10).fill().map((_, j) => 
                                i === j ? 1.0 : (Math.random() - 0.5) * 1.8
                            )
                        )
                    }
                };
                
                // 生成3D散点图数据
                const scatter3D = {};
                Object.keys(scatterData).forEach(group => {
                    scatter3D[group] = scatterData[group];
                });
                
                // 生成统计信息
                const statistics = {
                    overall: {
                        r2: 0.78,
                        p_value: 0.001
                    },
                    control: {
                        r2: 0.85,
                        rmse: 0.8
                    },
                    mci: {
                        r2: 0.72,
                        rmse: 1.2
                    },
                    ad: {
                        r2: 0.68,
                        rmse: 1.5
                    }
                };
                
                return {
                    scatter_data: scatterData,
                    bland_altman: blandAltmanData,
                    roc_data: rocData,
                    correlation_matrix: correlationMatrix,
                    scatter_3d: scatter3D,
                    statistics: statistics
                };
            }
            
            // 辅助方法
            getGroupLabel(group) {
                const labels = {
                    zh: {
                        'control': '对照组',
                        'mci': 'MCI组',
                        'ad': 'AD组'
                    },
                    en: {
                        'control': 'Control',
                        'mci': 'MCI',
                        'ad': 'AD'
                    }
                };
                return labels[currentLanguage] ? labels[currentLanguage][group] || group : group;
            }
            
            getGroupColor(group, alpha = 1) {
                const colors = {
                    'control': `rgba(40, 167, 69, ${alpha})`,   // 绿色
                    'mci': `rgba(255, 193, 7, ${alpha})`,       // 黄色
                    'ad': `rgba(220, 53, 69, ${alpha})`         // 红色
                };
                return colors[group] || `rgba(108, 117, 125, ${alpha})`;
            }
            
            getCorrelationColor(value) {
                // 将相关系数(-1到1)映射到颜色
                const normalized = (value + 1) / 2; // 转换到0-1范围
                
                if (normalized < 0.5) {
                    // 负相关：红色渐变
                    const intensity = (0.5 - normalized) * 2;
                    return `rgba(215, 48, 39, ${intensity})`;
                } else {
                    // 正相关：蓝色渐变
                    const intensity = (normalized - 0.5) * 2;
                    return `rgba(49, 54, 149, ${intensity})`;
                }
            }
            
            // 交互控制方法
            filterScatterMatrix(group) {
                const chart = this.charts['scatter-matrix'];
                if (!chart) return;
                
                chart.data.datasets.forEach(dataset => {
                    if (dataset.group) {
                        dataset.hidden = group !== 'all' && dataset.group !== group;
                    }
                });
                
                chart.update();
                console.log(`🔍 散点图筛选: ${group}`);
            }
            
            updateFilterButtons(activeBtn, selector) {
                document.querySelectorAll(selector).forEach(btn => {
                    btn.classList.remove('active');
                });
                activeBtn.classList.add('active');
            }
            
            updateHeatmapType(type) {
                console.log(`🔥 切换热力图类型: ${type}`);
                this.updateHeatmapChart();
            }
            
            toggle3DVisualization(enabled) {
                const container = document.getElementById('3d-visualization-10e');
                if (container) {
                    container.style.display = enabled ? 'block' : 'none';
                }
                console.log(`🎲 3D可视化: ${enabled ? '启用' : '禁用'}`);
            }
            
            // 显示/隐藏方法
            showLoading() {
                document.getElementById('loading-10e').style.display = 'block';
                document.getElementById('empty-state-10e').style.display = 'none';
                document.getElementById('correlation-results-10e').style.display = 'none';
            }
            
            hideLoading() {
                document.getElementById('loading-10e').style.display = 'none';
            }
            
            showResults() {
                document.getElementById('empty-state-10e').style.display = 'none';
                document.getElementById('correlation-results-10e').style.display = 'block';
            }
            
            updateAnalysisButton() {
                const btn = document.getElementById('analyze-correlation-10e');
                if (btn) {
                    btn.disabled = !this.currentConfig;
                }
            }
            
            updateVisualizationOptions() {
                // 根据分析类型调整可视化选项
                const include3D = document.getElementById('include-3d-10e');
                if (include3D) {
                    include3D.disabled = this.analysisType === 'diagnostic';
                }
            }
            
            // 图表交互方法
            toggleRegressionLines() {
                console.log('📈 切换回归线显示');
                // 实现回归线切换逻辑
                alert('回归线切换功能开发中...');
            }
            
            toggleConfidenceBands() {
                console.log('📊 切换置信带显示');
                // 实现置信带切换逻辑
                alert('置信带切换功能开发中...');
            }
            
            toggleOptimalThreshold() {
                console.log('🎯 切换最佳阈值显示');
                // 实现最佳阈值切换逻辑
                alert('最佳阈值切换功能开发中...');
            }
            
            toggleCorrelationValues() {
                console.log('🔢 切换相关性数值显示');
                // 实现相关性数值切换逻辑
                alert('相关性数值切换功能开发中...');
            }
            
            updateDiagnosticThreshold(threshold) {
                console.log(`🎚️ 更新诊断阈值: ${threshold}`);
                // 重新计算诊断指标
                if (this.correlationData && this.correlationData.roc_data) {
                    // 这里应该重新计算ROC指标
                    alert(`诊断阈值更新为: ${threshold}`);
                }
            }
            
            // 3D控制方法
            update3DSettings() {
                console.log('🎛️ 更新3D设置');
                // 更新3D图表设置但不重新渲染
            }
            
            apply3DSettings() {
                console.log('✅ 应用3D设置');
                if (this.correlationData && this.correlationData.scatter_3d) {
                    this.update3DScatterPlot();
                }
            }
            
            reset3DView() {
                console.log('🔄 重置3D视角');
                if (this.plotly3D && typeof Plotly !== 'undefined') {
                    const layout = {
                        scene: {
                            camera: {
                                eye: { x: 1.5, y: 1.5, z: 1.5 }
                            }
                        }
                    };
                    Plotly.relayout(this.plotly3D, layout);
                }
            }
            
            toggle3DAnimation() {
                console.log('🎬 切换3D动画');
                // 实现3D自动旋转动画
                alert('3D动画切换功能开发中...');
            }
            
            // 导出功能（占位符实现）
            async exportComprehensiveReport() {
                console.log('📄 导出综合报告');
                alert('综合报告导出功能开发中...');
            }
            
            async exportAllCharts() {
                console.log('📊 导出所有图表');
                alert('图表导出功能开发中...');
            }
            
            downloadChart(chartType) {
                console.log(`💾 下载图表: ${chartType}`);
                
                const chart = this.charts[chartType.replace('-', '_')];
                if (chart) {
                    const url = chart.toBase64Image();
                    const link = document.createElement('a');
                    link.download = `${chartType}-${Date.now()}.png`;
                    link.href = url;
                    link.click();
                } else {
                    alert('图表下载功能开发中...');
                }
            }
        }
        
        // 全局管理器实例
        let module10EManager = null;
        
        // 初始化模块10-E管理器
        function initModule10E() {
            console.log('🚀 初始化模块10-E管理器');
            
            try {
                if (!module10EManager) {
                    module10EManager = new Module10EManager();
                    console.log('✅ 模块10-E管理器实例创建成功');
                } else {
                    console.log('ℹ️ 模块10-E管理器已存在，重新初始化');
                }
                
                module10EManager.init();
                console.log('✅ 模块10-E初始化完成');
                
            } catch (error) {
                console.error('❌ 模块10-E初始化失败:', error);
                console.error('错误堆栈:', error.stack);
            }
        }
        
        console.log('🎨 模块10-E MMSE预测关联性深度可视化模块脚本加载完成');
        // ================= 模块10-E：MMSE预测关联性深度可视化 JavaScript 代码结束 =================
        
        // 全局调试函数 - 用户可在控制台调用
        window.debugModule10E = function() {
            console.log('🔧 模块10-E调试工具');
            
            if (!module10EManager) {
                console.log('❌ Module10EManager未初始化');
                return;
            }
            
            console.log('📊 管理器状态:', {
                currentConfig: module10EManager.currentConfig,
                hasCorrelationData: !!module10EManager.correlationData,
                chartsCount: Object.keys(module10EManager.charts).length,
                analysisType: module10EManager.analysisType
            });
            
            // 检查图表状态
            console.log('📈 图表状态:');
            Object.keys(module10EManager.charts).forEach(chartName => {
                const chart = module10EManager.charts[chartName];
                console.log(`  - ${chartName}:`, {
                    initialized: !!chart,
                    datasetsCount: chart ? chart.data.datasets.length : 0
                });
            });
            
            // 检查3D图表
            console.log('🎲 3D图表状态:', {
                plotly3DInitialized: !!module10EManager.plotly3D,
                plotlyLoaded: typeof Plotly !== 'undefined'
            });
            
            // 检查UI元素
            const uiElements = [
                'model-config-select-10e',
                'analysis-type-10e',
                'analyze-correlation-10e',
                'scatter-matrix-10e',
                'bland-altman-chart-10e',
                'roc-chart-10e',
                'correlation-heatmap-10e',
                '3d-scatter-container-10e'
            ];
            
            console.log('🎨 UI元素状态:');
            uiElements.forEach(id => {
                const element = document.getElementById(id);
                console.log(`  - ${id}:`, !!element);
            });
        };
        
        window.debugModule10D = function() {
            console.log('🔧 模块10-D调试工具');
            
            if (!module10DManager) {
                console.log('❌ Module10DManager未初始化');
                return;
            }
            
            console.log('📊 管理器状态:', {
                currentConfig: module10DManager.currentConfig,
                hasPerformanceData: !!module10DManager.performanceData,
                chartsCount: Object.keys(module10DManager.charts).length
            });
            
            // 调用内部调试函数
            if (typeof module10DManager.debugChartState === 'function') {
                module10DManager.debugChartState();
            }
            
            // 检查按钮状态
            const filterBtns = document.querySelectorAll('.group-filter-10d');
            console.log(`🎛️ 筛选按钮数量: ${filterBtns.length}`);
            filterBtns.forEach((btn, index) => {
                console.log(`  按钮${index + 1}: ${btn.dataset.group}, 激活=${btn.classList.contains('active')}`);
            });
        };
        
        console.log('👁️ 模块10 Eye-Index 综合评估模块脚本加载完成');
        console.log('💡 提示: 在控制台输入 debugModule10D() 或 debugModule10E() 可查看调试信息');
        console.log('🎨 模块10-E 当前使用模拟数据进行演示，实际API开发中...');
        // ================= 模块10：Eye-Index 综合评估 JavaScript 代码结束 =================
            

        
        </script>
    </body>
</html> 